<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 01059107-1a0b-4a58-a80c-cd4a28ae06a1 (2026-01-21 09:54Z) -->

# Electron devtool 啟動時顯示問題 (2026-01-21 09:54Z)

_**User**_

electron 程式啟動時為何會有 devtool 顯示？如何關閉 devtool 

---

_**Agent (model default, mode Agent)**_


檢查 Electron 主程式設定，找出 devtools 在啟動時顯示的原因，並提供關閉方法。


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: d:\_Code\_GitHub\eigent-260119\electron\main\index.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How is devtools opened or enabled in Electron main process?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 1797,
            "column": 2
          },
          "endPosition": {
            "line": 1918,
            "column": 1
          }
        },
        "contents": "// ==================== app event handle ====================\napp.whenReady().then(async () =&gt; {\n  // Wait for profile initialization to complete\n  log.info('[MAIN] Waiting for profile initialization...');\n  try {\n    await profileInitPromise;\n    log.info('[MAIN] Profile initialization completed');\n  } catch (error) {\n    log.error('[MAIN] Profile initialization failed:', error);\n  }\n\n  // ==================== install React DevTools ====================\n  // Only install in development mode\n  if (VITE_DEV_SERVER_URL) {\n    try {\n      log.info('[DEVTOOLS] Installing React DevTools extension...');\n      // Dynamic import to avoid bundling in production\n      const { default: installExtension, REACT_DEVELOPER_TOOLS } = await import(\n        'electron-devtools-installer'\n      );\n      const name = await installExtension(REACT_DEVELOPER_TOOLS, {\n        loadExtensionOptions: { allowFileAccess: true },\n      });\n      log.info(&#96;[DEVTOOLS] Successfully installed extension: ${name}&#96;);\n    } catch (err) {\n      log.error('[DEVTOOLS] Failed to install React DevTools:', err);\n      // Don't throw - allow app to continue even if extension installation fails\n    }\n  }\n\n  // ==================== download handle ====================\n  session.defaultSession.on('will-download', (event, item, webContents) =&gt; {\n    item.once('done', (event, state) =&gt; {\n      shell.showItemInFolder(item.getURL().replace('localfile://', ''));\n    });\n  });\n\n  // ==================== protocol handle ====================\n  // Register protocol handler for both default session and main window session\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "// ==================== app event handle ====================",
            "lineNumber": 1800
          },
          {
            "text": "app.whenReady().then(async () =&gt; {",
            "lineNumber": 1801
          },
          {
            "text": "  // Wait for profile initialization to complete",
            "lineNumber": 1802
          },
          {
            "text": "  log.info('[MAIN] Waiting for profile initialization...');",
            "lineNumber": 1803
          },
          {
            "text": "  try {",
            "lineNumber": 1804
          },
          {
            "text": "    await profileInitPromise;",
            "lineNumber": 1805
          },
          {
            "text": "    log.info('[MAIN] Profile initialization completed');",
            "lineNumber": 1806
          },
          {
            "text": "  } catch (error) {",
            "lineNumber": 1807
          },
          {
            "text": "    log.error('[MAIN] Profile initialization failed:', error);",
            "lineNumber": 1808
          },
          {
            "text": "  }",
            "lineNumber": 1809
          },
          {
            "lineNumber": 1810
          },
          {
            "text": "  // ==================== install React DevTools ====================",
            "lineNumber": 1811
          },
          {
            "text": "  // Only install in development mode",
            "lineNumber": 1812
          },
          {
            "text": "  if (VITE_DEV_SERVER_URL) {",
            "lineNumber": 1813
          },
          {
            "text": "    try {",
            "lineNumber": 1814
          },
          {
            "text": "      log.info('[DEVTOOLS] Installing React DevTools extension...');",
            "lineNumber": 1815
          },
          {
            "text": "      // Dynamic import to avoid bundling in production",
            "lineNumber": 1816
          },
          {
            "text": "      const { default: installExtension, REACT_DEVELOPER_TOOLS } = await import(",
            "lineNumber": 1817
          },
          {
            "text": "        'electron-devtools-installer'",
            "lineNumber": 1818
          },
          {
            "text": "      );",
            "lineNumber": 1819
          },
          {
            "text": "      const name = await installExtension(REACT_DEVELOPER_TOOLS, {",
            "lineNumber": 1820
          },
          {
            "text": "        loadExtensionOptions: { allowFileAccess: true },",
            "lineNumber": 1821
          },
          {
            "text": "      });",
            "lineNumber": 1822
          },
          {
            "text": "      log.info(&#96;[DEVTOOLS] Successfully installed extension: ${name}&#96;);",
            "lineNumber": 1823
          },
          {
            "text": "    } catch (err) {",
            "lineNumber": 1824
          },
          {
            "text": "      log.error('[DEVTOOLS] Failed to install React DevTools:', err);",
            "lineNumber": 1825
          },
          {
            "text": "      // Don't throw - allow app to continue even if extension installation fails",
            "lineNumber": 1826
          },
          {
            "text": "    }",
            "lineNumber": 1827
          },
          {
            "text": "  }",
            "lineNumber": 1828
          },
          {
            "lineNumber": 1829
          },
          {
            "text": "  // ==================== download handle ====================",
            "lineNumber": 1830
          },
          {
            "text": "  session.defaultSession.on('will-download', (event, item, webContents) =&gt; {",
            "lineNumber": 1831
          },
          {
            "text": "    item.once('done', (event, state) =&gt; {",
            "lineNumber": 1832
          },
          {
            "text": "      shell.showItemInFolder(item.getURL().replace('localfile://', ''));",
            "lineNumber": 1833
          },
          {
            "text": "    });",
            "lineNumber": 1834
          },
          {
            "text": "  });",
            "lineNumber": 1835
          },
          {
            "lineNumber": 1836
          },
          {
            "text": "  // ==================== protocol handle ====================",
            "lineNumber": 1837
          },
          {
            "text": "  // Register protocol handler for both default session and main window session",
            "lineNumber": 1838
          },
          {
            "text": "}",
            "lineNumber": 1919
          }
        ]
      },
      "score": 0.557120144367218
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 1577,
            "column": 2
          },
          "endPosition": {
            "line": 1655,
            "column": 1
          }
        },
        "contents": "// ==================== devtools shortcuts ====================\nconst setupDevToolsShortcuts = () =&gt; {\n  if (!win) return;\n\n  const toggleDevTools = () =&gt; win?.webContents.toggleDevTools();\n\n  win.webContents.on('before-input-event', (event, input) =&gt; {\n    // F12 key\n    if (input.key === 'F12' &amp;&amp; input.type === 'keyDown') {\n      toggleDevTools();\n    }\n\n    // Ctrl+Shift+I (Windows/Linux) or Cmd+Shift+I (Mac)\n    if (\n      input.control &amp;&amp;\n      input.shift &amp;&amp;\n      input.key.toLowerCase() === 'i' &amp;&amp;\n      input.type === 'keyDown'\n    ) {\n      toggleDevTools();\n    }\n\n    // Mac Cmd+Shift+I\n    if (\n      input.meta &amp;&amp;\n      input.shift &amp;&amp;\n      input.key.toLowerCase() === 'i' &amp;&amp;\n      input.type === 'keyDown'\n    ) {\n      toggleDevTools();\n    }\n  });\n};\n\n// ==================== external link handle ====================\nconst setupExternalLinkHandling = ()\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "// ==================== devtools shortcuts ====================",
            "lineNumber": 1580
          },
          {
            "text": "const setupDevToolsShortcuts = () =&gt; {",
            "lineNumber": 1581
          },
          {
            "text": "  if (!win) return;",
            "lineNumber": 1582
          },
          {
            "lineNumber": 1583
          },
          {
            "text": "  const toggleDevTools = () =&gt; win?.webContents.toggleDevTools();",
            "lineNumber": 1584
          },
          {
            "lineNumber": 1585
          },
          {
            "text": "  win.webContents.on('before-input-event', (event, input) =&gt; {",
            "lineNumber": 1586
          },
          {
            "text": "    // F12 key",
            "lineNumber": 1587
          },
          {
            "text": "    if (input.key === 'F12' &amp;&amp; input.type === 'keyDown') {",
            "lineNumber": 1588
          },
          {
            "text": "      toggleDevTools();",
            "lineNumber": 1589
          },
          {
            "text": "    }",
            "lineNumber": 1590
          },
          {
            "lineNumber": 1591
          },
          {
            "text": "    // Ctrl+Shift+I (Windows/Linux) or Cmd+Shift+I (Mac)",
            "lineNumber": 1592
          },
          {
            "text": "    if (",
            "lineNumber": 1593
          },
          {
            "text": "      input.control &amp;&amp;",
            "lineNumber": 1594
          },
          {
            "text": "      input.shift &amp;&amp;",
            "lineNumber": 1595
          },
          {
            "text": "      input.key.toLowerCase() === 'i' &amp;&amp;",
            "lineNumber": 1596
          },
          {
            "text": "      input.type === 'keyDown'",
            "lineNumber": 1597
          },
          {
            "text": "    ) {",
            "lineNumber": 1598
          },
          {
            "text": "      toggleDevTools();",
            "lineNumber": 1599
          },
          {
            "text": "    }",
            "lineNumber": 1600
          },
          {
            "lineNumber": 1601
          },
          {
            "text": "    // Mac Cmd+Shift+I",
            "lineNumber": 1602
          },
          {
            "text": "    if (",
            "lineNumber": 1603
          },
          {
            "text": "      input.meta &amp;&amp;",
            "lineNumber": 1604
          },
          {
            "text": "      input.shift &amp;&amp;",
            "lineNumber": 1605
          },
          {
            "text": "      input.key.toLowerCase() === 'i' &amp;&amp;",
            "lineNumber": 1606
          },
          {
            "text": "      input.type === 'keyDown'",
            "lineNumber": 1607
          },
          {
            "text": "    ) {",
            "lineNumber": 1608
          },
          {
            "text": "      toggleDevTools();",
            "lineNumber": 1609
          },
          {
            "text": "    }",
            "lineNumber": 1610
          },
          {
            "text": "  });",
            "lineNumber": 1611
          },
          {
            "text": "};",
            "lineNumber": 1612
          },
          {
            "lineNumber": 1613
          },
          {
            "text": "// ==================== external link handle ====================",
            "lineNumber": 1614
          },
          {
            "text": "const setupExternalLinkHandling = ()",
            "lineNumber": 1615
          },
          {
            "text": ";",
            "lineNumber": 1656
          }
        ]
      },
      "score": 0.541395366191864
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 127,
            "column": 3
          },
          "endPosition": {
            "line": 181,
            "column": 1
          }
        },
        "contents": "// ==================== app config ====================\nprocess.env.APP_ROOT = MAIN_DIST;\nprocess.env.VITE_PUBLIC = VITE_PUBLIC;\n\n// Disable system theme\nnativeTheme.themeSource = 'light';\n\n// Set log level\nlog.transports.console.level = 'info';\nlog.transports.file.level = 'info';\nlog.transports.console.format = '[{level}]{text}';\nlog.transports.file.format = '[{level}]{text}';\n\n// Disable GPU Acceleration for Windows 7\nif (os.release().startsWith('6.1')) app.disableHardwareAcceleration();\n\n// Set application name for Windows 10+ notifications\nif (process.platform === 'win32') app.setAppUserModelId(app.getName());\n\nif (!app.requestSingleInstanceLock()) {\n  app.quit();\n  process.exit(0);\n}\n\n// ==================== protocol config ====================\nconst setupProtocolHandlers = () =&gt; {\n  if (process.env.NODE_ENV === 'development') {\n    const isDefault = app.isDefaultProtocolClient('eigent', process.execPath, [\n      path.resolve(process.argv[1]),\n    ]);\n    if (!isDefault) {\n      app.setAsDefaultProtocolClient('eigent', process.execPath, [\n        path.resolve(process.argv[1]),\n      ]);\n    }\n  } else {\n    app.setAsDefaultProtocolClient('eigent');\n  }\n};\n\n// ==================== protocol url handle ====================\nfunction handleProtocolUrl(url: string) {\n  log.info('enter handleProtocolUrl', url);\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "// ==================== app config ====================",
            "lineNumber": 130
          },
          {
            "text": "process.env.APP_ROOT = MAIN_DIST;",
            "lineNumber": 131
          },
          {
            "text": "process.env.VITE_PUBLIC = VITE_PUBLIC;",
            "lineNumber": 132
          },
          {
            "lineNumber": 133
          },
          {
            "text": "// Disable system theme",
            "lineNumber": 134
          },
          {
            "text": "nativeTheme.themeSource = 'light';",
            "lineNumber": 135
          },
          {
            "lineNumber": 136
          },
          {
            "text": "// Set log level",
            "lineNumber": 137
          },
          {
            "text": "log.transports.console.level = 'info';",
            "lineNumber": 138
          },
          {
            "text": "log.transports.file.level = 'info';",
            "lineNumber": 139
          },
          {
            "text": "log.transports.console.format = '[{level}]{text}';",
            "lineNumber": 140
          },
          {
            "text": "log.transports.file.format = '[{level}]{text}';",
            "lineNumber": 141
          },
          {
            "lineNumber": 142
          },
          {
            "text": "// Disable GPU Acceleration for Windows 7",
            "lineNumber": 143
          },
          {
            "text": "if (os.release().startsWith('6.1')) app.disableHardwareAcceleration();",
            "lineNumber": 144
          },
          {
            "lineNumber": 145
          },
          {
            "text": "// Set application name for Windows 10+ notifications",
            "lineNumber": 146
          },
          {
            "text": "if (process.platform === 'win32') app.setAppUserModelId(app.getName());",
            "lineNumber": 147
          },
          {
            "lineNumber": 148
          },
          {
            "text": "if (!app.requestSingleInstanceLock()) {",
            "lineNumber": 149
          },
          {
            "text": "  app.quit();",
            "lineNumber": 150
          },
          {
            "text": "  process.exit(0);",
            "lineNumber": 151
          },
          {
            "text": "}",
            "lineNumber": 152
          },
          {
            "lineNumber": 153
          },
          {
            "text": "// ==================== protocol config ====================",
            "lineNumber": 154
          },
          {
            "text": "const setupProtocolHandlers = () =&gt; {",
            "lineNumber": 155
          },
          {
            "text": "  if (process.env.NODE_ENV === 'development') {",
            "lineNumber": 156
          },
          {
            "text": "    const isDefault = app.isDefaultProtocolClient('eigent', process.execPath, [",
            "lineNumber": 157
          },
          {
            "text": "      path.resolve(process.argv[1]),",
            "lineNumber": 158
          },
          {
            "text": "    ]);",
            "lineNumber": 159
          },
          {
            "text": "    if (!isDefault) {",
            "lineNumber": 160
          },
          {
            "text": "      app.setAsDefaultProtocolClient('eigent', process.execPath, [",
            "lineNumber": 161
          },
          {
            "text": "        path.resolve(process.argv[1]),",
            "lineNumber": 162
          },
          {
            "text": "      ]);",
            "lineNumber": 163
          },
          {
            "text": "    }",
            "lineNumber": 164
          },
          {
            "text": "  } else {",
            "lineNumber": 165
          },
          {
            "text": "    app.setAsDefaultProtocolClient('eigent');",
            "lineNumber": 166
          },
          {
            "text": "  }",
            "lineNumber": 167
          },
          {
            "text": "};",
            "lineNumber": 168
          },
          {
            "lineNumber": 169
          },
          {
            "text": "// ==================== protocol url handle ====================",
            "lineNumber": 170
          },
          {
            "text": "function handleProtocolUrl(url: string) {",
            "lineNumber": 171,
            "isSignature": true
          },
          {
            "text": "  log.info('enter handleProtocolUrl', url);",
            "lineNumber": 172
          },
          {
            "text": "}",
            "lineNumber": 182,
            "isSignature": true
          }
        ]
      },
      "score": 0.5019800066947937
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 1227
          },
          "endPosition": {
            "line": 1569,
            "column": 1
          }
        },
        "contents": "async function createWindow() {\n() =&gt; {\n\n(err) =&gt; {\n\n        });\n    });\n  } else {\n    // The proper flow is now handled by useInstallationSetup.ts with dual-check mechanism:\n    // 1. Installation complete event → installationCompleted.current = true\n    // 2. Backend ready event → backendReady.current = true\n    // 3. Only when BOTH are true → setInitState('done')\n    //\n    // This ensures frontend never shows before backend is ready.\n    log.info(\n      'Installation already complete - letting useInstallationSetup handle state transitions'\n    );\n  }\n\n  // Load content\n  if (VITE_DEV_SERVER_URL) {\n    win.loadURL(VITE_DEV_SERVER_URL);\n    win.webContents.openDevTools();\n  } else {\n    win.loadFile(indexHtml);\n  }\n\n  // Wait for window to be ready\n  await new Promise&lt;void&gt;((resolve) =&gt; {\n    win!.webContents.once('did-finish-load', () =&gt; {\n      log.info(\n        'Window content loaded, starting dependency check immediately...'\n      );\n      resolve();\n    });\n  });\n\n  // Mark window as ready and process any queued protocol URLs\n  isWindowReady = true;\n  log.info('Window is ready, processing queued protocol URLs...');\n  processQueuedProtocolUrls();\n\n  // Wait for React components to mount and register event listeners\n  await new Promise((resolve) =&gt; setTimeout(resolve, 500));\n\n  // Now check and install dependencies\n  let res: PromiseReturnType = await checkAndInstallDepsOnUpdate({ win });\n  if (!res.success) {\n    log.info('[DEPS INSTALL] Dependency Error: ', res.message);\n    // Note: install-dependencies-complete failure event is already sent by installDependencies function\n    // in install-deps.ts, so we don't send it again here to avoid duplicate events\n    return;\n  }\n  log.info('[DEPS INSTALL] Dependency Success: ', res.message);\n\n  // IMPORTANT: Wait a bit to ensure React components have mounted and registered event listeners\n  // This prevents race condition where events are sent before listeners are ready\n  await new Promise((resolve) =&gt; setTimeout(resolve, 500));\n\n  // IMPORTANT: Always send install-dependencies-complete event when installation check succeeds\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1228,
                "column": 1
              },
              "endPosition": {
                "line": 1229,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "async function createWindow() {",
            "lineNumber": 1228,
            "isSignature": true
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1443
          },
          {
            "lineNumber": 1453
          },
          {
            "text": "(err) =&gt; {",
            "lineNumber": 1499
          },
          {
            "lineNumber": 1500
          },
          {
            "text": "        });",
            "lineNumber": 1501
          },
          {
            "text": "    });",
            "lineNumber": 1502
          },
          {
            "text": "  } else {",
            "lineNumber": 1503
          },
          {
            "text": "    // The proper flow is now handled by useInstallationSetup.ts with dual-check mechanism:",
            "lineNumber": 1504
          },
          {
            "text": "    // 1. Installation complete event → installationCompleted.current = true",
            "lineNumber": 1505
          },
          {
            "text": "    // 2. Backend ready event → backendReady.current = true",
            "lineNumber": 1506
          },
          {
            "text": "    // 3. Only when BOTH are true → setInitState('done')",
            "lineNumber": 1507
          },
          {
            "text": "    //",
            "lineNumber": 1508
          },
          {
            "text": "    // This ensures frontend never shows before backend is ready.",
            "lineNumber": 1509
          },
          {
            "text": "    log.info(",
            "lineNumber": 1510
          },
          {
            "text": "      'Installation already complete - letting useInstallationSetup handle state transitions'",
            "lineNumber": 1511
          },
          {
            "text": "    );",
            "lineNumber": 1512
          },
          {
            "text": "  }",
            "lineNumber": 1513
          },
          {
            "lineNumber": 1514
          },
          {
            "text": "  // Load content",
            "lineNumber": 1515
          },
          {
            "text": "  if (VITE_DEV_SERVER_URL) {",
            "lineNumber": 1516
          },
          {
            "text": "    win.loadURL(VITE_DEV_SERVER_URL);",
            "lineNumber": 1517
          },
          {
            "text": "    win.webContents.openDevTools();",
            "lineNumber": 1518
          },
          {
            "text": "  } else {",
            "lineNumber": 1519
          },
          {
            "text": "    win.loadFile(indexHtml);",
            "lineNumber": 1520
          },
          {
            "text": "  }",
            "lineNumber": 1521
          },
          {
            "lineNumber": 1522
          },
          {
            "text": "  // Wait for window to be ready",
            "lineNumber": 1523
          },
          {
            "text": "  await new Promise&lt;void&gt;((resolve) =&gt; {",
            "lineNumber": 1524
          },
          {
            "text": "    win!.webContents.once('did-finish-load', () =&gt; {",
            "lineNumber": 1525
          },
          {
            "text": "      log.info(",
            "lineNumber": 1526
          },
          {
            "text": "        'Window content loaded, starting dependency check immediately...'",
            "lineNumber": 1527
          },
          {
            "text": "      );",
            "lineNumber": 1528
          },
          {
            "text": "      resolve();",
            "lineNumber": 1529
          },
          {
            "text": "    });",
            "lineNumber": 1530
          },
          {
            "text": "  });",
            "lineNumber": 1531
          },
          {
            "lineNumber": 1532
          },
          {
            "text": "  // Mark window as ready and process any queued protocol URLs",
            "lineNumber": 1533
          },
          {
            "text": "  isWindowReady = true;",
            "lineNumber": 1534
          },
          {
            "text": "  log.info('Window is ready, processing queued protocol URLs...');",
            "lineNumber": 1535
          },
          {
            "text": "  processQueuedProtocolUrls();",
            "lineNumber": 1536
          },
          {
            "lineNumber": 1537
          },
          {
            "text": "  // Wait for React components to mount and register event listeners",
            "lineNumber": 1538
          },
          {
            "text": "  await new Promise((resolve) =&gt; setTimeout(resolve, 500));",
            "lineNumber": 1539
          },
          {
            "lineNumber": 1540
          },
          {
            "text": "  // Now check and install dependencies",
            "lineNumber": 1541
          },
          {
            "text": "  let res: PromiseReturnType = await checkAndInstallDepsOnUpdate({ win });",
            "lineNumber": 1542
          },
          {
            "text": "  if (!res.success) {",
            "lineNumber": 1543
          },
          {
            "text": "    log.info('[DEPS INSTALL] Dependency Error: ', res.message);",
            "lineNumber": 1544
          },
          {
            "text": "    // Note: install-dependencies-complete failure event is already sent by installDependencies function",
            "lineNumber": 1545
          },
          {
            "text": "    // in install-deps.ts, so we don't send it again here to avoid duplicate events",
            "lineNumber": 1546
          },
          {
            "text": "    return;",
            "lineNumber": 1547
          },
          {
            "text": "  }",
            "lineNumber": 1548
          },
          {
            "text": "  log.info('[DEPS INSTALL] Dependency Success: ', res.message);",
            "lineNumber": 1549
          },
          {
            "lineNumber": 1550
          },
          {
            "text": "  // IMPORTANT: Wait a bit to ensure React components have mounted and registered event listeners",
            "lineNumber": 1551
          },
          {
            "text": "  // This prevents race condition where events are sent before listeners are ready",
            "lineNumber": 1552
          },
          {
            "text": "  await new Promise((resolve) =&gt; setTimeout(resolve, 500));",
            "lineNumber": 1553
          },
          {
            "lineNumber": 1554
          },
          {
            "text": "  // IMPORTANT: Always send install-dependencies-complete event when installation check succeeds",
            "lineNumber": 1555
          },
          {
            "text": "}",
            "lineNumber": 1570,
            "isSignature": true
          }
        ]
      },
      "score": 0.47674131393432617
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 320
          },
          "endPosition": {
            "line": 1184,
            "column": 1
          }
        },
        "contents": "function registerIpcHandlers() {\nasync (_event, email, { key, value }) =&gt; {\n\n\n    return { success: true };\n  });\n\n  ipcMain.handle('env-remove', async (_event, email, key) =&gt; {\n    log.info('env-remove', key);\n    const ENV_PATH = getEnvPath(email);\n    let content = '';\n    try {\n      content = fs.existsSync(ENV_PATH)\n        ? fs.readFileSync(ENV_PATH, 'utf-8')\n        : '';\n    } catch (error) {\n      log.error('env-remove error:', error);\n    }\n    let lines = content.split(/\\r?\\n/);\n    lines = removeEnvKey(lines, key);\n    fs.writeFileSync(ENV_PATH, lines.join('\\n'), 'utf-8');\n    log.info('env-remove success', ENV_PATH);\n\n    // Also remove from global .env file\n    const GLOBAL_ENV_PATH = path.join(os.homedir(), '.eigent', '.env');\n    try {\n      let globalContent = fs.existsSync(GLOBAL_ENV_PATH)\n        ? fs.readFileSync(GLOBAL_ENV_PATH, 'utf-8')\n        : '';\n      let globalLines = globalContent.split(/\\r?\\n/);\n      globalLines = removeEnvKey(globalLines, key);\n      fs.writeFileSync(GLOBAL_ENV_PATH, globalLines.join('\\n'), 'utf-8');\n      log.info(\n        &#96;env-remove: removed ${key} from both user and global .env files&#96;\n      );\n    } catch (error) {\n      log.error('global env-remove error:', error);\n    }\n\n    return { success: true };\n  });\n\n  // ==================== new window handler ====================\n  ipcMain.handle('open-win', (_, arg) =&gt; {\n    const childWindow = new BrowserWindow({\n      webPreferences: {\n        preload,\n        nodeIntegration: true,\n        contextIsolation: false,\n      },\n    });\n\n    if (VITE_DEV_SERVER_URL) {\n      childWindow.loadURL(&#96;${VITE_DEV_SERVER_URL}#${arg}&#96;);\n    } else {\n      childWindow.loadFile(indexHtml, { hash: arg });\n    }\n  });\n\n  // ==================== FileReader handler ====================\n  ipcMain.handle(\n    'open-file',\n    async (_, type: string, filePath: string, isShowSourceCode: boolean) =&gt; {\n      const manager = checkManagerInstance(fileReader, 'FileReader');\n      return manager.openFile(type, filePath, isShowSourceCode);\n    }\n  );\n\n  ipcMain.handle('download-file', async (_, url: string) =&gt; {\n    try\n  }\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 321,
                "column": 1
              },
              "endPosition": {
                "line": 322,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "function registerIpcHandlers() {",
            "lineNumber": 321,
            "isSignature": true
          },
          {
            "text": "async (_event, email, { key, value }) =&gt; {",
            "lineNumber": 878
          },
          {
            "lineNumber": 909
          },
          {
            "lineNumber": 910
          },
          {
            "text": "    return { success: true };",
            "lineNumber": 911
          },
          {
            "text": "  });",
            "lineNumber": 912
          },
          {
            "lineNumber": 913
          },
          {
            "text": "  ipcMain.handle('env-remove', async (_event, email, key) =&gt; {",
            "lineNumber": 914
          },
          {
            "text": "    log.info('env-remove', key);",
            "lineNumber": 915
          },
          {
            "text": "    const ENV_PATH = getEnvPath(email);",
            "lineNumber": 916
          },
          {
            "text": "    let content = '';",
            "lineNumber": 917
          },
          {
            "text": "    try {",
            "lineNumber": 918
          },
          {
            "text": "      content = fs.existsSync(ENV_PATH)",
            "lineNumber": 919
          },
          {
            "text": "        ? fs.readFileSync(ENV_PATH, 'utf-8')",
            "lineNumber": 920
          },
          {
            "text": "        : '';",
            "lineNumber": 921
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 922
          },
          {
            "text": "      log.error('env-remove error:', error);",
            "lineNumber": 923
          },
          {
            "text": "    }",
            "lineNumber": 924
          },
          {
            "text": "    let lines = content.split(/\\r?\\n/);",
            "lineNumber": 925
          },
          {
            "text": "    lines = removeEnvKey(lines, key);",
            "lineNumber": 926
          },
          {
            "text": "    fs.writeFileSync(ENV_PATH, lines.join('\\n'), 'utf-8');",
            "lineNumber": 927
          },
          {
            "text": "    log.info('env-remove success', ENV_PATH);",
            "lineNumber": 928
          },
          {
            "lineNumber": 929
          },
          {
            "text": "    // Also remove from global .env file",
            "lineNumber": 930
          },
          {
            "text": "    const GLOBAL_ENV_PATH = path.join(os.homedir(), '.eigent', '.env');",
            "lineNumber": 931
          },
          {
            "text": "    try {",
            "lineNumber": 932
          },
          {
            "text": "      let globalContent = fs.existsSync(GLOBAL_ENV_PATH)",
            "lineNumber": 933
          },
          {
            "text": "        ? fs.readFileSync(GLOBAL_ENV_PATH, 'utf-8')",
            "lineNumber": 934
          },
          {
            "text": "        : '';",
            "lineNumber": 935
          },
          {
            "text": "      let globalLines = globalContent.split(/\\r?\\n/);",
            "lineNumber": 936
          },
          {
            "text": "      globalLines = removeEnvKey(globalLines, key);",
            "lineNumber": 937
          },
          {
            "text": "      fs.writeFileSync(GLOBAL_ENV_PATH, globalLines.join('\\n'), 'utf-8');",
            "lineNumber": 938
          },
          {
            "text": "      log.info(",
            "lineNumber": 939
          },
          {
            "text": "        &#96;env-remove: removed ${key} from both user and global .env files&#96;",
            "lineNumber": 940
          },
          {
            "text": "      );",
            "lineNumber": 941
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 942
          },
          {
            "text": "      log.error('global env-remove error:', error);",
            "lineNumber": 943
          },
          {
            "text": "    }",
            "lineNumber": 944
          },
          {
            "lineNumber": 945
          },
          {
            "text": "    return { success: true };",
            "lineNumber": 946
          },
          {
            "text": "  });",
            "lineNumber": 947
          },
          {
            "lineNumber": 948
          },
          {
            "text": "  // ==================== new window handler ====================",
            "lineNumber": 949
          },
          {
            "text": "  ipcMain.handle('open-win', (_, arg) =&gt; {",
            "lineNumber": 950
          },
          {
            "text": "    const childWindow = new BrowserWindow({",
            "lineNumber": 951
          },
          {
            "text": "      webPreferences: {",
            "lineNumber": 952
          },
          {
            "text": "        preload,",
            "lineNumber": 953
          },
          {
            "text": "        nodeIntegration: true,",
            "lineNumber": 954
          },
          {
            "text": "        contextIsolation: false,",
            "lineNumber": 955
          },
          {
            "text": "      },",
            "lineNumber": 956
          },
          {
            "text": "    });",
            "lineNumber": 957
          },
          {
            "lineNumber": 958
          },
          {
            "text": "    if (VITE_DEV_SERVER_URL) {",
            "lineNumber": 959
          },
          {
            "text": "      childWindow.loadURL(&#96;${VITE_DEV_SERVER_URL}#${arg}&#96;);",
            "lineNumber": 960
          },
          {
            "text": "    } else {",
            "lineNumber": 961
          },
          {
            "text": "      childWindow.loadFile(indexHtml, { hash: arg });",
            "lineNumber": 962
          },
          {
            "text": "    }",
            "lineNumber": 963
          },
          {
            "text": "  });",
            "lineNumber": 964
          },
          {
            "lineNumber": 965
          },
          {
            "text": "  // ==================== FileReader handler ====================",
            "lineNumber": 966
          },
          {
            "text": "  ipcMain.handle(",
            "lineNumber": 967
          },
          {
            "text": "    'open-file',",
            "lineNumber": 968
          },
          {
            "text": "    async (_, type: string, filePath: string, isShowSourceCode: boolean) =&gt; {",
            "lineNumber": 969
          },
          {
            "text": "      const manager = checkManagerInstance(fileReader, 'FileReader');",
            "lineNumber": 970
          },
          {
            "text": "      return manager.openFile(type, filePath, isShowSourceCode);",
            "lineNumber": 971
          },
          {
            "text": "    }",
            "lineNumber": 972
          },
          {
            "text": "  );",
            "lineNumber": 973
          },
          {
            "lineNumber": 974
          },
          {
            "text": "  ipcMain.handle('download-file', async (_, url: string) =&gt; {",
            "lineNumber": 975
          },
          {
            "text": "    try",
            "lineNumber": 976
          },
          {
            "text": "  }",
            "lineNumber": 1021
          },
          {
            "text": "}",
            "lineNumber": 1185,
            "isSignature": true
          }
        ]
      },
      "score": 0.47214144468307495
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 57,
            "column": 41
          },
          "endPosition": {
            "line": 108,
            "column": 28
          }
        },
        "contents": "let python_process: ChildProcessWithoutNullStreams | null = null;\nlet backendPort: number = 5001;\nlet browser_port = 9222;\n\n// Protocol URL queue for handling URLs before window is ready\nlet protocolUrlQueue: string[] = [];\nlet isWindowReady = false;\n\n// ==================== path config ====================\nconst preload = path.join(__dirname, '../preload/index.mjs');\nconst indexHtml = path.join(RENDERER_DIST, 'index.html');\nconst logPath = log.transports.file.getFile().path;\n\n// Profile initialization promise\nlet profileInitPromise: Promise&lt;void&gt;;\n\n// Set remote debugging port\n// Storage strategy:\n// 1. Main window: partition 'persist:main_window' in app userData → Eigent account (persistent)\n// 2. WebView: partition 'persist:user_login' in app userData → will import cookies from tool_controller via session API\n// 3. tool_controller: ~/.eigent/browser_profiles/profile_user_login → source of truth for login cookies\n// 4. CDP browser: uses separate profile (doesn't share with main app)\nprofileInitPromise = findAvailablePort(browser_port).then(async (port) =&gt; {\n  browser_port = port;\n  app.commandLine.appendSwitch('remote-debugging-port', port + '');\n\n  // Create isolated profile for CDP browser only\n  const browserProfilesBase = path.join(\n    os.homedir(),\n    '.eigent',\n    'browser_profiles'\n  );\n  const cdpProfile = path.join(browserProfilesBase, &#96;cdp_profile_${port}&#96;);\n\n  try {\n    await fsp.mkdir(cdpProfile, { recursive: true });\n    log.info(&#96;[CDP BROWSER] Created CDP profile directory at ${cdpProfile}&#96;);\n  } catch (error) {\n    log.error(&#96;[CDP BROWSER] Failed to create directory: ${error}&#96;);\n  }\n\n  // Set user-data-dir for Chrome DevTools Protocol only\n  app.commandLine.appendSwitch('user-data-dir', cdpProfile);\n\n  log.info(&#96;[CDP BROWSER] Chrome DevTools Protocol enabled on port ${port}&#96;);\n  log.info(&#96;[CDP BROWSER] CDP profile directory: ${cdpProfile}&#96;);\n  log.info(&#96;[STORAGE] Main app userData: ${app.getPath('userData')}&#96;);\n});\n\n// Memory optimization settings\napp.commandLine.appendSwitch",
        "signatures": {},
        "detailedLines": [
          {
            "text": "let python_process: ChildProcessWithoutNullStreams | null = null;",
            "lineNumber": 59
          },
          {
            "text": "let backendPort: number = 5001;",
            "lineNumber": 60
          },
          {
            "text": "let browser_port = 9222;",
            "lineNumber": 61
          },
          {
            "lineNumber": 62
          },
          {
            "text": "// Protocol URL queue for handling URLs before window is ready",
            "lineNumber": 63
          },
          {
            "text": "let protocolUrlQueue: string[] = [];",
            "lineNumber": 64
          },
          {
            "text": "let isWindowReady = false;",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "// ==================== path config ====================",
            "lineNumber": 67
          },
          {
            "text": "const preload = path.join(__dirname, '../preload/index.mjs');",
            "lineNumber": 68
          },
          {
            "text": "const indexHtml = path.join(RENDERER_DIST, 'index.html');",
            "lineNumber": 69
          },
          {
            "text": "const logPath = log.transports.file.getFile().path;",
            "lineNumber": 70
          },
          {
            "lineNumber": 71
          },
          {
            "text": "// Profile initialization promise",
            "lineNumber": 72
          },
          {
            "text": "let profileInitPromise: Promise&lt;void&gt;;",
            "lineNumber": 73
          },
          {
            "lineNumber": 74
          },
          {
            "text": "// Set remote debugging port",
            "lineNumber": 75
          },
          {
            "text": "// Storage strategy:",
            "lineNumber": 76
          },
          {
            "text": "// 1. Main window: partition 'persist:main_window' in app userData → Eigent account (persistent)",
            "lineNumber": 77
          },
          {
            "text": "// 2. WebView: partition 'persist:user_login' in app userData → will import cookies from tool_controller via session API",
            "lineNumber": 78
          },
          {
            "text": "// 3. tool_controller: ~/.eigent/browser_profiles/profile_user_login → source of truth for login cookies",
            "lineNumber": 79
          },
          {
            "text": "// 4. CDP browser: uses separate profile (doesn't share with main app)",
            "lineNumber": 80
          },
          {
            "text": "profileInitPromise = findAvailablePort(browser_port).then(async (port) =&gt; {",
            "lineNumber": 81
          },
          {
            "text": "  browser_port = port;",
            "lineNumber": 82
          },
          {
            "text": "  app.commandLine.appendSwitch('remote-debugging-port', port + '');",
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  // Create isolated profile for CDP browser only",
            "lineNumber": 85
          },
          {
            "text": "  const browserProfilesBase = path.join(",
            "lineNumber": 86
          },
          {
            "text": "    os.homedir(),",
            "lineNumber": 87
          },
          {
            "text": "    '.eigent',",
            "lineNumber": 88
          },
          {
            "text": "    'browser_profiles'",
            "lineNumber": 89
          },
          {
            "text": "  );",
            "lineNumber": 90
          },
          {
            "text": "  const cdpProfile = path.join(browserProfilesBase, &#96;cdp_profile_${port}&#96;);",
            "lineNumber": 91
          },
          {
            "lineNumber": 92
          },
          {
            "text": "  try {",
            "lineNumber": 93
          },
          {
            "text": "    await fsp.mkdir(cdpProfile, { recursive: true });",
            "lineNumber": 94
          },
          {
            "text": "    log.info(&#96;[CDP BROWSER] Created CDP profile directory at ${cdpProfile}&#96;);",
            "lineNumber": 95
          },
          {
            "text": "  } catch (error) {",
            "lineNumber": 96
          },
          {
            "text": "    log.error(&#96;[CDP BROWSER] Failed to create directory: ${error}&#96;);",
            "lineNumber": 97
          },
          {
            "text": "  }",
            "lineNumber": 98
          },
          {
            "lineNumber": 99
          },
          {
            "text": "  // Set user-data-dir for Chrome DevTools Protocol only",
            "lineNumber": 100
          },
          {
            "text": "  app.commandLine.appendSwitch('user-data-dir', cdpProfile);",
            "lineNumber": 101
          },
          {
            "lineNumber": 102
          },
          {
            "text": "  log.info(&#96;[CDP BROWSER] Chrome DevTools Protocol enabled on port ${port}&#96;);",
            "lineNumber": 103
          },
          {
            "text": "  log.info(&#96;[CDP BROWSER] CDP profile directory: ${cdpProfile}&#96;);",
            "lineNumber": 104
          },
          {
            "text": "  log.info(&#96;[STORAGE] Main app userData: ${app.getPath('userData')}&#96;);",
            "lineNumber": 105
          },
          {
            "text": "});",
            "lineNumber": 106
          },
          {
            "lineNumber": 107
          },
          {
            "text": "// Memory optimization settings",
            "lineNumber": 108
          },
          {
            "text": "app.commandLine.appendSwitch",
            "lineNumber": 109
          }
        ]
      },
      "score": 0.44661810994148254
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 60,
            "column": 24
          }
        },
        "contents": "import {\n  app,\n  BrowserWindow,\n  shell,\n  ipcMain,\n  Menu,\n  dialog,\n  nativeTheme,\n  protocol,\n  session,\n} from 'electron';\nimport { fileURLToPath } from 'node:url';\nimport path from 'node:path';\nimport os, { homedir } from 'node:os';\nimport log from 'electron-log';\nimport { update, registerUpdateIpcHandlers } from './update';\nimport { checkToolInstalled, killProcessOnPort, startBackend } from './init';\nimport { WebViewManager } from './webview';\nimport { FileReader } from './fileReader';\nimport { ChildProcessWithoutNullStreams } from 'node:child_process';\nimport fs, { existsSync, readFileSync } from 'node:fs';\nimport fsp from 'fs/promises';\nimport { addMcp, removeMcp, updateMcp, readMcpConfig } from './utils/mcpConfig';\nimport {\n  getEnvPath,\n  updateEnvBlock,\n  removeEnvKey,\n  getEmailFolderPath,\n} from './utils/envUtil';\nimport { copyBrowserData } from './copy';\nimport { findAvailablePort } from './init';\nimport kill from 'tree-kill';\nimport { zipFolder } from './utils/log';\nimport mime from 'mime';\nimport axios from 'axios';\nimport FormData from 'form-data';\nimport {\n  checkAndInstallDepsOnUpdate,\n  PromiseReturnType,\n  getInstallationStatus,\n} from './install-deps';\nimport { isBinaryExists, getBackendPath, getVenvPath } from './utils/process';\n\nconst userData = app.getPath('userData');\n\n// ==================== constants ====================\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\nconst MAIN_DIST = path.join(__dirname, '../..');\nconst RENDERER_DIST = path.join(MAIN_DIST, 'dist');\nconst VITE_DEV_SERVER_URL = process.env.VITE_DEV_SERVER_URL;\nconst VITE_PUBLIC = VITE_DEV_SERVER_URL\n  ? path.join(MAIN_DIST, 'public')\n  : RENDERER_DIST;\n\n// ==================== global variables ====================\nlet win: BrowserWindow | null = null;\nlet webViewManager: WebViewManager | null = null;\nlet fileReader: FileReader | null = null;\nlet python_process: ChildProcessWithoutNullStreams | null = null;\nlet backendPort: number = 5001;\nlet browser_port = 9222;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import {",
            "lineNumber": 1
          },
          {
            "text": "  app,",
            "lineNumber": 2
          },
          {
            "text": "  BrowserWindow,",
            "lineNumber": 3
          },
          {
            "text": "  shell,",
            "lineNumber": 4
          },
          {
            "text": "  ipcMain,",
            "lineNumber": 5
          },
          {
            "text": "  Menu,",
            "lineNumber": 6
          },
          {
            "text": "  dialog,",
            "lineNumber": 7
          },
          {
            "text": "  nativeTheme,",
            "lineNumber": 8
          },
          {
            "text": "  protocol,",
            "lineNumber": 9
          },
          {
            "text": "  session,",
            "lineNumber": 10
          },
          {
            "text": "} from 'electron';",
            "lineNumber": 11
          },
          {
            "text": "import { fileURLToPath } from 'node:url';",
            "lineNumber": 12
          },
          {
            "text": "import path from 'node:path';",
            "lineNumber": 13
          },
          {
            "text": "import os, { homedir } from 'node:os';",
            "lineNumber": 14
          },
          {
            "text": "import log from 'electron-log';",
            "lineNumber": 15
          },
          {
            "text": "import { update, registerUpdateIpcHandlers } from './update';",
            "lineNumber": 16
          },
          {
            "text": "import { checkToolInstalled, killProcessOnPort, startBackend } from './init';",
            "lineNumber": 17
          },
          {
            "text": "import { WebViewManager } from './webview';",
            "lineNumber": 18
          },
          {
            "text": "import { FileReader } from './fileReader';",
            "lineNumber": 19
          },
          {
            "text": "import { ChildProcessWithoutNullStreams } from 'node:child_process';",
            "lineNumber": 20
          },
          {
            "text": "import fs, { existsSync, readFileSync } from 'node:fs';",
            "lineNumber": 21
          },
          {
            "text": "import fsp from 'fs/promises';",
            "lineNumber": 22
          },
          {
            "text": "import { addMcp, removeMcp, updateMcp, readMcpConfig } from './utils/mcpConfig';",
            "lineNumber": 23
          },
          {
            "text": "import {",
            "lineNumber": 24
          },
          {
            "text": "  getEnvPath,",
            "lineNumber": 25
          },
          {
            "text": "  updateEnvBlock,",
            "lineNumber": 26
          },
          {
            "text": "  removeEnvKey,",
            "lineNumber": 27
          },
          {
            "text": "  getEmailFolderPath,",
            "lineNumber": 28
          },
          {
            "text": "} from './utils/envUtil';",
            "lineNumber": 29
          },
          {
            "text": "import { copyBrowserData } from './copy';",
            "lineNumber": 30
          },
          {
            "text": "import { findAvailablePort } from './init';",
            "lineNumber": 31
          },
          {
            "text": "import kill from 'tree-kill';",
            "lineNumber": 32
          },
          {
            "text": "import { zipFolder } from './utils/log';",
            "lineNumber": 33
          },
          {
            "text": "import mime from 'mime';",
            "lineNumber": 34
          },
          {
            "text": "import axios from 'axios';",
            "lineNumber": 35
          },
          {
            "text": "import FormData from 'form-data';",
            "lineNumber": 36
          },
          {
            "text": "import {",
            "lineNumber": 37
          },
          {
            "text": "  checkAndInstallDepsOnUpdate,",
            "lineNumber": 38
          },
          {
            "text": "  PromiseReturnType,",
            "lineNumber": 39
          },
          {
            "text": "  getInstallationStatus,",
            "lineNumber": 40
          },
          {
            "text": "} from './install-deps';",
            "lineNumber": 41
          },
          {
            "text": "import { isBinaryExists, getBackendPath, getVenvPath } from './utils/process';",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "const userData = app.getPath('userData');",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "// ==================== constants ====================",
            "lineNumber": 46
          },
          {
            "text": "const __dirname = path.dirname(fileURLToPath(import.meta.url));",
            "lineNumber": 47
          },
          {
            "text": "const MAIN_DIST = path.join(__dirname, '../..');",
            "lineNumber": 48
          },
          {
            "text": "const RENDERER_DIST = path.join(MAIN_DIST, 'dist');",
            "lineNumber": 49
          },
          {
            "text": "const VITE_DEV_SERVER_URL = process.env.VITE_DEV_SERVER_URL;",
            "lineNumber": 50
          },
          {
            "text": "const VITE_PUBLIC = VITE_DEV_SERVER_URL",
            "lineNumber": 51
          },
          {
            "text": "  ? path.join(MAIN_DIST, 'public')",
            "lineNumber": 52
          },
          {
            "text": "  : RENDERER_DIST;",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "// ==================== global variables ====================",
            "lineNumber": 55
          },
          {
            "text": "let win: BrowserWindow | null = null;",
            "lineNumber": 56
          },
          {
            "text": "let webViewManager: WebViewManager | null = null;",
            "lineNumber": 57
          },
          {
            "text": "let fileReader: FileReader | null = null;",
            "lineNumber": 58
          },
          {
            "text": "let python_process: ChildProcessWithoutNullStreams | null = null;",
            "lineNumber": 59
          },
          {
            "text": "let backendPort: number = 5001;",
            "lineNumber": 60
          },
          {
            "text": "let browser_port = 9222;",
            "lineNumber": 61
          }
        ]
      },
      "score": 0.43174946308135986
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 1217,
            "column": 2
          },
          "endPosition": {
            "line": 1569,
            "column": 1
          }
        },
        "contents": "// ==================== installation lock ====================\nlet isInstallationInProgress = false;\nlet installationLock: Promise&lt;PromiseReturnType&gt; = Promise.resolve({\n  message: 'No installation needed',\n  success: true,\n});\n\n// ==================== window create ====================\nasync function createWindow() {\n  const isMac = process.platform === 'darwin';\n\n  // Ensure .eigent directories exist before anything else\n  ensureEigentDirectories();\n\n  log.info(\n    &#96;[PROJECT BROWSER WINDOW] Creating BrowserWindow which will start Chrome with CDP on port ${browser_port}&#96;\n  );\n  log.info(\n    &#96;[PROJECT BROWSER WINDOW] Current user data path: ${app.getPath(\n      'userData'\n    )}&#96;\n  );\n  log.info(\n    &#96;[PROJECT BROWSER WINDOW] Command line switch user-data-dir: ${app.commandLine.getSwitchValue(\n      'user-data-dir'\n    )}&#96;\n  );\n\n  win = new BrowserWindow({\n    title: 'Eigent',\n    width: 1200,\n    height: 800,\n    minWidth: 1050,\n    minHeight: 650,\n    frame: false,\n    transparent: true,\n    vibrancy: 'sidebar',\n    visualEffectState: 'active',\n    backgroundColor: '#f5f5f580',\n    titleBarStyle: isMac ? 'hidden' : undefined,\n    trafficLightPosition: isMac ? { x: 10, y: 10 } : undefined,\n    icon: path.join(VITE_PUBLIC, 'favicon.ico'),\n    roundedCorners: true,\n    webPreferences: {\n      // Use a dedicated partition for main window to isolate from webviews\n      // This ensures main window's auth data (localStorage) is stored separately and persists across restarts\n      partition: 'persist:main_window',\n      webSecurity: false,\n      preload,\n      nodeIntegration: true,\n      contextIsolation: true,\n      webviewTag: true,\n      spellcheck: false,\n    },\n  });\n\n  // Main window now uses default userData directly with partition 'persist:main_window'\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "// ==================== installation lock ====================",
            "lineNumber": 1220
          },
          {
            "text": "let isInstallationInProgress = false;",
            "lineNumber": 1221
          },
          {
            "text": "let installationLock: Promise&lt;PromiseReturnType&gt; = Promise.resolve({",
            "lineNumber": 1222
          },
          {
            "text": "  message: 'No installation needed',",
            "lineNumber": 1223
          },
          {
            "text": "  success: true,",
            "lineNumber": 1224
          },
          {
            "text": "});",
            "lineNumber": 1225
          },
          {
            "lineNumber": 1226
          },
          {
            "text": "// ==================== window create ====================",
            "lineNumber": 1227
          },
          {
            "text": "async function createWindow() {",
            "lineNumber": 1228,
            "isSignature": true
          },
          {
            "text": "  const isMac = process.platform === 'darwin';",
            "lineNumber": 1229
          },
          {
            "lineNumber": 1230
          },
          {
            "text": "  // Ensure .eigent directories exist before anything else",
            "lineNumber": 1231
          },
          {
            "text": "  ensureEigentDirectories();",
            "lineNumber": 1232
          },
          {
            "lineNumber": 1233
          },
          {
            "text": "  log.info(",
            "lineNumber": 1234
          },
          {
            "text": "    &#96;[PROJECT BROWSER WINDOW] Creating BrowserWindow which will start Chrome with CDP on port ${browser_port}&#96;",
            "lineNumber": 1235
          },
          {
            "text": "  );",
            "lineNumber": 1236
          },
          {
            "text": "  log.info(",
            "lineNumber": 1237
          },
          {
            "text": "    &#96;[PROJECT BROWSER WINDOW] Current user data path: ${app.getPath(",
            "lineNumber": 1238
          },
          {
            "text": "      'userData'",
            "lineNumber": 1239
          },
          {
            "text": "    )}&#96;",
            "lineNumber": 1240
          },
          {
            "text": "  );",
            "lineNumber": 1241
          },
          {
            "text": "  log.info(",
            "lineNumber": 1242
          },
          {
            "text": "    &#96;[PROJECT BROWSER WINDOW] Command line switch user-data-dir: ${app.commandLine.getSwitchValue(",
            "lineNumber": 1243
          },
          {
            "text": "      'user-data-dir'",
            "lineNumber": 1244
          },
          {
            "text": "    )}&#96;",
            "lineNumber": 1245
          },
          {
            "text": "  );",
            "lineNumber": 1246
          },
          {
            "lineNumber": 1247
          },
          {
            "text": "  win = new BrowserWindow({",
            "lineNumber": 1248
          },
          {
            "text": "    title: 'Eigent',",
            "lineNumber": 1249
          },
          {
            "text": "    width: 1200,",
            "lineNumber": 1250
          },
          {
            "text": "    height: 800,",
            "lineNumber": 1251
          },
          {
            "text": "    minWidth: 1050,",
            "lineNumber": 1252
          },
          {
            "text": "    minHeight: 650,",
            "lineNumber": 1253
          },
          {
            "text": "    frame: false,",
            "lineNumber": 1254
          },
          {
            "text": "    transparent: true,",
            "lineNumber": 1255
          },
          {
            "text": "    vibrancy: 'sidebar',",
            "lineNumber": 1256
          },
          {
            "text": "    visualEffectState: 'active',",
            "lineNumber": 1257
          },
          {
            "text": "    backgroundColor: '#f5f5f580',",
            "lineNumber": 1258
          },
          {
            "text": "    titleBarStyle: isMac ? 'hidden' : undefined,",
            "lineNumber": 1259
          },
          {
            "text": "    trafficLightPosition: isMac ? { x: 10, y: 10 } : undefined,",
            "lineNumber": 1260
          },
          {
            "text": "    icon: path.join(VITE_PUBLIC, 'favicon.ico'),",
            "lineNumber": 1261
          },
          {
            "text": "    roundedCorners: true,",
            "lineNumber": 1262
          },
          {
            "text": "    webPreferences: {",
            "lineNumber": 1263
          },
          {
            "text": "      // Use a dedicated partition for main window to isolate from webviews",
            "lineNumber": 1264
          },
          {
            "text": "      // This ensures main window's auth data (localStorage) is stored separately and persists across restarts",
            "lineNumber": 1265
          },
          {
            "text": "      partition: 'persist:main_window',",
            "lineNumber": 1266
          },
          {
            "text": "      webSecurity: false,",
            "lineNumber": 1267
          },
          {
            "text": "      preload,",
            "lineNumber": 1268
          },
          {
            "text": "      nodeIntegration: true,",
            "lineNumber": 1269
          },
          {
            "text": "      contextIsolation: true,",
            "lineNumber": 1270
          },
          {
            "text": "      webviewTag: true,",
            "lineNumber": 1271
          },
          {
            "text": "      spellcheck: false,",
            "lineNumber": 1272
          },
          {
            "text": "    },",
            "lineNumber": 1273
          },
          {
            "text": "  });",
            "lineNumber": 1274
          },
          {
            "lineNumber": 1275
          },
          {
            "text": "  // Main window now uses default userData directly with partition 'persist:main_window'",
            "lineNumber": 1276
          },
          {
            "text": "}",
            "lineNumber": 1570,
            "isSignature": true
          }
        ]
      },
      "score": 0.423420250415802
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 1227
          },
          "endPosition": {
            "line": 1569,
            "column": 1
          }
        },
        "contents": "async function createWindow() {\n\n\n  // ==================== initialize manager ====================\n  fileReader = new FileReader(win);\n  webViewManager = new WebViewManager(win);\n\n  // create multiple webviews\n  log.info(\n    &#96;[PROJECT BROWSER] Creating WebViews with partition: persist:user_login&#96;\n  );\n  for (let i = 1; i &lt;= 8; i++) {\n    webViewManager.createWebview(i === 1 ? undefined : i.toString());\n  }\n  log.info('[PROJECT BROWSER] WebViewManager initialized with webviews');\n\n  // ==================== set event listeners ====================\n  setupWindowEventListeners();\n  setupDevToolsShortcuts();\n  setupExternalLinkHandling();\n  handleBeforeClose();\n\n  // ==================== auto update ====================\n  update(win);\n\n  // ==================== CHECK IF INSTALLATION IS NEEDED BEFORE LOADING CONTENT ====================\n  log.info('Pre-checking if dependencies need to be installed...');\n\n  // Check if prebuilt dependencies are available (for packaged app)\n  let hasPrebuiltDeps = false;\n  if (app.isPackaged) {\n    const prebuiltBinDir = path.join(process.resourcesPath, 'prebuilt', 'bin');\n    const prebuiltVenvDir = path.join(\n      process.resourcesPath,\n      'prebuilt',\n      'venv'\n    );\n    const uvPath = path.join(\n      prebuiltBinDir,\n      process.platform === 'win32' ? 'uv.exe' : 'uv'\n    );\n    const bunPath = path.join(\n      prebuiltBinDir,\n      process.platform === 'win32' ? 'bun.exe' : 'bun'\n    );\n    const pyvenvCfg = path.join(prebuiltVenvDir, 'pyvenv.cfg');\n\n    hasPrebuiltDeps =\n      fs.existsSync(uvPath) &amp;&amp;\n      fs.existsSync(bunPath) &amp;&amp;\n      fs.existsSync(pyvenvCfg);\n    if (hasPrebuiltDeps) {\n      log.info(\n        '[PRE-CHECK] Prebuilt dependencies found, skipping installation check'\n      );\n    }\n  }\n\n  // Check version and tools status synchronously\n  const currentVersion = app.getVersion();\n  const versionFile = path.join(app.getPath('userData'), 'version.txt');\n  const versionExists = fs.existsSync(versionFile);\n  let savedVersion = '';\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1228,
                "column": 1
              },
              "endPosition": {
                "line": 1229,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "async function createWindow() {",
            "lineNumber": 1228,
            "isSignature": true
          },
          {
            "lineNumber": 1335
          },
          {
            "lineNumber": 1336
          },
          {
            "text": "  // ==================== initialize manager ====================",
            "lineNumber": 1337
          },
          {
            "text": "  fileReader = new FileReader(win);",
            "lineNumber": 1338
          },
          {
            "text": "  webViewManager = new WebViewManager(win);",
            "lineNumber": 1339
          },
          {
            "lineNumber": 1340
          },
          {
            "text": "  // create multiple webviews",
            "lineNumber": 1341
          },
          {
            "text": "  log.info(",
            "lineNumber": 1342
          },
          {
            "text": "    &#96;[PROJECT BROWSER] Creating WebViews with partition: persist:user_login&#96;",
            "lineNumber": 1343
          },
          {
            "text": "  );",
            "lineNumber": 1344
          },
          {
            "text": "  for (let i = 1; i &lt;= 8; i++) {",
            "lineNumber": 1345
          },
          {
            "text": "    webViewManager.createWebview(i === 1 ? undefined : i.toString());",
            "lineNumber": 1346
          },
          {
            "text": "  }",
            "lineNumber": 1347
          },
          {
            "text": "  log.info('[PROJECT BROWSER] WebViewManager initialized with webviews');",
            "lineNumber": 1348
          },
          {
            "lineNumber": 1349
          },
          {
            "text": "  // ==================== set event listeners ====================",
            "lineNumber": 1350
          },
          {
            "text": "  setupWindowEventListeners();",
            "lineNumber": 1351
          },
          {
            "text": "  setupDevToolsShortcuts();",
            "lineNumber": 1352
          },
          {
            "text": "  setupExternalLinkHandling();",
            "lineNumber": 1353
          },
          {
            "text": "  handleBeforeClose();",
            "lineNumber": 1354
          },
          {
            "lineNumber": 1355
          },
          {
            "text": "  // ==================== auto update ====================",
            "lineNumber": 1356
          },
          {
            "text": "  update(win);",
            "lineNumber": 1357
          },
          {
            "lineNumber": 1358
          },
          {
            "text": "  // ==================== CHECK IF INSTALLATION IS NEEDED BEFORE LOADING CONTENT ====================",
            "lineNumber": 1359
          },
          {
            "text": "  log.info('Pre-checking if dependencies need to be installed...');",
            "lineNumber": 1360
          },
          {
            "lineNumber": 1361
          },
          {
            "text": "  // Check if prebuilt dependencies are available (for packaged app)",
            "lineNumber": 1362
          },
          {
            "text": "  let hasPrebuiltDeps = false;",
            "lineNumber": 1363
          },
          {
            "text": "  if (app.isPackaged) {",
            "lineNumber": 1364
          },
          {
            "text": "    const prebuiltBinDir = path.join(process.resourcesPath, 'prebuilt', 'bin');",
            "lineNumber": 1365
          },
          {
            "text": "    const prebuiltVenvDir = path.join(",
            "lineNumber": 1366
          },
          {
            "text": "      process.resourcesPath,",
            "lineNumber": 1367
          },
          {
            "text": "      'prebuilt',",
            "lineNumber": 1368
          },
          {
            "text": "      'venv'",
            "lineNumber": 1369
          },
          {
            "text": "    );",
            "lineNumber": 1370
          },
          {
            "text": "    const uvPath = path.join(",
            "lineNumber": 1371
          },
          {
            "text": "      prebuiltBinDir,",
            "lineNumber": 1372
          },
          {
            "text": "      process.platform === 'win32' ? 'uv.exe' : 'uv'",
            "lineNumber": 1373
          },
          {
            "text": "    );",
            "lineNumber": 1374
          },
          {
            "text": "    const bunPath = path.join(",
            "lineNumber": 1375
          },
          {
            "text": "      prebuiltBinDir,",
            "lineNumber": 1376
          },
          {
            "text": "      process.platform === 'win32' ? 'bun.exe' : 'bun'",
            "lineNumber": 1377
          },
          {
            "text": "    );",
            "lineNumber": 1378
          },
          {
            "text": "    const pyvenvCfg = path.join(prebuiltVenvDir, 'pyvenv.cfg');",
            "lineNumber": 1379
          },
          {
            "lineNumber": 1380
          },
          {
            "text": "    hasPrebuiltDeps =",
            "lineNumber": 1381
          },
          {
            "text": "      fs.existsSync(uvPath) &amp;&amp;",
            "lineNumber": 1382
          },
          {
            "text": "      fs.existsSync(bunPath) &amp;&amp;",
            "lineNumber": 1383
          },
          {
            "text": "      fs.existsSync(pyvenvCfg);",
            "lineNumber": 1384
          },
          {
            "text": "    if (hasPrebuiltDeps) {",
            "lineNumber": 1385
          },
          {
            "text": "      log.info(",
            "lineNumber": 1386
          },
          {
            "text": "        '[PRE-CHECK] Prebuilt dependencies found, skipping installation check'",
            "lineNumber": 1387
          },
          {
            "text": "      );",
            "lineNumber": 1388
          },
          {
            "text": "    }",
            "lineNumber": 1389
          },
          {
            "text": "  }",
            "lineNumber": 1390
          },
          {
            "lineNumber": 1391
          },
          {
            "text": "  // Check version and tools status synchronously",
            "lineNumber": 1392
          },
          {
            "text": "  const currentVersion = app.getVersion();",
            "lineNumber": 1393
          },
          {
            "text": "  const versionFile = path.join(app.getPath('userData'), 'version.txt');",
            "lineNumber": 1394
          },
          {
            "text": "  const versionExists = fs.existsSync(versionFile);",
            "lineNumber": 1395
          },
          {
            "text": "  let savedVersion = '';",
            "lineNumber": 1396
          },
          {
            "text": "}",
            "lineNumber": 1570,
            "isSignature": true
          }
        ]
      },
      "score": 0.41723203659057617
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\.vscode\\launch.json",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 69,
            "column": 1
          }
        },
        "contents": "{\n  // Use IntelliSense to learn about possible attributes.\n  // Hover to view descriptions of existing attributes.\n  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n  \"version\": \"0.2.0\",\n  \"compounds\": [\n    {\n      \"name\": \"Debug App\",\n      \"preLaunchTask\": \"Before Debug\",\n      \"configurations\": [\n        \"Debug Main Process\",\n        \"Debug Renderer Process\"\n      ],\n      \"presentation\": {\n        \"hidden\": false,\n        \"group\": \"\",\n        \"order\": 1\n      },\n      \"stopAll\": true\n    }\n  ],\n  \"configurations\": [\n    {\n      \"name\": \"Debug Main Process\",\n      \"type\": \"node\",\n      \"request\": \"launch\",\n      \"runtimeExecutable\": \"${workspaceRoot}/node_modules/.bin/electron\",\n      \"windows\": {\n        \"runtimeExecutable\": \"${workspaceRoot}/node_modules/.bin/electron.cmd\"\n      },\n      \"runtimeArgs\": [\n        \"--no-sandbox\",\n        \"--remote-debugging-port=9229\",\n        \".\"\n      ],\n      \"envFile\": \"${workspaceFolder}/.vscode/.debug.env\",\n      \"console\": \"integratedTerminal\"\n    },\n    {\n      \"name\": \"Debug Renderer Process\",\n      \"port\": 9229,\n      \"request\": \"attach\",\n      \"type\": \"chrome\",\n      \"timeout\": 60000,\n      \"skipFiles\": [\n        \"&lt;node_internals&gt;/**\",\n        \"${workspaceRoot}/node_modules/**\",\n        \"${workspaceRoot}/dist-electron/**\",\n        // Skip files in host(VITE_DEV_SERVER_URL)\n        \"http://127.0.0.1:7777/**\"\n      ]\n    },\n    {\n      \"name\": \"Debug Python Backend (Attach)\",\n      \"type\": \"debugpy\",\n      \"request\": \"attach\",\n      \"connect\": {\n        \"host\": \"localhost\",\n        \"port\": 5678\n      },\n      \"pathMappings\": [\n        {\n          \"localRoot\": \"${workspaceFolder}/backend\",\n          \"remoteRoot\": \".\"\n        }\n      ],\n      \"justMyCode\": false\n    }\n  ]\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "{",
            "lineNumber": 1
          },
          {
            "text": "  // Use IntelliSense to learn about possible attributes.",
            "lineNumber": 2
          },
          {
            "text": "  // Hover to view descriptions of existing attributes.",
            "lineNumber": 3
          },
          {
            "text": "  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387",
            "lineNumber": 4
          },
          {
            "text": "  \"version\": \"0.2.0\",",
            "lineNumber": 5
          },
          {
            "text": "  \"compounds\": [",
            "lineNumber": 6
          },
          {
            "text": "    {",
            "lineNumber": 7
          },
          {
            "text": "      \"name\": \"Debug App\",",
            "lineNumber": 8
          },
          {
            "text": "      \"preLaunchTask\": \"Before Debug\",",
            "lineNumber": 9
          },
          {
            "text": "      \"configurations\": [",
            "lineNumber": 10
          },
          {
            "text": "        \"Debug Main Process\",",
            "lineNumber": 11
          },
          {
            "text": "        \"Debug Renderer Process\"",
            "lineNumber": 12
          },
          {
            "text": "      ],",
            "lineNumber": 13
          },
          {
            "text": "      \"presentation\": {",
            "lineNumber": 14
          },
          {
            "text": "        \"hidden\": false,",
            "lineNumber": 15
          },
          {
            "text": "        \"group\": \"\",",
            "lineNumber": 16
          },
          {
            "text": "        \"order\": 1",
            "lineNumber": 17
          },
          {
            "text": "      },",
            "lineNumber": 18
          },
          {
            "text": "      \"stopAll\": true",
            "lineNumber": 19
          },
          {
            "text": "    }",
            "lineNumber": 20
          },
          {
            "text": "  ],",
            "lineNumber": 21
          },
          {
            "text": "  \"configurations\": [",
            "lineNumber": 22
          },
          {
            "text": "    {",
            "lineNumber": 23
          },
          {
            "text": "      \"name\": \"Debug Main Process\",",
            "lineNumber": 24
          },
          {
            "text": "      \"type\": \"node\",",
            "lineNumber": 25
          },
          {
            "text": "      \"request\": \"launch\",",
            "lineNumber": 26
          },
          {
            "text": "      \"runtimeExecutable\": \"${workspaceRoot}/node_modules/.bin/electron\",",
            "lineNumber": 27
          },
          {
            "text": "      \"windows\": {",
            "lineNumber": 28
          },
          {
            "text": "        \"runtimeExecutable\": \"${workspaceRoot}/node_modules/.bin/electron.cmd\"",
            "lineNumber": 29
          },
          {
            "text": "      },",
            "lineNumber": 30
          },
          {
            "text": "      \"runtimeArgs\": [",
            "lineNumber": 31
          },
          {
            "text": "        \"--no-sandbox\",",
            "lineNumber": 32
          },
          {
            "text": "        \"--remote-debugging-port=9229\",",
            "lineNumber": 33
          },
          {
            "text": "        \".\"",
            "lineNumber": 34
          },
          {
            "text": "      ],",
            "lineNumber": 35
          },
          {
            "text": "      \"envFile\": \"${workspaceFolder}/.vscode/.debug.env\",",
            "lineNumber": 36
          },
          {
            "text": "      \"console\": \"integratedTerminal\"",
            "lineNumber": 37
          },
          {
            "text": "    },",
            "lineNumber": 38
          },
          {
            "text": "    {",
            "lineNumber": 39
          },
          {
            "text": "      \"name\": \"Debug Renderer Process\",",
            "lineNumber": 40
          },
          {
            "text": "      \"port\": 9229,",
            "lineNumber": 41
          },
          {
            "text": "      \"request\": \"attach\",",
            "lineNumber": 42
          },
          {
            "text": "      \"type\": \"chrome\",",
            "lineNumber": 43
          },
          {
            "text": "      \"timeout\": 60000,",
            "lineNumber": 44
          },
          {
            "text": "      \"skipFiles\": [",
            "lineNumber": 45
          },
          {
            "text": "        \"&lt;node_internals&gt;/**\",",
            "lineNumber": 46
          },
          {
            "text": "        \"${workspaceRoot}/node_modules/**\",",
            "lineNumber": 47
          },
          {
            "text": "        \"${workspaceRoot}/dist-electron/**\",",
            "lineNumber": 48
          },
          {
            "text": "        // Skip files in host(VITE_DEV_SERVER_URL)",
            "lineNumber": 49
          },
          {
            "text": "        \"http://127.0.0.1:7777/**\"",
            "lineNumber": 50
          },
          {
            "text": "      ]",
            "lineNumber": 51
          },
          {
            "text": "    },",
            "lineNumber": 52
          },
          {
            "text": "    {",
            "lineNumber": 53
          },
          {
            "text": "      \"name\": \"Debug Python Backend (Attach)\",",
            "lineNumber": 54
          },
          {
            "text": "      \"type\": \"debugpy\",",
            "lineNumber": 55
          },
          {
            "text": "      \"request\": \"attach\",",
            "lineNumber": 56
          },
          {
            "text": "      \"connect\": {",
            "lineNumber": 57
          },
          {
            "text": "        \"host\": \"localhost\",",
            "lineNumber": 58
          },
          {
            "text": "        \"port\": 5678",
            "lineNumber": 59
          },
          {
            "text": "      },",
            "lineNumber": 60
          },
          {
            "text": "      \"pathMappings\": [",
            "lineNumber": 61
          },
          {
            "text": "        {",
            "lineNumber": 62
          },
          {
            "text": "          \"localRoot\": \"${workspaceFolder}/backend\",",
            "lineNumber": 63
          },
          {
            "text": "          \"remoteRoot\": \".\"",
            "lineNumber": 64
          },
          {
            "text": "        }",
            "lineNumber": 65
          },
          {
            "text": "      ],",
            "lineNumber": 66
          },
          {
            "text": "      \"justMyCode\": false",
            "lineNumber": 67
          },
          {
            "text": "    }",
            "lineNumber": 68
          },
          {
            "text": "  ]",
            "lineNumber": 69
          },
          {
            "text": "}",
            "lineNumber": 70
          }
        ]
      },
      "score": 0.40660560131073
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 238,
            "column": 1
          },
          "endPosition": {
            "line": 266,
            "column": 1
          }
        },
        "contents": "// ==================== single instance lock ====================\nconst setupSingleInstanceLock = () =&gt; {\n  const gotLock = app.requestSingleInstanceLock();\n  if (!gotLock) {\n    log.info('no-lock');\n    app.quit();\n  } else {\n    app.on('second-instance', (event, argv) =&gt; {\n      log.info('second-instance', argv);\n      const url = argv.find((arg) =&gt; arg.startsWith('eigent://'));\n      if (url) handleProtocolUrl(url);\n      if (win) win.show();\n    });\n\n    app.on('open-url', (event, url) =&gt; {\n      log.info('open-url');\n      event.preventDefault();\n      handleProtocolUrl(url);\n    });\n  }\n};\n\n// ==================== initialize config ====================\nconst initializeApp = ()\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "// ==================== single instance lock ====================",
            "lineNumber": 241
          },
          {
            "text": "const setupSingleInstanceLock = () =&gt; {",
            "lineNumber": 242
          },
          {
            "text": "  const gotLock = app.requestSingleInstanceLock();",
            "lineNumber": 243
          },
          {
            "text": "  if (!gotLock) {",
            "lineNumber": 244
          },
          {
            "text": "    log.info('no-lock');",
            "lineNumber": 245
          },
          {
            "text": "    app.quit();",
            "lineNumber": 246
          },
          {
            "text": "  } else {",
            "lineNumber": 247
          },
          {
            "text": "    app.on('second-instance', (event, argv) =&gt; {",
            "lineNumber": 248
          },
          {
            "text": "      log.info('second-instance', argv);",
            "lineNumber": 249
          },
          {
            "text": "      const url = argv.find((arg) =&gt; arg.startsWith('eigent://'));",
            "lineNumber": 250
          },
          {
            "text": "      if (url) handleProtocolUrl(url);",
            "lineNumber": 251
          },
          {
            "text": "      if (win) win.show();",
            "lineNumber": 252
          },
          {
            "text": "    });",
            "lineNumber": 253
          },
          {
            "lineNumber": 254
          },
          {
            "text": "    app.on('open-url', (event, url) =&gt; {",
            "lineNumber": 255
          },
          {
            "text": "      log.info('open-url');",
            "lineNumber": 256
          },
          {
            "text": "      event.preventDefault();",
            "lineNumber": 257
          },
          {
            "text": "      handleProtocolUrl(url);",
            "lineNumber": 258
          },
          {
            "text": "    });",
            "lineNumber": 259
          },
          {
            "text": "  }",
            "lineNumber": 260
          },
          {
            "text": "};",
            "lineNumber": 261
          },
          {
            "lineNumber": 262
          },
          {
            "text": "// ==================== initialize config ====================",
            "lineNumber": 263
          },
          {
            "text": "const initializeApp = ()",
            "lineNumber": 264
          },
          {
            "text": ";",
            "lineNumber": 267
          }
        ]
      },
      "score": 0.3991492986679077
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\main.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 56,
            "column": 47
          }
        },
        "contents": "import os\nimport sys\nimport pathlib\nimport signal\nimport asyncio\nimport atexit\n\n# Add project root to Python path to import shared utils\n_project_root = pathlib.Path(__file__).parent.parent\nif str(_project_root) not in sys.path:\n    sys.path.insert(0, str(_project_root))\n\n# 1) Load env and init traceroot BEFORE importing modules that get a logger\nfrom utils import traceroot_wrapper as traceroot\nfrom app import api\n\n# Only initialize traceroot if enabled\nif traceroot.is_enabled():\n    from traceroot.integrations.fastapi import connect_fastapi\n    connect_fastapi(api)\n\n# 2) Now safe to import modules that use traceroot.get_logger() at import-time\nfrom app.component.environment import env\nfrom app.router import register_routers\n\n\nos.environ[\"PYTHONIOENCODING\"] = \"utf-8\"\n\napp_logger = traceroot.get_logger(\"main\")\n\n# Log application startup\napp_logger.info(\"Starting Eigent Multi-Agent System API\")\napp_logger.info(f\"Python encoding: {os.environ.get('PYTHONIOENCODING')}\")\napp_logger.info(f\"Environment: {os.environ.get('ENVIRONMENT', 'development')}\")\n\nprefix = env(\"url_prefix\", \"\")\napp_logger.info(f\"Loading routers with prefix: '{prefix}'\")\nregister_routers(api, prefix)\napp_logger.info(\"All routers loaded successfully\")\n\n# Check if debug mode is enabled via environment variable\nif os.environ.get('ENABLE_PYTHON_DEBUG') == 'true':\n    try:\n        import debugpy\n        DEBUG_PORT = int(os.environ.get('DEBUG_PORT', '5678'))\n        app_logger.info(f\"Debug mode enabled - Starting debugpy server on port {DEBUG_PORT}\")\n        debugpy.listen((\"localhost\", DEBUG_PORT))\n        app_logger.info(f\"Debugger ready for attachment on localhost:{DEBUG_PORT}\")\n        #📝 In VS Code: Run 'Debug Python Backend (Attach)' configuration\n        # Don't wait for client automatically - let it attach when ready\n    except ImportError:\n        app_logger.warning(\"debugpy not available, install with: uv add debugpy\")\n    except Exception as e:\n        app_logger.error(f\"Failed to start debugpy: {e}\")\n\n\ndir = pathlib.Path(__file__).parent / \"runtime\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import os",
            "lineNumber": 1
          },
          {
            "text": "import sys",
            "lineNumber": 2
          },
          {
            "text": "import pathlib",
            "lineNumber": 3
          },
          {
            "text": "import signal",
            "lineNumber": 4
          },
          {
            "text": "import asyncio",
            "lineNumber": 5
          },
          {
            "text": "import atexit",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "# Add project root to Python path to import shared utils",
            "lineNumber": 8
          },
          {
            "text": "_project_root = pathlib.Path(__file__).parent.parent",
            "lineNumber": 9
          },
          {
            "text": "if str(_project_root) not in sys.path:",
            "lineNumber": 10
          },
          {
            "text": "    sys.path.insert(0, str(_project_root))",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "# 1) Load env and init traceroot BEFORE importing modules that get a logger",
            "lineNumber": 13
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 14
          },
          {
            "text": "from app import api",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "# Only initialize traceroot if enabled",
            "lineNumber": 17
          },
          {
            "text": "if traceroot.is_enabled():",
            "lineNumber": 18
          },
          {
            "text": "    from traceroot.integrations.fastapi import connect_fastapi",
            "lineNumber": 19
          },
          {
            "text": "    connect_fastapi(api)",
            "lineNumber": 20
          },
          {
            "lineNumber": 21
          },
          {
            "text": "# 2) Now safe to import modules that use traceroot.get_logger() at import-time",
            "lineNumber": 22
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 23
          },
          {
            "text": "from app.router import register_routers",
            "lineNumber": 24
          },
          {
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "os.environ[\"PYTHONIOENCODING\"] = \"utf-8\"",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "app_logger = traceroot.get_logger(\"main\")",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "# Log application startup",
            "lineNumber": 31
          },
          {
            "text": "app_logger.info(\"Starting Eigent Multi-Agent System API\")",
            "lineNumber": 32
          },
          {
            "text": "app_logger.info(f\"Python encoding: {os.environ.get('PYTHONIOENCODING')}\")",
            "lineNumber": 33
          },
          {
            "text": "app_logger.info(f\"Environment: {os.environ.get('ENVIRONMENT', 'development')}\")",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "prefix = env(\"url_prefix\", \"\")",
            "lineNumber": 36
          },
          {
            "text": "app_logger.info(f\"Loading routers with prefix: '{prefix}'\")",
            "lineNumber": 37
          },
          {
            "text": "register_routers(api, prefix)",
            "lineNumber": 38
          },
          {
            "text": "app_logger.info(\"All routers loaded successfully\")",
            "lineNumber": 39
          },
          {
            "lineNumber": 40
          },
          {
            "text": "# Check if debug mode is enabled via environment variable",
            "lineNumber": 41
          },
          {
            "text": "if os.environ.get('ENABLE_PYTHON_DEBUG') == 'true':",
            "lineNumber": 42
          },
          {
            "text": "    try:",
            "lineNumber": 43
          },
          {
            "text": "        import debugpy",
            "lineNumber": 44
          },
          {
            "text": "        DEBUG_PORT = int(os.environ.get('DEBUG_PORT', '5678'))",
            "lineNumber": 45
          },
          {
            "text": "        app_logger.info(f\"Debug mode enabled - Starting debugpy server on port {DEBUG_PORT}\")",
            "lineNumber": 46
          },
          {
            "text": "        debugpy.listen((\"localhost\", DEBUG_PORT))",
            "lineNumber": 47
          },
          {
            "text": "        app_logger.info(f\"Debugger ready for attachment on localhost:{DEBUG_PORT}\")",
            "lineNumber": 48
          },
          {
            "text": "        #📝 In VS Code: Run 'Debug Python Backend (Attach)' configuration",
            "lineNumber": 49
          },
          {
            "text": "        # Don't wait for client automatically - let it attach when ready",
            "lineNumber": 50
          },
          {
            "text": "    except ImportError:",
            "lineNumber": 51
          },
          {
            "text": "        app_logger.warning(\"debugpy not available, install with: uv add debugpy\")",
            "lineNumber": 52
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 53
          },
          {
            "text": "        app_logger.error(f\"Failed to start debugpy: {e}\")",
            "lineNumber": 54
          },
          {
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "dir = pathlib.Path(__file__).parent / \"runtime\"",
            "lineNumber": 57
          }
        ]
      },
      "score": 0.38889455795288086
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 1800
          },
          "endPosition": {
            "line": 1938
          }
        },
        "contents": "async () =&gt; {\nconst protocolHandler = async \n\n          'Content-Length': data.length.toString(),\n        },\n      });\n    } catch (err) {\n      log.error(&#96;[PROTOCOL] Error reading file: ${err}&#96;);\n      return new Response('Internal Server Error', { status: 500 });\n    }\n  };\n\n  // Register on default session\n  protocol.handle('localfile', protocolHandler);\n\n  // Also register on main window session\n  const mainSession = session.fromPartition('persist:main_window');\n  mainSession.protocol.handle('localfile', protocolHandler);\n\n  log.info(\n    '[PROTOCOL] Registered localfile protocol on both default and main_window sessions'\n  );\n\n  // ==================== initialize app ====================\n  initializeApp();\n  registerIpcHandlers();\n  createWindow();\n});\n\n// ==================== window close event ====================\napp.on",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1801,
                "column": 1
              },
              "endPosition": {
                "line": 1801,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 1801,
                "column": 22
              },
              "endPosition": {
                "line": 1802,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 1839,
                "column": 3
              },
              "endPosition": {
                "line": 1839,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1839,
                "column": 9
              },
              "endPosition": {
                "line": 1839,
                "column": 33
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "async () =&gt; {",
            "lineNumber": 1801
          },
          {
            "text": "const protocolHandler = async ",
            "lineNumber": 1839
          },
          {
            "lineNumber": 1894
          },
          {
            "text": "          'Content-Length': data.length.toString(),",
            "lineNumber": 1895
          },
          {
            "text": "        },",
            "lineNumber": 1896
          },
          {
            "text": "      });",
            "lineNumber": 1897
          },
          {
            "text": "    } catch (err) {",
            "lineNumber": 1898
          },
          {
            "text": "      log.error(&#96;[PROTOCOL] Error reading file: ${err}&#96;);",
            "lineNumber": 1899
          },
          {
            "text": "      return new Response('Internal Server Error', { status: 500 });",
            "lineNumber": 1900
          },
          {
            "text": "    }",
            "lineNumber": 1901
          },
          {
            "text": "  };",
            "lineNumber": 1902
          },
          {
            "lineNumber": 1903
          },
          {
            "text": "  // Register on default session",
            "lineNumber": 1904
          },
          {
            "text": "  protocol.handle('localfile', protocolHandler);",
            "lineNumber": 1905
          },
          {
            "lineNumber": 1906
          },
          {
            "text": "  // Also register on main window session",
            "lineNumber": 1907
          },
          {
            "text": "  const mainSession = session.fromPartition('persist:main_window');",
            "lineNumber": 1908
          },
          {
            "text": "  mainSession.protocol.handle('localfile', protocolHandler);",
            "lineNumber": 1909
          },
          {
            "lineNumber": 1910
          },
          {
            "text": "  log.info(",
            "lineNumber": 1911
          },
          {
            "text": "    '[PROTOCOL] Registered localfile protocol on both default and main_window sessions'",
            "lineNumber": 1912
          },
          {
            "text": "  );",
            "lineNumber": 1913
          },
          {
            "lineNumber": 1914
          },
          {
            "text": "  // ==================== initialize app ====================",
            "lineNumber": 1915
          },
          {
            "text": "  initializeApp();",
            "lineNumber": 1916
          },
          {
            "text": "  registerIpcHandlers();",
            "lineNumber": 1917
          },
          {
            "text": "  createWindow();",
            "lineNumber": 1918
          },
          {
            "text": "});",
            "lineNumber": 1919
          },
          {
            "lineNumber": 1920
          },
          {
            "text": "// ==================== window close event ====================",
            "lineNumber": 1921
          },
          {
            "text": "app.on",
            "lineNumber": 1922
          }
        ]
      },
      "score": 0.3849436938762665
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\package.json",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 36
          }
        },
        "contents": "{\n  \"name\": \"eigent\",\n  \"version\": \"0.0.80\",\n  \"main\": \"dist-electron/main/index.js\",\n  \"description\": \"Eigent\",\n  \"author\": \"Eigent.AI\",\n  \"license\": \"MIT\",\n  \"private\": true,\n  \"debug\": {\n    \"env\": {\n      \"VITE_DEV_SERVER_URL\": \"http://127.0.0.1:7777/\"\n    }\n  },\n  \"type\": \"module\",\n  \"scripts\": {\n    \"compile-babel\": \"cd backend &amp;&amp; uv run pybabel compile -d lang\",\n    \"clean-cache\": \"rimraf node_modules/.vite\",\n    \"dev\": \"npm run clean-cache &amp;&amp; vite\",\n    \"preinstall-deps\": \"node scripts/preinstall-deps.js\",\n    \"clean-symlinks\": \"node scripts/clean-symlinks.js\",\n    \"test-signing\": \"node scripts/test-signing.js\",\n    \"build\": \"npm run preinstall-deps &amp;&amp; npm run clean-symlinks &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp;  electron-builder -- --publish always\",\n    \"build:mac\": \"npm run preinstall-deps &amp;&amp; npm run clean-symlinks &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --mac\",\n    \"build:mac:test\": \"npm run preinstall-deps &amp;&amp; npm run clean-symlinks &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --mac &amp;&amp; npm run test-signing\",\n    \"build:win\": \"npm run preinstall-deps &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --win\",\n    \"build:all\": \"npm run preinstall-deps &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --mac --win\",\n    \"preview\": \"vite preview\",\n    \"pretest\": \"vite build --mode=test\",\n    \"test\": \"vitest run\",\n    \"test:watch\": \"vitest\",\n    \"test:e2e\": \"vitest run --config vitest.config.ts\",\n    \"test:coverage\": \"vitest run --coverage\",\n    \"type-check\": \"tsc --noEmit\"\n  },\n  \"dependencies\": {\n    \"@electron/notarize\": \"^2.5.0\",",
        "signatures": {},
        "detailedLines": [
          {
            "text": "{",
            "lineNumber": 1
          },
          {
            "text": "  \"name\": \"eigent\",",
            "lineNumber": 2
          },
          {
            "text": "  \"version\": \"0.0.80\",",
            "lineNumber": 3
          },
          {
            "text": "  \"main\": \"dist-electron/main/index.js\",",
            "lineNumber": 4
          },
          {
            "text": "  \"description\": \"Eigent\",",
            "lineNumber": 5
          },
          {
            "text": "  \"author\": \"Eigent.AI\",",
            "lineNumber": 6
          },
          {
            "text": "  \"license\": \"MIT\",",
            "lineNumber": 7
          },
          {
            "text": "  \"private\": true,",
            "lineNumber": 8
          },
          {
            "text": "  \"debug\": {",
            "lineNumber": 9
          },
          {
            "text": "    \"env\": {",
            "lineNumber": 10
          },
          {
            "text": "      \"VITE_DEV_SERVER_URL\": \"http://127.0.0.1:7777/\"",
            "lineNumber": 11
          },
          {
            "text": "    }",
            "lineNumber": 12
          },
          {
            "text": "  },",
            "lineNumber": 13
          },
          {
            "text": "  \"type\": \"module\",",
            "lineNumber": 14
          },
          {
            "text": "  \"scripts\": {",
            "lineNumber": 15
          },
          {
            "text": "    \"compile-babel\": \"cd backend &amp;&amp; uv run pybabel compile -d lang\",",
            "lineNumber": 16
          },
          {
            "text": "    \"clean-cache\": \"rimraf node_modules/.vite\",",
            "lineNumber": 17
          },
          {
            "text": "    \"dev\": \"npm run clean-cache &amp;&amp; vite\",",
            "lineNumber": 18
          },
          {
            "text": "    \"preinstall-deps\": \"node scripts/preinstall-deps.js\",",
            "lineNumber": 19
          },
          {
            "text": "    \"clean-symlinks\": \"node scripts/clean-symlinks.js\",",
            "lineNumber": 20
          },
          {
            "text": "    \"test-signing\": \"node scripts/test-signing.js\",",
            "lineNumber": 21
          },
          {
            "text": "    \"build\": \"npm run preinstall-deps &amp;&amp; npm run clean-symlinks &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp;  electron-builder -- --publish always\",",
            "lineNumber": 22
          },
          {
            "text": "    \"build:mac\": \"npm run preinstall-deps &amp;&amp; npm run clean-symlinks &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --mac\",",
            "lineNumber": 23
          },
          {
            "text": "    \"build:mac:test\": \"npm run preinstall-deps &amp;&amp; npm run clean-symlinks &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --mac &amp;&amp; npm run test-signing\",",
            "lineNumber": 24
          },
          {
            "text": "    \"build:win\": \"npm run preinstall-deps &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --win\",",
            "lineNumber": 25
          },
          {
            "text": "    \"build:all\": \"npm run preinstall-deps &amp;&amp; npm run compile-babel &amp;&amp; tsc &amp;&amp; vite build &amp;&amp; electron-builder --mac --win\",",
            "lineNumber": 26
          },
          {
            "text": "    \"preview\": \"vite preview\",",
            "lineNumber": 27
          },
          {
            "text": "    \"pretest\": \"vite build --mode=test\",",
            "lineNumber": 28
          },
          {
            "text": "    \"test\": \"vitest run\",",
            "lineNumber": 29
          },
          {
            "text": "    \"test:watch\": \"vitest\",",
            "lineNumber": 30
          },
          {
            "text": "    \"test:e2e\": \"vitest run --config vitest.config.ts\",",
            "lineNumber": 31
          },
          {
            "text": "    \"test:coverage\": \"vitest run --coverage\",",
            "lineNumber": 32
          },
          {
            "text": "    \"type-check\": \"tsc --noEmit\"",
            "lineNumber": 33
          },
          {
            "text": "  },",
            "lineNumber": 34
          },
          {
            "text": "  \"dependencies\": {",
            "lineNumber": 35
          },
          {
            "text": "    \"@electron/notarize\": \"^2.5.0\",",
            "lineNumber": 36
          }
        ]
      },
      "score": 0.3822341859340668
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\update.ts",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 62,
            "column": 1
          }
        },
        "contents": "import { app, ipcMain } from 'electron'\nimport { createRequire } from 'node:module'\nimport type {\n  ProgressInfo,\n  UpdateDownloadedEvent,\n  UpdateInfo,\n} from 'electron-updater'\n\nconst { autoUpdater } = createRequire(import.meta.url)('electron-updater');\n\nexport function update(win: Electron.BrowserWindow) {\n\n  // When set to false, the update download will be triggered through the API\n  autoUpdater.verifyUpdateCodeSignature = false;\n  autoUpdater.autoDownload = false\n  autoUpdater.disableWebInstaller = false\n  autoUpdater.allowDowngrade = false\n\n  autoUpdater.forceDevUpdateConfig = true\n\n  // start check\n  autoUpdater.on('checking-for-update', function () { })\n  // update available\n  autoUpdater.on('update-available', (arg: UpdateInfo) =&gt; {\n    if (win &amp;&amp; !win.isDestroyed()) {\n      win.webContents.send('update-can-available', { update: true, version: app.getVersion(), newVersion: arg?.version })\n    }\n  })\n  // update not available\n  autoUpdater.on('update-not-available', (arg: UpdateInfo) =&gt; {\n    if (win &amp;&amp; !win.isDestroyed()) {\n      win.webContents.send('update-can-available', { update: false, version: app.getVersion(), newVersion: arg?.version })\n    }\n  })\n  console.log('Current version:', autoUpdater.currentVersion.version)\n  console.log('Update config path:', autoUpdater.getUpdateConfigPath?.())\n  console.log('User data path (where config lives):', app.getPath('userData'))\n  if (app.isPackaged) {\n    autoUpdater.checkForUpdatesAndNotify()\n  }\n  const feed = {\n    provider: 'github',\n    owner: 'eigent-ai',\n    repo: 'eigent',\n    releaseType: 'release',\n    channel: process.platform === 'darwin' ? (process.arch === 'arm64' ? 'latest-arm64' : 'latest-x64') : 'latest'\n  }\n\n  autoUpdater.setFeedURL(feed)\n  if (!app.isPackaged) {\n    console.log('[DEV] setFeedURL:', feed)\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import { app, ipcMain } from 'electron'",
            "lineNumber": 1
          },
          {
            "text": "import { createRequire } from 'node:module'",
            "lineNumber": 2
          },
          {
            "text": "import type {",
            "lineNumber": 3
          },
          {
            "text": "  ProgressInfo,",
            "lineNumber": 4
          },
          {
            "text": "  UpdateDownloadedEvent,",
            "lineNumber": 5
          },
          {
            "text": "  UpdateInfo,",
            "lineNumber": 6
          },
          {
            "text": "} from 'electron-updater'",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "const { autoUpdater } = createRequire(import.meta.url)('electron-updater');",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "export function update(win: Electron.BrowserWindow) {",
            "lineNumber": 11,
            "isSignature": true
          },
          {
            "lineNumber": 12
          },
          {
            "text": "  // When set to false, the update download will be triggered through the API",
            "lineNumber": 13
          },
          {
            "text": "  autoUpdater.verifyUpdateCodeSignature = false;",
            "lineNumber": 14
          },
          {
            "text": "  autoUpdater.autoDownload = false",
            "lineNumber": 15
          },
          {
            "text": "  autoUpdater.disableWebInstaller = false",
            "lineNumber": 16
          },
          {
            "text": "  autoUpdater.allowDowngrade = false",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "  autoUpdater.forceDevUpdateConfig = true",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "  // start check",
            "lineNumber": 21
          },
          {
            "text": "  autoUpdater.on('checking-for-update', function () { })",
            "lineNumber": 22
          },
          {
            "text": "  // update available",
            "lineNumber": 23
          },
          {
            "text": "  autoUpdater.on('update-available', (arg: UpdateInfo) =&gt; {",
            "lineNumber": 24
          },
          {
            "text": "    if (win &amp;&amp; !win.isDestroyed()) {",
            "lineNumber": 25
          },
          {
            "text": "      win.webContents.send('update-can-available', { update: true, version: app.getVersion(), newVersion: arg?.version })",
            "lineNumber": 26
          },
          {
            "text": "    }",
            "lineNumber": 27
          },
          {
            "text": "  })",
            "lineNumber": 28
          },
          {
            "text": "  // update not available",
            "lineNumber": 29
          },
          {
            "text": "  autoUpdater.on('update-not-available', (arg: UpdateInfo) =&gt; {",
            "lineNumber": 30
          },
          {
            "text": "    if (win &amp;&amp; !win.isDestroyed()) {",
            "lineNumber": 31
          },
          {
            "text": "      win.webContents.send('update-can-available', { update: false, version: app.getVersion(), newVersion: arg?.version })",
            "lineNumber": 32
          },
          {
            "text": "    }",
            "lineNumber": 33
          },
          {
            "text": "  })",
            "lineNumber": 34
          },
          {
            "text": "  console.log('Current version:', autoUpdater.currentVersion.version)",
            "lineNumber": 35
          },
          {
            "text": "  console.log('Update config path:', autoUpdater.getUpdateConfigPath?.())",
            "lineNumber": 36
          },
          {
            "text": "  console.log('User data path (where config lives):', app.getPath('userData'))",
            "lineNumber": 37
          },
          {
            "text": "  if (app.isPackaged) {",
            "lineNumber": 38
          },
          {
            "text": "    autoUpdater.checkForUpdatesAndNotify()",
            "lineNumber": 39
          },
          {
            "text": "  }",
            "lineNumber": 40
          },
          {
            "text": "  const feed = {",
            "lineNumber": 41
          },
          {
            "text": "    provider: 'github',",
            "lineNumber": 42
          },
          {
            "text": "    owner: 'eigent-ai',",
            "lineNumber": 43
          },
          {
            "text": "    repo: 'eigent',",
            "lineNumber": 44
          },
          {
            "text": "    releaseType: 'release',",
            "lineNumber": 45
          },
          {
            "text": "    channel: process.platform === 'darwin' ? (process.arch === 'arm64' ? 'latest-arm64' : 'latest-x64') : 'latest'",
            "lineNumber": 46
          },
          {
            "text": "  }",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "  autoUpdater.setFeedURL(feed)",
            "lineNumber": 49
          },
          {
            "text": "  if (!app.isPackaged) {",
            "lineNumber": 50
          },
          {
            "text": "    console.log('[DEV] setFeedURL:', feed)",
            "lineNumber": 51
          },
          {
            "text": "}",
            "lineNumber": 63,
            "isSignature": true
          }
        ]
      },
      "score": 0.3651421070098877
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 320
          },
          "endPosition": {
            "line": 1184,
            "column": 1
          }
        },
        "contents": "function registerIpcHandlers() {\nasync (event, email: string) =&gt; {\n\n  });\n  ipcMain.handle(\n    'execute-command',\n    async (event, command: string, email: string) =&gt; {\n      log.info('execute-command', command);\n      const { MCP_REMOTE_CONFIG_DIR } = getEmailFolderPath(email);\n\n      try {\n        const { spawn } = await import('child_process');\n\n        // Add --host parameter\n        const commandWithHost = &#96;${command} --debug --host dev.eigent.ai/api/oauth/notion/callback?code=1&#96;;\n        // const commandWithHost = &#96;${command}&#96;;\n\n        log.info(' start execute command:', commandWithHost);\n\n        // Parse command and arguments\n        const [cmd, ...args] = commandWithHost.split(' ');\n        log.info('start execute command:', commandWithHost.split(' '));\n        console.log(cmd, args);\n        return new Promise((resolve) =&gt; {\n          const child = spawn(cmd, args, {\n            cwd: process.cwd(),\n            env: { ...process.env, MCP_REMOTE_CONFIG_DIR },\n            stdio: ['pipe', 'pipe', 'pipe'],\n          });\n\n          let stdout = '';\n          let stderr = '';\n\n          // Realtime listen standard output\n          child.stdout.on('data', (data) =&gt; {\n            const output = data.toString();\n            stdout += output;\n            log.info('Real-time output:', output.trim());\n          });\n\n          // Realtime listen error output\n          child.stderr.on\n\n        }\n    }\n\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 321,
                "column": 1
              },
              "endPosition": {
                "line": 322,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "function registerIpcHandlers() {",
            "lineNumber": 321,
            "isSignature": true
          },
          {
            "text": "async (event, email: string) =&gt; {",
            "lineNumber": 370
          },
          {
            "lineNumber": 371
          },
          {
            "text": "  });",
            "lineNumber": 372
          },
          {
            "text": "  ipcMain.handle(",
            "lineNumber": 373
          },
          {
            "text": "    'execute-command',",
            "lineNumber": 374
          },
          {
            "text": "    async (event, command: string, email: string) =&gt; {",
            "lineNumber": 375
          },
          {
            "text": "      log.info('execute-command', command);",
            "lineNumber": 376
          },
          {
            "text": "      const { MCP_REMOTE_CONFIG_DIR } = getEmailFolderPath(email);",
            "lineNumber": 377
          },
          {
            "lineNumber": 378
          },
          {
            "text": "      try {",
            "lineNumber": 379
          },
          {
            "text": "        const { spawn } = await import('child_process');",
            "lineNumber": 380
          },
          {
            "lineNumber": 381
          },
          {
            "text": "        // Add --host parameter",
            "lineNumber": 382
          },
          {
            "text": "        const commandWithHost = &#96;${command} --debug --host dev.eigent.ai/api/oauth/notion/callback?code=1&#96;;",
            "lineNumber": 383
          },
          {
            "text": "        // const commandWithHost = &#96;${command}&#96;;",
            "lineNumber": 384
          },
          {
            "lineNumber": 385
          },
          {
            "text": "        log.info(' start execute command:', commandWithHost);",
            "lineNumber": 386
          },
          {
            "lineNumber": 387
          },
          {
            "text": "        // Parse command and arguments",
            "lineNumber": 388
          },
          {
            "text": "        const [cmd, ...args] = commandWithHost.split(' ');",
            "lineNumber": 389
          },
          {
            "text": "        log.info('start execute command:', commandWithHost.split(' '));",
            "lineNumber": 390
          },
          {
            "text": "        console.log(cmd, args);",
            "lineNumber": 391
          },
          {
            "text": "        return new Promise((resolve) =&gt; {",
            "lineNumber": 392
          },
          {
            "text": "          const child = spawn(cmd, args, {",
            "lineNumber": 393
          },
          {
            "text": "            cwd: process.cwd(),",
            "lineNumber": 394
          },
          {
            "text": "            env: { ...process.env, MCP_REMOTE_CONFIG_DIR },",
            "lineNumber": 395
          },
          {
            "text": "            stdio: ['pipe', 'pipe', 'pipe'],",
            "lineNumber": 396
          },
          {
            "text": "          });",
            "lineNumber": 397
          },
          {
            "lineNumber": 398
          },
          {
            "text": "          let stdout = '';",
            "lineNumber": 399
          },
          {
            "text": "          let stderr = '';",
            "lineNumber": 400
          },
          {
            "lineNumber": 401
          },
          {
            "text": "          // Realtime listen standard output",
            "lineNumber": 402
          },
          {
            "text": "          child.stdout.on('data', (data) =&gt; {",
            "lineNumber": 403
          },
          {
            "text": "            const output = data.toString();",
            "lineNumber": 404
          },
          {
            "text": "            stdout += output;",
            "lineNumber": 405
          },
          {
            "text": "            log.info('Real-time output:', output.trim());",
            "lineNumber": 406
          },
          {
            "text": "          });",
            "lineNumber": 407
          },
          {
            "lineNumber": 408
          },
          {
            "text": "          // Realtime listen error output",
            "lineNumber": 409
          },
          {
            "text": "          child.stderr.on",
            "lineNumber": 410
          },
          {
            "lineNumber": 434
          },
          {
            "text": "        }",
            "lineNumber": 447
          },
          {
            "text": "    }",
            "lineNumber": 452
          },
          {
            "lineNumber": 453
          },
          {
            "text": "}",
            "lineNumber": 1185,
            "isSignature": true
          }
        ]
      },
      "score": 0.3645736575126648
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\update.ts",
        "range": {
          "startPosition": {
            "line": 10
          },
          "endPosition": {
            "line": 67,
            "column": 3
          }
        },
        "contents": "export function update(win: Electron.BrowserWindow) {\n\n  if (!app.isPackaged) {\n    console.log('[DEV] setFeedURL:', feed)\n    // In development, check for updates but don't fail if it errors\n    autoUpdater.checkForUpdates().catch((err: Error) =&gt; {\n      console.log('[DEV] Update check failed (expected in dev environment):', err.message)\n    })\n  }\n\n  // Handle errors globally to prevent crashes\n  autoUpdater.on('error', (error: Error) =&gt; {\n    console.error('[AutoUpdater] Update error:', error.message)\n    // Don't crash the app on update errors\n  })\n}\n\n/**\n * Registers update-related IPC handlers\n * Should be called once when the app starts\n */",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 11,
                "column": 1
              },
              "endPosition": {
                "line": 11,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 11,
                "column": 8
              },
              "endPosition": {
                "line": 13,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export function update(win: Electron.BrowserWindow) {",
            "lineNumber": 11,
            "isSignature": true
          },
          {
            "lineNumber": 49
          },
          {
            "text": "  if (!app.isPackaged) {",
            "lineNumber": 50
          },
          {
            "text": "    console.log('[DEV] setFeedURL:', feed)",
            "lineNumber": 51
          },
          {
            "text": "    // In development, check for updates but don't fail if it errors",
            "lineNumber": 52
          },
          {
            "text": "    autoUpdater.checkForUpdates().catch((err: Error) =&gt; {",
            "lineNumber": 53
          },
          {
            "text": "      console.log('[DEV] Update check failed (expected in dev environment):', err.message)",
            "lineNumber": 54
          },
          {
            "text": "    })",
            "lineNumber": 55
          },
          {
            "text": "  }",
            "lineNumber": 56
          },
          {
            "lineNumber": 57
          },
          {
            "text": "  // Handle errors globally to prevent crashes",
            "lineNumber": 58
          },
          {
            "text": "  autoUpdater.on('error', (error: Error) =&gt; {",
            "lineNumber": 59
          },
          {
            "text": "    console.error('[AutoUpdater] Update error:', error.message)",
            "lineNumber": 60
          },
          {
            "text": "    // Don't crash the app on update errors",
            "lineNumber": 61
          },
          {
            "text": "  })",
            "lineNumber": 62
          },
          {
            "text": "}",
            "lineNumber": 63,
            "isSignature": true
          },
          {
            "lineNumber": 64
          },
          {
            "text": "/**",
            "lineNumber": 65
          },
          {
            "text": " * Registers update-related IPC handlers",
            "lineNumber": 66
          },
          {
            "text": " * Should be called once when the app starts",
            "lineNumber": 67
          },
          {
            "text": " */",
            "lineNumber": 68
          }
        ]
      },
      "score": 0.3636820316314697
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\test\\unit\\electron\\main\\index.test.ts",
        "range": {
          "startPosition": {
            "column": 73
          },
          "endPosition": {
            "line": 109,
            "column": 1
          }
        },
        "contents": "// Mock all modules first\nconst mockApp = {\n  getPath: vi.fn(),\n  getVersion: vi.fn(),\n  getLocale: vi.fn(),\n  requestSingleInstanceLock: vi.fn(),\n  quit: vi.fn(),\n  setAsDefaultProtocolClient: vi.fn(),\n  isDefaultProtocolClient: vi.fn(),\n  setAppUserModelId: vi.fn(),\n  disableHardwareAcceleration: vi.fn(),\n  commandLine: {\n    appendSwitch: vi.fn(),\n  },\n  whenReady: vi.fn(),\n  on: vi.fn(),\n};\n\nconst mockBrowserWindow = vi.fn(() =&gt; ({\n  loadURL: vi.fn(),\n  loadFile: vi.fn(),\n  show: vi.fn(),\n  close: vi.fn(),\n  minimize: vi.fn(),\n  isMaximized: vi.fn(),\n  maximize: vi.fn(),\n  unmaximize: vi.fn(),\n  isDestroyed: vi.fn(),\n  isFullScreen: vi.fn(),\n  webContents: {\n    openDevTools: vi.fn(),\n    send: vi.fn(),\n    on: vi.fn(),\n    setWindowOpenHandler: vi.fn(),\n    toggleDevTools: vi.fn(),\n  },\n  getAllWindows: vi.fn(),\n}));\n\nconst mockDialog = {\n  showOpenDialog: vi.fn(),\n  showSaveDialog: vi.fn(),\n};\n\nconst mockShell = {\n  openExternal: vi.fn(),\n  showItemInFolder: vi.fn(),\n};\n\nconst mockIpcMain = {\n  handle: vi.fn(),\n  on: vi.fn(),\n};\n\nconst mockMenu = {\n  setApplicationMenu: vi.fn(),\n};\n\nconst mockFs = {\n  existsSync: vi.fn(),\n  readFileSync: vi.fn(),\n  writeFileSync: vi.fn(),\n  createReadStream: vi.fn(),\n  unlinkSync: vi.fn(),\n  createWriteStream: vi.fn(),\n};\n\nconst mockFsp = {\n  access: vi.fn(),\n  stat: vi.fn(),\n  readFile: vi.fn(),\n  writeFile: vi.fn(),\n  rm: vi.fn(),\n};\n\nconst mockOs = {\n  release: vi.fn(),\n  homedir: vi.fn(),\n};\n\nconst mockLog = {\n  info: vi.fn(),\n  error: vi.fn(),\n  warn: vi.fn(),\n  transports: {\n    file: {\n      getFile: vi.fn(() =&gt; ({ path: \"/mock/log/path\" })),\n    },\n    console: { level: \"info\" },\n  },\n};\n\nconst mockAxios = {\n  post: vi.fn(),\n};\n\n// Apply mocks\nvi.mock(\"electron\", () =&gt; ({\n  app: mockApp,\n)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "// Mock all modules first",
            "lineNumber": 3
          },
          {
            "text": "const mockApp = {",
            "lineNumber": 4
          },
          {
            "text": "  getPath: vi.fn(),",
            "lineNumber": 5
          },
          {
            "text": "  getVersion: vi.fn(),",
            "lineNumber": 6
          },
          {
            "text": "  getLocale: vi.fn(),",
            "lineNumber": 7
          },
          {
            "text": "  requestSingleInstanceLock: vi.fn(),",
            "lineNumber": 8
          },
          {
            "text": "  quit: vi.fn(),",
            "lineNumber": 9
          },
          {
            "text": "  setAsDefaultProtocolClient: vi.fn(),",
            "lineNumber": 10
          },
          {
            "text": "  isDefaultProtocolClient: vi.fn(),",
            "lineNumber": 11
          },
          {
            "text": "  setAppUserModelId: vi.fn(),",
            "lineNumber": 12
          },
          {
            "text": "  disableHardwareAcceleration: vi.fn(),",
            "lineNumber": 13
          },
          {
            "text": "  commandLine: {",
            "lineNumber": 14
          },
          {
            "text": "    appendSwitch: vi.fn(),",
            "lineNumber": 15
          },
          {
            "text": "  },",
            "lineNumber": 16
          },
          {
            "text": "  whenReady: vi.fn(),",
            "lineNumber": 17
          },
          {
            "text": "  on: vi.fn(),",
            "lineNumber": 18
          },
          {
            "text": "};",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "const mockBrowserWindow = vi.fn(() =&gt; ({",
            "lineNumber": 21
          },
          {
            "text": "  loadURL: vi.fn(),",
            "lineNumber": 22
          },
          {
            "text": "  loadFile: vi.fn(),",
            "lineNumber": 23
          },
          {
            "text": "  show: vi.fn(),",
            "lineNumber": 24
          },
          {
            "text": "  close: vi.fn(),",
            "lineNumber": 25
          },
          {
            "text": "  minimize: vi.fn(),",
            "lineNumber": 26
          },
          {
            "text": "  isMaximized: vi.fn(),",
            "lineNumber": 27
          },
          {
            "text": "  maximize: vi.fn(),",
            "lineNumber": 28
          },
          {
            "text": "  unmaximize: vi.fn(),",
            "lineNumber": 29
          },
          {
            "text": "  isDestroyed: vi.fn(),",
            "lineNumber": 30
          },
          {
            "text": "  isFullScreen: vi.fn(),",
            "lineNumber": 31
          },
          {
            "text": "  webContents: {",
            "lineNumber": 32
          },
          {
            "text": "    openDevTools: vi.fn(),",
            "lineNumber": 33
          },
          {
            "text": "    send: vi.fn(),",
            "lineNumber": 34
          },
          {
            "text": "    on: vi.fn(),",
            "lineNumber": 35
          },
          {
            "text": "    setWindowOpenHandler: vi.fn(),",
            "lineNumber": 36
          },
          {
            "text": "    toggleDevTools: vi.fn(),",
            "lineNumber": 37
          },
          {
            "text": "  },",
            "lineNumber": 38
          },
          {
            "text": "  getAllWindows: vi.fn(),",
            "lineNumber": 39
          },
          {
            "text": "}));",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "const mockDialog = {",
            "lineNumber": 42
          },
          {
            "text": "  showOpenDialog: vi.fn(),",
            "lineNumber": 43
          },
          {
            "text": "  showSaveDialog: vi.fn(),",
            "lineNumber": 44
          },
          {
            "text": "};",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "const mockShell = {",
            "lineNumber": 47
          },
          {
            "text": "  openExternal: vi.fn(),",
            "lineNumber": 48
          },
          {
            "text": "  showItemInFolder: vi.fn(),",
            "lineNumber": 49
          },
          {
            "text": "};",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "const mockIpcMain = {",
            "lineNumber": 52
          },
          {
            "text": "  handle: vi.fn(),",
            "lineNumber": 53
          },
          {
            "text": "  on: vi.fn(),",
            "lineNumber": 54
          },
          {
            "text": "};",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "const mockMenu = {",
            "lineNumber": 57
          },
          {
            "text": "  setApplicationMenu: vi.fn(),",
            "lineNumber": 58
          },
          {
            "text": "};",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "const mockFs = {",
            "lineNumber": 61
          },
          {
            "text": "  existsSync: vi.fn(),",
            "lineNumber": 62
          },
          {
            "text": "  readFileSync: vi.fn(),",
            "lineNumber": 63
          },
          {
            "text": "  writeFileSync: vi.fn(),",
            "lineNumber": 64
          },
          {
            "text": "  createReadStream: vi.fn(),",
            "lineNumber": 65
          },
          {
            "text": "  unlinkSync: vi.fn(),",
            "lineNumber": 66
          },
          {
            "text": "  createWriteStream: vi.fn(),",
            "lineNumber": 67
          },
          {
            "text": "};",
            "lineNumber": 68
          },
          {
            "lineNumber": 69
          },
          {
            "text": "const mockFsp = {",
            "lineNumber": 70
          },
          {
            "text": "  access: vi.fn(),",
            "lineNumber": 71
          },
          {
            "text": "  stat: vi.fn(),",
            "lineNumber": 72
          },
          {
            "text": "  readFile: vi.fn(),",
            "lineNumber": 73
          },
          {
            "text": "  writeFile: vi.fn(),",
            "lineNumber": 74
          },
          {
            "text": "  rm: vi.fn(),",
            "lineNumber": 75
          },
          {
            "text": "};",
            "lineNumber": 76
          },
          {
            "lineNumber": 77
          },
          {
            "text": "const mockOs = {",
            "lineNumber": 78
          },
          {
            "text": "  release: vi.fn(),",
            "lineNumber": 79
          },
          {
            "text": "  homedir: vi.fn(),",
            "lineNumber": 80
          },
          {
            "text": "};",
            "lineNumber": 81
          },
          {
            "lineNumber": 82
          },
          {
            "text": "const mockLog = {",
            "lineNumber": 83
          },
          {
            "text": "  info: vi.fn(),",
            "lineNumber": 84
          },
          {
            "text": "  error: vi.fn(),",
            "lineNumber": 85
          },
          {
            "text": "  warn: vi.fn(),",
            "lineNumber": 86
          },
          {
            "text": "  transports: {",
            "lineNumber": 87
          },
          {
            "text": "    file: {",
            "lineNumber": 88
          },
          {
            "text": "      getFile: vi.fn(() =&gt; ({ path: \"/mock/log/path\" })),",
            "lineNumber": 89
          },
          {
            "text": "    },",
            "lineNumber": 90
          },
          {
            "text": "    console: { level: \"info\" },",
            "lineNumber": 91
          },
          {
            "text": "  },",
            "lineNumber": 92
          },
          {
            "text": "};",
            "lineNumber": 93
          },
          {
            "lineNumber": 94
          },
          {
            "text": "const mockAxios = {",
            "lineNumber": 95
          },
          {
            "text": "  post: vi.fn(),",
            "lineNumber": 96
          },
          {
            "text": "};",
            "lineNumber": 97
          },
          {
            "lineNumber": 98
          },
          {
            "text": "// Apply mocks",
            "lineNumber": 99
          },
          {
            "text": "vi.mock(\"electron\", () =&gt; ({",
            "lineNumber": 100
          },
          {
            "text": "  app: mockApp,",
            "lineNumber": 101
          },
          {
            "text": ")",
            "lineNumber": 110
          }
        ]
      },
      "score": 0.3569912910461426
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\controller\\tool_controller.py",
        "range": {
          "startPosition": {
            "line": 304
          },
          "endPosition": {
            "line": 822
          }
        },
        "contents": "@router.post(\"/browser/login\", name=\"open browser for login\")\nasync def open_browser_login():\n\n        electron_script_content = '''\nconst { app, BrowserWindow, ipcMain } = require('electron');\nconst path = require('path');\n\n// Parse command line arguments\nconst args = process.argv.slice(2);\nconst userDataDir = args[0];\nconst cdpPort = args[1];\nconst startUrl = args[2] || 'https://www.google.com';\n\n// This must be called before app.ready\napp.commandLine.appendSwitch('remote-debugging-port', cdpPort);\n\nconsole.log('[ELECTRON BROWSER] Starting with:');\nconsole.log('  Chrome version:', process.versions.chrome);\nconsole.log('  User data dir (requested):', userDataDir);\nconsole.log('  CDP port:', cdpPort);\nconsole.log('  Start URL:', startUrl);\n\n// Set app paths - must be done before app.ready\n// Do NOT use commandLine.appendSwitch('user-data-dir') as it conflicts with setPath\napp.setPath('userData', userDataDir);\napp.setPath('sessionData', userDataDir);\n\napp.whenReady().then(async () =&gt; {\n  const { session } = require('electron');\n  const fs = require('fs');\n  const path = require('path');\n\n  // Log actual paths being used\n  console.log('[ELECTRON BROWSER] Actual paths:');\n  console.log('  app.getPath(\"userData\"):', app.getPath('userData'));\n  console.log('  app.getPath(\"sessionData\"):', app.getPath('sessionData'));\n  console.log('  app.getPath(\"cache\"):', app.getPath('cache'));\n  console.log('  app.getPath(\"temp\"):', app.getPath('temp'));\n  console.log('  process.argv:', process.argv);\n\n  // Check command line switches\n  console.log('[ELECTRON BROWSER] Command line switches:');\n  console.log('  user-data-dir:', app.commandLine.getSwitchValue('user-data-dir'));\n  console.log('  remote-debugging-port:', app.commandLine.getSwitchValue('remote-debugging-port'));\n\n  // Log partition session info\n  const userLoginSession = session.fromPartition('persist:user_login');\n  console.log('[ELECTRON BROWSER] Session info:');\n  console.log('  Partition: persist:user_login');\n  console.log('  Session storage path:', userLoginSession.getStoragePath());\n\n  // Check if Cookies file exists\n  const cookiesPath = path.join(app.getPath('userData'), 'Partitions', 'user_login', 'Cookies');\n  console.log('[ELECTRON BROWSER] Cookies path:', cookiesPath);\n  console.log('[ELECTRON BROWSER] Cookies exists:', fs.existsSync(cookiesPath));\n  if (fs.existsSync(cookiesPath)) {\n    const stats = fs.statSync(cookiesPath);\n    console.log('[ELECTRON BROWSER] Cookies file size:', stats.size, 'bytes');\n  }\n  const win = new BrowserWindow({\n    width: 1400,\n    height: 900,\n    title: 'Eigent Browser - Login',\n    webPreferences: {\n      nodeIntegration: true,\n      contextIsolation: false,\n      webviewTag: true\n    }\n  });\n\n  // Create navigation bar and webview\n  const html = &#96;\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;\n      display: flex;\n      flex-direction: column;\n      height: 100vh;\n      overflow: hidden;\n    }\n    \n    #nav-bar {\n      display: flex;\n      align-items: center;\n      padding: 8px;\n      background: #f5f5f5;\n      border-bottom: 1px solid #ddd;\n      gap: 8px;\n    }\n    \n    button {\n      padding: 6px 12px;\n      border: 1px solid #ccc;\n      background: white;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 14px;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n    }\n    \n    button:hover:not(:disabled) {\n      background: #f0f0f0;\n    }\n    \n    button:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n    \n    #url-input {\n      flex: 1;\n      padding: 8px 12px;\n      border: 1px solid #ccc;\n      border-radius: 4px;\n      font-size: 14px;\n    }\n    \n    #url-input:focus {\n      outline: none;\n      border-color: #4285f4;\n    }\n    \n    #webview {\n      flex: 1;\n      width: 100%;\n      border: none;\n    }\n    \n    .nav-icon {\n      font-size: 16px;\n    }\n    \n    #loading-indicator {\n      width: 20px;\n      height: 20px;\n      border: 2px solid #f3f3f3;\n      border-top: 2px solid #4285f4;\n      border-radius: 50%;\n      animation: spin 1s linear infinite;\n      display: none;\n    }\n    \n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n    \n    .loading #loading-indicator {\n      display: block;\n    }\n    \n    .loading #reload-btn .nav-icon {\n      display: none;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"nav-bar\"&gt;\n    &lt;button id=\"back-btn\" title=\"Back\"&gt;\n      &lt;span class=\"nav-icon\"&gt;←&lt;/span&gt;\n    &lt;/button&gt;\n    &lt;button id=\"forward-btn\" title=\"Forward\"&gt;\n      &lt;span class=\"nav-icon\"&gt;→&lt;/span&gt;\n    &lt;/button&gt;\n    &lt;button id=\"reload-btn\" title=\"Reload\"&gt;\n      &lt;span class=\"nav-icon\"&gt;↻&lt;/span&gt;\n      &lt;div id=\"loading-indicator\"&gt;&lt;/div&gt;\n    &lt;/button&gt;\n    &lt;button id=\"home-btn\" title=\"Home\"&gt;\n      &lt;span class=\"nav-icon\"&gt;🏠&lt;/span&gt;\n    &lt;/button&gt;\n    &lt;input type=\"text\" id=\"url-input\" placeholder=\"Enter URL...\" /&gt;\n    &lt;button id=\"go-btn\"&gt;Go&lt;/button&gt;\n    &lt;button id=\"linkedin-btn\" style=\"background: #0077B5; color: white; border-color: #0077B5;\"&gt;\n      LinkedIn\n    &lt;/button&gt;\n    &lt;button id=\"info-btn\" title=\"Show Info\"&gt;ℹ️&lt;/button&gt;\n  &lt;/div&gt;\n  \n  &lt;webview id=\"webview\" src=\"${startUrl}\" partition=\"persist:user_login\"&gt;&lt;/webview&gt;\n  \n  &lt;div id=\"info-panel\" style=\"display: none; position: absolute; top: 50px; right: 10px; background: white; border: 1px solid #ccc; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; max-width: 400px; font-size: 12px;\"&gt;\n    &lt;h4 style=\"margin: 0 0 10px 0;\"&gt;Browser Info&lt;/h4&gt;\n    &lt;div id=\"info-content\"&gt;&lt;/div&gt;\n    &lt;button onclick=\"document.getElementById('info-panel').style.display='none'\" style=\"margin-top: 10px;\"&gt;Close&lt;/button&gt;\n  &lt;/div&gt;\n  \n  &lt;script&gt;\n    const webview = document.getElementById('webview');\n    const backBtn = document.getElementById('back-btn');\n    const forwardBtn = document.getElementById('forward-btn');\n    const reloadBtn = document.getElementById('reload-btn');\n    const homeBtn = document.getElementById('home-btn');\n    const urlInput = document.getElementById('url-input');\n    const goBtn = document.getElementById('go-btn');\n    const linkedinBtn = document.getElementById('linkedin-btn');\n    const navBar = document.getElementById('nav-bar');\n    const infoBtn = document.getElementById('info-btn');\n    const infoPanel = document.getElementById('info-panel');\n    const infoContent = document.getElementById('info-content');\n    \n    // Show info panel\n    infoBtn.addEventListener('click', () =&gt; {\n      const { ipcRenderer } = require('electron');\n      \n      // Get browser info\n      const info = {\n        'Chrome Version': process.versions.chrome,\n        'Electron Version': process.versions.electron,\n        'Node Version': process.versions.node,\n        'User Data Dir (requested)': '${userDataDir}',\n        'CDP Port': '${cdpPort}',\n        'Platform': process.platform,\n        'Architecture': process.arch\n      };\n      \n      // Also check webview partition info\n      const partition = webview.partition || 'default';\n      info['WebView Partition'] = partition;\n      \n      // Format info as HTML\n      let html = '&lt;table style=\"width: 100%; border-collapse: collapse;\"&gt;';\n      for (const [key, value] of Object.entries(info)) {\n        html += '&lt;tr&gt;&lt;td style=\"padding: 4px; border-bottom: 1px solid #eee;\"&gt;&lt;strong&gt;' + key + ':&lt;/strong&gt;&lt;/td&gt;&lt;td style=\"padding: 4px; border-bottom: 1px solid #eee; word-break: break-all;\"&gt;' + value + '&lt;/td&gt;&lt;/tr&gt;';\n      }\n      html += '&lt;/table&gt;';\n      \n      infoContent.innerHTML = html;\n      infoPanel.style.display = 'block';\n    });\n    \n    // Update navigation buttons\n    function updateNavButtons() {\n      backBtn.disabled = !webview.canGoBack();\n      forwardBtn.disabled = !webview.canGoForward();\n    }\n    \n    // Navigate to URL\n    function navigateToUrl() {\n      let url = urlInput.value.trim();\n      if (!url) return;\n      \n      if (!url.startsWith('http://') &amp;&amp; !url.startsWith('https://')) {\n        url = 'https://' + url;\n      }\n      \n      webview.loadURL(url);\n    }\n    \n    // Event listeners\n    backBtn.addEventListener('click', () =&gt; webview.goBack());\n    forwardBtn.addEventListener('click', () =&gt; webview.goForward());\n    reloadBtn.addEventListener('click', () =&gt; webview.reload());\n    homeBtn.addEventListener('click', () =&gt; webview.loadURL('${startUrl}'));\n    goBtn.addEventListener('click', navigateToUrl);\n    linkedinBtn.addEventListener('click', () =&gt; webview.loadURL('https://www.linkedin.com'));\n    \n    urlInput.addEventListener('keypress', (e) =&gt; {\n      if (e.key === 'Enter') {\n        navigateToUrl();\n      }\n    });\n    \n    // WebView events\n    webview.addEventListener('did-start-loading', () =&gt; {\n      navBar.classList.add('loading');\n    });\n    \n    webview.addEventListener('did-stop-loading', () =&gt; {\n      navBar.classList.remove('loading');\n      updateNavButtons();\n    });\n    \n    webview.addEventListener('did-navigate', (e) =&gt; {\n      urlInput.value = e.url;\n      updateNavButtons();\n    });\n    \n    webview.addEventListener('did-navigate-in-page', (e) =&gt; {\n      urlInput.value = e.url;\n      updateNavButtons();\n    });\n    \n    webview.addEventListener('new-window', (e) =&gt; {\n      // Open new windows in the same webview\n      e.preventDefault();\n      webview.loadURL(e.url);\n    });\n    \n    // Initialize\n    updateNavButtons();\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;&#96;;\n\n  win.loadURL('data:text/html;charset=UTF-8,' + encodeURIComponent(html));\n\n  // Show window when ready\n  win.once('ready-to-show', () =&gt; {\n    win.show();\n\n    // Log cookies periodically to track changes\n    setInterval(async () =&gt; {\n      try {\n        const cookies = await userLoginSession.cookies.get({});\n        console.log('[ELECTRON BROWSER] Current cookies count:', cookies.length);\n        if (cookies.length &gt; 0) {\n          console.log('[ELECTRON BROWSER] Cookie domains:', [...new Set(cookies.map(c =&gt; c.domain))]);\n        }\n      } catch (error) {\n        console.error('[ELECTRON BROWSER] Failed to get cookies:', error);\n      }\n    }, 5000); // Check every 5 seconds\n  });\n  \n  win.on('closed', async () =&gt; {\n    console.log('[ELECTRON BROWSER] Window closed, preparing to quit...');\n\n    // Flush storage data before quitting to ensure cookies are saved\n    try {\n      const { session } = require('electron');\n      const fs = require('fs');\n      const path = require('path');\n      const userLoginSession = session.fromPartition('persist:user_login');\n\n      // Log cookies before flush\n      const cookiesBeforeFlush = await userLoginSession.cookies.get({});\n      console.log('[ELECTRON BROWSER] Cookies count before flush:', cookiesBeforeFlush.length);\n\n      // Flush storage\n      console.log('[ELECTRON BROWSER] Flushing storage data...');\n      await userLoginSession.flushStorageData();\n      console.log('[ELECTRON BROWSER] Storage data flushed successfully');\n\n      // Check cookies file after flush\n      const cookiesPath = path.join(app.getPath('userData'), 'Partitions', 'user_login', 'Cookies');\n      if (fs.existsSync(cookiesPath)) {\n        const stats = fs.statSync(cookiesPath);\n        console.log('[ELECTRON BROWSER] Cookies file size after flush:', stats.size, 'bytes');\n      } else {\n        console.log('[ELECTRON BROWSER] WARNING: Cookies file does not exist after flush!');\n      }\n    } catch (error) {\n      console.error('[ELECTRON BROWSER] Failed to flush storage data:', error);\n    }\n    app.quit();\n  });\n});\n\nlet isQuitting = false;\n\napp.on('before-quit', async (event) =&gt; {\n  if (isQuitting) return;\n\n  // Prevent immediate quit to allow storage flush and cookie sync\n  event.preventDefault();\n  isQuitting = true;\n\n  console.log('[ELECTRON BROWSER] before-quit event triggered');\n\n  try {\n    const { session } = require('electron');\n    const fs = require('fs');\n    const path = require('path');\n    const userLoginSession = session.fromPartition('persist:user_login');\n\n    // Log cookies before flush\n    const cookiesBeforeQuit = await userLoginSession.cookies.get({});\n    console.log('[ELECTRON BROWSER] Cookies count before quit:', cookiesBeforeQuit.length);\n    if (cookiesBeforeQuit.length &gt; 0) {\n      console.log('[ELECTRON BROWSER] Cookie domains before quit:', [...new Set(cookiesBeforeQuit.map(c =&gt; c.domain))]);\n    }\n\n    // Flush storage\n    console.log('[ELECTRON BROWSER] Flushing storage on quit...');\n    await userLoginSession.flushStorageData();\n    console.log('[ELECTRON BROWSER] Storage data flushed on quit');\n  } catch (error) {\n    console.error('[ELECTRON BROWSER] Failed to sync cookies:', error);\n  } finally {\n    console.log('[ELECTRON BROWSER] Exiting now...');\n    // Force quit after sync\n    app.exit(0);\n  }\n});\n\napp.on('window-all-closed', () =&gt; {\n  if (!isQuitting) {\n    app.quit();\n  }\n});\n'''\n        \n        # Write the Electron script\n        with",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 305,
                "column": 1
              },
              "endPosition": {
                "line": 306,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 306,
                "column": 1
              },
              "endPosition": {
                "line": 307,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@router.post(\"/browser/login\", name=\"open browser for login\")",
            "lineNumber": 305
          },
          {
            "text": "async def open_browser_login():",
            "lineNumber": 306,
            "isSignature": true
          },
          {
            "lineNumber": 351
          },
          {
            "text": "        electron_script_content = '''",
            "lineNumber": 352
          },
          {
            "text": "const { app, BrowserWindow, ipcMain } = require('electron');",
            "lineNumber": 353
          },
          {
            "text": "const path = require('path');",
            "lineNumber": 354
          },
          {
            "lineNumber": 355
          },
          {
            "text": "// Parse command line arguments",
            "lineNumber": 356
          },
          {
            "text": "const args = process.argv.slice(2);",
            "lineNumber": 357
          },
          {
            "text": "const userDataDir = args[0];",
            "lineNumber": 358
          },
          {
            "text": "const cdpPort = args[1];",
            "lineNumber": 359
          },
          {
            "text": "const startUrl = args[2] || 'https://www.google.com';",
            "lineNumber": 360
          },
          {
            "lineNumber": 361
          },
          {
            "text": "// This must be called before app.ready",
            "lineNumber": 362
          },
          {
            "text": "app.commandLine.appendSwitch('remote-debugging-port', cdpPort);",
            "lineNumber": 363
          },
          {
            "lineNumber": 364
          },
          {
            "text": "console.log('[ELECTRON BROWSER] Starting with:');",
            "lineNumber": 365
          },
          {
            "text": "console.log('  Chrome version:', process.versions.chrome);",
            "lineNumber": 366
          },
          {
            "text": "console.log('  User data dir (requested):', userDataDir);",
            "lineNumber": 367
          },
          {
            "text": "console.log('  CDP port:', cdpPort);",
            "lineNumber": 368
          },
          {
            "text": "console.log('  Start URL:', startUrl);",
            "lineNumber": 369
          },
          {
            "lineNumber": 370
          },
          {
            "text": "// Set app paths - must be done before app.ready",
            "lineNumber": 371
          },
          {
            "text": "// Do NOT use commandLine.appendSwitch('user-data-dir') as it conflicts with setPath",
            "lineNumber": 372
          },
          {
            "text": "app.setPath('userData', userDataDir);",
            "lineNumber": 373
          },
          {
            "text": "app.setPath('sessionData', userDataDir);",
            "lineNumber": 374
          },
          {
            "lineNumber": 375
          },
          {
            "text": "app.whenReady().then(async () =&gt; {",
            "lineNumber": 376
          },
          {
            "text": "  const { session } = require('electron');",
            "lineNumber": 377
          },
          {
            "text": "  const fs = require('fs');",
            "lineNumber": 378
          },
          {
            "text": "  const path = require('path');",
            "lineNumber": 379
          },
          {
            "lineNumber": 380
          },
          {
            "text": "  // Log actual paths being used",
            "lineNumber": 381
          },
          {
            "text": "  console.log('[ELECTRON BROWSER] Actual paths:');",
            "lineNumber": 382
          },
          {
            "text": "  console.log('  app.getPath(\"userData\"):', app.getPath('userData'));",
            "lineNumber": 383
          },
          {
            "text": "  console.log('  app.getPath(\"sessionData\"):', app.getPath('sessionData'));",
            "lineNumber": 384
          },
          {
            "text": "  console.log('  app.getPath(\"cache\"):', app.getPath('cache'));",
            "lineNumber": 385
          },
          {
            "text": "  console.log('  app.getPath(\"temp\"):', app.getPath('temp'));",
            "lineNumber": 386
          },
          {
            "text": "  console.log('  process.argv:', process.argv);",
            "lineNumber": 387
          },
          {
            "lineNumber": 388
          },
          {
            "text": "  // Check command line switches",
            "lineNumber": 389
          },
          {
            "text": "  console.log('[ELECTRON BROWSER] Command line switches:');",
            "lineNumber": 390
          },
          {
            "text": "  console.log('  user-data-dir:', app.commandLine.getSwitchValue('user-data-dir'));",
            "lineNumber": 391
          },
          {
            "text": "  console.log('  remote-debugging-port:', app.commandLine.getSwitchValue('remote-debugging-port'));",
            "lineNumber": 392
          },
          {
            "lineNumber": 393
          },
          {
            "text": "  // Log partition session info",
            "lineNumber": 394
          },
          {
            "text": "  const userLoginSession = session.fromPartition('persist:user_login');",
            "lineNumber": 395
          },
          {
            "text": "  console.log('[ELECTRON BROWSER] Session info:');",
            "lineNumber": 396
          },
          {
            "text": "  console.log('  Partition: persist:user_login');",
            "lineNumber": 397
          },
          {
            "text": "  console.log('  Session storage path:', userLoginSession.getStoragePath());",
            "lineNumber": 398
          },
          {
            "lineNumber": 399
          },
          {
            "text": "  // Check if Cookies file exists",
            "lineNumber": 400
          },
          {
            "text": "  const cookiesPath = path.join(app.getPath('userData'), 'Partitions', 'user_login', 'Cookies');",
            "lineNumber": 401
          },
          {
            "text": "  console.log('[ELECTRON BROWSER] Cookies path:', cookiesPath);",
            "lineNumber": 402
          },
          {
            "text": "  console.log('[ELECTRON BROWSER] Cookies exists:', fs.existsSync(cookiesPath));",
            "lineNumber": 403
          },
          {
            "text": "  if (fs.existsSync(cookiesPath)) {",
            "lineNumber": 404
          },
          {
            "text": "    const stats = fs.statSync(cookiesPath);",
            "lineNumber": 405
          },
          {
            "text": "    console.log('[ELECTRON BROWSER] Cookies file size:', stats.size, 'bytes');",
            "lineNumber": 406
          },
          {
            "text": "  }",
            "lineNumber": 407
          },
          {
            "text": "  const win = new BrowserWindow({",
            "lineNumber": 408
          },
          {
            "text": "    width: 1400,",
            "lineNumber": 409
          },
          {
            "text": "    height: 900,",
            "lineNumber": 410
          },
          {
            "text": "    title: 'Eigent Browser - Login',",
            "lineNumber": 411
          },
          {
            "text": "    webPreferences: {",
            "lineNumber": 412
          },
          {
            "text": "      nodeIntegration: true,",
            "lineNumber": 413
          },
          {
            "text": "      contextIsolation: false,",
            "lineNumber": 414
          },
          {
            "text": "      webviewTag: true",
            "lineNumber": 415
          },
          {
            "text": "    }",
            "lineNumber": 416
          },
          {
            "text": "  });",
            "lineNumber": 417
          },
          {
            "lineNumber": 418
          },
          {
            "text": "  // Create navigation bar and webview",
            "lineNumber": 419
          },
          {
            "text": "  const html = &#96;",
            "lineNumber": 420
          },
          {
            "text": "&lt;!DOCTYPE html&gt;",
            "lineNumber": 421
          },
          {
            "text": "&lt;html&gt;",
            "lineNumber": 422
          },
          {
            "text": "&lt;head&gt;",
            "lineNumber": 423
          },
          {
            "text": "  &lt;style&gt;",
            "lineNumber": 424
          },
          {
            "text": "    body {",
            "lineNumber": 425
          },
          {
            "text": "      margin: 0;",
            "lineNumber": 426
          },
          {
            "text": "      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;",
            "lineNumber": 427
          },
          {
            "text": "      display: flex;",
            "lineNumber": 428
          },
          {
            "text": "      flex-direction: column;",
            "lineNumber": 429
          },
          {
            "text": "      height: 100vh;",
            "lineNumber": 430
          },
          {
            "text": "      overflow: hidden;",
            "lineNumber": 431
          },
          {
            "text": "    }",
            "lineNumber": 432
          },
          {
            "text": "    ",
            "lineNumber": 433
          },
          {
            "text": "    #nav-bar {",
            "lineNumber": 434
          },
          {
            "text": "      display: flex;",
            "lineNumber": 435
          },
          {
            "text": "      align-items: center;",
            "lineNumber": 436
          },
          {
            "text": "      padding: 8px;",
            "lineNumber": 437
          },
          {
            "text": "      background: #f5f5f5;",
            "lineNumber": 438
          },
          {
            "text": "      border-bottom: 1px solid #ddd;",
            "lineNumber": 439
          },
          {
            "text": "      gap: 8px;",
            "lineNumber": 440
          },
          {
            "text": "    }",
            "lineNumber": 441
          },
          {
            "text": "    ",
            "lineNumber": 442
          },
          {
            "text": "    button {",
            "lineNumber": 443
          },
          {
            "text": "      padding: 6px 12px;",
            "lineNumber": 444
          },
          {
            "text": "      border: 1px solid #ccc;",
            "lineNumber": 445
          },
          {
            "text": "      background: white;",
            "lineNumber": 446
          },
          {
            "text": "      border-radius: 4px;",
            "lineNumber": 447
          },
          {
            "text": "      cursor: pointer;",
            "lineNumber": 448
          },
          {
            "text": "      font-size: 14px;",
            "lineNumber": 449
          },
          {
            "text": "      display: flex;",
            "lineNumber": 450
          },
          {
            "text": "      align-items: center;",
            "lineNumber": 451
          },
          {
            "text": "      gap: 4px;",
            "lineNumber": 452
          },
          {
            "text": "    }",
            "lineNumber": 453
          },
          {
            "text": "    ",
            "lineNumber": 454
          },
          {
            "text": "    button:hover:not(:disabled) {",
            "lineNumber": 455
          },
          {
            "text": "      background: #f0f0f0;",
            "lineNumber": 456
          },
          {
            "text": "    }",
            "lineNumber": 457
          },
          {
            "text": "    ",
            "lineNumber": 458
          },
          {
            "text": "    button:disabled {",
            "lineNumber": 459
          },
          {
            "text": "      opacity: 0.5;",
            "lineNumber": 460
          },
          {
            "text": "      cursor: not-allowed;",
            "lineNumber": 461
          },
          {
            "text": "    }",
            "lineNumber": 462
          },
          {
            "text": "    ",
            "lineNumber": 463
          },
          {
            "text": "    #url-input {",
            "lineNumber": 464
          },
          {
            "text": "      flex: 1;",
            "lineNumber": 465
          },
          {
            "text": "      padding: 8px 12px;",
            "lineNumber": 466
          },
          {
            "text": "      border: 1px solid #ccc;",
            "lineNumber": 467
          },
          {
            "text": "      border-radius: 4px;",
            "lineNumber": 468
          },
          {
            "text": "      font-size: 14px;",
            "lineNumber": 469
          },
          {
            "text": "    }",
            "lineNumber": 470
          },
          {
            "text": "    ",
            "lineNumber": 471
          },
          {
            "text": "    #url-input:focus {",
            "lineNumber": 472
          },
          {
            "text": "      outline: none;",
            "lineNumber": 473
          },
          {
            "text": "      border-color: #4285f4;",
            "lineNumber": 474
          },
          {
            "text": "    }",
            "lineNumber": 475
          },
          {
            "text": "    ",
            "lineNumber": 476
          },
          {
            "text": "    #webview {",
            "lineNumber": 477
          },
          {
            "text": "      flex: 1;",
            "lineNumber": 478
          },
          {
            "text": "      width: 100%;",
            "lineNumber": 479
          },
          {
            "text": "      border: none;",
            "lineNumber": 480
          },
          {
            "text": "    }",
            "lineNumber": 481
          },
          {
            "text": "    ",
            "lineNumber": 482
          },
          {
            "text": "    .nav-icon {",
            "lineNumber": 483
          },
          {
            "text": "      font-size: 16px;",
            "lineNumber": 484
          },
          {
            "text": "    }",
            "lineNumber": 485
          },
          {
            "text": "    ",
            "lineNumber": 486
          },
          {
            "text": "    #loading-indicator {",
            "lineNumber": 487
          },
          {
            "text": "      width: 20px;",
            "lineNumber": 488
          },
          {
            "text": "      height: 20px;",
            "lineNumber": 489
          },
          {
            "text": "      border: 2px solid #f3f3f3;",
            "lineNumber": 490
          },
          {
            "text": "      border-top: 2px solid #4285f4;",
            "lineNumber": 491
          },
          {
            "text": "      border-radius: 50%;",
            "lineNumber": 492
          },
          {
            "text": "      animation: spin 1s linear infinite;",
            "lineNumber": 493
          },
          {
            "text": "      display: none;",
            "lineNumber": 494
          },
          {
            "text": "    }",
            "lineNumber": 495
          },
          {
            "text": "    ",
            "lineNumber": 496
          },
          {
            "text": "    @keyframes spin {",
            "lineNumber": 497
          },
          {
            "text": "      0% { transform: rotate(0deg); }",
            "lineNumber": 498
          },
          {
            "text": "      100% { transform: rotate(360deg); }",
            "lineNumber": 499
          },
          {
            "text": "    }",
            "lineNumber": 500
          },
          {
            "text": "    ",
            "lineNumber": 501
          },
          {
            "text": "    .loading #loading-indicator {",
            "lineNumber": 502
          },
          {
            "text": "      display: block;",
            "lineNumber": 503
          },
          {
            "text": "    }",
            "lineNumber": 504
          },
          {
            "text": "    ",
            "lineNumber": 505
          },
          {
            "text": "    .loading #reload-btn .nav-icon {",
            "lineNumber": 506
          },
          {
            "text": "      display: none;",
            "lineNumber": 507
          },
          {
            "text": "    }",
            "lineNumber": 508
          },
          {
            "text": "  &lt;/style&gt;",
            "lineNumber": 509
          },
          {
            "text": "&lt;/head&gt;",
            "lineNumber": 510
          },
          {
            "text": "&lt;body&gt;",
            "lineNumber": 511
          },
          {
            "text": "  &lt;div id=\"nav-bar\"&gt;",
            "lineNumber": 512
          },
          {
            "text": "    &lt;button id=\"back-btn\" title=\"Back\"&gt;",
            "lineNumber": 513
          },
          {
            "text": "      &lt;span class=\"nav-icon\"&gt;←&lt;/span&gt;",
            "lineNumber": 514
          },
          {
            "text": "    &lt;/button&gt;",
            "lineNumber": 515
          },
          {
            "text": "    &lt;button id=\"forward-btn\" title=\"Forward\"&gt;",
            "lineNumber": 516
          },
          {
            "text": "      &lt;span class=\"nav-icon\"&gt;→&lt;/span&gt;",
            "lineNumber": 517
          },
          {
            "text": "    &lt;/button&gt;",
            "lineNumber": 518
          },
          {
            "text": "    &lt;button id=\"reload-btn\" title=\"Reload\"&gt;",
            "lineNumber": 519
          },
          {
            "text": "      &lt;span class=\"nav-icon\"&gt;↻&lt;/span&gt;",
            "lineNumber": 520
          },
          {
            "text": "      &lt;div id=\"loading-indicator\"&gt;&lt;/div&gt;",
            "lineNumber": 521
          },
          {
            "text": "    &lt;/button&gt;",
            "lineNumber": 522
          },
          {
            "text": "    &lt;button id=\"home-btn\" title=\"Home\"&gt;",
            "lineNumber": 523
          },
          {
            "text": "      &lt;span class=\"nav-icon\"&gt;🏠&lt;/span&gt;",
            "lineNumber": 524
          },
          {
            "text": "    &lt;/button&gt;",
            "lineNumber": 525
          },
          {
            "text": "    &lt;input type=\"text\" id=\"url-input\" placeholder=\"Enter URL...\" /&gt;",
            "lineNumber": 526
          },
          {
            "text": "    &lt;button id=\"go-btn\"&gt;Go&lt;/button&gt;",
            "lineNumber": 527
          },
          {
            "text": "    &lt;button id=\"linkedin-btn\" style=\"background: #0077B5; color: white; border-color: #0077B5;\"&gt;",
            "lineNumber": 528
          },
          {
            "text": "      LinkedIn",
            "lineNumber": 529
          },
          {
            "text": "    &lt;/button&gt;",
            "lineNumber": 530
          },
          {
            "text": "    &lt;button id=\"info-btn\" title=\"Show Info\"&gt;ℹ️&lt;/button&gt;",
            "lineNumber": 531
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 532
          },
          {
            "text": "  ",
            "lineNumber": 533
          },
          {
            "text": "  &lt;webview id=\"webview\" src=\"${startUrl}\" partition=\"persist:user_login\"&gt;&lt;/webview&gt;",
            "lineNumber": 534
          },
          {
            "text": "  ",
            "lineNumber": 535
          },
          {
            "text": "  &lt;div id=\"info-panel\" style=\"display: none; position: absolute; top: 50px; right: 10px; background: white; border: 1px solid #ccc; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; max-width: 400px; font-size: 12px;\"&gt;",
            "lineNumber": 536
          },
          {
            "text": "    &lt;h4 style=\"margin: 0 0 10px 0;\"&gt;Browser Info&lt;/h4&gt;",
            "lineNumber": 537
          },
          {
            "text": "    &lt;div id=\"info-content\"&gt;&lt;/div&gt;",
            "lineNumber": 538
          },
          {
            "text": "    &lt;button onclick=\"document.getElementById('info-panel').style.display='none'\" style=\"margin-top: 10px;\"&gt;Close&lt;/button&gt;",
            "lineNumber": 539
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 540
          },
          {
            "text": "  ",
            "lineNumber": 541
          },
          {
            "text": "  &lt;script&gt;",
            "lineNumber": 542
          },
          {
            "text": "    const webview = document.getElementById('webview');",
            "lineNumber": 543
          },
          {
            "text": "    const backBtn = document.getElementById('back-btn');",
            "lineNumber": 544
          },
          {
            "text": "    const forwardBtn = document.getElementById('forward-btn');",
            "lineNumber": 545
          },
          {
            "text": "    const reloadBtn = document.getElementById('reload-btn');",
            "lineNumber": 546
          },
          {
            "text": "    const homeBtn = document.getElementById('home-btn');",
            "lineNumber": 547
          },
          {
            "text": "    const urlInput = document.getElementById('url-input');",
            "lineNumber": 548
          },
          {
            "text": "    const goBtn = document.getElementById('go-btn');",
            "lineNumber": 549
          },
          {
            "text": "    const linkedinBtn = document.getElementById('linkedin-btn');",
            "lineNumber": 550
          },
          {
            "text": "    const navBar = document.getElementById('nav-bar');",
            "lineNumber": 551
          },
          {
            "text": "    const infoBtn = document.getElementById('info-btn');",
            "lineNumber": 552
          },
          {
            "text": "    const infoPanel = document.getElementById('info-panel');",
            "lineNumber": 553
          },
          {
            "text": "    const infoContent = document.getElementById('info-content');",
            "lineNumber": 554
          },
          {
            "text": "    ",
            "lineNumber": 555
          },
          {
            "text": "    // Show info panel",
            "lineNumber": 556
          },
          {
            "text": "    infoBtn.addEventListener('click', () =&gt; {",
            "lineNumber": 557
          },
          {
            "text": "      const { ipcRenderer } = require('electron');",
            "lineNumber": 558
          },
          {
            "text": "      ",
            "lineNumber": 559
          },
          {
            "text": "      // Get browser info",
            "lineNumber": 560
          },
          {
            "text": "      const info = {",
            "lineNumber": 561
          },
          {
            "text": "        'Chrome Version': process.versions.chrome,",
            "lineNumber": 562
          },
          {
            "text": "        'Electron Version': process.versions.electron,",
            "lineNumber": 563
          },
          {
            "text": "        'Node Version': process.versions.node,",
            "lineNumber": 564
          },
          {
            "text": "        'User Data Dir (requested)': '${userDataDir}',",
            "lineNumber": 565
          },
          {
            "text": "        'CDP Port': '${cdpPort}',",
            "lineNumber": 566
          },
          {
            "text": "        'Platform': process.platform,",
            "lineNumber": 567
          },
          {
            "text": "        'Architecture': process.arch",
            "lineNumber": 568
          },
          {
            "text": "      };",
            "lineNumber": 569
          },
          {
            "text": "      ",
            "lineNumber": 570
          },
          {
            "text": "      // Also check webview partition info",
            "lineNumber": 571
          },
          {
            "text": "      const partition = webview.partition || 'default';",
            "lineNumber": 572
          },
          {
            "text": "      info['WebView Partition'] = partition;",
            "lineNumber": 573
          },
          {
            "text": "      ",
            "lineNumber": 574
          },
          {
            "text": "      // Format info as HTML",
            "lineNumber": 575
          },
          {
            "text": "      let html = '&lt;table style=\"width: 100%; border-collapse: collapse;\"&gt;';",
            "lineNumber": 576
          },
          {
            "text": "      for (const [key, value] of Object.entries(info)) {",
            "lineNumber": 577
          },
          {
            "text": "        html += '&lt;tr&gt;&lt;td style=\"padding: 4px; border-bottom: 1px solid #eee;\"&gt;&lt;strong&gt;' + key + ':&lt;/strong&gt;&lt;/td&gt;&lt;td style=\"padding: 4px; border-bottom: 1px solid #eee; word-break: break-all;\"&gt;' + value + '&lt;/td&gt;&lt;/tr&gt;';",
            "lineNumber": 578
          },
          {
            "text": "      }",
            "lineNumber": 579
          },
          {
            "text": "      html += '&lt;/table&gt;';",
            "lineNumber": 580
          },
          {
            "text": "      ",
            "lineNumber": 581
          },
          {
            "text": "      infoContent.innerHTML = html;",
            "lineNumber": 582
          },
          {
            "text": "      infoPanel.style.display = 'block';",
            "lineNumber": 583
          },
          {
            "text": "    });",
            "lineNumber": 584
          },
          {
            "text": "    ",
            "lineNumber": 585
          },
          {
            "text": "    // Update navigation buttons",
            "lineNumber": 586
          },
          {
            "text": "    function updateNavButtons() {",
            "lineNumber": 587
          },
          {
            "text": "      backBtn.disabled = !webview.canGoBack();",
            "lineNumber": 588
          },
          {
            "text": "      forwardBtn.disabled = !webview.canGoForward();",
            "lineNumber": 589
          },
          {
            "text": "    }",
            "lineNumber": 590
          },
          {
            "text": "    ",
            "lineNumber": 591
          },
          {
            "text": "    // Navigate to URL",
            "lineNumber": 592
          },
          {
            "text": "    function navigateToUrl() {",
            "lineNumber": 593
          },
          {
            "text": "      let url = urlInput.value.trim();",
            "lineNumber": 594
          },
          {
            "text": "      if (!url) return;",
            "lineNumber": 595
          },
          {
            "text": "      ",
            "lineNumber": 596
          },
          {
            "text": "      if (!url.startsWith('http://') &amp;&amp; !url.startsWith('https://')) {",
            "lineNumber": 597
          },
          {
            "text": "        url = 'https://' + url;",
            "lineNumber": 598
          },
          {
            "text": "      }",
            "lineNumber": 599
          },
          {
            "text": "      ",
            "lineNumber": 600
          },
          {
            "text": "      webview.loadURL(url);",
            "lineNumber": 601
          },
          {
            "text": "    }",
            "lineNumber": 602
          },
          {
            "text": "    ",
            "lineNumber": 603
          },
          {
            "text": "    // Event listeners",
            "lineNumber": 604
          },
          {
            "text": "    backBtn.addEventListener('click', () =&gt; webview.goBack());",
            "lineNumber": 605
          },
          {
            "text": "    forwardBtn.addEventListener('click', () =&gt; webview.goForward());",
            "lineNumber": 606
          },
          {
            "text": "    reloadBtn.addEventListener('click', () =&gt; webview.reload());",
            "lineNumber": 607
          },
          {
            "text": "    homeBtn.addEventListener('click', () =&gt; webview.loadURL('${startUrl}'));",
            "lineNumber": 608
          },
          {
            "text": "    goBtn.addEventListener('click', navigateToUrl);",
            "lineNumber": 609
          },
          {
            "text": "    linkedinBtn.addEventListener('click', () =&gt; webview.loadURL('https://www.linkedin.com'));",
            "lineNumber": 610
          },
          {
            "text": "    ",
            "lineNumber": 611
          },
          {
            "text": "    urlInput.addEventListener('keypress', (e) =&gt; {",
            "lineNumber": 612
          },
          {
            "text": "      if (e.key === 'Enter') {",
            "lineNumber": 613
          },
          {
            "text": "        navigateToUrl();",
            "lineNumber": 614
          },
          {
            "text": "      }",
            "lineNumber": 615
          },
          {
            "text": "    });",
            "lineNumber": 616
          },
          {
            "text": "    ",
            "lineNumber": 617
          },
          {
            "text": "    // WebView events",
            "lineNumber": 618
          },
          {
            "text": "    webview.addEventListener('did-start-loading', () =&gt; {",
            "lineNumber": 619
          },
          {
            "text": "      navBar.classList.add('loading');",
            "lineNumber": 620
          },
          {
            "text": "    });",
            "lineNumber": 621
          },
          {
            "text": "    ",
            "lineNumber": 622
          },
          {
            "text": "    webview.addEventListener('did-stop-loading', () =&gt; {",
            "lineNumber": 623
          },
          {
            "text": "      navBar.classList.remove('loading');",
            "lineNumber": 624
          },
          {
            "text": "      updateNavButtons();",
            "lineNumber": 625
          },
          {
            "text": "    });",
            "lineNumber": 626
          },
          {
            "text": "    ",
            "lineNumber": 627
          },
          {
            "text": "    webview.addEventListener('did-navigate', (e) =&gt; {",
            "lineNumber": 628
          },
          {
            "text": "      urlInput.value = e.url;",
            "lineNumber": 629
          },
          {
            "text": "      updateNavButtons();",
            "lineNumber": 630
          },
          {
            "text": "    });",
            "lineNumber": 631
          },
          {
            "text": "    ",
            "lineNumber": 632
          },
          {
            "text": "    webview.addEventListener('did-navigate-in-page', (e) =&gt; {",
            "lineNumber": 633
          },
          {
            "text": "      urlInput.value = e.url;",
            "lineNumber": 634
          },
          {
            "text": "      updateNavButtons();",
            "lineNumber": 635
          },
          {
            "text": "    });",
            "lineNumber": 636
          },
          {
            "text": "    ",
            "lineNumber": 637
          },
          {
            "text": "    webview.addEventListener('new-window', (e) =&gt; {",
            "lineNumber": 638
          },
          {
            "text": "      // Open new windows in the same webview",
            "lineNumber": 639
          },
          {
            "text": "      e.preventDefault();",
            "lineNumber": 640
          },
          {
            "text": "      webview.loadURL(e.url);",
            "lineNumber": 641
          },
          {
            "text": "    });",
            "lineNumber": 642
          },
          {
            "text": "    ",
            "lineNumber": 643
          },
          {
            "text": "    // Initialize",
            "lineNumber": 644
          },
          {
            "text": "    updateNavButtons();",
            "lineNumber": 645
          },
          {
            "text": "  &lt;/script&gt;",
            "lineNumber": 646
          },
          {
            "text": "&lt;/body&gt;",
            "lineNumber": 647
          },
          {
            "text": "&lt;/html&gt;&#96;;",
            "lineNumber": 648
          },
          {
            "lineNumber": 649
          },
          {
            "text": "  win.loadURL('data:text/html;charset=UTF-8,' + encodeURIComponent(html));",
            "lineNumber": 650
          },
          {
            "lineNumber": 651
          },
          {
            "text": "  // Show window when ready",
            "lineNumber": 652
          },
          {
            "text": "  win.once('ready-to-show', () =&gt; {",
            "lineNumber": 653
          },
          {
            "text": "    win.show();",
            "lineNumber": 654
          },
          {
            "lineNumber": 655
          },
          {
            "text": "    // Log cookies periodically to track changes",
            "lineNumber": 656
          },
          {
            "text": "    setInterval(async () =&gt; {",
            "lineNumber": 657
          },
          {
            "text": "      try {",
            "lineNumber": 658
          },
          {
            "text": "        const cookies = await userLoginSession.cookies.get({});",
            "lineNumber": 659
          },
          {
            "text": "        console.log('[ELECTRON BROWSER] Current cookies count:', cookies.length);",
            "lineNumber": 660
          },
          {
            "text": "        if (cookies.length &gt; 0) {",
            "lineNumber": 661
          },
          {
            "text": "          console.log('[ELECTRON BROWSER] Cookie domains:', [...new Set(cookies.map(c =&gt; c.domain))]);",
            "lineNumber": 662
          },
          {
            "text": "        }",
            "lineNumber": 663
          },
          {
            "text": "      } catch (error) {",
            "lineNumber": 664
          },
          {
            "text": "        console.error('[ELECTRON BROWSER] Failed to get cookies:', error);",
            "lineNumber": 665
          },
          {
            "text": "      }",
            "lineNumber": 666
          },
          {
            "text": "    }, 5000); // Check every 5 seconds",
            "lineNumber": 667
          },
          {
            "text": "  });",
            "lineNumber": 668
          },
          {
            "text": "  ",
            "lineNumber": 669
          },
          {
            "text": "  win.on('closed', async () =&gt; {",
            "lineNumber": 670
          },
          {
            "text": "    console.log('[ELECTRON BROWSER] Window closed, preparing to quit...');",
            "lineNumber": 671
          },
          {
            "lineNumber": 672
          },
          {
            "text": "    // Flush storage data before quitting to ensure cookies are saved",
            "lineNumber": 673
          },
          {
            "text": "    try {",
            "lineNumber": 674
          },
          {
            "text": "      const { session } = require('electron');",
            "lineNumber": 675
          },
          {
            "text": "      const fs = require('fs');",
            "lineNumber": 676
          },
          {
            "text": "      const path = require('path');",
            "lineNumber": 677
          },
          {
            "text": "      const userLoginSession = session.fromPartition('persist:user_login');",
            "lineNumber": 678
          },
          {
            "lineNumber": 679
          },
          {
            "text": "      // Log cookies before flush",
            "lineNumber": 680
          },
          {
            "text": "      const cookiesBeforeFlush = await userLoginSession.cookies.get({});",
            "lineNumber": 681
          },
          {
            "text": "      console.log('[ELECTRON BROWSER] Cookies count before flush:', cookiesBeforeFlush.length);",
            "lineNumber": 682
          },
          {
            "lineNumber": 683
          },
          {
            "text": "      // Flush storage",
            "lineNumber": 684
          },
          {
            "text": "      console.log('[ELECTRON BROWSER] Flushing storage data...');",
            "lineNumber": 685
          },
          {
            "text": "      await userLoginSession.flushStorageData();",
            "lineNumber": 686
          },
          {
            "text": "      console.log('[ELECTRON BROWSER] Storage data flushed successfully');",
            "lineNumber": 687
          },
          {
            "lineNumber": 688
          },
          {
            "text": "      // Check cookies file after flush",
            "lineNumber": 689
          },
          {
            "text": "      const cookiesPath = path.join(app.getPath('userData'), 'Partitions', 'user_login', 'Cookies');",
            "lineNumber": 690
          },
          {
            "text": "      if (fs.existsSync(cookiesPath)) {",
            "lineNumber": 691
          },
          {
            "text": "        const stats = fs.statSync(cookiesPath);",
            "lineNumber": 692
          },
          {
            "text": "        console.log('[ELECTRON BROWSER] Cookies file size after flush:', stats.size, 'bytes');",
            "lineNumber": 693
          },
          {
            "text": "      } else {",
            "lineNumber": 694
          },
          {
            "text": "        console.log('[ELECTRON BROWSER] WARNING: Cookies file does not exist after flush!');",
            "lineNumber": 695
          },
          {
            "text": "      }",
            "lineNumber": 696
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 697
          },
          {
            "text": "      console.error('[ELECTRON BROWSER] Failed to flush storage data:', error);",
            "lineNumber": 698
          },
          {
            "text": "    }",
            "lineNumber": 699
          },
          {
            "text": "    app.quit();",
            "lineNumber": 700
          },
          {
            "text": "  });",
            "lineNumber": 701
          },
          {
            "text": "});",
            "lineNumber": 702
          },
          {
            "lineNumber": 703
          },
          {
            "text": "let isQuitting = false;",
            "lineNumber": 704
          },
          {
            "lineNumber": 705
          },
          {
            "text": "app.on('before-quit', async (event) =&gt; {",
            "lineNumber": 706
          },
          {
            "text": "  if (isQuitting) return;",
            "lineNumber": 707
          },
          {
            "lineNumber": 708
          },
          {
            "text": "  // Prevent immediate quit to allow storage flush and cookie sync",
            "lineNumber": 709
          },
          {
            "text": "  event.preventDefault();",
            "lineNumber": 710
          },
          {
            "text": "  isQuitting = true;",
            "lineNumber": 711
          },
          {
            "lineNumber": 712
          },
          {
            "text": "  console.log('[ELECTRON BROWSER] before-quit event triggered');",
            "lineNumber": 713
          },
          {
            "lineNumber": 714
          },
          {
            "text": "  try {",
            "lineNumber": 715
          },
          {
            "text": "    const { session } = require('electron');",
            "lineNumber": 716
          },
          {
            "text": "    const fs = require('fs');",
            "lineNumber": 717
          },
          {
            "text": "    const path = require('path');",
            "lineNumber": 718
          },
          {
            "text": "    const userLoginSession = session.fromPartition('persist:user_login');",
            "lineNumber": 719
          },
          {
            "lineNumber": 720
          },
          {
            "text": "    // Log cookies before flush",
            "lineNumber": 721
          },
          {
            "text": "    const cookiesBeforeQuit = await userLoginSession.cookies.get({});",
            "lineNumber": 722
          },
          {
            "text": "    console.log('[ELECTRON BROWSER] Cookies count before quit:', cookiesBeforeQuit.length);",
            "lineNumber": 723
          },
          {
            "text": "    if (cookiesBeforeQuit.length &gt; 0) {",
            "lineNumber": 724
          },
          {
            "text": "      console.log('[ELECTRON BROWSER] Cookie domains before quit:', [...new Set(cookiesBeforeQuit.map(c =&gt; c.domain))]);",
            "lineNumber": 725
          },
          {
            "text": "    }",
            "lineNumber": 726
          },
          {
            "lineNumber": 727
          },
          {
            "text": "    // Flush storage",
            "lineNumber": 728
          },
          {
            "text": "    console.log('[ELECTRON BROWSER] Flushing storage on quit...');",
            "lineNumber": 729
          },
          {
            "text": "    await userLoginSession.flushStorageData();",
            "lineNumber": 730
          },
          {
            "text": "    console.log('[ELECTRON BROWSER] Storage data flushed on quit');",
            "lineNumber": 731
          },
          {
            "text": "  } catch (error) {",
            "lineNumber": 732
          },
          {
            "text": "    console.error('[ELECTRON BROWSER] Failed to sync cookies:', error);",
            "lineNumber": 733
          },
          {
            "text": "  } finally {",
            "lineNumber": 734
          },
          {
            "text": "    console.log('[ELECTRON BROWSER] Exiting now...');",
            "lineNumber": 735
          },
          {
            "text": "    // Force quit after sync",
            "lineNumber": 736
          },
          {
            "text": "    app.exit(0);",
            "lineNumber": 737
          },
          {
            "text": "  }",
            "lineNumber": 738
          },
          {
            "text": "});",
            "lineNumber": 739
          },
          {
            "lineNumber": 740
          },
          {
            "text": "app.on('window-all-closed', () =&gt; {",
            "lineNumber": 741
          },
          {
            "text": "  if (!isQuitting) {",
            "lineNumber": 742
          },
          {
            "text": "    app.quit();",
            "lineNumber": 743
          },
          {
            "text": "  }",
            "lineNumber": 744
          },
          {
            "text": "});",
            "lineNumber": 745
          },
          {
            "text": "'''",
            "lineNumber": 746
          },
          {
            "text": "        ",
            "lineNumber": 747
          },
          {
            "text": "        # Write the Electron script",
            "lineNumber": 748
          },
          {
            "text": "        with",
            "lineNumber": 749
          }
        ]
      },
      "score": 0.3553577959537506
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\test\\unit\\electron\\main\\windowLifecycle.test.ts",
        "range": {
          "startPosition": {
            "line": 9
          },
          "endPosition": {
            "line": 406,
            "column": 1
          }
        },
        "contents": "() =&gt; {\n() =&gt; {\n\n\n    it('should handle Ctrl+Shift+I to toggle dev tools on Windows/Linux', () =&gt; {\n      let beforeInputCallback: any\n\n      mockWebContents.on.mockImplementation((event: string, callback: any) =&gt; {\n        if (event === 'before-input-event') {\n          beforeInputCallback = callback\n        }\n      })\n\n      // Simulate setupDevToolsShortcuts\n      mockWebContents.on('before-input-event', (event: any, input: any) =&gt; {\n        if (input.control &amp;&amp; input.shift &amp;&amp; input.key.toLowerCase() === 'i' &amp;&amp; input.type === 'keyDown') {\n          mockWebContents.toggleDevTools()\n        }\n      })\n\n      // Trigger Ctrl+Shift+I\n      if (beforeInputCallback) {\n        const mockEvent = { preventDefault: vi.fn() }\n        const mockInput = { \n          control: true, \n          shift: true, \n          key: 'I', \n          type: 'keyDown' \n        }\n        beforeInputCallback(mockEvent, mockInput)\n      }\n\n      expect(mockWebContents.toggleDevTools).toHaveBeenCalled()\n    })\n\n    it('should handle Cmd+Shift+I to toggle dev tools on Mac', () =&gt; {\n      let beforeInputCallback: any\n\n      mockWebContents.on.mockImplementation((event: string, callback: any) =&gt; {\n        if (event === 'before-input-event') {\n          beforeInputCallback = callback\n        }\n      })\n\n      // Simulate setupDevToolsShortcuts\n      mockWebContents.on('before-input-event', (event: any, input: any) =&gt; {\n        if (input.meta &amp;&amp; input.shift &amp;&amp; input.key.toLowerCase() === 'i' &amp;&amp; input.type === 'keyDown') {\n          mockWebContents.toggleDevTools()\n        }\n      })\n\n      // Trigger Cmd+Shift+I\n      if (beforeInputCallback) {\n        const mockEvent = { preventDefault: vi.fn() }\n        const mockInput = { \n          meta: true, \n          shift: true, \n          key: 'I', \n          type: 'keyDown' \n        }\n        beforeInputCallback(mockEvent, mockInput)\n      }\n\n      expect(mockWebContents.toggleDevTools).toHaveBeenCalled()\n    })\n\n    it('should not trigger dev tools on key up events',\n\n  }\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 10,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 61
              },
              "endPosition": {
                "line": 11,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 104,
                "column": 3
              },
              "endPosition": {
                "line": 104,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 104,
                "column": 40
              },
              "endPosition": {
                "line": 105,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "() =&gt; {",
            "lineNumber": 10
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 104
          },
          {
            "lineNumber": 136
          },
          {
            "lineNumber": 137
          },
          {
            "text": "    it('should handle Ctrl+Shift+I to toggle dev tools on Windows/Linux', () =&gt; {",
            "lineNumber": 138
          },
          {
            "text": "      let beforeInputCallback: any",
            "lineNumber": 139
          },
          {
            "lineNumber": 140
          },
          {
            "text": "      mockWebContents.on.mockImplementation((event: string, callback: any) =&gt; {",
            "lineNumber": 141
          },
          {
            "text": "        if (event === 'before-input-event') {",
            "lineNumber": 142
          },
          {
            "text": "          beforeInputCallback = callback",
            "lineNumber": 143
          },
          {
            "text": "        }",
            "lineNumber": 144
          },
          {
            "text": "      })",
            "lineNumber": 145
          },
          {
            "lineNumber": 146
          },
          {
            "text": "      // Simulate setupDevToolsShortcuts",
            "lineNumber": 147
          },
          {
            "text": "      mockWebContents.on('before-input-event', (event: any, input: any) =&gt; {",
            "lineNumber": 148
          },
          {
            "text": "        if (input.control &amp;&amp; input.shift &amp;&amp; input.key.toLowerCase() === 'i' &amp;&amp; input.type === 'keyDown') {",
            "lineNumber": 149
          },
          {
            "text": "          mockWebContents.toggleDevTools()",
            "lineNumber": 150
          },
          {
            "text": "        }",
            "lineNumber": 151
          },
          {
            "text": "      })",
            "lineNumber": 152
          },
          {
            "lineNumber": 153
          },
          {
            "text": "      // Trigger Ctrl+Shift+I",
            "lineNumber": 154
          },
          {
            "text": "      if (beforeInputCallback) {",
            "lineNumber": 155
          },
          {
            "text": "        const mockEvent = { preventDefault: vi.fn() }",
            "lineNumber": 156
          },
          {
            "text": "        const mockInput = { ",
            "lineNumber": 157
          },
          {
            "text": "          control: true, ",
            "lineNumber": 158
          },
          {
            "text": "          shift: true, ",
            "lineNumber": 159
          },
          {
            "text": "          key: 'I', ",
            "lineNumber": 160
          },
          {
            "text": "          type: 'keyDown' ",
            "lineNumber": 161
          },
          {
            "text": "        }",
            "lineNumber": 162
          },
          {
            "text": "        beforeInputCallback(mockEvent, mockInput)",
            "lineNumber": 163
          },
          {
            "text": "      }",
            "lineNumber": 164
          },
          {
            "lineNumber": 165
          },
          {
            "text": "      expect(mockWebContents.toggleDevTools).toHaveBeenCalled()",
            "lineNumber": 166
          },
          {
            "text": "    })",
            "lineNumber": 167
          },
          {
            "lineNumber": 168
          },
          {
            "text": "    it('should handle Cmd+Shift+I to toggle dev tools on Mac', () =&gt; {",
            "lineNumber": 169
          },
          {
            "text": "      let beforeInputCallback: any",
            "lineNumber": 170
          },
          {
            "lineNumber": 171
          },
          {
            "text": "      mockWebContents.on.mockImplementation((event: string, callback: any) =&gt; {",
            "lineNumber": 172
          },
          {
            "text": "        if (event === 'before-input-event') {",
            "lineNumber": 173
          },
          {
            "text": "          beforeInputCallback = callback",
            "lineNumber": 174
          },
          {
            "text": "        }",
            "lineNumber": 175
          },
          {
            "text": "      })",
            "lineNumber": 176
          },
          {
            "lineNumber": 177
          },
          {
            "text": "      // Simulate setupDevToolsShortcuts",
            "lineNumber": 178
          },
          {
            "text": "      mockWebContents.on('before-input-event', (event: any, input: any) =&gt; {",
            "lineNumber": 179
          },
          {
            "text": "        if (input.meta &amp;&amp; input.shift &amp;&amp; input.key.toLowerCase() === 'i' &amp;&amp; input.type === 'keyDown') {",
            "lineNumber": 180
          },
          {
            "text": "          mockWebContents.toggleDevTools()",
            "lineNumber": 181
          },
          {
            "text": "        }",
            "lineNumber": 182
          },
          {
            "text": "      })",
            "lineNumber": 183
          },
          {
            "lineNumber": 184
          },
          {
            "text": "      // Trigger Cmd+Shift+I",
            "lineNumber": 185
          },
          {
            "text": "      if (beforeInputCallback) {",
            "lineNumber": 186
          },
          {
            "text": "        const mockEvent = { preventDefault: vi.fn() }",
            "lineNumber": 187
          },
          {
            "text": "        const mockInput = { ",
            "lineNumber": 188
          },
          {
            "text": "          meta: true, ",
            "lineNumber": 189
          },
          {
            "text": "          shift: true, ",
            "lineNumber": 190
          },
          {
            "text": "          key: 'I', ",
            "lineNumber": 191
          },
          {
            "text": "          type: 'keyDown' ",
            "lineNumber": 192
          },
          {
            "text": "        }",
            "lineNumber": 193
          },
          {
            "text": "        beforeInputCallback(mockEvent, mockInput)",
            "lineNumber": 194
          },
          {
            "text": "      }",
            "lineNumber": 195
          },
          {
            "lineNumber": 196
          },
          {
            "text": "      expect(mockWebContents.toggleDevTools).toHaveBeenCalled()",
            "lineNumber": 197
          },
          {
            "text": "    })",
            "lineNumber": 198
          },
          {
            "lineNumber": 199
          },
          {
            "text": "    it('should not trigger dev tools on key up events',",
            "lineNumber": 200
          },
          {
            "lineNumber": 224
          },
          {
            "text": "  }",
            "lineNumber": 256
          },
          {
            "text": "}",
            "lineNumber": 407
          }
        ]
      },
      "score": 0.3535546064376831
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\init.ts",
        "range": {
          "startPosition": {
            "line": 119
          },
          "endPosition": {
            "line": 474,
            "column": 1
          }
        },
        "contents": "export async function startBackend(setPort?: (port: number) =&gt; void): Promise&lt;any&gt; {\nconsole.log('start fastapi')\n    const uv_path = await getBinaryPath('uv')\n    const backendPath = getBackendPath()\n    const userData = app.getPath('userData');\n    const currentVersion = app.getVersion();\n    const venvPath = getVenvPath(currentVersion);\n    console.log('userData', userData)\n    console.log('Using venv path:', venvPath)\n    // Try to find an available port, with aggressive cleanup if needed\n    let port: number;\n    const portFile = path.join(userData, 'port.txt');\n    if (fs.existsSync(portFile)) {\n        port = parseInt(fs.readFileSync(portFile, 'utf-8'));\n        log.info(&#96;Found port from file: ${port}&#96;);\n        await killProcessOnPort(port);\n    }\n    try {\n        port = await findAvailablePort(5001);\n        fs.writeFileSync(portFile, port.toString());\n        log.info(&#96;Found available port: ${port}&#96;);\n    } catch (error) {\n        log.error('Failed to find available port, attempting cleanup...');\n\n        // Last resort: try to kill all processes in the range\n        for (let p = 5001; p &lt;= 5050; p++) {\n            await killProcessOnPort(p);\n        }\n\n        // Try once more\n        port = await findAvailablePort(5001);\n    }\n\n    if (setPort) {\n        setPort(port);\n    }\n\n    const npmCacheDir = path.join(venvPath, '.npm-cache');\n    if (!fs.existsSync(npmCacheDir)) {\n        fs.mkdirSync(npmCacheDir, { recursive: true });\n    }\n\n    const uvEnv = getUvEnv(currentVersion);\n    const env = {\n        ...process.env,\n        ...uvEnv,\n        SERVER_URL: \"https://dev.eigent.ai/api\",\n        PYTHONIOENCODING: 'utf-8',\n        PYTHONUNBUFFERED: '1',\n        npm_config_cache: npmCacheDir,\n    }\n\n    const displayFilteredLogs = (data: String) =&gt;\n\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 120,
                "column": 1
              },
              "endPosition": {
                "line": 120,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 120,
                "column": 8
              },
              "endPosition": {
                "line": 121,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export async function startBackend(setPort?: (port: number) =&gt; void): Promise&lt;any&gt; {",
            "lineNumber": 120,
            "isSignature": true
          },
          {
            "text": "console.log('start fastapi')",
            "lineNumber": 121
          },
          {
            "text": "    const uv_path = await getBinaryPath('uv')",
            "lineNumber": 122
          },
          {
            "text": "    const backendPath = getBackendPath()",
            "lineNumber": 123
          },
          {
            "text": "    const userData = app.getPath('userData');",
            "lineNumber": 124
          },
          {
            "text": "    const currentVersion = app.getVersion();",
            "lineNumber": 125
          },
          {
            "text": "    const venvPath = getVenvPath(currentVersion);",
            "lineNumber": 126
          },
          {
            "text": "    console.log('userData', userData)",
            "lineNumber": 127
          },
          {
            "text": "    console.log('Using venv path:', venvPath)",
            "lineNumber": 128
          },
          {
            "text": "    // Try to find an available port, with aggressive cleanup if needed",
            "lineNumber": 129
          },
          {
            "text": "    let port: number;",
            "lineNumber": 130
          },
          {
            "text": "    const portFile = path.join(userData, 'port.txt');",
            "lineNumber": 131
          },
          {
            "text": "    if (fs.existsSync(portFile)) {",
            "lineNumber": 132
          },
          {
            "text": "        port = parseInt(fs.readFileSync(portFile, 'utf-8'));",
            "lineNumber": 133
          },
          {
            "text": "        log.info(&#96;Found port from file: ${port}&#96;);",
            "lineNumber": 134
          },
          {
            "text": "        await killProcessOnPort(port);",
            "lineNumber": 135
          },
          {
            "text": "    }",
            "lineNumber": 136
          },
          {
            "text": "    try {",
            "lineNumber": 137
          },
          {
            "text": "        port = await findAvailablePort(5001);",
            "lineNumber": 138
          },
          {
            "text": "        fs.writeFileSync(portFile, port.toString());",
            "lineNumber": 139
          },
          {
            "text": "        log.info(&#96;Found available port: ${port}&#96;);",
            "lineNumber": 140
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 141
          },
          {
            "text": "        log.error('Failed to find available port, attempting cleanup...');",
            "lineNumber": 142
          },
          {
            "lineNumber": 143
          },
          {
            "text": "        // Last resort: try to kill all processes in the range",
            "lineNumber": 144
          },
          {
            "text": "        for (let p = 5001; p &lt;= 5050; p++) {",
            "lineNumber": 145
          },
          {
            "text": "            await killProcessOnPort(p);",
            "lineNumber": 146
          },
          {
            "text": "        }",
            "lineNumber": 147
          },
          {
            "lineNumber": 148
          },
          {
            "text": "        // Try once more",
            "lineNumber": 149
          },
          {
            "text": "        port = await findAvailablePort(5001);",
            "lineNumber": 150
          },
          {
            "text": "    }",
            "lineNumber": 151
          },
          {
            "lineNumber": 152
          },
          {
            "text": "    if (setPort) {",
            "lineNumber": 153
          },
          {
            "text": "        setPort(port);",
            "lineNumber": 154
          },
          {
            "text": "    }",
            "lineNumber": 155
          },
          {
            "lineNumber": 156
          },
          {
            "text": "    const npmCacheDir = path.join(venvPath, '.npm-cache');",
            "lineNumber": 157
          },
          {
            "text": "    if (!fs.existsSync(npmCacheDir)) {",
            "lineNumber": 158
          },
          {
            "text": "        fs.mkdirSync(npmCacheDir, { recursive: true });",
            "lineNumber": 159
          },
          {
            "text": "    }",
            "lineNumber": 160
          },
          {
            "lineNumber": 161
          },
          {
            "text": "    const uvEnv = getUvEnv(currentVersion);",
            "lineNumber": 162
          },
          {
            "text": "    const env = {",
            "lineNumber": 163
          },
          {
            "text": "        ...process.env,",
            "lineNumber": 164
          },
          {
            "text": "        ...uvEnv,",
            "lineNumber": 165
          },
          {
            "text": "        SERVER_URL: \"https://dev.eigent.ai/api\",",
            "lineNumber": 166
          },
          {
            "text": "        PYTHONIOENCODING: 'utf-8',",
            "lineNumber": 167
          },
          {
            "text": "        PYTHONUNBUFFERED: '1',",
            "lineNumber": 168
          },
          {
            "text": "        npm_config_cache: npmCacheDir,",
            "lineNumber": 169
          },
          {
            "text": "    }",
            "lineNumber": 170
          },
          {
            "lineNumber": 171
          },
          {
            "text": "    const displayFilteredLogs = (data: String) =&gt;",
            "lineNumber": 172
          },
          {
            "lineNumber": 190
          },
          {
            "text": "}",
            "lineNumber": 475,
            "isSignature": true
          }
        ]
      },
      "score": 0.3526783883571625
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 1655,
            "column": 2
          },
          "endPosition": {
            "line": 1781,
            "column": 1
          }
        },
        "contents": "// ==================== check and start backend ====================\nconst checkAndStartBackend = async () =&gt; {\n  log.info('Checking and starting backend service...');\n  try {\n    // Clean up any existing backend process before starting new one\n    if (python_process &amp;&amp; !python_process.killed) {\n      log.info('Cleaning up existing backend process before restart...');\n      await cleanupPythonProcess();\n      python_process = null;\n    }\n\n    const isToolInstalled = await checkToolInstalled();\n    if (isToolInstalled.success) {\n      log.info('Tool installed, starting backend service...');\n\n      // Start backend and wait for health check to pass\n      python_process = await startBackend((port) =&gt; {\n        backendPort = port;\n        log.info('Backend service started successfully', { port });\n      });\n\n      // Notify frontend that backend is ready\n      if (win &amp;&amp; !win.isDestroyed()) {\n        log.info('Backend is ready, notifying frontend...');\n        win.webContents.send('backend-ready', {\n          success: true,\n          port: backendPort,\n        });\n      }\n\n      python_process?.on('exit', (code, signal) =&gt; {\n        log.info('Python process exited', { code, signal });\n      });\n    } else {\n      log.warn('Tool not installed, cannot start backend service');\n      // Notify frontend that backend cannot start\n      if (win &amp;&amp; !win.isDestroyed()) {\n        win.webContents.send('backend-ready', {\n          success: false,\n          error: 'Tools not installed',\n        });\n      }\n    }\n  } catch (error) {\n    log.error('Failed to start backend:', error);\n    // Notify frontend of backend startup failure\n    if (win &amp;&amp; !win.isDestroyed()) {\n      win.webContents.send('backend-ready', {\n        success: false,\n        error: String(error),\n      });\n    }\n  }\n};\n\n// ==================== process cleanup ====================\nconst cleanupPythonProcess = async ()\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "// ==================== check and start backend ====================",
            "lineNumber": 1658
          },
          {
            "text": "const checkAndStartBackend = async () =&gt; {",
            "lineNumber": 1659
          },
          {
            "text": "  log.info('Checking and starting backend service...');",
            "lineNumber": 1660
          },
          {
            "text": "  try {",
            "lineNumber": 1661
          },
          {
            "text": "    // Clean up any existing backend process before starting new one",
            "lineNumber": 1662
          },
          {
            "text": "    if (python_process &amp;&amp; !python_process.killed) {",
            "lineNumber": 1663
          },
          {
            "text": "      log.info('Cleaning up existing backend process before restart...');",
            "lineNumber": 1664
          },
          {
            "text": "      await cleanupPythonProcess();",
            "lineNumber": 1665
          },
          {
            "text": "      python_process = null;",
            "lineNumber": 1666
          },
          {
            "text": "    }",
            "lineNumber": 1667
          },
          {
            "lineNumber": 1668
          },
          {
            "text": "    const isToolInstalled = await checkToolInstalled();",
            "lineNumber": 1669
          },
          {
            "text": "    if (isToolInstalled.success) {",
            "lineNumber": 1670
          },
          {
            "text": "      log.info('Tool installed, starting backend service...');",
            "lineNumber": 1671
          },
          {
            "lineNumber": 1672
          },
          {
            "text": "      // Start backend and wait for health check to pass",
            "lineNumber": 1673
          },
          {
            "text": "      python_process = await startBackend((port) =&gt; {",
            "lineNumber": 1674
          },
          {
            "text": "        backendPort = port;",
            "lineNumber": 1675
          },
          {
            "text": "        log.info('Backend service started successfully', { port });",
            "lineNumber": 1676
          },
          {
            "text": "      });",
            "lineNumber": 1677
          },
          {
            "lineNumber": 1678
          },
          {
            "text": "      // Notify frontend that backend is ready",
            "lineNumber": 1679
          },
          {
            "text": "      if (win &amp;&amp; !win.isDestroyed()) {",
            "lineNumber": 1680
          },
          {
            "text": "        log.info('Backend is ready, notifying frontend...');",
            "lineNumber": 1681
          },
          {
            "text": "        win.webContents.send('backend-ready', {",
            "lineNumber": 1682
          },
          {
            "text": "          success: true,",
            "lineNumber": 1683
          },
          {
            "text": "          port: backendPort,",
            "lineNumber": 1684
          },
          {
            "text": "        });",
            "lineNumber": 1685
          },
          {
            "text": "      }",
            "lineNumber": 1686
          },
          {
            "lineNumber": 1687
          },
          {
            "text": "      python_process?.on('exit', (code, signal) =&gt; {",
            "lineNumber": 1688
          },
          {
            "text": "        log.info('Python process exited', { code, signal });",
            "lineNumber": 1689
          },
          {
            "text": "      });",
            "lineNumber": 1690
          },
          {
            "text": "    } else {",
            "lineNumber": 1691
          },
          {
            "text": "      log.warn('Tool not installed, cannot start backend service');",
            "lineNumber": 1692
          },
          {
            "text": "      // Notify frontend that backend cannot start",
            "lineNumber": 1693
          },
          {
            "text": "      if (win &amp;&amp; !win.isDestroyed()) {",
            "lineNumber": 1694
          },
          {
            "text": "        win.webContents.send('backend-ready', {",
            "lineNumber": 1695
          },
          {
            "text": "          success: false,",
            "lineNumber": 1696
          },
          {
            "text": "          error: 'Tools not installed',",
            "lineNumber": 1697
          },
          {
            "text": "        });",
            "lineNumber": 1698
          },
          {
            "text": "      }",
            "lineNumber": 1699
          },
          {
            "text": "    }",
            "lineNumber": 1700
          },
          {
            "text": "  } catch (error) {",
            "lineNumber": 1701
          },
          {
            "text": "    log.error('Failed to start backend:', error);",
            "lineNumber": 1702
          },
          {
            "text": "    // Notify frontend of backend startup failure",
            "lineNumber": 1703
          },
          {
            "text": "    if (win &amp;&amp; !win.isDestroyed()) {",
            "lineNumber": 1704
          },
          {
            "text": "      win.webContents.send('backend-ready', {",
            "lineNumber": 1705
          },
          {
            "text": "        success: false,",
            "lineNumber": 1706
          },
          {
            "text": "        error: String(error),",
            "lineNumber": 1707
          },
          {
            "text": "      });",
            "lineNumber": 1708
          },
          {
            "text": "    }",
            "lineNumber": 1709
          },
          {
            "text": "  }",
            "lineNumber": 1710
          },
          {
            "text": "};",
            "lineNumber": 1711
          },
          {
            "lineNumber": 1712
          },
          {
            "text": "// ==================== process cleanup ====================",
            "lineNumber": 1713
          },
          {
            "text": "const cleanupPythonProcess = async ()",
            "lineNumber": 1714
          },
          {
            "text": ";",
            "lineNumber": 1782
          }
        ]
      },
      "score": 0.3510524034500122
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\index.ts",
        "range": {
          "startPosition": {
            "line": 318,
            "column": 2
          },
          "endPosition": {
            "line": 1184,
            "column": 1
          }
        },
        "contents": "function registerIpcHandlers() {\n  // ==================== basic info handler ====================\n  ipcMain.handle('get-browser-port', () =&gt; {\n    log.info('Getting browser port');\n    return browser_port;\n  });\n  ipcMain.handle('get-app-version', () =&gt; app.getVersion());\n  ipcMain.handle('get-backend-port', () =&gt; backendPort);\n\n  // ==================== restart app handler ====================\n  ipcMain.handle('restart-app', async () =&gt; {\n    log.info('[RESTART] Restarting app to apply user profile changes');\n\n    // Clean up Python process first\n    await cleanupPythonProcess();\n\n    // Schedule relaunch after a short delay\n    setTimeout(() =&gt; {\n      app.relaunch();\n      app.quit();\n    }, 100);\n  });\n\n  ipcMain.handle('restart-backend', async () =&gt; {\n    try {\n      if (backendPort) {\n        log.info('Restarting backend service...');\n        await cleanupPythonProcess();\n        await checkAndStartBackend();\n        log.info('Backend restart completed successfully');\n        return { success: true };\n      } else {\n        log.warn('No backend port found, starting fresh backend');\n        await checkAndStartBackend();\n        return { success: true };\n      }\n    } catch (error) {\n      log.error('Failed to restart backend:', error);\n      return { success: false, error: String(error) };\n    }\n  });\n  ipcMain.handle('get-system-language', getSystemLanguage);\n  ipcMain.handle('is-fullscreen', () =&gt; win?.isFullScreen() || false);\n  ipcMain.handle('get-home-dir', () =&gt; {\n    const platform = process.platform;\n    return platform === 'win32' ? process.env.USERPROFILE : process.env.HOME;\n  });\n\n  // ==================== command execution handler ====================\n  ipcMain.handle('get-email-folder-path', async (event, email: string) =&gt; {\n    return getEmailFolderPath(email);\n  });\n  ipcMain.handle(\n    'execute-command',\n\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "function registerIpcHandlers() {",
            "lineNumber": 321,
            "isSignature": true
          },
          {
            "text": "  // ==================== basic info handler ====================",
            "lineNumber": 322
          },
          {
            "text": "  ipcMain.handle('get-browser-port', () =&gt; {",
            "lineNumber": 323
          },
          {
            "text": "    log.info('Getting browser port');",
            "lineNumber": 324
          },
          {
            "text": "    return browser_port;",
            "lineNumber": 325
          },
          {
            "text": "  });",
            "lineNumber": 326
          },
          {
            "text": "  ipcMain.handle('get-app-version', () =&gt; app.getVersion());",
            "lineNumber": 327
          },
          {
            "text": "  ipcMain.handle('get-backend-port', () =&gt; backendPort);",
            "lineNumber": 328
          },
          {
            "lineNumber": 329
          },
          {
            "text": "  // ==================== restart app handler ====================",
            "lineNumber": 330
          },
          {
            "text": "  ipcMain.handle('restart-app', async () =&gt; {",
            "lineNumber": 331
          },
          {
            "text": "    log.info('[RESTART] Restarting app to apply user profile changes');",
            "lineNumber": 332
          },
          {
            "lineNumber": 333
          },
          {
            "text": "    // Clean up Python process first",
            "lineNumber": 334
          },
          {
            "text": "    await cleanupPythonProcess();",
            "lineNumber": 335
          },
          {
            "lineNumber": 336
          },
          {
            "text": "    // Schedule relaunch after a short delay",
            "lineNumber": 337
          },
          {
            "text": "    setTimeout(() =&gt; {",
            "lineNumber": 338
          },
          {
            "text": "      app.relaunch();",
            "lineNumber": 339
          },
          {
            "text": "      app.quit();",
            "lineNumber": 340
          },
          {
            "text": "    }, 100);",
            "lineNumber": 341
          },
          {
            "text": "  });",
            "lineNumber": 342
          },
          {
            "lineNumber": 343
          },
          {
            "text": "  ipcMain.handle('restart-backend', async () =&gt; {",
            "lineNumber": 344
          },
          {
            "text": "    try {",
            "lineNumber": 345
          },
          {
            "text": "      if (backendPort) {",
            "lineNumber": 346
          },
          {
            "text": "        log.info('Restarting backend service...');",
            "lineNumber": 347
          },
          {
            "text": "        await cleanupPythonProcess();",
            "lineNumber": 348
          },
          {
            "text": "        await checkAndStartBackend();",
            "lineNumber": 349
          },
          {
            "text": "        log.info('Backend restart completed successfully');",
            "lineNumber": 350
          },
          {
            "text": "        return { success: true };",
            "lineNumber": 351
          },
          {
            "text": "      } else {",
            "lineNumber": 352
          },
          {
            "text": "        log.warn('No backend port found, starting fresh backend');",
            "lineNumber": 353
          },
          {
            "text": "        await checkAndStartBackend();",
            "lineNumber": 354
          },
          {
            "text": "        return { success: true };",
            "lineNumber": 355
          },
          {
            "text": "      }",
            "lineNumber": 356
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 357
          },
          {
            "text": "      log.error('Failed to restart backend:', error);",
            "lineNumber": 358
          },
          {
            "text": "      return { success: false, error: String(error) };",
            "lineNumber": 359
          },
          {
            "text": "    }",
            "lineNumber": 360
          },
          {
            "text": "  });",
            "lineNumber": 361
          },
          {
            "text": "  ipcMain.handle('get-system-language', getSystemLanguage);",
            "lineNumber": 362
          },
          {
            "text": "  ipcMain.handle('is-fullscreen', () =&gt; win?.isFullScreen() || false);",
            "lineNumber": 363
          },
          {
            "text": "  ipcMain.handle('get-home-dir', () =&gt; {",
            "lineNumber": 364
          },
          {
            "text": "    const platform = process.platform;",
            "lineNumber": 365
          },
          {
            "text": "    return platform === 'win32' ? process.env.USERPROFILE : process.env.HOME;",
            "lineNumber": 366
          },
          {
            "text": "  });",
            "lineNumber": 367
          },
          {
            "lineNumber": 368
          },
          {
            "text": "  // ==================== command execution handler ====================",
            "lineNumber": 369
          },
          {
            "text": "  ipcMain.handle('get-email-folder-path', async (event, email: string) =&gt; {",
            "lineNumber": 370
          },
          {
            "text": "    return getEmailFolderPath(email);",
            "lineNumber": 371
          },
          {
            "text": "  });",
            "lineNumber": 372
          },
          {
            "text": "  ipcMain.handle(",
            "lineNumber": 373
          },
          {
            "text": "    'execute-command',",
            "lineNumber": 374
          },
          {
            "lineNumber": 453
          },
          {
            "text": "}",
            "lineNumber": 1185,
            "isSignature": true
          }
        ]
      },
      "score": 0.34695160388946533
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\vite.config.ts",
        "range": {
          "startPosition": {
            "line": 11
          },
          "endPosition": {
            "line": 93,
            "column": 1
          }
        },
        "contents": "export default ({ command, mode }) =&gt; {\n\n      electron({\n        main: {\n          // Shortcut of &#96;build.lib.entry&#96;\n          entry: 'electron/main/index.ts',\n          onstart(args) {\n            if (process.env.VSCODE_DEBUG) {\n              console.log(/* For &#96;.vscode/.debug.script.mjs&#96; */'[startup] Electron App')\n            } else {\n              args.startup()\n            }\n          },\n          vite: {\n            build: {\n              sourcemap,\n              minify: isBuild,\n              outDir: 'dist-electron/main',\n              rollupOptions: {\n                external: Object.keys('dependencies' in pkg ? pkg.dependencies : {}),\n              },\n            },\n          },\n        },\n        preload: {\n          // Shortcut of &#96;build.rollupOptions.input&#96;.\n          // Preload scripts may contain Web assets, so use the &#96;build.rollupOptions.input&#96; instead &#96;build.lib.entry&#96;.\n          input: 'electron/preload/index.ts',\n          vite: {\n            build: {\n              sourcemap: sourcemap ? 'inline' : undefined, // #332\n              minify: isBuild,\n              outDir: 'dist-electron/preload',\n              rollupOptions: {\n                external: Object.keys('dependencies' in pkg ? pkg.dependencies : {}),\n              },\n            },\n          },\n        },\n        // Ployfill the Electron and Node.js API for Renderer process.\n        // If you want use Node.js in Renderer process, the &#96;nodeIntegration&#96; needs to be enabled in the Main process.\n        // See 👉 https://github.com/electron-vite/vite-plugin-electron-renderer\n        renderer: {},\n      }),\n    ],\n    server: {\n      open: false,\n      ...(process.env.VSCODE_DEBUG &amp;&amp;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 12,
                "column": 1
              },
              "endPosition": {
                "line": 12,
                "column": 16
              }
            },
            {
              "startPosition": {
                "line": 12,
                "column": 16
              },
              "endPosition": {
                "line": 12,
                "column": 16
              }
            },
            {
              "startPosition": {
                "line": 12,
                "column": 29
              },
              "endPosition": {
                "line": 13,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export default ({ command, mode }) =&gt; {",
            "lineNumber": 12
          },
          {
            "lineNumber": 30
          },
          {
            "text": "      electron({",
            "lineNumber": 31
          },
          {
            "text": "        main: {",
            "lineNumber": 32
          },
          {
            "text": "          // Shortcut of &#96;build.lib.entry&#96;",
            "lineNumber": 33
          },
          {
            "text": "          entry: 'electron/main/index.ts',",
            "lineNumber": 34
          },
          {
            "text": "          onstart(args) {",
            "lineNumber": 35
          },
          {
            "text": "            if (process.env.VSCODE_DEBUG) {",
            "lineNumber": 36
          },
          {
            "text": "              console.log(/* For &#96;.vscode/.debug.script.mjs&#96; */'[startup] Electron App')",
            "lineNumber": 37
          },
          {
            "text": "            } else {",
            "lineNumber": 38
          },
          {
            "text": "              args.startup()",
            "lineNumber": 39
          },
          {
            "text": "            }",
            "lineNumber": 40
          },
          {
            "text": "          },",
            "lineNumber": 41
          },
          {
            "text": "          vite: {",
            "lineNumber": 42
          },
          {
            "text": "            build: {",
            "lineNumber": 43
          },
          {
            "text": "              sourcemap,",
            "lineNumber": 44
          },
          {
            "text": "              minify: isBuild,",
            "lineNumber": 45
          },
          {
            "text": "              outDir: 'dist-electron/main',",
            "lineNumber": 46
          },
          {
            "text": "              rollupOptions: {",
            "lineNumber": 47
          },
          {
            "text": "                external: Object.keys('dependencies' in pkg ? pkg.dependencies : {}),",
            "lineNumber": 48
          },
          {
            "text": "              },",
            "lineNumber": 49
          },
          {
            "text": "            },",
            "lineNumber": 50
          },
          {
            "text": "          },",
            "lineNumber": 51
          },
          {
            "text": "        },",
            "lineNumber": 52
          },
          {
            "text": "        preload: {",
            "lineNumber": 53
          },
          {
            "text": "          // Shortcut of &#96;build.rollupOptions.input&#96;.",
            "lineNumber": 54
          },
          {
            "text": "          // Preload scripts may contain Web assets, so use the &#96;build.rollupOptions.input&#96; instead &#96;build.lib.entry&#96;.",
            "lineNumber": 55
          },
          {
            "text": "          input: 'electron/preload/index.ts',",
            "lineNumber": 56
          },
          {
            "text": "          vite: {",
            "lineNumber": 57
          },
          {
            "text": "            build: {",
            "lineNumber": 58
          },
          {
            "text": "              sourcemap: sourcemap ? 'inline' : undefined, // #332",
            "lineNumber": 59
          },
          {
            "text": "              minify: isBuild,",
            "lineNumber": 60
          },
          {
            "text": "              outDir: 'dist-electron/preload',",
            "lineNumber": 61
          },
          {
            "text": "              rollupOptions: {",
            "lineNumber": 62
          },
          {
            "text": "                external: Object.keys('dependencies' in pkg ? pkg.dependencies : {}),",
            "lineNumber": 63
          },
          {
            "text": "              },",
            "lineNumber": 64
          },
          {
            "text": "            },",
            "lineNumber": 65
          },
          {
            "text": "          },",
            "lineNumber": 66
          },
          {
            "text": "        },",
            "lineNumber": 67
          },
          {
            "text": "        // Ployfill the Electron and Node.js API for Renderer process.",
            "lineNumber": 68
          },
          {
            "text": "        // If you want use Node.js in Renderer process, the &#96;nodeIntegration&#96; needs to be enabled in the Main process.",
            "lineNumber": 69
          },
          {
            "text": "        // See 👉 https://github.com/electron-vite/vite-plugin-electron-renderer",
            "lineNumber": 70
          },
          {
            "text": "        renderer: {},",
            "lineNumber": 71
          },
          {
            "text": "      }),",
            "lineNumber": 72
          },
          {
            "text": "    ],",
            "lineNumber": 73
          },
          {
            "text": "    server: {",
            "lineNumber": 74
          },
          {
            "text": "      open: false,",
            "lineNumber": 75
          },
          {
            "text": "      ...(process.env.VSCODE_DEBUG &amp;&amp;",
            "lineNumber": 76
          },
          {
            "text": "}",
            "lineNumber": 94
          }
        ]
      },
      "score": 0.3468632698059082
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\ref\\COMMANDS.md",
        "range": {
          "startPosition": {
            "line": 191
          },
          "endPosition": {
            "line": 261
          }
        },
        "contents": "| &#96;test:&#96; | 測試相關 |\n| &#96;chore:&#96; | 建置/工具相關 |\n\n---\n\n## 環境變數\n\n### 前端 (.env.development)\n\n| 變數名稱 | 說明 | 範例值 |\n|---------|------|--------|\n| &#96;VITE_BASE_URL&#96; | API 基礎路徑 | &#96;/api&#96; |\n| &#96;VITE_PROXY_URL&#96; | 代理目標 URL | &#96;https://dev.eigent.ai&#96; |\n| &#96;VITE_USE_LOCAL_PROXY&#96; | 是否使用本地代理 | &#96;true&#96; / &#96;false&#96; |\n\n### 後端環境變數\n\n#### 嵌入式後端（backend/）\n\n**注意**：嵌入式後端的環境變數由 Electron 自動注入，通常不需要手動設定。\n\n| 變數名稱 | 說明 | 預設值 | 可選覆寫位置 |\n|---------|------|--------|------------|\n| &#96;SERVER_URL&#96; | 雲端服務 URL（用於同步任務步驟） | &#96;https://dev.eigent.ai/api&#96; | &#96;~/.eigent/.env&#96; |\n| &#96;PYTHONIOENCODING&#96; | Python I/O 編碼 | &#96;utf-8&#96; | - |\n| &#96;PYTHONUNBUFFERED&#96; | Python 輸出緩衝 | &#96;1&#96; | - |\n\n#### Local Server（server/.env）\n\n| 變數名稱 | 說明 | 範例值 |\n|---------|------|--------|\n| &#96;database_url&#96; | PostgreSQL 連線字串 | &#96;postgresql://user:pass@host:5432/db&#96; |\n| &#96;url_prefix&#96; | API 路由前綴 | &#96;/api&#96; |\n\n**設定方式**：\n1. **.env 文件**（推薦）：在 &#96;server/&#96; 目錄下建立 &#96;.env&#96; 文件\n2. **環境變數**：在啟動前設定環境變數（見上方「方式 B」）\n\n---\n\n## 除錯技巧\n\n### 開啟 Electron DevTools\n\n開發模式下自動開啟，或使用快捷鍵：\n- Windows/Linux: &#96;Ctrl + Shift + I&#96;\n- macOS: &#96;Cmd + Option + I&#96;\n\n### 檢查後端健康狀態\n\n&#96;&#96;&#96;bash\n# 檢查嵌入式後端（backend/）\n# 注意：埠號可能動態分配，可透過 Electron IPC 取得\ncurl http://localhost:5001/health\n\n# 檢查 Local Server（server/）\ncurl http://localhost:3001/health\n&#96;&#96;&#96;\n\n### 查看 Swagger API 文件\n\n開啟瀏覽器訪問：\n\n- **嵌入式後端**（&#96;backend/&#96;）：\n  - URL：&#96;http://localhost:&lt;port&gt;/docs&#96;\n  - 注意：埠號由 Electron 動態分配（預設從 5001 起），可透過 Electron IPC 取得實際埠號\n  - 主要端點：&#96;/chat&#96;（SSE 任務執行）、&#96;/health&#96;\n\n- **Local Server**（&#96;server/&#96;）：\n  - URL：&#96;http://localhost:3001/docs&#96;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "| &#96;test:&#96; | 測試相關 |",
            "lineNumber": 192
          },
          {
            "text": "| &#96;chore:&#96; | 建置/工具相關 |",
            "lineNumber": 193
          },
          {
            "lineNumber": 194
          },
          {
            "text": "---",
            "lineNumber": 195
          },
          {
            "lineNumber": 196
          },
          {
            "text": "## 環境變數",
            "lineNumber": 197
          },
          {
            "lineNumber": 198
          },
          {
            "text": "### 前端 (.env.development)",
            "lineNumber": 199
          },
          {
            "lineNumber": 200
          },
          {
            "text": "| 變數名稱 | 說明 | 範例值 |",
            "lineNumber": 201
          },
          {
            "text": "|---------|------|--------|",
            "lineNumber": 202
          },
          {
            "text": "| &#96;VITE_BASE_URL&#96; | API 基礎路徑 | &#96;/api&#96; |",
            "lineNumber": 203
          },
          {
            "text": "| &#96;VITE_PROXY_URL&#96; | 代理目標 URL | &#96;https://dev.eigent.ai&#96; |",
            "lineNumber": 204
          },
          {
            "text": "| &#96;VITE_USE_LOCAL_PROXY&#96; | 是否使用本地代理 | &#96;true&#96; / &#96;false&#96; |",
            "lineNumber": 205
          },
          {
            "lineNumber": 206
          },
          {
            "text": "### 後端環境變數",
            "lineNumber": 207
          },
          {
            "lineNumber": 208
          },
          {
            "text": "#### 嵌入式後端（backend/）",
            "lineNumber": 209
          },
          {
            "lineNumber": 210
          },
          {
            "text": "**注意**：嵌入式後端的環境變數由 Electron 自動注入，通常不需要手動設定。",
            "lineNumber": 211
          },
          {
            "lineNumber": 212
          },
          {
            "text": "| 變數名稱 | 說明 | 預設值 | 可選覆寫位置 |",
            "lineNumber": 213
          },
          {
            "text": "|---------|------|--------|------------|",
            "lineNumber": 214
          },
          {
            "text": "| &#96;SERVER_URL&#96; | 雲端服務 URL（用於同步任務步驟） | &#96;https://dev.eigent.ai/api&#96; | &#96;~/.eigent/.env&#96; |",
            "lineNumber": 215
          },
          {
            "text": "| &#96;PYTHONIOENCODING&#96; | Python I/O 編碼 | &#96;utf-8&#96; | - |",
            "lineNumber": 216
          },
          {
            "text": "| &#96;PYTHONUNBUFFERED&#96; | Python 輸出緩衝 | &#96;1&#96; | - |",
            "lineNumber": 217
          },
          {
            "lineNumber": 218
          },
          {
            "text": "#### Local Server（server/.env）",
            "lineNumber": 219
          },
          {
            "lineNumber": 220
          },
          {
            "text": "| 變數名稱 | 說明 | 範例值 |",
            "lineNumber": 221
          },
          {
            "text": "|---------|------|--------|",
            "lineNumber": 222
          },
          {
            "text": "| &#96;database_url&#96; | PostgreSQL 連線字串 | &#96;postgresql://user:pass@host:5432/db&#96; |",
            "lineNumber": 223
          },
          {
            "text": "| &#96;url_prefix&#96; | API 路由前綴 | &#96;/api&#96; |",
            "lineNumber": 224
          },
          {
            "lineNumber": 225
          },
          {
            "text": "**設定方式**：",
            "lineNumber": 226
          },
          {
            "text": "1. **.env 文件**（推薦）：在 &#96;server/&#96; 目錄下建立 &#96;.env&#96; 文件",
            "lineNumber": 227
          },
          {
            "text": "2. **環境變數**：在啟動前設定環境變數（見上方「方式 B」）",
            "lineNumber": 228
          },
          {
            "lineNumber": 229
          },
          {
            "text": "---",
            "lineNumber": 230
          },
          {
            "lineNumber": 231
          },
          {
            "text": "## 除錯技巧",
            "lineNumber": 232
          },
          {
            "lineNumber": 233
          },
          {
            "text": "### 開啟 Electron DevTools",
            "lineNumber": 234
          },
          {
            "lineNumber": 235
          },
          {
            "text": "開發模式下自動開啟，或使用快捷鍵：",
            "lineNumber": 236
          },
          {
            "text": "- Windows/Linux: &#96;Ctrl + Shift + I&#96;",
            "lineNumber": 237
          },
          {
            "text": "- macOS: &#96;Cmd + Option + I&#96;",
            "lineNumber": 238
          },
          {
            "lineNumber": 239
          },
          {
            "text": "### 檢查後端健康狀態",
            "lineNumber": 240
          },
          {
            "lineNumber": 241
          },
          {
            "text": "&#96;&#96;&#96;bash",
            "lineNumber": 242
          },
          {
            "text": "# 檢查嵌入式後端（backend/）",
            "lineNumber": 243
          },
          {
            "text": "# 注意：埠號可能動態分配，可透過 Electron IPC 取得",
            "lineNumber": 244
          },
          {
            "text": "curl http://localhost:5001/health",
            "lineNumber": 245
          },
          {
            "lineNumber": 246
          },
          {
            "text": "# 檢查 Local Server（server/）",
            "lineNumber": 247
          },
          {
            "text": "curl http://localhost:3001/health",
            "lineNumber": 248
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 249
          },
          {
            "lineNumber": 250
          },
          {
            "text": "### 查看 Swagger API 文件",
            "lineNumber": 251
          },
          {
            "lineNumber": 252
          },
          {
            "text": "開啟瀏覽器訪問：",
            "lineNumber": 253
          },
          {
            "lineNumber": 254
          },
          {
            "text": "- **嵌入式後端**（&#96;backend/&#96;）：",
            "lineNumber": 255
          },
          {
            "text": "  - URL：&#96;http://localhost:&lt;port&gt;/docs&#96;",
            "lineNumber": 256
          },
          {
            "text": "  - 注意：埠號由 Electron 動態分配（預設從 5001 起），可透過 Electron IPC 取得實際埠號",
            "lineNumber": 257
          },
          {
            "text": "  - 主要端點：&#96;/chat&#96;（SSE 任務執行）、&#96;/health&#96;",
            "lineNumber": 258
          },
          {
            "lineNumber": 259
          },
          {
            "text": "- **Local Server**（&#96;server/&#96;）：",
            "lineNumber": 260
          },
          {
            "text": "  - URL：&#96;http://localhost:3001/docs&#96;",
            "lineNumber": 261
          }
        ]
      },
      "score": 0.34667861461639404
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

