<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session dfa7610f-1748-44ca-b5a4-f6271341a327 (2026-01-21 02:39Z) -->

# 專案訊息傳遞至 Slack 頻道 (2026-01-21 02:39Z)

_**User**_

請協助分析，專案中如何將訊息傳遞到 slack 的頻道之中？

---

_**Agent (model default, mode Agent)**_


分析專案中如何將訊息傳遞到 Slack 頻道。先探索專案結構並搜尋相關程式碼。


---

<tool-use data-tool-type="unknown" data-tool-name="list_dir_v2">
<details>
<summary>Tool use: **list_dir_v2**</summary>


Parameters:

```json
{
  "targetDirectory": "."
}
```
Result:

```json
{
  "directoryTreeRoot": {
    "absPath": "d:\\_Code\\_GitHub\\eigent-260119",
    "childrenDirs": [
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\.github",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\.github\\ISSUE_TEMPLATE",
            "childrenFiles": [
              {
                "name": "bug_report.yml"
              },
              {
                "name": "discussions.yml"
              },
              {
                "name": "feature_request.yml"
              },
              {
                "name": "questions.yml"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\.github\\workflows",
            "childrenFiles": [
              {
                "name": "build-view.yml"
              },
              {
                "name": "build.yml"
              },
              {
                "name": "ci.yml"
              },
              {
                "name": "codeql.yml"
              },
              {
                "name": "lint-markdown.yml"
              },
              {
                "name": "remove-old-artifacts.yml"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": "dependabot.yml"
          },
          {
            "name": "PULL_REQUEST_TEMPLATE.md"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\.specstory",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\.specstory\\history",
            "childrenFiles": [
              {
                "name": "2026-01-19_07-20Z-本機登入導向問題.md"
              },
              {
                "name": "2026-01-19_09-07Z-esbuild-45-377-reference.md"
              },
              {
                "name": "2026-01-19_09-45Z-文件內容疑問.md"
              },
              {
                "name": "2026-01-20_Eigent Browser Automation Feasibility.md"
              },
              {
                "name": "2026-01-21_01-10Z-log-to-mermaid-sequence-diagram.md"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": ".gitignore"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\.vscode",
        "childrenFiles": [
          {
            "name": ".debug.script.mjs"
          },
          {
            "name": "extensions.json"
          },
          {
            "name": "launch.json"
          },
          {
            "name": "settings.json"
          },
          {
            "name": "tasks.json"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\.vscode",
            "fullSubtreeExtensionCounts": {
              ".json": 1
            },
            "numFiles": 1
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\command",
                "fullSubtreeExtensionCounts": {
                  ".py": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\component",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\component\\pydantic",
                    "childrenDirs": [
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\component\\pydantic\\translations",
                        "fullSubtreeExtensionCounts": {
                          ".json": 2
                        },
                        "numFiles": 2
                      }
                    ],
                    "fullSubtreeExtensionCounts": {
                      ".json": 2,
                      ".py": 1
                    },
                    "numFiles": 3
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".json": 2,
                  ".py": 9
                },
                "numFiles": 11
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\controller",
                "childrenFiles": [
                  {
                    "name": "__init__.py"
                  },
                  {
                    "name": "chat_controller.py"
                  },
                  {
                    "name": "health_controller.py"
                  },
                  {
                    "name": "model_controller.py"
                  },
                  {
                    "name": "task_controller.py"
                  },
                  {
                    "name": "tool_controller.py"
                  }
                ],
                "childrenWereProcessed": true
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\exception",
                "fullSubtreeExtensionCounts": {
                  ".py": 2
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\middleware",
                "fullSubtreeExtensionCounts": {
                  ".py": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\model",
                "fullSubtreeExtensionCounts": {
                  ".py": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\service",
                "fullSubtreeExtensionCounts": {
                  ".py": 2
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\utils",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\utils\\listen",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\utils\\server",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\app\\utils\\toolkit",
                    "fullSubtreeExtensionCounts": {
                      ".py": 35
                    },
                    "numFiles": 35
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".py": 44
                },
                "numFiles": 44
              }
            ],
            "childrenFiles": [
              {
                "name": "__init__.py"
              }
            ],
            "childrenWereProcessed": true,
            "fullSubtreeExtensionCounts": {
              ".py": 61,
              ".json": 2
            },
            "numFiles": 63
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\lang",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\lang\\en_US",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\lang\\en_US\\LC_MESSAGES",
                    "fullSubtreeExtensionCounts": {
                      ".po": 1
                    },
                    "numFiles": 1
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".po": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\lang\\zh_CN",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\lang\\zh_CN\\LC_MESSAGES",
                    "fullSubtreeExtensionCounts": {
                      ".po": 1
                    },
                    "numFiles": 1
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".po": 1
                },
                "numFiles": 1
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".po": 2
            },
            "numFiles": 2
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\tests",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\tests\\unit",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\tests\\unit\\controller",
                    "fullSubtreeExtensionCounts": {
                      ".py": 4
                    },
                    "numFiles": 4
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\tests\\unit\\service",
                    "fullSubtreeExtensionCounts": {
                      ".py": 2
                    },
                    "numFiles": 2
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\backend\\tests\\unit\\utils",
                    "childrenFiles": [
                      {
                        "name": "test_agent.py"
                      },
                      {
                        "name": "test_single_agent_worker.py"
                      },
                      {
                        "name": "test_terminal_toolkit.py"
                      },
                      {
                        "name": "test_workforce.py"
                      }
                    ],
                    "childrenWereProcessed": true
                  }
                ],
                "childrenWereProcessed": true,
                "fullSubtreeExtensionCounts": {
                  ".py": 6
                },
                "numFiles": 6
              }
            ],
            "childrenWereProcessed": true,
            "fullSubtreeExtensionCounts": {
              ".py": 7
            },
            "numFiles": 7
          }
        ],
        "childrenFiles": [
          {
            "name": "babel.cfg"
          },
          {
            "name": "cli.py"
          },
          {
            "name": "uv.lock"
          }
        ],
        "childrenWereProcessed": true,
        "fullSubtreeExtensionCounts": {
          ".py": 69,
          ".md": 1,
          ".toml": 1,
          ".pot": 1,
          ".json": 3,
          "": 2,
          ".po": 2
        },
        "numFiles": 79
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\build",
        "childrenFiles": [
          {
            "name": "icon.icns"
          },
          {
            "name": "icon.ico"
          },
          {
            "name": "icon.png"
          },
          {
            "name": "installer.nsh"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\config",
        "childrenFiles": [
          {
            "name": "before-sign.cjs"
          },
          {
            "name": "browser-profiles.json"
          },
          {
            "name": "notarize.cjs"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\docs",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\docs\\core",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\docs\\core\\models",
                "fullSubtreeExtensionCounts": {
                  ".md": 2
                },
                "numFiles": 2
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".md": 6
            },
            "numFiles": 6
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\docs\\get_started",
            "childrenFiles": [
              {
                "name": "installation.md"
              },
              {
                "name": "quick_start.md"
              },
              {
                "name": "welcome.md"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\docs\\images",
            "childrenFiles": [
              {
                "name": "gemini_1.png"
              },
              {
                "name": "gemini_2.png"
              },
              {
                "name": "gemini_3.png"
              },
              {
                "name": "gemini_4.png"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\docs\\troubleshooting",
            "childrenFiles": [
              {
                "name": "bug.md"
              },
              {
                "name": "support.md"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": "docs.json"
          }
        ],
        "childrenWereProcessed": true,
        "fullSubtreeExtensionCounts": {
          ".md": 6
        },
        "numFiles": 6
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\electron",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\electron\\main",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\electron\\main\\utils",
                "childrenFiles": [
                  {
                    "name": "envUtil.ts"
                  },
                  {
                    "name": "log.ts"
                  },
                  {
                    "name": "mcpConfig.ts"
                  },
                  {
                    "name": "process.ts"
                  },
                  {
                    "name": "safeWebContentsSend.ts"
                  }
                ],
                "childrenWereProcessed": true
              }
            ],
            "childrenFiles": [
              {
                "name": "copy.ts"
              },
              {
                "name": "fileReader.ts"
              },
              {
                "name": "index.ts"
              },
              {
                "name": "init.ts"
              },
              {
                "name": "install-deps.ts"
              },
              {
                "name": "update.ts"
              },
              {
                "name": "webview.ts"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\electron\\preload",
            "childrenFiles": [
              {
                "name": "index.ts"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": "electron-env.d.ts"
          },
          {
            "name": "electron.d.ts"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist",
                    "childrenDirs": [
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components",
                        "childrenDirs": [
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components\\elements",
                            "fullSubtreeExtensionCounts": {
                              ".map": 6,
                              ".js": 6
                            },
                            "numFiles": 12
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components\\message-cards",
                            "fullSubtreeExtensionCounts": {
                              ".map": 3,
                              ".js": 3
                            },
                            "numFiles": 6
                          }
                        ],
                        "fullSubtreeExtensionCounts": {
                          ".map": 23,
                          ".js": 23
                        },
                        "numFiles": 46
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page",
                        "childrenDirs": [
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page\\account-settings",
                            "childrenDirs": [
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page\\account-settings\\active-sessions",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page\\account-settings\\api-keys",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page\\account-settings\\email-and-auth",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 6,
                                  ".js": 6
                                },
                                "numFiles": 12
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page\\account-settings\\profile-page",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page\\account-settings\\settings",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 3,
                                  ".js": 3
                                },
                                "numFiles": 6
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\components-page\\account-settings\\teams",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 9,
                                  ".js": 9
                                },
                                "numFiles": 18
                              }
                            ],
                            "fullSubtreeExtensionCounts": {
                              ".js": 24,
                              ".map": 24
                            },
                            "numFiles": 48
                          }
                        ],
                        "fullSubtreeExtensionCounts": {
                          ".map": 40,
                          ".js": 40
                        },
                        "numFiles": 80
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm",
                        "childrenDirs": [
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components",
                            "childrenDirs": [
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components\\elements",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 6,
                                  ".js": 6
                                },
                                "numFiles": 12
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components\\message-cards",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 3,
                                  ".js": 3
                                },
                                "numFiles": 6
                              }
                            ],
                            "fullSubtreeExtensionCounts": {
                              ".map": 23,
                              ".js": 23
                            },
                            "numFiles": 46
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page",
                            "childrenDirs": [
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page\\account-settings",
                                "childrenDirs": [
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page\\account-settings\\active-sessions",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page\\account-settings\\api-keys",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page\\account-settings\\email-and-auth",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 6,
                                      ".js": 6
                                    },
                                    "numFiles": 12
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page\\account-settings\\profile-page",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page\\account-settings\\settings",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 3,
                                      ".js": 3
                                    },
                                    "numFiles": 6
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\components-page\\account-settings\\teams",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 9,
                                      ".js": 9
                                    },
                                    "numFiles": 18
                                  }
                                ],
                                "fullSubtreeExtensionCounts": {
                                  ".map": 24,
                                  ".js": 24
                                },
                                "numFiles": 48
                              }
                            ],
                            "fullSubtreeExtensionCounts": {
                              ".map": 40,
                              ".js": 40
                            },
                            "numFiles": 80
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\generated",
                            "fullSubtreeExtensionCounts": {
                              ".map": 2,
                              ".js": 2
                            },
                            "numFiles": 4
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib",
                            "childrenDirs": [
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app",
                                "childrenDirs": [
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\api-keys",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\apps",
                                    "childrenDirs": [
                                      {
                                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\apps\\implementations",
                                        "fullSubtreeExtensionCounts": {
                                          ".map": 5,
                                          ".js": 5
                                        },
                                        "numFiles": 10
                                      },
                                      {
                                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\apps\\interfaces",
                                        "fullSubtreeExtensionCounts": {
                                          ".map": 3,
                                          ".js": 3
                                        },
                                        "numFiles": 6
                                      }
                                    ],
                                    "fullSubtreeExtensionCounts": {
                                      ".js": 9,
                                      ".map": 9
                                    },
                                    "numFiles": 18
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\connected-accounts",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\contact-channels",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\email",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\email-templates",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\internal-api-keys",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\permissions",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\project-configs",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\projects",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\teams",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\lib\\stack-app\\users",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 1,
                                      ".js": 1
                                    },
                                    "numFiles": 2
                                  }
                                ],
                                "fullSubtreeExtensionCounts": {
                                  ".map": 22,
                                  ".js": 22
                                },
                                "numFiles": 44
                              }
                            ],
                            "fullSubtreeExtensionCounts": {
                              ".map": 26,
                              ".js": 26
                            },
                            "numFiles": 52
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\providers",
                            "fullSubtreeExtensionCounts": {
                              ".map": 5,
                              ".js": 5
                            },
                            "numFiles": 10
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\esm\\utils",
                            "fullSubtreeExtensionCounts": {
                              ".map": 3,
                              ".js": 3
                            },
                            "numFiles": 6
                          }
                        ],
                        "fullSubtreeExtensionCounts": {
                          ".map": 101,
                          ".js": 101
                        },
                        "numFiles": 202
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\generated",
                        "fullSubtreeExtensionCounts": {
                          ".map": 2,
                          ".js": 2
                        },
                        "numFiles": 4
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib",
                        "childrenDirs": [
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app",
                            "childrenDirs": [
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\api-keys",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\apps",
                                "childrenDirs": [
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\apps\\implementations",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 5,
                                      ".js": 5
                                    },
                                    "numFiles": 10
                                  },
                                  {
                                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\apps\\interfaces",
                                    "fullSubtreeExtensionCounts": {
                                      ".map": 3,
                                      ".js": 3
                                    },
                                    "numFiles": 6
                                  }
                                ],
                                "fullSubtreeExtensionCounts": {
                                  ".map": 9,
                                  ".js": 9
                                },
                                "numFiles": 18
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\connected-accounts",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\contact-channels",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\email",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\email-templates",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\internal-api-keys",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\permissions",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\project-configs",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\projects",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\teams",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              },
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\lib\\stack-app\\users",
                                "fullSubtreeExtensionCounts": {
                                  ".map": 1,
                                  ".js": 1
                                },
                                "numFiles": 2
                              }
                            ],
                            "fullSubtreeExtensionCounts": {
                              ".map": 22,
                              ".js": 22
                            },
                            "numFiles": 44
                          }
                        ],
                        "fullSubtreeExtensionCounts": {
                          ".map": 26,
                          ".js": 26
                        },
                        "numFiles": 52
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\providers",
                        "fullSubtreeExtensionCounts": {
                          ".map": 5,
                          ".js": 5
                        },
                        "numFiles": 10
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\react\\dist\\utils",
                        "fullSubtreeExtensionCounts": {
                          ".map": 3,
                          ".js": 3
                        },
                        "numFiles": 6
                      }
                    ],
                    "fullSubtreeExtensionCounts": {
                      ".map": 202,
                      ".js": 202,
                      ".ts": 1,
                      ".mts": 1
                    },
                    "numFiles": 406
                  }
                ],
                "childrenFiles": [
                  {
                    "name": "LICENSE"
                  },
                  {
                    "name": "package.json"
                  },
                  {
                    "name": "README.md"
                  }
                ],
                "childrenWereProcessed": true,
                "fullSubtreeExtensionCounts": {
                  ".map": 202,
                  ".js": 202,
                  ".md": 1,
                  ".ts": 1,
                  ".mts": 1
                },
                "numFiles": 407
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist",
                    "childrenDirs": [
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\config",
                        "fullSubtreeExtensionCounts": {
                          ".mts": 2,
                          ".map": 2,
                          ".js": 2,
                          ".ts": 2
                        },
                        "numFiles": 8
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\esm",
                        "childrenDirs": [
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\esm\\config",
                            "fullSubtreeExtensionCounts": {
                              ".map": 2,
                              ".js": 2
                            },
                            "numFiles": 4
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\esm\\helpers",
                            "fullSubtreeExtensionCounts": {
                              ".map": 2,
                              ".js": 2
                            },
                            "numFiles": 4
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\esm\\hooks",
                            "fullSubtreeExtensionCounts": {
                              ".map": 4,
                              ".js": 4
                            },
                            "numFiles": 8
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\esm\\interface",
                            "childrenDirs": [
                              {
                                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\esm\\interface\\crud",
                                "fullSubtreeExtensionCounts": {
                                  ".js": 18,
                                  ".map": 18
                                },
                                "numFiles": 36
                              }
                            ],
                            "fullSubtreeExtensionCounts": {
                              ".map": 22,
                              ".js": 22
                            },
                            "numFiles": 44
                          },
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\esm\\utils",
                            "fullSubtreeExtensionCounts": {
                              ".map": 43,
                              ".js": 43
                            },
                            "numFiles": 86
                          }
                        ],
                        "fullSubtreeExtensionCounts": {
                          ".map": 79,
                          ".js": 79
                        },
                        "numFiles": 158
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\helpers",
                        "fullSubtreeExtensionCounts": {
                          ".map": 2,
                          ".js": 2,
                          ".ts": 2,
                          ".mts": 2
                        },
                        "numFiles": 8
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\hooks",
                        "fullSubtreeExtensionCounts": {
                          ".map": 4,
                          ".js": 4,
                          ".ts": 4,
                          ".mts": 4
                        },
                        "numFiles": 16
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\interface",
                        "childrenDirs": [
                          {
                            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\interface\\crud",
                            "fullSubtreeExtensionCounts": {
                              ".map": 18,
                              ".js": 18,
                              ".ts": 18,
                              ".mts": 18
                            },
                            "numFiles": 72
                          }
                        ],
                        "fullSubtreeExtensionCounts": {
                          ".map": 22,
                          ".js": 22,
                          ".ts": 22,
                          ".mts": 22
                        },
                        "numFiles": 88
                      },
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\package\\@stackframe\\stack-shared\\dist\\utils",
                        "fullSubtreeExtensionCounts": {
                          ".map": 43,
                          ".js": 43,
                          ".ts": 43,
                          ".mts": 43
                        },
                        "numFiles": 172
                      }
                    ],
                    "fullSubtreeExtensionCounts": {
                      ".map": 158,
                      ".js": 158,
                      ".ts": 79,
                      ".mts": 79
                    },
                    "numFiles": 474
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".json": 1,
                  "": 1,
                  ".map": 158,
                  ".js": 158,
                  ".ts": 79,
                  ".mts": 79,
                  ".md": 1
                },
                "numFiles": 477
              }
            ],
            "childrenWereProcessed": true,
            "fullSubtreeExtensionCounts": {
              ".json": 1,
              "": 1,
              ".map": 360,
              ".js": 360,
              ".ts": 80,
              ".mts": 80,
              ".md": 2
            },
            "numFiles": 884
          }
        ],
        "childrenWereProcessed": true,
        "fullSubtreeExtensionCounts": {
          ".json": 1,
          "": 1,
          ".map": 360,
          ".js": 360,
          ".ts": 80,
          ".mts": 80,
          ".md": 2
        },
        "numFiles": 884
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\ref",
        "childrenFiles": [
          {
            "name": "ARCHITECTURE.md"
          },
          {
            "name": "BACKEND_API.md"
          },
          {
            "name": "COMMANDS.md"
          },
          {
            "name": "DATA_MODELS.md"
          },
          {
            "name": "ELECTRON_IPC.md"
          },
          {
            "name": "FAQ.md"
          },
          {
            "name": "FRONTEND.md"
          },
          {
            "name": "GETTING_STARTED.md"
          },
          {
            "name": "GLOSSARY.md"
          },
          {
            "name": "SERVER_API.md"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\resources",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\resources\\scripts",
            "childrenFiles": [
              {
                "name": "download.js"
              },
              {
                "name": "install-bun.js"
              },
              {
                "name": "install-uv.js"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\scripts",
        "childrenFiles": [
          {
            "name": "clean-symlinks.js"
          },
          {
            "name": "preinstall-deps.js"
          },
          {
            "name": "test-signing.js"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\alembic",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\alembic\\versions",
                "fullSubtreeExtensionCounts": {
                  ".py": 4
                },
                "numFiles": 4
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".py": 5,
              ".mako": 1
            },
            "numFiles": 6
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\component",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\component\\pydantic",
                    "childrenDirs": [
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\component\\pydantic\\translations",
                        "fullSubtreeExtensionCounts": {
                          ".json": 2
                        },
                        "numFiles": 2
                      }
                    ],
                    "fullSubtreeExtensionCounts": {
                      ".py": 1,
                      ".json": 2
                    },
                    "numFiles": 3
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\component\\validator",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".py": 13,
                  ".json": 2
                },
                "numFiles": 15
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\controller",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\controller\\chat",
                    "fullSubtreeExtensionCounts": {
                      ".py": 4
                    },
                    "numFiles": 4
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\controller\\config",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\controller\\mcp",
                    "fullSubtreeExtensionCounts": {
                      ".py": 4
                    },
                    "numFiles": 4
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\controller\\oauth",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\controller\\provider",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\controller\\user",
                    "fullSubtreeExtensionCounts": {
                      ".py": 3
                    },
                    "numFiles": 3
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".py": 17
                },
                "numFiles": 17
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\exception",
                "fullSubtreeExtensionCounts": {
                  ".py": 2
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\middleware",
                "fullSubtreeExtensionCounts": {
                  ".py": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model\\abstract",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model\\chat",
                    "fullSubtreeExtensionCounts": {
                      ".py": 5
                    },
                    "numFiles": 5
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model\\config",
                    "fullSubtreeExtensionCounts": {
                      ".py": 2
                    },
                    "numFiles": 2
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model\\mcp",
                    "fullSubtreeExtensionCounts": {
                      ".py": 5
                    },
                    "numFiles": 5
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model\\pay",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model\\provider",
                    "fullSubtreeExtensionCounts": {
                      ".py": 1
                    },
                    "numFiles": 1
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\model\\user",
                    "fullSubtreeExtensionCounts": {
                      ".py": 9
                    },
                    "numFiles": 9
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".py": 24
                },
                "numFiles": 24
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\app\\type",
                "fullSubtreeExtensionCounts": {
                  ".py": 2
                },
                "numFiles": 2
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".py": 60,
              ".json": 2
            },
            "numFiles": 62
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\lang",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\lang\\zh_CN",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\server\\lang\\zh_CN\\LC_MESSAGES",
                    "fullSubtreeExtensionCounts": {
                      ".po": 1
                    },
                    "numFiles": 1
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".po": 1
                },
                "numFiles": 1
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".po": 1
            },
            "numFiles": 1
          }
        ],
        "fullSubtreeExtensionCounts": {
          ".lock": 1,
          ".sh": 2,
          ".ps1": 1,
          ".bat": 1,
          ".md": 2,
          ".toml": 1,
          ".pot": 1,
          ".py": 67,
          ".po": 1,
          "": 2,
          ".yml": 2,
          ".cfg": 1,
          ".example": 1,
          ".ini": 1,
          ".mako": 1,
          ".json": 2
        },
        "numFiles": 87
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\api",
            "fullSubtreeExtensionCounts": {
              ".ts": 1
            },
            "numFiles": 1
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\assets",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\assets\\animation",
                "fullSubtreeExtensionCounts": {
                  ".json": 2
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\assets\\mcp",
                "fullSubtreeExtensionCounts": {
                  ".svg": 5
                },
                "numFiles": 5
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".svg": 21,
              ".mp4": 3,
              ".png": 5,
              ".gif": 1,
              ".jpg": 1,
              ".json": 2
            },
            "numFiles": 33
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\AddWorker",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 2
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\animate-ui",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\animate-ui\\icons",
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 9
                    },
                    "numFiles": 9
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\animate-ui\\primitives",
                    "childrenDirs": [
                      {
                        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\animate-ui\\primitives\\animate",
                        "fullSubtreeExtensionCounts": {
                          ".tsx": 1
                        },
                        "numFiles": 1
                      }
                    ],
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 1
                    },
                    "numFiles": 1
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".tsx": 10
                },
                "numFiles": 10
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\BottomBar",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\BrowserAgentWorkSpace",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ChatBox",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ChatBox\\BottomBox",
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 5
                    },
                    "numFiles": 5
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ChatBox\\MessageItem",
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 6
                    },
                    "numFiles": 6
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ChatBox\\TaskBox",
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 5
                    },
                    "numFiles": 5
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".tsx": 21,
                  ".md": 1
                },
                "numFiles": 22
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\Dialog",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 3
                },
                "numFiles": 3
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\Folder",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 2
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\GlobalSearch",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\GroupedHistoryView",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 4
                },
                "numFiles": 4
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\Halo",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\HistorySidebar",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 2
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\InstallStep",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\InstallStep\\InstallationErrorDialog",
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 1
                    },
                    "numFiles": 1
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".tsx": 4
                },
                "numFiles": 4
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\IntegrationList",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\Layout",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\MenuButton",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\Navigation",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\SearchInput",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\SideBar",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\TaskState",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\Terminal",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\TerminalAgentWrokSpace",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\Toast",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 3
                },
                "numFiles": 3
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\TopBar",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1,
                  ".css": 1
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ui",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ui\\ShinyText",
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 1,
                      ".css": 1
                    },
                    "numFiles": 2
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ui\\SplitText",
                    "fullSubtreeExtensionCounts": {
                      ".jsx": 1,
                      ".ts": 1
                    },
                    "numFiles": 2
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\ui\\WordCarousel",
                    "fullSubtreeExtensionCounts": {
                      ".tsx": 1,
                      ".css": 1,
                      ".ts": 1
                    },
                    "numFiles": 3
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".tsx": 31,
                  ".css": 2,
                  ".ts": 2,
                  ".jsx": 1
                },
                "numFiles": 36
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\update",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\WindowControls",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1,
                  ".css": 1
                },
                "numFiles": 2
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\WorkFlow",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 3
                },
                "numFiles": 3
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\components\\WorkSpaceMenu",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".tsx": 105,
              ".css": 4,
              ".ts": 2,
              ".jsx": 1,
              ".md": 1
            },
            "numFiles": 113
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\demos",
            "fullSubtreeExtensionCounts": {
              ".ts": 1
            },
            "numFiles": 1
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\hooks",
            "fullSubtreeExtensionCounts": {
              ".ts": 2,
              ".tsx": 4
            },
            "numFiles": 6
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\ar",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\de",
                    "childrenFiles": [
                      {
                        "name": "chat.json"
                      },
                      {
                        "name": "dashboard.json"
                      },
                      {
                        "name": "index.ts"
                      },
                      {
                        "name": "layout.json"
                      },
                      {
                        "name": "setting.json"
                      },
                      {
                        "name": "update.json"
                      },
                      {
                        "name": "workforce.json"
                      }
                    ],
                    "childrenWereProcessed": true
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\en-us",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\es",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\fr",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\it",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\ja",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\ko",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\ru",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\zh-Hans",
                    "fullSubtreeExtensionCounts": {
                      ".json": 6,
                      ".ts": 1
                    },
                    "numFiles": 7
                  },
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\i18n\\locales\\zh-Hant",
                    "childrenFiles": [
                      {
                        "name": "chat.json"
                      },
                      {
                        "name": "dashboard.json"
                      },
                      {
                        "name": "index.ts"
                      },
                      {
                        "name": "layout.json"
                      },
                      {
                        "name": "setting.json"
                      },
                      {
                        "name": "update.json"
                      },
                      {
                        "name": "workforce.json"
                      }
                    ],
                    "childrenWereProcessed": true
                  }
                ],
                "childrenWereProcessed": true,
                "fullSubtreeExtensionCounts": {
                  ".json": 54,
                  ".ts": 10
                },
                "numFiles": 64
              }
            ],
            "childrenWereProcessed": true,
            "fullSubtreeExtensionCounts": {
              ".json": 54,
              ".ts": 11
            },
            "numFiles": 65
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\lib",
            "fullSubtreeExtensionCounts": {
              ".ts": 6
            },
            "numFiles": 6
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\pages",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\pages\\Dashboard",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 4
                },
                "numFiles": 4
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\pages\\Setting",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\pages\\Setting\\components",
                    "fullSubtreeExtensionCounts": {
                      ".ts": 2,
                      ".tsx": 8
                    },
                    "numFiles": 10
                  }
                ],
                "childrenFiles": [
                  {
                    "name": "MCP.tsx"
                  },
                  {
                    "name": "MCPMarket.tsx"
                  },
                  {
                    "name": "Models.tsx"
                  },
                  {
                    "name": "Privacy.tsx"
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".tsx": 10,
                  ".ts": 2
                },
                "numFiles": 12
              }
            ],
            "childrenFiles": [
              {
                "name": "Setting.tsx"
              },
              {
                "name": "SignUp.tsx"
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".tsx": 18,
              ".ts": 2
            },
            "numFiles": 20
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\routers",
            "childrenFiles": [
              {
                "name": "index.tsx"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\service",
            "fullSubtreeExtensionCounts": {
              ".ts": 1
            },
            "numFiles": 1
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\stack",
            "fullSubtreeExtensionCounts": {
              ".ts": 1
            },
            "numFiles": 1
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\store",
            "childrenFiles": [
              {
                "name": "authStore.ts"
              },
              {
                "name": "chatStore.ts"
              },
              {
                "name": "globalStore.ts"
              },
              {
                "name": "installationStore.ts"
              },
              {
                "name": "projectStore.ts"
              },
              {
                "name": "sidebarStore.ts"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\style",
            "childrenFiles": [
              {
                "name": "index.css"
              },
              {
                "name": "token.css"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\src\\types",
            "childrenFiles": [
              {
                "name": "chatbox.d.ts"
              },
              {
                "name": "electron-updater.d.ts"
              },
              {
                "name": "electron.d.ts"
              },
              {
                "name": "history.d.ts"
              },
              {
                "name": "index.ts"
              },
              {
                "name": "stackframe-react.d.ts"
              },
              {
                "name": "three-shim.d.ts"
              },
              {
                "name": "workspace.d.ts"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": "vite-env.d.ts"
          }
        ],
        "fullSubtreeExtensionCounts": {
          ".tsx": 129,
          ".json": 56,
          ".ts": 27,
          ".css": 4,
          ".jsx": 1,
          ".md": 1,
          ".svg": 21,
          ".mp4": 3,
          ".png": 5,
          ".gif": 1,
          ".jpg": 1
        },
        "numFiles": 249
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test",
        "childrenDirs": [
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\integration",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\integration\\chatStore",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 4
                },
                "numFiles": 4
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\integration\\components",
                "fullSubtreeExtensionCounts": {
                  ".tsx": 1
                },
                "numFiles": 1
              }
            ],
            "fullSubtreeExtensionCounts": {
              ".tsx": 5
            },
            "numFiles": 5
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\mocks",
            "childrenFiles": [
              {
                "name": "authStore.mock.ts"
              },
              {
                "name": "electronMocks.ts"
              },
              {
                "name": "environmentMocks.ts"
              },
              {
                "name": "proxy.mock.ts"
              },
              {
                "name": "sse.mock.ts"
              },
              {
                "name": "testUtils.ts"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\screenshots",
            "fullSubtreeExtensionCounts": {
              ".png": 1
            },
            "numFiles": 1
          },
          {
            "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit",
            "childrenDirs": [
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit\\components",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit\\components\\Setting",
                    "fullSubtreeExtensionCounts": {
                      ".ts": 1
                    },
                    "numFiles": 1
                  }
                ],
                "fullSubtreeExtensionCounts": {
                  ".tsx": 3,
                  ".ts": 1
                },
                "numFiles": 4
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit\\electron",
                "childrenDirs": [
                  {
                    "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit\\electron\\main",
                    "childrenFiles": [
                      {
                        "name": "domReadyHandlers.test.ts"
                      },
                      {
                        "name": "fileReader.test.ts"
                      },
                      {
                        "name": "index.test.ts"
                      },
                      {
                        "name": "installationStateLogic.test.ts"
                      },
                      {
                        "name": "processUtilsDemo.test.ts"
                      },
                      {
                        "name": "windowLifecycle.test.ts"
                      }
                    ],
                    "childrenWereProcessed": true
                  }
                ],
                "childrenFiles": [
                  {
                    "name": "install-deps.test.ts"
                  }
                ],
                "childrenWereProcessed": true
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit\\examples",
                "childrenFiles": [
                  {
                    "name": "installationFlow.test.ts"
                  }
                ],
                "childrenWereProcessed": true
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit\\hooks",
                "childrenFiles": [
                  {
                    "name": "useInstallationSetup.test.ts"
                  }
                ],
                "childrenWereProcessed": true
              },
              {
                "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\test\\unit\\store",
                "childrenFiles": [
                  {
                    "name": "chatStore.test.ts"
                  },
                  {
                    "name": "installationStore.test.ts"
                  }
                ],
                "childrenWereProcessed": true
              }
            ],
            "childrenFiles": [
              {
                "name": "utils.test.ts"
              }
            ],
            "childrenWereProcessed": true,
            "fullSubtreeExtensionCounts": {
              ".tsx": 3,
              ".ts": 2
            },
            "numFiles": 5
          }
        ],
        "childrenFiles": [
          {
            "name": "README.md"
          },
          {
            "name": "vitest-jest-dom.d.ts"
          }
        ],
        "childrenWereProcessed": true,
        "fullSubtreeExtensionCounts": {
          ".tsx": 8,
          ".ts": 3,
          ".png": 1
        },
        "numFiles": 12
      },
      {
        "absPath": "d:\\_Code\\_GitHub\\eigent-260119\\utils",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "traceroot_wrapper.py"
          }
        ],
        "childrenWereProcessed": true
      }
    ],
    "childrenFiles": [
      {
        "name": ".cursorindexingignore"
      },
      {
        "name": ".gitattributes"
      },
      {
        "name": ".gitignore"
      },
      {
        "name": ".markdownlintignore"
      },
      {
        "name": ".npmrc"
      },
      {
        "name": "components.json"
      },
      {
        "name": "CONTRIBUTING.md"
      },
      {
        "name": "electron-builder.json"
      },
      {
        "name": "entitlements.mac.plist"
      },
      {
        "name": "index.html"
      },
      {
        "name": "LICENSE"
      },
      {
        "name": "package.json"
      },
      {
        "name": "postcss.config.cjs"
      },
      {
        "name": "README_CN.md"
      },
      {
        "name": "README_JA.md"
      },
      {
        "name": "README_PT-BR.md"
      },
      {
        "name": "README.md"
      },
      {
        "name": "SECURITY.md"
      },
      {
        "name": "tsconfig.json"
      },
      {
        "name": "tsconfig.node.json"
      },
      {
        "name": "vite.config.ts"
      },
      {
        "name": "vitest.config.ts"
      }
    ],
    "fullSubtreeExtensionCounts": {
      ".tsx": 137,
      ".py": 136,
      ".json": 62,
      ".ts": 110,
      ".md": 12,
      "": 5,
      ".toml": 2,
      ".pot": 2,
      ".js": 361,
      ".map": 360,
      ".png": 6,
      ".po": 3,
      ".lock": 1,
      ".sh": 2,
      ".ps1": 1,
      ".bat": 1,
      ".mts": 80,
      ".css": 4,
      ".yml": 2,
      ".cfg": 1,
      ".jsx": 1,
      ".svg": 21,
      ".mp4": 3,
      ".gif": 1,
      ".jpg": 1,
      ".example": 1,
      ".ini": 1,
      ".mako": 1
    },
    "numFiles": 1318
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How are messages sent to Slack channels?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\human_toolkit.py",
        "range": {
          "startPosition": {
            "line": 12
          },
          "endPosition": {
            "line": 147
          }
        },
        "contents": "@auto_listen_toolkit(BaseToolkit)\nclass HumanToolkit(BaseToolkit, AbstractToolkit):\n\n\n    @listen_toolkit()\n    def send_message_to_user(\n        self,\n        message_title: str,\n        message_description: str,\n        message_attachment: str | None = None,\n    ) -&gt; str:\n        r\"\"\"Use this tool to send a tidy message to the user, including a\n        short title, a one-sentence description, and an optional attachment.\n\n        This one-way tool keeps the user informed about your progress,\n        decisions, or actions. It does not require a response.\n        You should use it to:\n        - Announce what you are about to do.\n        For example:\n        message_title=\"Starting Task\"\n        message_description=\"Searching for papers on GUI Agents.\"\n        - Report the result of an action.\n        For example:\n        message_title=\"Search Complete\"\n        message_description=\"Found 15 relevant papers.\"\n        - Report a created file.\n        For example:\n        message_title=\"File Ready\"\n        message_description=\"The report is ready for your review.\"\n        message_attachment=\"report.pdf\"\n        - State a decision.\n        For example:\n        message_title=\"Next Step\"\n        message_description=\"Analyzing the top 10 papers.\"\n        - Give a status update during a long-running task.\n\n        Args:\n            message_title (str): The title of the message.\n            message_description (str): The short description.\n            message_attachment (str): The attachment of the message,\n                which can be a file path or a URL.\n\n        Returns:\n            str: Confirmation that the message was successfully sent.\n        \"\"\"\n        print(f\"\\nAgent Message:\\n{message_title} \\n{message_description}\\n\")\n        if message_attachment:\n            print(message_attachment)\n\n        task_lock = get_task_lock(self.api_task_id)\n\n        # Get process_task_id from ContextVar with fallback\n        current_process_task_id = process_task.get(\"\")\n        if not current_process_task_id:\n            current_process_task_id =",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 13,
                "column": 1
              },
              "endPosition": {
                "line": 14,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 14,
                "column": 1
              },
              "endPosition": {
                "line": 15,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@auto_listen_toolkit(BaseToolkit)",
            "lineNumber": 13
          },
          {
            "text": "class HumanToolkit(BaseToolkit, AbstractToolkit):",
            "lineNumber": 14,
            "isSignature": true
          },
          {
            "lineNumber": 62
          },
          {
            "lineNumber": 63
          },
          {
            "text": "    @listen_toolkit()",
            "lineNumber": 64
          },
          {
            "text": "    def send_message_to_user(",
            "lineNumber": 65
          },
          {
            "text": "        self,",
            "lineNumber": 66
          },
          {
            "text": "        message_title: str,",
            "lineNumber": 67
          },
          {
            "text": "        message_description: str,",
            "lineNumber": 68
          },
          {
            "text": "        message_attachment: str | None = None,",
            "lineNumber": 69
          },
          {
            "text": "    ) -&gt; str:",
            "lineNumber": 70
          },
          {
            "text": "        r\"\"\"Use this tool to send a tidy message to the user, including a",
            "lineNumber": 71
          },
          {
            "text": "        short title, a one-sentence description, and an optional attachment.",
            "lineNumber": 72
          },
          {
            "lineNumber": 73
          },
          {
            "text": "        This one-way tool keeps the user informed about your progress,",
            "lineNumber": 74
          },
          {
            "text": "        decisions, or actions. It does not require a response.",
            "lineNumber": 75
          },
          {
            "text": "        You should use it to:",
            "lineNumber": 76
          },
          {
            "text": "        - Announce what you are about to do.",
            "lineNumber": 77
          },
          {
            "text": "        For example:",
            "lineNumber": 78
          },
          {
            "text": "        message_title=\"Starting Task\"",
            "lineNumber": 79
          },
          {
            "text": "        message_description=\"Searching for papers on GUI Agents.\"",
            "lineNumber": 80
          },
          {
            "text": "        - Report the result of an action.",
            "lineNumber": 81
          },
          {
            "text": "        For example:",
            "lineNumber": 82
          },
          {
            "text": "        message_title=\"Search Complete\"",
            "lineNumber": 83
          },
          {
            "text": "        message_description=\"Found 15 relevant papers.\"",
            "lineNumber": 84
          },
          {
            "text": "        - Report a created file.",
            "lineNumber": 85
          },
          {
            "text": "        For example:",
            "lineNumber": 86
          },
          {
            "text": "        message_title=\"File Ready\"",
            "lineNumber": 87
          },
          {
            "text": "        message_description=\"The report is ready for your review.\"",
            "lineNumber": 88
          },
          {
            "text": "        message_attachment=\"report.pdf\"",
            "lineNumber": 89
          },
          {
            "text": "        - State a decision.",
            "lineNumber": 90
          },
          {
            "text": "        For example:",
            "lineNumber": 91
          },
          {
            "text": "        message_title=\"Next Step\"",
            "lineNumber": 92
          },
          {
            "text": "        message_description=\"Analyzing the top 10 papers.\"",
            "lineNumber": 93
          },
          {
            "text": "        - Give a status update during a long-running task.",
            "lineNumber": 94
          },
          {
            "lineNumber": 95
          },
          {
            "text": "        Args:",
            "lineNumber": 96
          },
          {
            "text": "            message_title (str): The title of the message.",
            "lineNumber": 97
          },
          {
            "text": "            message_description (str): The short description.",
            "lineNumber": 98
          },
          {
            "text": "            message_attachment (str): The attachment of the message,",
            "lineNumber": 99
          },
          {
            "text": "                which can be a file path or a URL.",
            "lineNumber": 100
          },
          {
            "lineNumber": 101
          },
          {
            "text": "        Returns:",
            "lineNumber": 102
          },
          {
            "text": "            str: Confirmation that the message was successfully sent.",
            "lineNumber": 103
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 104
          },
          {
            "text": "        print(f\"\\nAgent Message:\\n{message_title} \\n{message_description}\\n\")",
            "lineNumber": 105
          },
          {
            "text": "        if message_attachment:",
            "lineNumber": 106
          },
          {
            "text": "            print(message_attachment)",
            "lineNumber": 107
          },
          {
            "lineNumber": 108
          },
          {
            "text": "        task_lock = get_task_lock(self.api_task_id)",
            "lineNumber": 109
          },
          {
            "lineNumber": 110
          },
          {
            "text": "        # Get process_task_id from ContextVar with fallback",
            "lineNumber": 111
          },
          {
            "text": "        current_process_task_id = process_task.get(\"\")",
            "lineNumber": 112
          },
          {
            "text": "        if not current_process_task_id:",
            "lineNumber": 113
          },
          {
            "text": "            current_process_task_id =",
            "lineNumber": 114
          }
        ]
      },
      "score": 0.3506852388381958
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\store\\chatStore.ts",
        "range": {
          "startPosition": {
            "line": 162
          },
          "endPosition": {
            "line": 2594,
            "column": 1
          }
        },
        "contents": "const chatStore = \n(set, get) =&gt; (\nasync (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {\n // Default to current store\n\t\t\t/**\n\t\t\t * Replay creates its own chatStore for each task with replayProject\n\t\t\t */\n\t\t\tif (project_id &amp;&amp; type !== \"replay\") {\n\t\t\t\tconsole.log(\"Creating a new Chat Instance for current project on end\")\n\t\t\t\tconst newChatResult = projectStore.appendInitChatStore(project_id);\n\n\t\t\t\tif (newChatResult) {\n\t\t\t\t\tnewTaskId = newChatResult.taskId;\n\t\t\t\t\ttargetChatStore = newChatResult.chatStore;\n\t\t\t\t\ttargetChatStore.getState().setIsPending(newTaskId, true);\n\n\t\t\t\t\t//From handleSend if message is given\n\t\t\t\t\t// Add the message to the new chatStore if provided\n\t\t\t\t\tif (messageContent) {\n\t\t\t\t\t\ttargetChatStore.getState().addMessages(newTaskId, {\n\t\t\t\t\t\t\tid: generateUniqueId(),\n\t\t\t\t\t\t\trole: \"user\",\n\t\t\t\t\t\t\tcontent: messageContent,\n\t\t\t\t\t\t\tattaches: messageAttaches || [],\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttargetChatStore.getState().setHasMessages(newTaskId, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst base_Url = import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL\n\t\t\tconst api = type == 'share' ?\n\t\t\t\t&#96;${base_Url}/api/chat/share/playback/${shareToken}?delay_time=${delayTime}&#96;\n\t\t\t\t: type == 'replay' ?\n\t\t\t\t\t&#96;${base_Url}/api/chat/steps/playback/${newTaskId}?delay_time=${delayTime}&#96;\n\t\t\t\t\t: &#96;${baseURL}/chat&#96;\n\n\t\t\tconst { tasks } = get()\n\t\t\tlet historyId: string | null = projectStore.getHistoryId(project_id);\n\t\t\tlet snapshots: any = [];\n\t\t\tlet skipFirstConfirm = true;\n\n\t\t\t// replay or share request\n\t\t\tif (type) {\n\t\t\t\tconst res = await proxyFetchGet(&#96;/api/chat/snapshots&#96;, {\n\t\t\t\t\tapi_task_id: taskId\n\t\t\t\t});\n\t\t\t\tif (res) {\n\t\t\t\t\tsnapshots = [...new Map(res.map((item: any) =&gt; [item.camel_task_id, item])).values()];\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\t// get current model\n\t\t\tlet apiModel = {\n\t\t\t\tapi_key: '',\n\t\t\t\tmodel_type: '',\n\t\t\t\tmodel_platform: '',\n\t\t\t\tapi_url: '',\n\t\t\t\textra_params: {}\n\t\t\t}\n\t\t\tif (modelType === 'custom' || modelType === 'local') {\n\t\t\t\tconst res = await proxyFetchGet('/api/providers', {\n\t\t\t\t\tprefer: true\n\t\t\t\t});\n\t\t}\n)\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 163,
                "column": 1
              },
              "endPosition": {
                "line": 163,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 7
              },
              "endPosition": {
                "line": 163,
                "column": 19
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 53
              },
              "endPosition": {
                "line": 163,
                "column": 53
              }
            },
            {
              "startPosition": {
                "line": 164,
                "column": 2
              },
              "endPosition": {
                "line": 164,
                "column": 17
              }
            },
            {
              "startPosition": {
                "line": 331,
                "column": 14
              },
              "endPosition": {
                "line": 332,
                "column": 4
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const chatStore = ",
            "lineNumber": 163
          },
          {
            "text": "(set, get) =&gt; (",
            "lineNumber": 164
          },
          {
            "text": "async (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {",
            "lineNumber": 331
          },
          {
            "text": " // Default to current store",
            "lineNumber": 368
          },
          {
            "text": "\t\t\t/**",
            "lineNumber": 369
          },
          {
            "text": "\t\t\t * Replay creates its own chatStore for each task with replayProject",
            "lineNumber": 370
          },
          {
            "text": "\t\t\t */",
            "lineNumber": 371
          },
          {
            "text": "\t\t\tif (project_id &amp;&amp; type !== \"replay\") {",
            "lineNumber": 372
          },
          {
            "text": "\t\t\t\tconsole.log(\"Creating a new Chat Instance for current project on end\")",
            "lineNumber": 373
          },
          {
            "text": "\t\t\t\tconst newChatResult = projectStore.appendInitChatStore(project_id);",
            "lineNumber": 374
          },
          {
            "lineNumber": 375
          },
          {
            "text": "\t\t\t\tif (newChatResult) {",
            "lineNumber": 376
          },
          {
            "text": "\t\t\t\t\tnewTaskId = newChatResult.taskId;",
            "lineNumber": 377
          },
          {
            "text": "\t\t\t\t\ttargetChatStore = newChatResult.chatStore;",
            "lineNumber": 378
          },
          {
            "text": "\t\t\t\t\ttargetChatStore.getState().setIsPending(newTaskId, true);",
            "lineNumber": 379
          },
          {
            "lineNumber": 380
          },
          {
            "text": "\t\t\t\t\t//From handleSend if message is given",
            "lineNumber": 381
          },
          {
            "text": "\t\t\t\t\t// Add the message to the new chatStore if provided",
            "lineNumber": 382
          },
          {
            "text": "\t\t\t\t\tif (messageContent) {",
            "lineNumber": 383
          },
          {
            "text": "\t\t\t\t\t\ttargetChatStore.getState().addMessages(newTaskId, {",
            "lineNumber": 384
          },
          {
            "text": "\t\t\t\t\t\t\tid: generateUniqueId(),",
            "lineNumber": 385
          },
          {
            "text": "\t\t\t\t\t\t\trole: \"user\",",
            "lineNumber": 386
          },
          {
            "text": "\t\t\t\t\t\t\tcontent: messageContent,",
            "lineNumber": 387
          },
          {
            "text": "\t\t\t\t\t\t\tattaches: messageAttaches || [],",
            "lineNumber": 388
          },
          {
            "text": "\t\t\t\t\t\t});",
            "lineNumber": 389
          },
          {
            "text": "\t\t\t\t\t\ttargetChatStore.getState().setHasMessages(newTaskId, true);",
            "lineNumber": 390
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 391
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 392
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 393
          },
          {
            "lineNumber": 394
          },
          {
            "text": "\t\t\tconst base_Url = import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL",
            "lineNumber": 395
          },
          {
            "text": "\t\t\tconst api = type == 'share' ?",
            "lineNumber": 396
          },
          {
            "text": "\t\t\t\t&#96;${base_Url}/api/chat/share/playback/${shareToken}?delay_time=${delayTime}&#96;",
            "lineNumber": 397
          },
          {
            "text": "\t\t\t\t: type == 'replay' ?",
            "lineNumber": 398
          },
          {
            "text": "\t\t\t\t\t&#96;${base_Url}/api/chat/steps/playback/${newTaskId}?delay_time=${delayTime}&#96;",
            "lineNumber": 399
          },
          {
            "text": "\t\t\t\t\t: &#96;${baseURL}/chat&#96;",
            "lineNumber": 400
          },
          {
            "lineNumber": 401
          },
          {
            "text": "\t\t\tconst { tasks } = get()",
            "lineNumber": 402
          },
          {
            "text": "\t\t\tlet historyId: string | null = projectStore.getHistoryId(project_id);",
            "lineNumber": 403
          },
          {
            "text": "\t\t\tlet snapshots: any = [];",
            "lineNumber": 404
          },
          {
            "text": "\t\t\tlet skipFirstConfirm = true;",
            "lineNumber": 405
          },
          {
            "lineNumber": 406
          },
          {
            "text": "\t\t\t// replay or share request",
            "lineNumber": 407
          },
          {
            "text": "\t\t\tif (type) {",
            "lineNumber": 408
          },
          {
            "text": "\t\t\t\tconst res = await proxyFetchGet(&#96;/api/chat/snapshots&#96;, {",
            "lineNumber": 409
          },
          {
            "text": "\t\t\t\t\tapi_task_id: taskId",
            "lineNumber": 410
          },
          {
            "text": "\t\t\t\t});",
            "lineNumber": 411
          },
          {
            "text": "\t\t\t\tif (res) {",
            "lineNumber": 412
          },
          {
            "text": "\t\t\t\t\tsnapshots = [...new Map(res.map((item: any) =&gt; [item.camel_task_id, item])).values()];",
            "lineNumber": 413
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 414
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 415
          },
          {
            "lineNumber": 416
          },
          {
            "lineNumber": 417
          },
          {
            "text": "\t\t\t// get current model",
            "lineNumber": 418
          },
          {
            "text": "\t\t\tlet apiModel = {",
            "lineNumber": 419
          },
          {
            "text": "\t\t\t\tapi_key: '',",
            "lineNumber": 420
          },
          {
            "text": "\t\t\t\tmodel_type: '',",
            "lineNumber": 421
          },
          {
            "text": "\t\t\t\tmodel_platform: '',",
            "lineNumber": 422
          },
          {
            "text": "\t\t\t\tapi_url: '',",
            "lineNumber": 423
          },
          {
            "text": "\t\t\t\textra_params: {}",
            "lineNumber": 424
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 425
          },
          {
            "text": "\t\t\tif (modelType === 'custom' || modelType === 'local') {",
            "lineNumber": 426
          },
          {
            "text": "\t\t\t\tconst res = await proxyFetchGet('/api/providers', {",
            "lineNumber": 427
          },
          {
            "text": "\t\t\t\t\tprefer: true",
            "lineNumber": 428
          },
          {
            "text": "\t\t\t\t});",
            "lineNumber": 429
          },
          {
            "text": "\t\t}",
            "lineNumber": 1888
          },
          {
            "text": ")",
            "lineNumber": 2594
          },
          {
            "text": ";",
            "lineNumber": 2595
          }
        ]
      },
      "score": 0.32625043392181396
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\slack_toolkit.py",
        "range": {
          "startPosition": {
            "column": 59
          },
          "endPosition": {
            "line": 25,
            "column": 21
          }
        },
        "contents": "from camel.toolkits.function_tool import FunctionTool\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\nfrom utils import traceroot_wrapper as traceroot\n\nlogger = traceroot.get_logger(\"slack_toolkit\")\n\n\n@auto_listen_toolkit(BaseSlackToolkit)\nclass SlackToolkit(BaseSlackToolkit, AbstractToolkit):\n    agent_name: str = Agents.social_medium_agent\n\n    def __init__(self, api_task_id: str, timeout: float | None = None):\n        super().__init__(timeout)\n        self.api_task_id = api_task_id\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:\n        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")\n        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):\n            return SlackToolkit(api_task_id).get_tools()\n        else:\n            return []",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from camel.toolkits.function_tool import FunctionTool",
            "lineNumber": 2
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 3
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 4
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 5
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 6
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "logger = traceroot.get_logger(\"slack_toolkit\")",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "@auto_listen_toolkit(BaseSlackToolkit)",
            "lineNumber": 12
          },
          {
            "text": "class SlackToolkit(BaseSlackToolkit, AbstractToolkit):",
            "lineNumber": 13,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.social_medium_agent",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "    def __init__(self, api_task_id: str, timeout: float | None = None):",
            "lineNumber": 16
          },
          {
            "text": "        super().__init__(timeout)",
            "lineNumber": 17
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "text": "    @classmethod",
            "lineNumber": 20
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:",
            "lineNumber": 21
          },
          {
            "text": "        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")",
            "lineNumber": 22
          },
          {
            "text": "        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):",
            "lineNumber": 23
          },
          {
            "text": "            return SlackToolkit(api_task_id).get_tools()",
            "lineNumber": 24
          },
          {
            "text": "        else:",
            "lineNumber": 25
          },
          {
            "text": "            return []",
            "lineNumber": 26,
            "isSignature": true
          }
        ]
      },
      "score": 0.3237681984901428
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 236
          },
          "endPosition": {
            "line": 1075
          }
        },
        "contents": "@sync_step\n@traceroot.trace()\nasync def step_solve(options: Chat, request: Request, task_lock: TaskLock):\n    # if True:\n    #     import faulthandler\n\n    #     faulthandler.enable()\n    #     for second in [5, 10, 20, 30, 60, 120, 240]:\n    #         faulthandler.dump_traceback_later(second)\n\n                else:\n                    if workforce is None:\n                        logger.warning(f\"[TRACE] Workforce is None - this might be the issue\")\n                    if not new_task_content:\n                        logger.warning(f\"[TRACE] No new task content provided\")\n            elif item.action == Action.create_agent:\n                yield sse_json(\"create_agent\", item.data)\n            elif item.action == Action.activate_agent:\n                yield sse_json(\"activate_agent\", item.data)\n            elif item.action == Action.deactivate_agent:\n                yield sse_json(\"deactivate_agent\", dict(item.data))\n            elif item.action == Action.assign_task:\n                yield sse_json(\"assign_task\", item.data)\n            elif item.action == Action.activate_toolkit:\n                yield sse_json(\"activate_toolkit\", item.data)\n            elif item.action == Action.deactivate_toolkit:\n                yield sse_json(\"deactivate_toolkit\", item.data)\n            elif item.action == Action.write_file:\n                yield sse_json(\n                    \"write_file\",\n                    {\"file_path\": item.data, \"process_task_id\": item.process_task_id},\n                )\n            elif item.action == Action.ask:\n                yield sse_json(\"ask\", item.data)\n            elif item.action == Action.notice:\n                yield sse_json(\n                    \"notice\",\n                    {\"notice\": item.data, \"process_task_id\": item.process_task_id},\n                )\n            elif item.action == Action.search_mcp:\n                yield sse_json(\"search_mcp\", item.data)\n            elif item.action == Action.install_mcp:\n                task = asyncio.create_task(install_mcp(mcp, item))\n                task_lock.add_background_task(task)\n            elif item.action == Action.terminal:\n                yield sse_json(\n                    \"terminal\",",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 237,
                "column": 1
              },
              "endPosition": {
                "line": 239,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 239,
                "column": 1
              },
              "endPosition": {
                "line": 247,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@sync_step",
            "lineNumber": 237
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 238
          },
          {
            "text": "async def step_solve(options: Chat, request: Request, task_lock: TaskLock):",
            "lineNumber": 239,
            "isSignature": true
          },
          {
            "text": "    # if True:",
            "lineNumber": 240,
            "isSignature": true
          },
          {
            "text": "    #     import faulthandler",
            "lineNumber": 241,
            "isSignature": true
          },
          {
            "lineNumber": 242,
            "isSignature": true
          },
          {
            "text": "    #     faulthandler.enable()",
            "lineNumber": 243,
            "isSignature": true
          },
          {
            "text": "    #     for second in [5, 10, 20, 30, 60, 120, 240]:",
            "lineNumber": 244,
            "isSignature": true
          },
          {
            "text": "    #         faulthandler.dump_traceback_later(second)",
            "lineNumber": 245,
            "isSignature": true
          },
          {
            "lineNumber": 877
          },
          {
            "text": "                else:",
            "lineNumber": 878
          },
          {
            "text": "                    if workforce is None:",
            "lineNumber": 879
          },
          {
            "text": "                        logger.warning(f\"[TRACE] Workforce is None - this might be the issue\")",
            "lineNumber": 880
          },
          {
            "text": "                    if not new_task_content:",
            "lineNumber": 881
          },
          {
            "text": "                        logger.warning(f\"[TRACE] No new task content provided\")",
            "lineNumber": 882
          },
          {
            "text": "            elif item.action == Action.create_agent:",
            "lineNumber": 883
          },
          {
            "text": "                yield sse_json(\"create_agent\", item.data)",
            "lineNumber": 884
          },
          {
            "text": "            elif item.action == Action.activate_agent:",
            "lineNumber": 885
          },
          {
            "text": "                yield sse_json(\"activate_agent\", item.data)",
            "lineNumber": 886
          },
          {
            "text": "            elif item.action == Action.deactivate_agent:",
            "lineNumber": 887
          },
          {
            "text": "                yield sse_json(\"deactivate_agent\", dict(item.data))",
            "lineNumber": 888
          },
          {
            "text": "            elif item.action == Action.assign_task:",
            "lineNumber": 889
          },
          {
            "text": "                yield sse_json(\"assign_task\", item.data)",
            "lineNumber": 890
          },
          {
            "text": "            elif item.action == Action.activate_toolkit:",
            "lineNumber": 891
          },
          {
            "text": "                yield sse_json(\"activate_toolkit\", item.data)",
            "lineNumber": 892
          },
          {
            "text": "            elif item.action == Action.deactivate_toolkit:",
            "lineNumber": 893
          },
          {
            "text": "                yield sse_json(\"deactivate_toolkit\", item.data)",
            "lineNumber": 894
          },
          {
            "text": "            elif item.action == Action.write_file:",
            "lineNumber": 895
          },
          {
            "text": "                yield sse_json(",
            "lineNumber": 896
          },
          {
            "text": "                    \"write_file\",",
            "lineNumber": 897
          },
          {
            "text": "                    {\"file_path\": item.data, \"process_task_id\": item.process_task_id},",
            "lineNumber": 898
          },
          {
            "text": "                )",
            "lineNumber": 899
          },
          {
            "text": "            elif item.action == Action.ask:",
            "lineNumber": 900
          },
          {
            "text": "                yield sse_json(\"ask\", item.data)",
            "lineNumber": 901
          },
          {
            "text": "            elif item.action == Action.notice:",
            "lineNumber": 902
          },
          {
            "text": "                yield sse_json(",
            "lineNumber": 903
          },
          {
            "text": "                    \"notice\",",
            "lineNumber": 904
          },
          {
            "text": "                    {\"notice\": item.data, \"process_task_id\": item.process_task_id},",
            "lineNumber": 905
          },
          {
            "text": "                )",
            "lineNumber": 906
          },
          {
            "text": "            elif item.action == Action.search_mcp:",
            "lineNumber": 907
          },
          {
            "text": "                yield sse_json(\"search_mcp\", item.data)",
            "lineNumber": 908
          },
          {
            "text": "            elif item.action == Action.install_mcp:",
            "lineNumber": 909
          },
          {
            "text": "                task = asyncio.create_task(install_mcp(mcp, item))",
            "lineNumber": 910
          },
          {
            "text": "                task_lock.add_background_task(task)",
            "lineNumber": 911
          },
          {
            "text": "            elif item.action == Action.terminal:",
            "lineNumber": 912
          },
          {
            "text": "                yield sse_json(",
            "lineNumber": 913
          },
          {
            "text": "                    \"terminal\",",
            "lineNumber": 914
          }
        ]
      },
      "score": 0.32125556468963623
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\store\\chatStore.ts",
        "range": {
          "startPosition": {
            "line": 162
          },
          "endPosition": {
            "line": 2594,
            "column": 1
          }
        },
        "contents": "const chatStore = \n(set, get) =&gt; (\nasync (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {\n\nasync onmessage(event: any) {\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (agentMessages.step === \"end\") {\n\t\t\t\t\t\t// compute task time\n\t\t\t\t\t\tconsole.log('tasks[taskId].snapshotsTemp', tasks[currentTaskId].snapshotsTemp)\n\t\t\t\t\t\tPromise.all(tasks[currentTaskId].snapshotsTemp.map((snapshot) =&gt;\n\t\t\t\t\t\t\tproxyFetchPost(&#96;/api/chat/snapshots&#96;, { ...snapshot })\n\t\t\t\t\t\t));\n\n\t\t\t\t\t\t// Async file upload\n\t\t\t\t\t\tlet res = await window.ipcRenderer.invoke(\n\t\t\t\t\t\t\t\"get-file-list\",\n\t\t\t\t\t\t\temail,\n\t\t\t\t\t\t\tcurrentTaskId,\n\t\t\t\t\t\t\t(project_id || projectStore.activeProjectId) as string\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!type &amp;&amp; import.meta.env.VITE_USE_LOCAL_PROXY !== 'true' &amp;&amp; res.length &gt; 0) {\n\t\t\t\t\t\t\t// Upload files sequentially to avoid overwhelming the server\n\t\t\t\t\t\t\tconst uploadResults = await Promise.allSettled(\n\t\t\t\t\t\t\t\tres.filter((file: any) =&gt; !file.isFolder).map(async (file: any) =&gt; {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t// Read file content using Electron API\n\t\t\t\t\t\t\t\t\t\tconst result = await window.ipcRenderer.invoke('read-file', file.path);\n\t\t\t\t\t\t\t\t\t\tif (result.success &amp;&amp; result.data) {\n\t\t\t\t\t\t\t\t\t\t\t// Create FormData for file upload\n\t\t\t\t\t\t\t\t\t\t\tconst formData = new FormData();\n\t\t\t\t\t\t\t\t\t\t\tconst blob = new Blob([result.data], { type: 'application/octet-stream' });\n\t\t\t\t\t\t\t\t\t\t\tformData.append('file', blob, file.name);\n\t\t\t\t\t\t\t\t\t\t\t//TODO(file): rename endpoint to use project_id\n\t\t\t\t\t\t\t\t\t\t\tformData.append('task_id', (project_id || projectStore.activeProjectId) as string);\n\n\t\t\t\t\t\t\t\t\t\t\t// Upload file\n\t\t\t\t\t\t\t\t\t\t\tawait uploadFile('/api/chat/files/upload', formData);\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('File uploaded successfully:', file.name);\n\t\t\t\t\t\t\t\t\t\t\treturn { success: true, fileName: file.name };\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tconsole.error('Failed to read file:', result.error);\n\t\t\t\t\t\t\t\t\t\t\treturn { success: false, fileName: file.name, error: result.error };\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\tconsole.error('File upload failed:', error);\n\t\t\t\t\t\t\t\t\t\treturn { success: false, fileName: file.name, error };\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Count successful uploads\n\t\t\t\t\t\t\tconst successCount = uploadResults.filter\n;\n\t\t\t\t}\n\n\t\t}\n)\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 163,
                "column": 1
              },
              "endPosition": {
                "line": 163,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 7
              },
              "endPosition": {
                "line": 163,
                "column": 19
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 53
              },
              "endPosition": {
                "line": 163,
                "column": 53
              }
            },
            {
              "startPosition": {
                "line": 164,
                "column": 2
              },
              "endPosition": {
                "line": 164,
                "column": 17
              }
            },
            {
              "startPosition": {
                "line": 331,
                "column": 14
              },
              "endPosition": {
                "line": 332,
                "column": 4
              }
            },
            {
              "startPosition": {
                "line": 586,
                "column": 4
              },
              "endPosition": {
                "line": 586,
                "column": 4
              }
            },
            {
              "startPosition": {
                "line": 612,
                "column": 5
              },
              "endPosition": {
                "line": 613,
                "column": 6
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const chatStore = ",
            "lineNumber": 163
          },
          {
            "text": "(set, get) =&gt; (",
            "lineNumber": 164
          },
          {
            "text": "async (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {",
            "lineNumber": 331
          },
          {
            "lineNumber": 586
          },
          {
            "text": "async onmessage(event: any) {",
            "lineNumber": 612
          },
          {
            "lineNumber": 1600
          },
          {
            "text": "\t\t\t\t\t\t}",
            "lineNumber": 1601
          },
          {
            "text": "\t\t\t\t\t\treturn;",
            "lineNumber": 1602
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 1603
          },
          {
            "lineNumber": 1604
          },
          {
            "text": "\t\t\t\t\tif (agentMessages.step === \"end\") {",
            "lineNumber": 1605
          },
          {
            "text": "\t\t\t\t\t\t// compute task time",
            "lineNumber": 1606
          },
          {
            "text": "\t\t\t\t\t\tconsole.log('tasks[taskId].snapshotsTemp', tasks[currentTaskId].snapshotsTemp)",
            "lineNumber": 1607
          },
          {
            "text": "\t\t\t\t\t\tPromise.all(tasks[currentTaskId].snapshotsTemp.map((snapshot) =&gt;",
            "lineNumber": 1608
          },
          {
            "text": "\t\t\t\t\t\t\tproxyFetchPost(&#96;/api/chat/snapshots&#96;, { ...snapshot })",
            "lineNumber": 1609
          },
          {
            "text": "\t\t\t\t\t\t));",
            "lineNumber": 1610
          },
          {
            "lineNumber": 1611
          },
          {
            "text": "\t\t\t\t\t\t// Async file upload",
            "lineNumber": 1612
          },
          {
            "text": "\t\t\t\t\t\tlet res = await window.ipcRenderer.invoke(",
            "lineNumber": 1613
          },
          {
            "text": "\t\t\t\t\t\t\t\"get-file-list\",",
            "lineNumber": 1614
          },
          {
            "text": "\t\t\t\t\t\t\temail,",
            "lineNumber": 1615
          },
          {
            "text": "\t\t\t\t\t\t\tcurrentTaskId,",
            "lineNumber": 1616
          },
          {
            "text": "\t\t\t\t\t\t\t(project_id || projectStore.activeProjectId) as string",
            "lineNumber": 1617
          },
          {
            "text": "\t\t\t\t\t\t);",
            "lineNumber": 1618
          },
          {
            "text": "\t\t\t\t\t\tif (!type &amp;&amp; import.meta.env.VITE_USE_LOCAL_PROXY !== 'true' &amp;&amp; res.length &gt; 0) {",
            "lineNumber": 1619
          },
          {
            "text": "\t\t\t\t\t\t\t// Upload files sequentially to avoid overwhelming the server",
            "lineNumber": 1620
          },
          {
            "text": "\t\t\t\t\t\t\tconst uploadResults = await Promise.allSettled(",
            "lineNumber": 1621
          },
          {
            "text": "\t\t\t\t\t\t\t\tres.filter((file: any) =&gt; !file.isFolder).map(async (file: any) =&gt; {",
            "lineNumber": 1622
          },
          {
            "text": "\t\t\t\t\t\t\t\t\ttry {",
            "lineNumber": 1623
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t// Read file content using Electron API",
            "lineNumber": 1624
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\tconst result = await window.ipcRenderer.invoke('read-file', file.path);",
            "lineNumber": 1625
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\tif (result.success &amp;&amp; result.data) {",
            "lineNumber": 1626
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\t// Create FormData for file upload",
            "lineNumber": 1627
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\tconst formData = new FormData();",
            "lineNumber": 1628
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\tconst blob = new Blob([result.data], { type: 'application/octet-stream' });",
            "lineNumber": 1629
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\tformData.append('file', blob, file.name);",
            "lineNumber": 1630
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\t//TODO(file): rename endpoint to use project_id",
            "lineNumber": 1631
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\tformData.append('task_id', (project_id || projectStore.activeProjectId) as string);",
            "lineNumber": 1632
          },
          {
            "lineNumber": 1633
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\t// Upload file",
            "lineNumber": 1634
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\tawait uploadFile('/api/chat/files/upload', formData);",
            "lineNumber": 1635
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\tconsole.log('File uploaded successfully:', file.name);",
            "lineNumber": 1636
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\treturn { success: true, fileName: file.name };",
            "lineNumber": 1637
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t} else {",
            "lineNumber": 1638
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\tconsole.error('Failed to read file:', result.error);",
            "lineNumber": 1639
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t\treturn { success: false, fileName: file.name, error: result.error };",
            "lineNumber": 1640
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\t}",
            "lineNumber": 1641
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t} catch (error) {",
            "lineNumber": 1642
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\tconsole.error('File upload failed:', error);",
            "lineNumber": 1643
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\treturn { success: false, fileName: file.name, error };",
            "lineNumber": 1644
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t}",
            "lineNumber": 1645
          },
          {
            "text": "\t\t\t\t\t\t\t\t})",
            "lineNumber": 1646
          },
          {
            "text": "\t\t\t\t\t\t\t);",
            "lineNumber": 1647
          },
          {
            "lineNumber": 1648
          },
          {
            "text": "\t\t\t\t\t\t\t// Count successful uploads",
            "lineNumber": 1649
          },
          {
            "text": "\t\t\t\t\t\t\tconst successCount = uploadResults.filter",
            "lineNumber": 1650
          },
          {
            "text": ";",
            "lineNumber": 1652
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 1836
          },
          {
            "lineNumber": 1886
          },
          {
            "text": "\t\t}",
            "lineNumber": 1888
          },
          {
            "text": ")",
            "lineNumber": 2594
          },
          {
            "text": ";",
            "lineNumber": 2595
          }
        ]
      },
      "score": 0.3063264489173889
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ChatBox\\index.tsx",
        "range": {
          "startPosition": {
            "line": 20
          },
          "endPosition": {
            "line": 1174,
            "column": 1
          }
        },
        "contents": "export default function ChatBox(): JSX.Element {\n\n  const share_token = searchParams.get('share_token');\n\n  const handleSend = async (messageStr?: string, taskId?: string) =&gt; {\n    const _taskId = taskId || chatStore.activeTaskId;\n    if (message.trim() === '' &amp;&amp; !messageStr) return;\n\n    // Check model first, then privacy\n    if (!hasModel) {\n      toast.error('Please select a model first.');\n      navigate('/setting/models');\n      return;\n    }\n    if (!privacy) {\n      toast.error('Please accept the privacy policy first.');\n      return;\n    }\n\n    const tempMessageContent = messageStr || message;\n    chatStore.setHasMessages(_taskId as string, true);\n    if (!_taskId) return;\n\n    // Multi-turn support: Check if task is running or planning (splitting/confirm)\n    const task = chatStore.tasks[_taskId];\n    const requiresHumanReply = Boolean(task?.activeAsk);\n    const isTaskBusy =\n      // running or paused counts as busy\n      (task.status === 'running' &amp;&amp; task.hasMessages) ||\n      task.status === 'pause' ||\n      // splitting phase: has to_sub_tasks not confirmed OR skeleton computing\n      task.messages.some((m) =&gt; m.step === 'to_sub_tasks' &amp;&amp; !m.isConfirm) ||\n      (!task.messages.find((m) =&gt; m.step === 'to_sub_tasks') &amp;&amp;\n        !task.hasWaitComfirm &amp;&amp;\n        task.messages.length &gt; 0) ||\n      task.isTakeControl ||\n      // explicit confirm wait while task is pending but card not confirmed yet\n      (!!task.messages.find((m) =&gt; m.step === 'to_sub_tasks' &amp;&amp; !m.isConfirm) &amp;&amp;\n        task.status === 'pending');\n    const isReplayChatStore = task?.type === 'replay';\n    if (!requiresHumanReply &amp;&amp; isTaskBusy &amp;&amp; !isReplayChatStore) {\n      toast.error(\n        'Current task is in progress. Please wait for it to finish before sending a new request.',\n        {\n          closeButton: true,\n        }\n      );\n      return;\n    }\n\n    if (textareaRef.current) textareaRef.current.style.height = '60px';\n    try {\n      if (requiresHumanReply) {\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 21,
                "column": 1
              },
              "endPosition": {
                "line": 21,
                "column": 16
              }
            },
            {
              "startPosition": {
                "line": 21,
                "column": 16
              },
              "endPosition": {
                "line": 22,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export default function ChatBox(): JSX.Element {",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "lineNumber": 149
          },
          {
            "text": "  const share_token = searchParams.get('share_token');",
            "lineNumber": 150
          },
          {
            "lineNumber": 151
          },
          {
            "text": "  const handleSend = async (messageStr?: string, taskId?: string) =&gt; {",
            "lineNumber": 152
          },
          {
            "text": "    const _taskId = taskId || chatStore.activeTaskId;",
            "lineNumber": 153
          },
          {
            "text": "    if (message.trim() === '' &amp;&amp; !messageStr) return;",
            "lineNumber": 154
          },
          {
            "lineNumber": 155
          },
          {
            "text": "    // Check model first, then privacy",
            "lineNumber": 156
          },
          {
            "text": "    if (!hasModel) {",
            "lineNumber": 157
          },
          {
            "text": "      toast.error('Please select a model first.');",
            "lineNumber": 158
          },
          {
            "text": "      navigate('/setting/models');",
            "lineNumber": 159
          },
          {
            "text": "      return;",
            "lineNumber": 160
          },
          {
            "text": "    }",
            "lineNumber": 161
          },
          {
            "text": "    if (!privacy) {",
            "lineNumber": 162
          },
          {
            "text": "      toast.error('Please accept the privacy policy first.');",
            "lineNumber": 163
          },
          {
            "text": "      return;",
            "lineNumber": 164
          },
          {
            "text": "    }",
            "lineNumber": 165
          },
          {
            "lineNumber": 166
          },
          {
            "text": "    const tempMessageContent = messageStr || message;",
            "lineNumber": 167
          },
          {
            "text": "    chatStore.setHasMessages(_taskId as string, true);",
            "lineNumber": 168
          },
          {
            "text": "    if (!_taskId) return;",
            "lineNumber": 169
          },
          {
            "lineNumber": 170
          },
          {
            "text": "    // Multi-turn support: Check if task is running or planning (splitting/confirm)",
            "lineNumber": 171
          },
          {
            "text": "    const task = chatStore.tasks[_taskId];",
            "lineNumber": 172
          },
          {
            "text": "    const requiresHumanReply = Boolean(task?.activeAsk);",
            "lineNumber": 173
          },
          {
            "text": "    const isTaskBusy =",
            "lineNumber": 174
          },
          {
            "text": "      // running or paused counts as busy",
            "lineNumber": 175
          },
          {
            "text": "      (task.status === 'running' &amp;&amp; task.hasMessages) ||",
            "lineNumber": 176
          },
          {
            "text": "      task.status === 'pause' ||",
            "lineNumber": 177
          },
          {
            "text": "      // splitting phase: has to_sub_tasks not confirmed OR skeleton computing",
            "lineNumber": 178
          },
          {
            "text": "      task.messages.some((m) =&gt; m.step === 'to_sub_tasks' &amp;&amp; !m.isConfirm) ||",
            "lineNumber": 179
          },
          {
            "text": "      (!task.messages.find((m) =&gt; m.step === 'to_sub_tasks') &amp;&amp;",
            "lineNumber": 180
          },
          {
            "text": "        !task.hasWaitComfirm &amp;&amp;",
            "lineNumber": 181
          },
          {
            "text": "        task.messages.length &gt; 0) ||",
            "lineNumber": 182
          },
          {
            "text": "      task.isTakeControl ||",
            "lineNumber": 183
          },
          {
            "text": "      // explicit confirm wait while task is pending but card not confirmed yet",
            "lineNumber": 184
          },
          {
            "text": "      (!!task.messages.find((m) =&gt; m.step === 'to_sub_tasks' &amp;&amp; !m.isConfirm) &amp;&amp;",
            "lineNumber": 185
          },
          {
            "text": "        task.status === 'pending');",
            "lineNumber": 186
          },
          {
            "text": "    const isReplayChatStore = task?.type === 'replay';",
            "lineNumber": 187
          },
          {
            "text": "    if (!requiresHumanReply &amp;&amp; isTaskBusy &amp;&amp; !isReplayChatStore) {",
            "lineNumber": 188
          },
          {
            "text": "      toast.error(",
            "lineNumber": 189
          },
          {
            "text": "        'Current task is in progress. Please wait for it to finish before sending a new request.',",
            "lineNumber": 190
          },
          {
            "text": "        {",
            "lineNumber": 191
          },
          {
            "text": "          closeButton: true,",
            "lineNumber": 192
          },
          {
            "text": "        }",
            "lineNumber": 193
          },
          {
            "text": "      );",
            "lineNumber": 194
          },
          {
            "text": "      return;",
            "lineNumber": 195
          },
          {
            "text": "    }",
            "lineNumber": 196
          },
          {
            "lineNumber": 197
          },
          {
            "text": "    if (textareaRef.current) textareaRef.current.style.height = '60px';",
            "lineNumber": 198
          },
          {
            "text": "    try {",
            "lineNumber": 199
          },
          {
            "text": "      if (requiresHumanReply) {",
            "lineNumber": 200
          },
          {
            "text": ";",
            "lineNumber": 389
          },
          {
            "text": "}",
            "lineNumber": 1175,
            "isSignature": true
          }
        ]
      },
      "score": 0.3029436469078064
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ChatBox\\index.tsx",
        "range": {
          "startPosition": {
            "line": 20
          },
          "endPosition": {
            "line": 1174,
            "column": 1
          }
        },
        "contents": "export default function ChatBox(): JSX.Element {\nconst handleSend = async \n\n    try {\n      if (requiresHumanReply) {\n        chatStore.addMessages(_taskId, {\n          id: generateUniqueId(),\n          role: 'user',\n          content: tempMessageContent,\n          attaches:\n            JSON.parse(JSON.stringify(chatStore.tasks[_taskId]?.attaches)) ||\n            [],\n        });\n        setMessage('');\n\n        // Scroll to bottom after adding user message\n        setTimeout(() =&gt; {\n          scrollToBottom();\n        }, 200);\n\n        chatStore.setIsPending(_taskId, true);\n\n        await fetchPost(&#96;/chat/${projectStore.activeProjectId}/human-reply&#96;, {\n          agent: chatStore.tasks[_taskId].activeAsk,\n          reply: tempMessageContent,\n        });\n        if (chatStore.tasks[_taskId].askList.length === 0) {\n          chatStore.setActiveAsk(_taskId, '');\n        } else {\n          let activeAskList = chatStore.tasks[_taskId].askList;\n          console.log(\n            'activeAskList',\n            JSON.parse(JSON.stringify(activeAskList))\n          );\n          let message = activeAskList.shift();\n          chatStore.setActiveAskList(_taskId, [...activeAskList]);\n          chatStore.setActiveAsk(_taskId, message?.agent_name || '');\n          chatStore.setIsPending(_taskId, false);\n          chatStore.addMessages(_taskId, message!);\n        }\n      } else {\n        // Check if we should continue the conversation or start a new task\n        const hasMessages =\n          chatStore.tasks[_taskId as string].messages.length;\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 21,
                "column": 1
              },
              "endPosition": {
                "line": 21,
                "column": 16
              }
            },
            {
              "startPosition": {
                "line": 21,
                "column": 16
              },
              "endPosition": {
                "line": 22,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 152,
                "column": 3
              },
              "endPosition": {
                "line": 152,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 152,
                "column": 9
              },
              "endPosition": {
                "line": 152,
                "column": 28
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export default function ChatBox(): JSX.Element {",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "const handleSend = async ",
            "lineNumber": 152
          },
          {
            "lineNumber": 198
          },
          {
            "text": "    try {",
            "lineNumber": 199
          },
          {
            "text": "      if (requiresHumanReply) {",
            "lineNumber": 200
          },
          {
            "text": "        chatStore.addMessages(_taskId, {",
            "lineNumber": 201
          },
          {
            "text": "          id: generateUniqueId(),",
            "lineNumber": 202
          },
          {
            "text": "          role: 'user',",
            "lineNumber": 203
          },
          {
            "text": "          content: tempMessageContent,",
            "lineNumber": 204
          },
          {
            "text": "          attaches:",
            "lineNumber": 205
          },
          {
            "text": "            JSON.parse(JSON.stringify(chatStore.tasks[_taskId]?.attaches)) ||",
            "lineNumber": 206
          },
          {
            "text": "            [],",
            "lineNumber": 207
          },
          {
            "text": "        });",
            "lineNumber": 208
          },
          {
            "text": "        setMessage('');",
            "lineNumber": 209
          },
          {
            "lineNumber": 210
          },
          {
            "text": "        // Scroll to bottom after adding user message",
            "lineNumber": 211
          },
          {
            "text": "        setTimeout(() =&gt; {",
            "lineNumber": 212
          },
          {
            "text": "          scrollToBottom();",
            "lineNumber": 213
          },
          {
            "text": "        }, 200);",
            "lineNumber": 214
          },
          {
            "lineNumber": 215
          },
          {
            "text": "        chatStore.setIsPending(_taskId, true);",
            "lineNumber": 216
          },
          {
            "lineNumber": 217
          },
          {
            "text": "        await fetchPost(&#96;/chat/${projectStore.activeProjectId}/human-reply&#96;, {",
            "lineNumber": 218
          },
          {
            "text": "          agent: chatStore.tasks[_taskId].activeAsk,",
            "lineNumber": 219
          },
          {
            "text": "          reply: tempMessageContent,",
            "lineNumber": 220
          },
          {
            "text": "        });",
            "lineNumber": 221
          },
          {
            "text": "        if (chatStore.tasks[_taskId].askList.length === 0) {",
            "lineNumber": 222
          },
          {
            "text": "          chatStore.setActiveAsk(_taskId, '');",
            "lineNumber": 223
          },
          {
            "text": "        } else {",
            "lineNumber": 224
          },
          {
            "text": "          let activeAskList = chatStore.tasks[_taskId].askList;",
            "lineNumber": 225
          },
          {
            "text": "          console.log(",
            "lineNumber": 226
          },
          {
            "text": "            'activeAskList',",
            "lineNumber": 227
          },
          {
            "text": "            JSON.parse(JSON.stringify(activeAskList))",
            "lineNumber": 228
          },
          {
            "text": "          );",
            "lineNumber": 229
          },
          {
            "text": "          let message = activeAskList.shift();",
            "lineNumber": 230
          },
          {
            "text": "          chatStore.setActiveAskList(_taskId, [...activeAskList]);",
            "lineNumber": 231
          },
          {
            "text": "          chatStore.setActiveAsk(_taskId, message?.agent_name || '');",
            "lineNumber": 232
          },
          {
            "text": "          chatStore.setIsPending(_taskId, false);",
            "lineNumber": 233
          },
          {
            "text": "          chatStore.addMessages(_taskId, message!);",
            "lineNumber": 234
          },
          {
            "text": "        }",
            "lineNumber": 235
          },
          {
            "text": "      } else {",
            "lineNumber": 236
          },
          {
            "text": "        // Check if we should continue the conversation or start a new task",
            "lineNumber": 237
          },
          {
            "text": "        const hasMessages =",
            "lineNumber": 238
          },
          {
            "text": "          chatStore.tasks[_taskId as string].messages.length;",
            "lineNumber": 239
          },
          {
            "text": ";",
            "lineNumber": 389
          },
          {
            "text": "}",
            "lineNumber": 1175,
            "isSignature": true
          }
        ]
      },
      "score": 0.299685001373291
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1584
          },
          "endPosition": {
            "line": 1710
          }
        },
        "contents": "@traceroot.trace()\nasync def social_medium_agent(options: Chat):\n{NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.\n\nYour integrated toolkits enable you to:\n\n1. WhatsApp Business Management (WhatsAppToolkit):\n   - Send text and template messages to customers via the WhatsApp Business\n   API.\n   - Retrieve business profile information.\n\n2. Twitter Account Management (TwitterToolkit):\n   - Create tweets with text content, polls, or as quote tweets.\n   - Delete existing tweets.\n   - Retrieve user profile information.\n\n3. LinkedIn Professional Networking (LinkedInToolkit):\n   - Create posts on LinkedIn.\n   - Delete existing posts.\n   - Retrieve authenticated user's profile information.\n\n4. Reddit Content Analysis (RedditToolkit):\n   - Collect top posts and comments from specified subreddits.\n   - Perform sentiment analysis on Reddit comments.\n   - Track keyword discussions across multiple subreddits.\n\n5. Notion Workspace Management (NotionToolkit):\n   - List all pages and users in a Notion workspace.\n   - Retrieve and extract text content from Notion blocks.\n\n6. Slack Workspace Interaction (SlackToolkit):\n   - Create new Slack channels (public or private).\n   - Join or leave existing channels.\n   - Send and delete messages in channels.\n   - Retrieve channel information and message history.\n\n7. Human Interaction (HumanToolkit):\n   - Ask questions to users and send messages via console.\n\n8. Agent Communication:\n   - Communicate with other agents using messaging tools when collaboration\n   is needed. Use &#96;list_available_agents&#96; to see available team members and\n   &#96;send_message&#96; to coordinate with them, especially when you need content\n   from document agents or research from browser agents.\n\n9. File System Access:\n   - You can use terminal tools to interact with the local file system in\n   your working directory (&#96;{working_directory}&#96;), for example, to access\n   files needed for posting. You can use tools like &#96;find&#96; to locate files,\n   &#96;grep&#96; to search within them, and &#96;curl&#96; to interact with web APIs that\n   are not covered by other tools.\n\nWhen assisting users, always:\n- Identify which platform's functionality is needed for the task.\n- Check if required API credentials are available before attempting\noperations.\n- Provide clear explanations of what actions you're taking.\n- Handle rate limits and API restrictions appropriately.\n- Ask clarifying questions when user requests are ambiguous.",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1585,
                "column": 1
              },
              "endPosition": {
                "line": 1586,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 1586,
                "column": 1
              },
              "endPosition": {
                "line": 1587,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1585
          },
          {
            "text": "async def social_medium_agent(options: Chat):",
            "lineNumber": 1586,
            "isSignature": true
          },
          {
            "text": "{NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.",
            "lineNumber": 1638
          },
          {
            "lineNumber": 1639
          },
          {
            "text": "Your integrated toolkits enable you to:",
            "lineNumber": 1640
          },
          {
            "lineNumber": 1641
          },
          {
            "text": "1. WhatsApp Business Management (WhatsAppToolkit):",
            "lineNumber": 1642
          },
          {
            "text": "   - Send text and template messages to customers via the WhatsApp Business",
            "lineNumber": 1643
          },
          {
            "text": "   API.",
            "lineNumber": 1644
          },
          {
            "text": "   - Retrieve business profile information.",
            "lineNumber": 1645
          },
          {
            "lineNumber": 1646
          },
          {
            "text": "2. Twitter Account Management (TwitterToolkit):",
            "lineNumber": 1647
          },
          {
            "text": "   - Create tweets with text content, polls, or as quote tweets.",
            "lineNumber": 1648
          },
          {
            "text": "   - Delete existing tweets.",
            "lineNumber": 1649
          },
          {
            "text": "   - Retrieve user profile information.",
            "lineNumber": 1650
          },
          {
            "lineNumber": 1651
          },
          {
            "text": "3. LinkedIn Professional Networking (LinkedInToolkit):",
            "lineNumber": 1652
          },
          {
            "text": "   - Create posts on LinkedIn.",
            "lineNumber": 1653
          },
          {
            "text": "   - Delete existing posts.",
            "lineNumber": 1654
          },
          {
            "text": "   - Retrieve authenticated user's profile information.",
            "lineNumber": 1655
          },
          {
            "lineNumber": 1656
          },
          {
            "text": "4. Reddit Content Analysis (RedditToolkit):",
            "lineNumber": 1657
          },
          {
            "text": "   - Collect top posts and comments from specified subreddits.",
            "lineNumber": 1658
          },
          {
            "text": "   - Perform sentiment analysis on Reddit comments.",
            "lineNumber": 1659
          },
          {
            "text": "   - Track keyword discussions across multiple subreddits.",
            "lineNumber": 1660
          },
          {
            "lineNumber": 1661
          },
          {
            "text": "5. Notion Workspace Management (NotionToolkit):",
            "lineNumber": 1662
          },
          {
            "text": "   - List all pages and users in a Notion workspace.",
            "lineNumber": 1663
          },
          {
            "text": "   - Retrieve and extract text content from Notion blocks.",
            "lineNumber": 1664
          },
          {
            "lineNumber": 1665
          },
          {
            "text": "6. Slack Workspace Interaction (SlackToolkit):",
            "lineNumber": 1666
          },
          {
            "text": "   - Create new Slack channels (public or private).",
            "lineNumber": 1667
          },
          {
            "text": "   - Join or leave existing channels.",
            "lineNumber": 1668
          },
          {
            "text": "   - Send and delete messages in channels.",
            "lineNumber": 1669
          },
          {
            "text": "   - Retrieve channel information and message history.",
            "lineNumber": 1670
          },
          {
            "lineNumber": 1671
          },
          {
            "text": "7. Human Interaction (HumanToolkit):",
            "lineNumber": 1672
          },
          {
            "text": "   - Ask questions to users and send messages via console.",
            "lineNumber": 1673
          },
          {
            "lineNumber": 1674
          },
          {
            "text": "8. Agent Communication:",
            "lineNumber": 1675
          },
          {
            "text": "   - Communicate with other agents using messaging tools when collaboration",
            "lineNumber": 1676
          },
          {
            "text": "   is needed. Use &#96;list_available_agents&#96; to see available team members and",
            "lineNumber": 1677
          },
          {
            "text": "   &#96;send_message&#96; to coordinate with them, especially when you need content",
            "lineNumber": 1678
          },
          {
            "text": "   from document agents or research from browser agents.",
            "lineNumber": 1679
          },
          {
            "lineNumber": 1680
          },
          {
            "text": "9. File System Access:",
            "lineNumber": 1681
          },
          {
            "text": "   - You can use terminal tools to interact with the local file system in",
            "lineNumber": 1682
          },
          {
            "text": "   your working directory (&#96;{working_directory}&#96;), for example, to access",
            "lineNumber": 1683
          },
          {
            "text": "   files needed for posting. You can use tools like &#96;find&#96; to locate files,",
            "lineNumber": 1684
          },
          {
            "text": "   &#96;grep&#96; to search within them, and &#96;curl&#96; to interact with web APIs that",
            "lineNumber": 1685
          },
          {
            "text": "   are not covered by other tools.",
            "lineNumber": 1686
          },
          {
            "lineNumber": 1687
          },
          {
            "text": "When assisting users, always:",
            "lineNumber": 1688
          },
          {
            "text": "- Identify which platform's functionality is needed for the task.",
            "lineNumber": 1689
          },
          {
            "text": "- Check if required API credentials are available before attempting",
            "lineNumber": 1690
          },
          {
            "text": "operations.",
            "lineNumber": 1691
          },
          {
            "text": "- Provide clear explanations of what actions you're taking.",
            "lineNumber": 1692
          },
          {
            "text": "- Handle rate limits and API restrictions appropriately.",
            "lineNumber": 1693
          },
          {
            "text": "- Ask clarifying questions when user requests are ambiguous.",
            "lineNumber": 1694
          }
        ]
      },
      "score": 0.29828551411628723
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\task.py",
        "range": {
          "startPosition": {
            "column": 53
          },
          "endPosition": {
            "line": 47,
            "column": 23
          }
        },
        "contents": "from typing import List, Dict, Optional\nfrom pydantic import BaseModel\nfrom app.exception.exception import ProgramException\nfrom app.model.chat import McpServers, Status, SupplementChat, Chat, UpdateData\nimport asyncio\nfrom enum import Enum\nfrom camel.tasks import Task\nfrom contextlib import contextmanager\nfrom contextvars import ContextVar\nfrom datetime import datetime, timedelta\nimport weakref\nfrom utils import traceroot_wrapper as traceroot\n\nlogger = traceroot.get_logger(\"task_service\")\n\n\nclass Action(str, Enum):\n    improve = \"improve\"  # user -&gt; backend\n    update_task = \"update_task\"  # user -&gt; backend\n    task_state = \"task_state\"  # backend -&gt; user\n    new_task_state = \"new_task_state\"  # backend -&gt; user\n    decompose_progress = \"decompose_progress\"  # backend -&gt; user (streaming decomposition)\n    decompose_text = \"decompose_text\"  # backend -&gt; user (raw streaming text)\n    start = \"start\"  # user -&gt; backend\n    create_agent = \"create_agent\"  # backend -&gt; user\n    activate_agent = \"activate_agent\"  # backend -&gt; user\n    deactivate_agent = \"deactivate_agent\"  # backend -&gt; user\n    assign_task = \"assign_task\"  # backend -&gt; user\n    activate_toolkit = \"activate_toolkit\"  # backend -&gt; user\n    deactivate_toolkit = \"deactivate_toolkit\"  # backend -&gt; user\n    write_file = \"write_file\"  # backend -&gt; user\n    ask = \"ask\"  # backend -&gt; user\n    notice = \"notice\"  # backend -&gt; user\n    search_mcp = \"search_mcp\"  # backend -&gt; user\n    install_mcp = \"install_mcp\"  # backend -&gt; user\n    terminal = \"terminal\"  # backend -&gt; user\n    end = \"end\"  # backend -&gt; user\n    stop = \"stop\"  # user -&gt; backend\n    supplement = \"supplement\"  # user -&gt; backend\n    pause = \"pause\"  # user -&gt; backend  user take control\n    resume = \"resume\"  # user -&gt; backend  user take control\n    new_agent = \"new_agent\"  # user -&gt; backend\n    budget_not_enough = \"budget_not_enough\"  # backend -&gt; user\n    add_task = \"add_task\"  # user -&gt; backend\n    remove_task = \"remove_task\"  # user -&gt; backend\n    skip_task = \"skip_task\"  # user -&gt; backend\n    timeout = \"timeout\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from typing import List, Dict, Optional",
            "lineNumber": 2
          },
          {
            "text": "from pydantic import BaseModel",
            "lineNumber": 3
          },
          {
            "text": "from app.exception.exception import ProgramException",
            "lineNumber": 4
          },
          {
            "text": "from app.model.chat import McpServers, Status, SupplementChat, Chat, UpdateData",
            "lineNumber": 5
          },
          {
            "text": "import asyncio",
            "lineNumber": 6
          },
          {
            "text": "from enum import Enum",
            "lineNumber": 7
          },
          {
            "text": "from camel.tasks import Task",
            "lineNumber": 8
          },
          {
            "text": "from contextlib import contextmanager",
            "lineNumber": 9
          },
          {
            "text": "from contextvars import ContextVar",
            "lineNumber": 10
          },
          {
            "text": "from datetime import datetime, timedelta",
            "lineNumber": 11
          },
          {
            "text": "import weakref",
            "lineNumber": 12
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "logger = traceroot.get_logger(\"task_service\")",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "lineNumber": 17
          },
          {
            "text": "class Action(str, Enum):",
            "lineNumber": 18,
            "isSignature": true
          },
          {
            "text": "    improve = \"improve\"  # user -&gt; backend",
            "lineNumber": 19
          },
          {
            "text": "    update_task = \"update_task\"  # user -&gt; backend",
            "lineNumber": 20
          },
          {
            "text": "    task_state = \"task_state\"  # backend -&gt; user",
            "lineNumber": 21
          },
          {
            "text": "    new_task_state = \"new_task_state\"  # backend -&gt; user",
            "lineNumber": 22
          },
          {
            "text": "    decompose_progress = \"decompose_progress\"  # backend -&gt; user (streaming decomposition)",
            "lineNumber": 23
          },
          {
            "text": "    decompose_text = \"decompose_text\"  # backend -&gt; user (raw streaming text)",
            "lineNumber": 24
          },
          {
            "text": "    start = \"start\"  # user -&gt; backend",
            "lineNumber": 25
          },
          {
            "text": "    create_agent = \"create_agent\"  # backend -&gt; user",
            "lineNumber": 26
          },
          {
            "text": "    activate_agent = \"activate_agent\"  # backend -&gt; user",
            "lineNumber": 27
          },
          {
            "text": "    deactivate_agent = \"deactivate_agent\"  # backend -&gt; user",
            "lineNumber": 28
          },
          {
            "text": "    assign_task = \"assign_task\"  # backend -&gt; user",
            "lineNumber": 29
          },
          {
            "text": "    activate_toolkit = \"activate_toolkit\"  # backend -&gt; user",
            "lineNumber": 30
          },
          {
            "text": "    deactivate_toolkit = \"deactivate_toolkit\"  # backend -&gt; user",
            "lineNumber": 31
          },
          {
            "text": "    write_file = \"write_file\"  # backend -&gt; user",
            "lineNumber": 32
          },
          {
            "text": "    ask = \"ask\"  # backend -&gt; user",
            "lineNumber": 33
          },
          {
            "text": "    notice = \"notice\"  # backend -&gt; user",
            "lineNumber": 34
          },
          {
            "text": "    search_mcp = \"search_mcp\"  # backend -&gt; user",
            "lineNumber": 35
          },
          {
            "text": "    install_mcp = \"install_mcp\"  # backend -&gt; user",
            "lineNumber": 36
          },
          {
            "text": "    terminal = \"terminal\"  # backend -&gt; user",
            "lineNumber": 37
          },
          {
            "text": "    end = \"end\"  # backend -&gt; user",
            "lineNumber": 38
          },
          {
            "text": "    stop = \"stop\"  # user -&gt; backend",
            "lineNumber": 39
          },
          {
            "text": "    supplement = \"supplement\"  # user -&gt; backend",
            "lineNumber": 40
          },
          {
            "text": "    pause = \"pause\"  # user -&gt; backend  user take control",
            "lineNumber": 41
          },
          {
            "text": "    resume = \"resume\"  # user -&gt; backend  user take control",
            "lineNumber": 42
          },
          {
            "text": "    new_agent = \"new_agent\"  # user -&gt; backend",
            "lineNumber": 43
          },
          {
            "text": "    budget_not_enough = \"budget_not_enough\"  # backend -&gt; user",
            "lineNumber": 44
          },
          {
            "text": "    add_task = \"add_task\"  # user -&gt; backend",
            "lineNumber": 45
          },
          {
            "text": "    remove_task = \"remove_task\"  # user -&gt; backend",
            "lineNumber": 46
          },
          {
            "text": "    skip_task = \"skip_task\"  # user -&gt; backend",
            "lineNumber": 47
          },
          {
            "text": "    timeout = \"timeout\"",
            "lineNumber": 48,
            "isSignature": true
          }
        ]
      },
      "score": 0.2967073917388916
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ChatBox\\index.tsx",
        "range": {
          "startPosition": {
            "line": 20
          },
          "endPosition": {
            "line": 1174,
            "column": 1
          }
        },
        "contents": "export default function ChatBox(): JSX.Element {\nconst handleSend = async \nconst shouldContinueConversation =\n === 'pending');\n\n        if (shouldContinueConversation) {\n          // Check if this is the very first message and task hasn't started\n          const hasSimpleResponse = chatStore.tasks[\n            _taskId as string\n          ].messages.some((m) =&gt; m.step === 'wait_confirm');\n          const hasComplexTask = chatStore.tasks[\n            _taskId as string\n          ].messages.some((m) =&gt; m.step === 'to_sub_tasks');\n          const hasErrorMessage = chatStore.tasks[\n            _taskId as string\n          ].messages.some(\n            (m) =&gt; m.role === 'agent' &amp;&amp; m.content.startsWith('❌ **Error**:')\n          );\n\n          // Only start a new task if: pending, no messages processed yet\n          // OR while or after replaying a project\n          if (\n            (chatStore.tasks[_taskId as string].status === 'pending' &amp;&amp;\n              !hasSimpleResponse &amp;&amp;\n              !hasComplexTask &amp;&amp;\n              !isFinished) ||\n            chatStore.tasks[_taskId].type === 'replay' ||\n            hasErrorMessage\n          ) {\n            setMessage('');\n            // Pass the message content to startTask instead of adding it to current chatStore\n            const attachesToSend =\n              JSON.parse(JSON.stringify(chatStore.tasks[_taskId]?.attaches)) ||\n              [];\n            try {\n              await chatStore.startTask(\n                _taskId,\n                undefined,\n                undefined,\n                undefined,\n                tempMessageContent,\n                attachesToSend\n              );\n            } catch (err: any) {\n              console.error('Failed to start task:', err);\n              toast.error(\n                err?.message ||\n                  'Failed to start task. Please check your model configuration.'\n              );\n              return;\n            }\n            // keep hasWaitComfirm as true so that follow-up improves work as usual\n          } else {\n            // Continue conversation: simple response, complex task, or finished task\n            console.log(\n              '[Multi-turn] Continuing conversation with improve API'\n\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 21,
                "column": 1
              },
              "endPosition": {
                "line": 21,
                "column": 16
              }
            },
            {
              "startPosition": {
                "line": 21,
                "column": 16
              },
              "endPosition": {
                "line": 22,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 152,
                "column": 3
              },
              "endPosition": {
                "line": 152,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 152,
                "column": 9
              },
              "endPosition": {
                "line": 152,
                "column": 28
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export default function ChatBox(): JSX.Element {",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "const handleSend = async ",
            "lineNumber": 152
          },
          {
            "text": "const shouldContinueConversation =",
            "lineNumber": 256
          },
          {
            "text": " === 'pending');",
            "lineNumber": 260
          },
          {
            "lineNumber": 261
          },
          {
            "text": "        if (shouldContinueConversation) {",
            "lineNumber": 262
          },
          {
            "text": "          // Check if this is the very first message and task hasn't started",
            "lineNumber": 263
          },
          {
            "text": "          const hasSimpleResponse = chatStore.tasks[",
            "lineNumber": 264
          },
          {
            "text": "            _taskId as string",
            "lineNumber": 265
          },
          {
            "text": "          ].messages.some((m) =&gt; m.step === 'wait_confirm');",
            "lineNumber": 266
          },
          {
            "text": "          const hasComplexTask = chatStore.tasks[",
            "lineNumber": 267
          },
          {
            "text": "            _taskId as string",
            "lineNumber": 268
          },
          {
            "text": "          ].messages.some((m) =&gt; m.step === 'to_sub_tasks');",
            "lineNumber": 269
          },
          {
            "text": "          const hasErrorMessage = chatStore.tasks[",
            "lineNumber": 270
          },
          {
            "text": "            _taskId as string",
            "lineNumber": 271
          },
          {
            "text": "          ].messages.some(",
            "lineNumber": 272
          },
          {
            "text": "            (m) =&gt; m.role === 'agent' &amp;&amp; m.content.startsWith('❌ **Error**:')",
            "lineNumber": 273
          },
          {
            "text": "          );",
            "lineNumber": 274
          },
          {
            "lineNumber": 275
          },
          {
            "text": "          // Only start a new task if: pending, no messages processed yet",
            "lineNumber": 276
          },
          {
            "text": "          // OR while or after replaying a project",
            "lineNumber": 277
          },
          {
            "text": "          if (",
            "lineNumber": 278
          },
          {
            "text": "            (chatStore.tasks[_taskId as string].status === 'pending' &amp;&amp;",
            "lineNumber": 279
          },
          {
            "text": "              !hasSimpleResponse &amp;&amp;",
            "lineNumber": 280
          },
          {
            "text": "              !hasComplexTask &amp;&amp;",
            "lineNumber": 281
          },
          {
            "text": "              !isFinished) ||",
            "lineNumber": 282
          },
          {
            "text": "            chatStore.tasks[_taskId].type === 'replay' ||",
            "lineNumber": 283
          },
          {
            "text": "            hasErrorMessage",
            "lineNumber": 284
          },
          {
            "text": "          ) {",
            "lineNumber": 285
          },
          {
            "text": "            setMessage('');",
            "lineNumber": 286
          },
          {
            "text": "            // Pass the message content to startTask instead of adding it to current chatStore",
            "lineNumber": 287
          },
          {
            "text": "            const attachesToSend =",
            "lineNumber": 288
          },
          {
            "text": "              JSON.parse(JSON.stringify(chatStore.tasks[_taskId]?.attaches)) ||",
            "lineNumber": 289
          },
          {
            "text": "              [];",
            "lineNumber": 290
          },
          {
            "text": "            try {",
            "lineNumber": 291
          },
          {
            "text": "              await chatStore.startTask(",
            "lineNumber": 292
          },
          {
            "text": "                _taskId,",
            "lineNumber": 293
          },
          {
            "text": "                undefined,",
            "lineNumber": 294
          },
          {
            "text": "                undefined,",
            "lineNumber": 295
          },
          {
            "text": "                undefined,",
            "lineNumber": 296
          },
          {
            "text": "                tempMessageContent,",
            "lineNumber": 297
          },
          {
            "text": "                attachesToSend",
            "lineNumber": 298
          },
          {
            "text": "              );",
            "lineNumber": 299
          },
          {
            "text": "            } catch (err: any) {",
            "lineNumber": 300
          },
          {
            "text": "              console.error('Failed to start task:', err);",
            "lineNumber": 301
          },
          {
            "text": "              toast.error(",
            "lineNumber": 302
          },
          {
            "text": "                err?.message ||",
            "lineNumber": 303
          },
          {
            "text": "                  'Failed to start task. Please check your model configuration.'",
            "lineNumber": 304
          },
          {
            "text": "              );",
            "lineNumber": 305
          },
          {
            "text": "              return;",
            "lineNumber": 306
          },
          {
            "text": "            }",
            "lineNumber": 307
          },
          {
            "text": "            // keep hasWaitComfirm as true so that follow-up improves work as usual",
            "lineNumber": 308
          },
          {
            "text": "          } else {",
            "lineNumber": 309
          },
          {
            "text": "            // Continue conversation: simple response, complex task, or finished task",
            "lineNumber": 310
          },
          {
            "text": "            console.log(",
            "lineNumber": 311
          },
          {
            "text": "              '[Multi-turn] Continuing conversation with improve API'",
            "lineNumber": 312
          },
          {
            "lineNumber": 313
          },
          {
            "text": ";",
            "lineNumber": 389
          },
          {
            "text": "}",
            "lineNumber": 1175,
            "isSignature": true
          }
        ]
      },
      "score": 0.2900625467300415
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\store\\chatStore.ts",
        "range": {
          "startPosition": {
            "line": 162
          },
          "endPosition": {
            "line": 2594,
            "column": 1
          }
        },
        "contents": "const chatStore = \n(set, get) =&gt; (\nasync (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {\nconst \n;\n\n\t\t\t// Get the locked task ID - this won't change during the SSE session\n\t\t\tconst getCurrentTaskId = () =&gt; {\n\t\t\t\treturn lockedTaskId;\n\t\t\t};\n\n\t\t\t// Function to update locked references (only for special cases like replay)\n\t\t\tconst updateLockedReferences = (newChatStore: VanillaChatStore, newTaskId: string) =&gt; {\n\t\t\t\tlockedChatStore = newChatStore;\n\t\t\t\tlockedTaskId = newTaskId;\n\t\t\t};\n\n\t\t\tfetchEventSource(api, {\n\t\t\t\tmethod: !type ? \"POST\" : \"GET\",\n\t\t\t\topenWhenHidden: true,\n\t\t\t\tsignal: abortController.signal, // Add abort signal for proper cleanup\n\t\t\t\theaders: { \"Content-Type\": \"application/json\", \"Authorization\": type == 'replay' ? &#96;Bearer ${token}&#96; : undefined as unknown as string },\n\t\t\t\tbody: !type ? JSON.stringify({\n\t\t\t\t\tproject_id: project_id,\n\t\t\t\t\ttask_id: newTaskId,\n\t\t\t\t\tquestion: messageContent || targetChatStore.getState().getLastUserMessage()?.content,\n\t\t\t\t\tmodel_platform: apiModel.model_platform,\n\t\t\t\t\temail,\n\t\t\t\t\tmodel_type: apiModel.model_type,\n\t\t\t\t\tapi_key: apiModel.api_key,\n\t\t\t\t\tapi_url: apiModel.api_url,\n\t\t\t\t\textra_params: apiModel.extra_params,\n\t\t\t\t\tinstalled_mcp: { mcpServers: {} },\n\t\t\t\t\tlanguage: systemLanguage,\n\t\t\t\t\tallow_local_system: true,\n\t\t\t\t\tattaches: (messageAttaches || targetChatStore.getState().tasks[newTaskId]?.attaches || []).map(f =&gt; f.filePath),\n\t\t\t\t\tsummary_prompt: &#96;&#96;,\n\t\t\t\t\tnew_agents: [...addWorkers],\n\t\t\t\t\tbrowser_port: browser_port,\n\t\t\t\t\tenv_path: envPath,\n\t\t\t\t\tsearch_config: searchConfig\n\t\t\t\t}) : undefined,\n\n\t\t\t\tasync onmessage(event: any) {\n\t\t\t\t\tlet agentMessages: AgentMessage;\n\t\t\t\t}\n\n\t\t}\n)\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 163,
                "column": 1
              },
              "endPosition": {
                "line": 163,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 7
              },
              "endPosition": {
                "line": 163,
                "column": 19
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 53
              },
              "endPosition": {
                "line": 163,
                "column": 53
              }
            },
            {
              "startPosition": {
                "line": 164,
                "column": 2
              },
              "endPosition": {
                "line": 164,
                "column": 17
              }
            },
            {
              "startPosition": {
                "line": 331,
                "column": 14
              },
              "endPosition": {
                "line": 332,
                "column": 4
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const chatStore = ",
            "lineNumber": 163
          },
          {
            "text": "(set, get) =&gt; (",
            "lineNumber": 164
          },
          {
            "text": "async (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {",
            "lineNumber": 331
          },
          {
            "text": "const ",
            "lineNumber": 571
          },
          {
            "text": ";",
            "lineNumber": 573
          },
          {
            "lineNumber": 574
          },
          {
            "text": "\t\t\t// Get the locked task ID - this won't change during the SSE session",
            "lineNumber": 575
          },
          {
            "text": "\t\t\tconst getCurrentTaskId = () =&gt; {",
            "lineNumber": 576
          },
          {
            "text": "\t\t\t\treturn lockedTaskId;",
            "lineNumber": 577
          },
          {
            "text": "\t\t\t};",
            "lineNumber": 578
          },
          {
            "lineNumber": 579
          },
          {
            "text": "\t\t\t// Function to update locked references (only for special cases like replay)",
            "lineNumber": 580
          },
          {
            "text": "\t\t\tconst updateLockedReferences = (newChatStore: VanillaChatStore, newTaskId: string) =&gt; {",
            "lineNumber": 581
          },
          {
            "text": "\t\t\t\tlockedChatStore = newChatStore;",
            "lineNumber": 582
          },
          {
            "text": "\t\t\t\tlockedTaskId = newTaskId;",
            "lineNumber": 583
          },
          {
            "text": "\t\t\t};",
            "lineNumber": 584
          },
          {
            "lineNumber": 585
          },
          {
            "text": "\t\t\tfetchEventSource(api, {",
            "lineNumber": 586
          },
          {
            "text": "\t\t\t\tmethod: !type ? \"POST\" : \"GET\",",
            "lineNumber": 587
          },
          {
            "text": "\t\t\t\topenWhenHidden: true,",
            "lineNumber": 588
          },
          {
            "text": "\t\t\t\tsignal: abortController.signal, // Add abort signal for proper cleanup",
            "lineNumber": 589
          },
          {
            "text": "\t\t\t\theaders: { \"Content-Type\": \"application/json\", \"Authorization\": type == 'replay' ? &#96;Bearer ${token}&#96; : undefined as unknown as string },",
            "lineNumber": 590
          },
          {
            "text": "\t\t\t\tbody: !type ? JSON.stringify({",
            "lineNumber": 591
          },
          {
            "text": "\t\t\t\t\tproject_id: project_id,",
            "lineNumber": 592
          },
          {
            "text": "\t\t\t\t\ttask_id: newTaskId,",
            "lineNumber": 593
          },
          {
            "text": "\t\t\t\t\tquestion: messageContent || targetChatStore.getState().getLastUserMessage()?.content,",
            "lineNumber": 594
          },
          {
            "text": "\t\t\t\t\tmodel_platform: apiModel.model_platform,",
            "lineNumber": 595
          },
          {
            "text": "\t\t\t\t\temail,",
            "lineNumber": 596
          },
          {
            "text": "\t\t\t\t\tmodel_type: apiModel.model_type,",
            "lineNumber": 597
          },
          {
            "text": "\t\t\t\t\tapi_key: apiModel.api_key,",
            "lineNumber": 598
          },
          {
            "text": "\t\t\t\t\tapi_url: apiModel.api_url,",
            "lineNumber": 599
          },
          {
            "text": "\t\t\t\t\textra_params: apiModel.extra_params,",
            "lineNumber": 600
          },
          {
            "text": "\t\t\t\t\tinstalled_mcp: { mcpServers: {} },",
            "lineNumber": 601
          },
          {
            "text": "\t\t\t\t\tlanguage: systemLanguage,",
            "lineNumber": 602
          },
          {
            "text": "\t\t\t\t\tallow_local_system: true,",
            "lineNumber": 603
          },
          {
            "text": "\t\t\t\t\tattaches: (messageAttaches || targetChatStore.getState().tasks[newTaskId]?.attaches || []).map(f =&gt; f.filePath),",
            "lineNumber": 604
          },
          {
            "text": "\t\t\t\t\tsummary_prompt: &#96;&#96;,",
            "lineNumber": 605
          },
          {
            "text": "\t\t\t\t\tnew_agents: [...addWorkers],",
            "lineNumber": 606
          },
          {
            "text": "\t\t\t\t\tbrowser_port: browser_port,",
            "lineNumber": 607
          },
          {
            "text": "\t\t\t\t\tenv_path: envPath,",
            "lineNumber": 608
          },
          {
            "text": "\t\t\t\t\tsearch_config: searchConfig",
            "lineNumber": 609
          },
          {
            "text": "\t\t\t\t}) : undefined,",
            "lineNumber": 610
          },
          {
            "lineNumber": 611
          },
          {
            "text": "\t\t\t\tasync onmessage(event: any) {",
            "lineNumber": 612
          },
          {
            "text": "\t\t\t\t\tlet agentMessages: AgentMessage;",
            "lineNumber": 613
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 1836
          },
          {
            "lineNumber": 1886
          },
          {
            "text": "\t\t}",
            "lineNumber": 1888
          },
          {
            "text": ")",
            "lineNumber": 2594
          },
          {
            "text": ";",
            "lineNumber": 2595
          }
        ]
      },
      "score": 0.2892911434173584
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 83
          },
          "endPosition": {
            "line": 654
          }
        },
        "contents": "class ListenChatAgent(ChatAgent):\n@traceroot.trace()\ndef _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:\n\n\n        try:\n            task_lock = get_task_lock(self.api_task_id)\n\n            toolkit_name = (\n                getattr(tool, \"_toolkit_name\")\n                if hasattr(tool, \"_toolkit_name\")\n                else \"mcp_toolkit\"\n            )\n            traceroot_logger.debug(\n                f\"Agent {self.agent_name} executing tool: {func_name} from toolkit: {toolkit_name} with args: {json.dumps(args, ensure_ascii=False)}\"\n            )\n\n            # Only send activate event if tool is NOT wrapped by @listen_toolkit\n            if not has_listen_decorator:\n                asyncio.create_task(\n                    task_lock.put_queue(\n                        ActionActivateToolkitData(\n                            data={\n                                \"agent_name\": self.agent_name,\n                                \"process_task_id\": self.process_task_id,\n                                \"toolkit_name\": toolkit_name,\n                                \"method_name\": func_name,\n                                \"message\": json.dumps(args, ensure_ascii=False),\n                            },\n                        )\n                    )\n                )\n            # Set process_task context for all tool executions\n            with set_process_task(self.process_task_id):\n                raw_result = tool(**args)\n            traceroot_logger.debug(f\"Tool {func_name} executed successfully\")\n            if self.mask_tool_output:\n                self._secure_result_store[tool_call_id] = raw_result\n                result = (\n                    \"[The tool has been executed successfully, but the output\"\n                    \" from the tool is masked. You can move forward]\"\n                )\n                mask_flag = True\n            else:\n                result = raw_result\n                mask_flag = False\n            # Prepare result message with truncation\n            if",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 84,
                "column": 1
              },
              "endPosition": {
                "line": 85,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 276,
                "column": 5
              },
              "endPosition": {
                "line": 277,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 277,
                "column": 5
              },
              "endPosition": {
                "line": 282,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ListenChatAgent(ChatAgent):",
            "lineNumber": 84,
            "isSignature": true
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 361
          },
          {
            "text": "def _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:",
            "lineNumber": 362
          },
          {
            "lineNumber": 376
          },
          {
            "lineNumber": 377
          },
          {
            "text": "        try:",
            "lineNumber": 378
          },
          {
            "text": "            task_lock = get_task_lock(self.api_task_id)",
            "lineNumber": 379
          },
          {
            "lineNumber": 380
          },
          {
            "text": "            toolkit_name = (",
            "lineNumber": 381
          },
          {
            "text": "                getattr(tool, \"_toolkit_name\")",
            "lineNumber": 382
          },
          {
            "text": "                if hasattr(tool, \"_toolkit_name\")",
            "lineNumber": 383
          },
          {
            "text": "                else \"mcp_toolkit\"",
            "lineNumber": 384
          },
          {
            "text": "            )",
            "lineNumber": 385
          },
          {
            "text": "            traceroot_logger.debug(",
            "lineNumber": 386
          },
          {
            "text": "                f\"Agent {self.agent_name} executing tool: {func_name} from toolkit: {toolkit_name} with args: {json.dumps(args, ensure_ascii=False)}\"",
            "lineNumber": 387
          },
          {
            "text": "            )",
            "lineNumber": 388
          },
          {
            "lineNumber": 389
          },
          {
            "text": "            # Only send activate event if tool is NOT wrapped by @listen_toolkit",
            "lineNumber": 390
          },
          {
            "text": "            if not has_listen_decorator:",
            "lineNumber": 391
          },
          {
            "text": "                asyncio.create_task(",
            "lineNumber": 392
          },
          {
            "text": "                    task_lock.put_queue(",
            "lineNumber": 393
          },
          {
            "text": "                        ActionActivateToolkitData(",
            "lineNumber": 394
          },
          {
            "text": "                            data={",
            "lineNumber": 395
          },
          {
            "text": "                                \"agent_name\": self.agent_name,",
            "lineNumber": 396
          },
          {
            "text": "                                \"process_task_id\": self.process_task_id,",
            "lineNumber": 397
          },
          {
            "text": "                                \"toolkit_name\": toolkit_name,",
            "lineNumber": 398
          },
          {
            "text": "                                \"method_name\": func_name,",
            "lineNumber": 399
          },
          {
            "text": "                                \"message\": json.dumps(args, ensure_ascii=False),",
            "lineNumber": 400
          },
          {
            "text": "                            },",
            "lineNumber": 401
          },
          {
            "text": "                        )",
            "lineNumber": 402
          },
          {
            "text": "                    )",
            "lineNumber": 403
          },
          {
            "text": "                )",
            "lineNumber": 404
          },
          {
            "text": "            # Set process_task context for all tool executions",
            "lineNumber": 405
          },
          {
            "text": "            with set_process_task(self.process_task_id):",
            "lineNumber": 406
          },
          {
            "text": "                raw_result = tool(**args)",
            "lineNumber": 407
          },
          {
            "text": "            traceroot_logger.debug(f\"Tool {func_name} executed successfully\")",
            "lineNumber": 408
          },
          {
            "text": "            if self.mask_tool_output:",
            "lineNumber": 409
          },
          {
            "text": "                self._secure_result_store[tool_call_id] = raw_result",
            "lineNumber": 410
          },
          {
            "text": "                result = (",
            "lineNumber": 411
          },
          {
            "text": "                    \"[The tool has been executed successfully, but the output\"",
            "lineNumber": 412
          },
          {
            "text": "                    \" from the tool is masked. You can move forward]\"",
            "lineNumber": 413
          },
          {
            "text": "                )",
            "lineNumber": 414
          },
          {
            "text": "                mask_flag = True",
            "lineNumber": 415
          },
          {
            "text": "            else:",
            "lineNumber": 416
          },
          {
            "text": "                result = raw_result",
            "lineNumber": 417
          },
          {
            "text": "                mask_flag = False",
            "lineNumber": 418
          },
          {
            "text": "            # Prepare result message with truncation",
            "lineNumber": 419
          },
          {
            "text": "            if",
            "lineNumber": 420
          }
        ]
      },
      "score": 0.2849574685096741
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\controller\\chat_controller.py",
        "range": {
          "startPosition": {
            "line": 70,
            "column": 13
          },
          "endPosition": {
            "line": 126
          }
        },
        "contents": "@router.post(\"/chat\", name=\"start chat\")\n@traceroot.trace()\nasync def post(data: Chat, request: Request):\n    chat_logger.info(\n        \"Starting new chat session\", extra={\"project_id\": data.project_id, \"task_id\": data.task_id, \"user\": data.email}\n    )\n    task_lock = get_or_create_task_lock(data.project_id)\n\n    # Set user-specific environment path for this thread\n    set_user_env_path(data.env_path)\n    load_dotenv(dotenv_path=data.env_path)\n\n    os.environ[\"file_save_path\"] = data.file_save_path()\n    os.environ[\"browser_port\"] = str(data.browser_port)\n    os.environ[\"OPENAI_API_KEY\"] = data.api_key\n    os.environ[\"OPENAI_API_BASE_URL\"] = data.api_url or \"https://api.openai.com/v1\"\n    os.environ[\"CAMEL_MODEL_LOG_ENABLED\"] = \"true\"\n\n    # Set user-specific search engine configuration if provided\n    if data.search_config:\n        for key, value in data.search_config.items():\n            if value:  # Only set non-empty values\n                os.environ[key] = value\n                chat_logger.info(f\"Set search config: {key}\", extra={\"project_id\": data.project_id})\n\n    email_sanitized = re.sub(r'[\\\\/*?:\"&lt;&gt;|\\s]', \"_\", data.email.split(\"@\")[0]).strip(\".\")\n    camel_log = (\n        Path.home()\n        / \".eigent\"\n        / email_sanitized\n        / (\"project_\" + data.project_id)\n        / (\"task_\" + data.task_id)\n        / \"camel_logs\"\n    )\n    camel_log.mkdir(parents=True, exist_ok=True)\n\n    os.environ[\"CAMEL_LOG_DIR\"] = str(camel_log)\n\n    if data.is_cloud():\n        os.environ[\"cloud_api_key\"] = data.api_key\n\n    # Set the initial current_task_id in task_lock\n    set_current_task_id(data.project_id, data.task_id)\n\n    # Put initial action in queue to start processing\n    await task_lock.put_queue(ActionImproveData(data=data.question, new_task_id=data.task_id))\n\n    chat_logger.info",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@router.post(\"/chat\", name=\"start chat\")",
            "lineNumber": 74
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 75
          },
          {
            "text": "async def post(data: Chat, request: Request):",
            "lineNumber": 76,
            "isSignature": true
          },
          {
            "text": "    chat_logger.info(",
            "lineNumber": 77
          },
          {
            "text": "        \"Starting new chat session\", extra={\"project_id\": data.project_id, \"task_id\": data.task_id, \"user\": data.email}",
            "lineNumber": 78
          },
          {
            "text": "    )",
            "lineNumber": 79
          },
          {
            "text": "    task_lock = get_or_create_task_lock(data.project_id)",
            "lineNumber": 80
          },
          {
            "lineNumber": 81
          },
          {
            "text": "    # Set user-specific environment path for this thread",
            "lineNumber": 82
          },
          {
            "text": "    set_user_env_path(data.env_path)",
            "lineNumber": 83
          },
          {
            "text": "    load_dotenv(dotenv_path=data.env_path)",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "    os.environ[\"file_save_path\"] = data.file_save_path()",
            "lineNumber": 86
          },
          {
            "text": "    os.environ[\"browser_port\"] = str(data.browser_port)",
            "lineNumber": 87
          },
          {
            "text": "    os.environ[\"OPENAI_API_KEY\"] = data.api_key",
            "lineNumber": 88
          },
          {
            "text": "    os.environ[\"OPENAI_API_BASE_URL\"] = data.api_url or \"https://api.openai.com/v1\"",
            "lineNumber": 89
          },
          {
            "text": "    os.environ[\"CAMEL_MODEL_LOG_ENABLED\"] = \"true\"",
            "lineNumber": 90
          },
          {
            "lineNumber": 91
          },
          {
            "text": "    # Set user-specific search engine configuration if provided",
            "lineNumber": 92
          },
          {
            "text": "    if data.search_config:",
            "lineNumber": 93
          },
          {
            "text": "        for key, value in data.search_config.items():",
            "lineNumber": 94
          },
          {
            "text": "            if value:  # Only set non-empty values",
            "lineNumber": 95
          },
          {
            "text": "                os.environ[key] = value",
            "lineNumber": 96
          },
          {
            "text": "                chat_logger.info(f\"Set search config: {key}\", extra={\"project_id\": data.project_id})",
            "lineNumber": 97
          },
          {
            "lineNumber": 98
          },
          {
            "text": "    email_sanitized = re.sub(r'[\\\\/*?:\"&lt;&gt;|\\s]', \"_\", data.email.split(\"@\")[0]).strip(\".\")",
            "lineNumber": 99
          },
          {
            "text": "    camel_log = (",
            "lineNumber": 100
          },
          {
            "text": "        Path.home()",
            "lineNumber": 101
          },
          {
            "text": "        / \".eigent\"",
            "lineNumber": 102
          },
          {
            "text": "        / email_sanitized",
            "lineNumber": 103
          },
          {
            "text": "        / (\"project_\" + data.project_id)",
            "lineNumber": 104
          },
          {
            "text": "        / (\"task_\" + data.task_id)",
            "lineNumber": 105
          },
          {
            "text": "        / \"camel_logs\"",
            "lineNumber": 106
          },
          {
            "text": "    )",
            "lineNumber": 107
          },
          {
            "text": "    camel_log.mkdir(parents=True, exist_ok=True)",
            "lineNumber": 108
          },
          {
            "lineNumber": 109
          },
          {
            "text": "    os.environ[\"CAMEL_LOG_DIR\"] = str(camel_log)",
            "lineNumber": 110
          },
          {
            "lineNumber": 111
          },
          {
            "text": "    if data.is_cloud():",
            "lineNumber": 112
          },
          {
            "text": "        os.environ[\"cloud_api_key\"] = data.api_key",
            "lineNumber": 113
          },
          {
            "lineNumber": 114
          },
          {
            "text": "    # Set the initial current_task_id in task_lock",
            "lineNumber": 115
          },
          {
            "text": "    set_current_task_id(data.project_id, data.task_id)",
            "lineNumber": 116
          },
          {
            "lineNumber": 117
          },
          {
            "text": "    # Put initial action in queue to start processing",
            "lineNumber": 118
          },
          {
            "text": "    await task_lock.put_queue(ActionImproveData(data=data.question, new_task_id=data.task_id))",
            "lineNumber": 119
          },
          {
            "lineNumber": 120
          },
          {
            "text": "    chat_logger.info",
            "lineNumber": 121
          }
        ]
      },
      "score": 0.28210678696632385
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 236
          },
          "endPosition": {
            "line": 1075
          }
        },
        "contents": "@sync_step\n@traceroot.trace()\nasync def step_solve(options: Chat, request: Request, task_lock: TaskLock):\n    # if True:\n    #     import faulthandler\n\n    #     faulthandler.enable()\n    #     for second in [5, 10, 20, 30, 60, 120, 240]:\n    #         faulthandler.dump_traceback_later(second)\nasync def run_decomposition():\n\n\n                            state_holder[\"summary_task\"] = summary_task_content\n                            try:\n                                setattr(task_lock, \"summary_task_content\", summary_task_content)\n                            except Exception:\n                                pass\n                            logger.info(f\"[NEW-QUESTION] 📤 Sending to_sub_tasks SSE to frontend (task card)\")\n                            logger.info(f\"[NEW-QUESTION] to_sub_tasks data: task_id={camel_task.id}, summary={summary_task_content[:50]}..., subtasks_count={len(camel_task.subtasks)}\")\n                            payload = {\n                                \"project_id\": options.project_id,\n                                \"task_id\": options.task_id,\n                                \"sub_tasks\": tree_sub_tasks(camel_task.subtasks),\n                                \"delta_sub_tasks\": tree_sub_tasks(sub_tasks),\n                                \"is_final\": True,\n                                \"summary_task\": summary_task_content,\n                            }\n                            await task_lock.put_queue(ActionDecomposeProgressData(data=payload))\n                            logger.info(f\"[NEW-QUESTION] ✅ to_sub_tasks SSE sent\")\n                        except Exception as e:\n                            logger.error(f\"Error in background decomposition: {e}\", exc_info=True)\n\n                    bg_task = asyncio.create_task(run_decomposition())\n                    task_lock.add_background_task(bg_task)\n\n            elif item.action == Action.update_task:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 237,
                "column": 1
              },
              "endPosition": {
                "line": 239,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 239,
                "column": 1
              },
              "endPosition": {
                "line": 247,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 448,
                "column": 21
              },
              "endPosition": {
                "line": 449,
                "column": 25
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@sync_step",
            "lineNumber": 237
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 238
          },
          {
            "text": "async def step_solve(options: Chat, request: Request, task_lock: TaskLock):",
            "lineNumber": 239,
            "isSignature": true
          },
          {
            "text": "    # if True:",
            "lineNumber": 240,
            "isSignature": true
          },
          {
            "text": "    #     import faulthandler",
            "lineNumber": 241,
            "isSignature": true
          },
          {
            "lineNumber": 242,
            "isSignature": true
          },
          {
            "text": "    #     faulthandler.enable()",
            "lineNumber": 243,
            "isSignature": true
          },
          {
            "text": "    #     for second in [5, 10, 20, 30, 60, 120, 240]:",
            "lineNumber": 244,
            "isSignature": true
          },
          {
            "text": "    #         faulthandler.dump_traceback_later(second)",
            "lineNumber": 245,
            "isSignature": true
          },
          {
            "text": "async def run_decomposition():",
            "lineNumber": 479
          },
          {
            "lineNumber": 526
          },
          {
            "lineNumber": 527
          },
          {
            "text": "                            state_holder[\"summary_task\"] = summary_task_content",
            "lineNumber": 528
          },
          {
            "text": "                            try:",
            "lineNumber": 529
          },
          {
            "text": "                                setattr(task_lock, \"summary_task_content\", summary_task_content)",
            "lineNumber": 530
          },
          {
            "text": "                            except Exception:",
            "lineNumber": 531
          },
          {
            "text": "                                pass",
            "lineNumber": 532
          },
          {
            "text": "                            logger.info(f\"[NEW-QUESTION] 📤 Sending to_sub_tasks SSE to frontend (task card)\")",
            "lineNumber": 533
          },
          {
            "text": "                            logger.info(f\"[NEW-QUESTION] to_sub_tasks data: task_id={camel_task.id}, summary={summary_task_content[:50]}..., subtasks_count={len(camel_task.subtasks)}\")",
            "lineNumber": 534
          },
          {
            "text": "                            payload = {",
            "lineNumber": 535
          },
          {
            "text": "                                \"project_id\": options.project_id,",
            "lineNumber": 536
          },
          {
            "text": "                                \"task_id\": options.task_id,",
            "lineNumber": 537
          },
          {
            "text": "                                \"sub_tasks\": tree_sub_tasks(camel_task.subtasks),",
            "lineNumber": 538
          },
          {
            "text": "                                \"delta_sub_tasks\": tree_sub_tasks(sub_tasks),",
            "lineNumber": 539
          },
          {
            "text": "                                \"is_final\": True,",
            "lineNumber": 540
          },
          {
            "text": "                                \"summary_task\": summary_task_content,",
            "lineNumber": 541
          },
          {
            "text": "                            }",
            "lineNumber": 542
          },
          {
            "text": "                            await task_lock.put_queue(ActionDecomposeProgressData(data=payload))",
            "lineNumber": 543
          },
          {
            "text": "                            logger.info(f\"[NEW-QUESTION] ✅ to_sub_tasks SSE sent\")",
            "lineNumber": 544
          },
          {
            "text": "                        except Exception as e:",
            "lineNumber": 545
          },
          {
            "text": "                            logger.error(f\"Error in background decomposition: {e}\", exc_info=True)",
            "lineNumber": 546
          },
          {
            "lineNumber": 547
          },
          {
            "text": "                    bg_task = asyncio.create_task(run_decomposition())",
            "lineNumber": 548
          },
          {
            "text": "                    task_lock.add_background_task(bg_task)",
            "lineNumber": 549
          },
          {
            "lineNumber": 550
          },
          {
            "text": "            elif item.action == Action.update_task:",
            "lineNumber": 551
          }
        ]
      },
      "score": 0.2815015912055969
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\human_toolkit.py",
        "range": {
          "startPosition": {
            "line": 12
          },
          "endPosition": {
            "line": 147,
            "column": 9
          }
        },
        "contents": "@auto_listen_toolkit(BaseToolkit)\nclass HumanToolkit(BaseToolkit, AbstractToolkit):\n@listen_toolkit()\ndef send_message_to_user(\n        self,\n        message_title: str,\n        message_description: str,\n        message_attachment: str | None = None,\n    ) -&gt; str:\n\n        if not current_process_task_id:\n            current_process_task_id = self.api_task_id\n            logger.warning(f\"[send_message_to_user] ContextVar process_task is empty, using api_task_id as fallback: '{current_process_task_id}'\")\n\n        from app.utils.listen.toolkit_listen import _safe_put_queue\n\n        notice_data = ActionNoticeData(\n            process_task_id=current_process_task_id,\n            data=f\"{message_description}\",\n        )\n        _safe_put_queue(task_lock, notice_data)\n\n        attachment_info = f\" {message_attachment}\" if message_attachment else \"\"\n        return f\"Message successfully sent to user: '{message_title} {message_description}{attachment_info}'\"\n\n    def get_tools(self) -&gt; list[FunctionTool]:\n        r\"\"\"Returns a list of FunctionTool objects representing the\n        functions in the toolkit.\n\n        Returns:\n            List[FunctionTool]: A list of FunctionTool objects\n                representing the functions in the toolkit.\n        \"\"\"\n        return [\n            FunctionTool(self.ask_human_via_gui),\n            FunctionTool(self.send_message_to_user),\n        ]\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str, agent_name: str) -&gt; list[FunctionTool]:\n        human = cls(api_task_id, agent_name)\n        return [\n            FunctionTool(human.ask_human_via_gui),\n            # Note: send_message_to_user is not included in get_can_use_tools\n            # It is only available via get_tools() if needed\n        ]",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 13,
                "column": 1
              },
              "endPosition": {
                "line": 14,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 14,
                "column": 1
              },
              "endPosition": {
                "line": 15,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 64,
                "column": 5
              },
              "endPosition": {
                "line": 65,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 65,
                "column": 5
              },
              "endPosition": {
                "line": 71,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@auto_listen_toolkit(BaseToolkit)",
            "lineNumber": 13
          },
          {
            "text": "class HumanToolkit(BaseToolkit, AbstractToolkit):",
            "lineNumber": 14,
            "isSignature": true
          },
          {
            "text": "@listen_toolkit()",
            "lineNumber": 64
          },
          {
            "text": "def send_message_to_user(",
            "lineNumber": 65
          },
          {
            "text": "        self,",
            "lineNumber": 66
          },
          {
            "text": "        message_title: str,",
            "lineNumber": 67
          },
          {
            "text": "        message_description: str,",
            "lineNumber": 68
          },
          {
            "text": "        message_attachment: str | None = None,",
            "lineNumber": 69
          },
          {
            "text": "    ) -&gt; str:",
            "lineNumber": 70
          },
          {
            "lineNumber": 112
          },
          {
            "text": "        if not current_process_task_id:",
            "lineNumber": 113
          },
          {
            "text": "            current_process_task_id = self.api_task_id",
            "lineNumber": 114
          },
          {
            "text": "            logger.warning(f\"[send_message_to_user] ContextVar process_task is empty, using api_task_id as fallback: '{current_process_task_id}'\")",
            "lineNumber": 115
          },
          {
            "lineNumber": 116
          },
          {
            "text": "        from app.utils.listen.toolkit_listen import _safe_put_queue",
            "lineNumber": 117
          },
          {
            "lineNumber": 118
          },
          {
            "text": "        notice_data = ActionNoticeData(",
            "lineNumber": 119
          },
          {
            "text": "            process_task_id=current_process_task_id,",
            "lineNumber": 120
          },
          {
            "text": "            data=f\"{message_description}\",",
            "lineNumber": 121
          },
          {
            "text": "        )",
            "lineNumber": 122
          },
          {
            "text": "        _safe_put_queue(task_lock, notice_data)",
            "lineNumber": 123
          },
          {
            "lineNumber": 124
          },
          {
            "text": "        attachment_info = f\" {message_attachment}\" if message_attachment else \"\"",
            "lineNumber": 125
          },
          {
            "text": "        return f\"Message successfully sent to user: '{message_title} {message_description}{attachment_info}'\"",
            "lineNumber": 126
          },
          {
            "lineNumber": 127
          },
          {
            "text": "    def get_tools(self) -&gt; list[FunctionTool]:",
            "lineNumber": 128
          },
          {
            "text": "        r\"\"\"Returns a list of FunctionTool objects representing the",
            "lineNumber": 129
          },
          {
            "text": "        functions in the toolkit.",
            "lineNumber": 130
          },
          {
            "lineNumber": 131
          },
          {
            "text": "        Returns:",
            "lineNumber": 132
          },
          {
            "text": "            List[FunctionTool]: A list of FunctionTool objects",
            "lineNumber": 133
          },
          {
            "text": "                representing the functions in the toolkit.",
            "lineNumber": 134
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 135
          },
          {
            "text": "        return [",
            "lineNumber": 136
          },
          {
            "text": "            FunctionTool(self.ask_human_via_gui),",
            "lineNumber": 137
          },
          {
            "text": "            FunctionTool(self.send_message_to_user),",
            "lineNumber": 138
          },
          {
            "text": "        ]",
            "lineNumber": 139
          },
          {
            "lineNumber": 140
          },
          {
            "text": "    @classmethod",
            "lineNumber": 141
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str, agent_name: str) -&gt; list[FunctionTool]:",
            "lineNumber": 142
          },
          {
            "text": "        human = cls(api_task_id, agent_name)",
            "lineNumber": 143
          },
          {
            "text": "        return [",
            "lineNumber": 144
          },
          {
            "text": "            FunctionTool(human.ask_human_via_gui),",
            "lineNumber": 145
          },
          {
            "text": "            # Note: send_message_to_user is not included in get_can_use_tools",
            "lineNumber": 146
          },
          {
            "text": "            # It is only available via get_tools() if needed",
            "lineNumber": 147
          },
          {
            "text": "        ]",
            "lineNumber": 148,
            "isSignature": true
          }
        ]
      },
      "score": 0.28138211369514465
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\component\\oauth_adapter.py",
        "range": {
          "startPosition": {
            "line": 17,
            "column": 12
          },
          "endPosition": {
            "line": 84
          }
        },
        "contents": "class SlackOAuthAdapter(OAuthAdapter):\n    def __init__(self, redirect_uri: Optional[str] = None):\n        self.client_id = env(\"SLACK_CLIENT_ID\", \"your_client_id\")\n        self.client_secret = env(\"SLACK_CLIENT_SECRET\", \"your_client_secret\")\n        self.redirect_uri = redirect_uri or env(\"SLACK_REDIRECT_URI\", \"https://localhost/api/oauth/slack/callback\")\n        self.scope = env(\"SLACK_SCOPE\", \"chat:write,channels:read,channels:join,groups:read,im:write\")\n\n    def get_authorize_url(self, state: Optional[str] = None) -&gt; Optional[str]:\n        url = (\n            f\"https://slack.com/oauth/v2/authorize?client_id={self.client_id}\"\n            f\"&amp;scope={self.scope}\"\n            f\"&amp;redirect_uri={self.redirect_uri}\"\n        )\n        if state:\n            url += f\"&amp;state={state}\"\n        return url\n\n    def fetch_token(self, code: Optional[str]) -&gt; Optional[Dict[str, Any]]:\n        if not code:\n            return None\n        token_url = \"https://slack.com/api/oauth.v2.access\"\n        data = {\n            \"client_id\": self.client_id,\n            \"client_secret\": self.client_secret,\n            \"code\": code,\n            \"redirect_uri\": self.redirect_uri,\n        }\n        with httpx.Client() as client:\n            resp = client.post(token_url, data=data)\n            return resp.json()\n\n\nclass NotionOAuthAdapter(OAuthAdapter):\n    def __init__(self, redirect_uri: Optional[str] = None):\n        self.client_id = env(\"NOTION_CLIENT_ID\", \"your_notion_client_id\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class SlackOAuthAdapter(OAuthAdapter):",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "    def __init__(self, redirect_uri: Optional[str] = None):",
            "lineNumber": 22
          },
          {
            "text": "        self.client_id = env(\"SLACK_CLIENT_ID\", \"your_client_id\")",
            "lineNumber": 23
          },
          {
            "text": "        self.client_secret = env(\"SLACK_CLIENT_SECRET\", \"your_client_secret\")",
            "lineNumber": 24
          },
          {
            "text": "        self.redirect_uri = redirect_uri or env(\"SLACK_REDIRECT_URI\", \"https://localhost/api/oauth/slack/callback\")",
            "lineNumber": 25
          },
          {
            "text": "        self.scope = env(\"SLACK_SCOPE\", \"chat:write,channels:read,channels:join,groups:read,im:write\")",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "    def get_authorize_url(self, state: Optional[str] = None) -&gt; Optional[str]:",
            "lineNumber": 28
          },
          {
            "text": "        url = (",
            "lineNumber": 29
          },
          {
            "text": "            f\"https://slack.com/oauth/v2/authorize?client_id={self.client_id}\"",
            "lineNumber": 30
          },
          {
            "text": "            f\"&amp;scope={self.scope}\"",
            "lineNumber": 31
          },
          {
            "text": "            f\"&amp;redirect_uri={self.redirect_uri}\"",
            "lineNumber": 32
          },
          {
            "text": "        )",
            "lineNumber": 33
          },
          {
            "text": "        if state:",
            "lineNumber": 34
          },
          {
            "text": "            url += f\"&amp;state={state}\"",
            "lineNumber": 35
          },
          {
            "text": "        return url",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "    def fetch_token(self, code: Optional[str]) -&gt; Optional[Dict[str, Any]]:",
            "lineNumber": 38
          },
          {
            "text": "        if not code:",
            "lineNumber": 39
          },
          {
            "text": "            return None",
            "lineNumber": 40
          },
          {
            "text": "        token_url = \"https://slack.com/api/oauth.v2.access\"",
            "lineNumber": 41
          },
          {
            "text": "        data = {",
            "lineNumber": 42
          },
          {
            "text": "            \"client_id\": self.client_id,",
            "lineNumber": 43
          },
          {
            "text": "            \"client_secret\": self.client_secret,",
            "lineNumber": 44
          },
          {
            "text": "            \"code\": code,",
            "lineNumber": 45
          },
          {
            "text": "            \"redirect_uri\": self.redirect_uri,",
            "lineNumber": 46
          },
          {
            "text": "        }",
            "lineNumber": 47
          },
          {
            "text": "        with httpx.Client() as client:",
            "lineNumber": 48
          },
          {
            "text": "            resp = client.post(token_url, data=data)",
            "lineNumber": 49
          },
          {
            "text": "            return resp.json()",
            "lineNumber": 50,
            "isSignature": true
          },
          {
            "lineNumber": 51
          },
          {
            "lineNumber": 52
          },
          {
            "text": "class NotionOAuthAdapter(OAuthAdapter):",
            "lineNumber": 53,
            "isSignature": true
          },
          {
            "text": "    def __init__(self, redirect_uri: Optional[str] = None):",
            "lineNumber": 54
          },
          {
            "text": "        self.client_id = env(\"NOTION_CLIENT_ID\", \"your_notion_client_id\")",
            "lineNumber": 55
          }
        ]
      },
      "score": 0.2785995602607727
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\store\\chatStore.ts",
        "range": {
          "startPosition": {
            "line": 162
          },
          "endPosition": {
            "line": 2594,
            "column": 1
          }
        },
        "contents": "const chatStore = \n(set, get) =&gt; (\nasync (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {\n\nasync onmessage(event: any) {\n\n\t\t\t\t\t\t\t\ttaskAssigning[assigneeAgentIndex].log.push(agentMessages);\n\n\t\t\t\t\t\t\t\tsetTaskAssigning(currentTaskId, [...taskAssigning]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet taskRunning = [...tasks[currentTaskId].taskRunning]\n\t\t\t\t\t\tconst { toolkit_name, method_name, message } =\n\t\t\t\t\t\t\tagentMessages.data;\n\t\t\t\t\t\tconst taskIndex = taskRunning.findIndex((task) =&gt;\n\t\t\t\t\t\t\ttask.agent?.type === agentMessages.data.agent_name &amp;&amp;\n\t\t\t\t\t\t\ttask.toolkits?.at(-1)?.toolkitName === toolkit_name\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (taskIndex !== -1) {\n\t\t\t\t\t\t\tif (toolkit_name &amp;&amp; method_name &amp;&amp; message) {\n\t\t\t\t\t\t\t\tconst targetMessage = filterMessage(agentMessages)\n\n\t\t\t\t\t\t\t\tif (targetMessage) {\n\t\t\t\t\t\t\t\t\ttaskRunning![taskIndex].toolkits?.unshift({\n\t\t\t\t\t\t\t\t\t\ttoolkitName: toolkit_name,\n\t\t\t\t\t\t\t\t\t\ttoolkitMethods: method_name,\n\t\t\t\t\t\t\t\t\t\tmessage: normalizeToolkitMessage(targetMessage.data.message),\n\t\t\t\t\t\t\t\t\t\ttoolkitStatus: \"completed\",\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTaskAssigning(currentTaskId, [...taskAssigning]);\n\t\t\t\t\t\tsetTaskRunning(currentTaskId, taskRunning);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Terminal\n\t\t\t\t\tif (agentMessages.step === \"terminal\") {\n\t\t\t\t\t\taddTerminal(currentTaskId, agentMessages.data.process_task_id as string, agentMessages.data.output as string)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t// Write File\n\t\t\t\t\tif (agentMessages.step === \"write_file\") {\n\t\t\t\t\t\tconsole.log('write_to_file', agentMessages.data)\n\t\t\t\t\t\tsetNuwFileNum(currentTaskId, tasks[currentTaskId].nuwFileNum + 1)\n\t\t\t\t\t\tconst { file_path } = agentMessages.data;\n\t\t\t\t\t\tconst fileName = file_path?.replace(/\\\\/g, \"/\").split(\"/\").pop() || \"\";\n\t\t\t\t\t\tconst fileType = fileName.split(\".\").pop() || \"\";\n\t\t\t\t\t\tconst fileInfo: FileInfo = {\n\t\t\t\t\t\t\tname: fileName,\n\t\t\t\t\t\t\ttype: fileType,\n\t\t\t\t\t\t\tpath: file_path || \"\",\n\t\t\t\t\t\t\ticon: FileText,\n\t\t\t\t\t\t};\n\t\t\t\t\t\taddFileList(currentTaskId, agentMessages.data.process_task_id as string, fileInfo);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif\n\t\t\t\t}\n\n\t\t}\n)\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 163,
                "column": 1
              },
              "endPosition": {
                "line": 163,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 7
              },
              "endPosition": {
                "line": 163,
                "column": 19
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 53
              },
              "endPosition": {
                "line": 163,
                "column": 53
              }
            },
            {
              "startPosition": {
                "line": 164,
                "column": 2
              },
              "endPosition": {
                "line": 164,
                "column": 17
              }
            },
            {
              "startPosition": {
                "line": 331,
                "column": 14
              },
              "endPosition": {
                "line": 332,
                "column": 4
              }
            },
            {
              "startPosition": {
                "line": 586,
                "column": 4
              },
              "endPosition": {
                "line": 586,
                "column": 4
              }
            },
            {
              "startPosition": {
                "line": 612,
                "column": 5
              },
              "endPosition": {
                "line": 613,
                "column": 6
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const chatStore = ",
            "lineNumber": 163
          },
          {
            "text": "(set, get) =&gt; (",
            "lineNumber": 164
          },
          {
            "text": "async (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {",
            "lineNumber": 331
          },
          {
            "lineNumber": 586
          },
          {
            "text": "async onmessage(event: any) {",
            "lineNumber": 612
          },
          {
            "lineNumber": 1379
          },
          {
            "text": "\t\t\t\t\t\t\t\ttaskAssigning[assigneeAgentIndex].log.push(agentMessages);",
            "lineNumber": 1380
          },
          {
            "lineNumber": 1381
          },
          {
            "text": "\t\t\t\t\t\t\t\tsetTaskAssigning(currentTaskId, [...taskAssigning]);",
            "lineNumber": 1382
          },
          {
            "text": "\t\t\t\t\t\t\t}",
            "lineNumber": 1383
          },
          {
            "text": "\t\t\t\t\t\t}",
            "lineNumber": 1384
          },
          {
            "lineNumber": 1385
          },
          {
            "text": "\t\t\t\t\t\tlet taskRunning = [...tasks[currentTaskId].taskRunning]",
            "lineNumber": 1386
          },
          {
            "text": "\t\t\t\t\t\tconst { toolkit_name, method_name, message } =",
            "lineNumber": 1387
          },
          {
            "text": "\t\t\t\t\t\t\tagentMessages.data;",
            "lineNumber": 1388
          },
          {
            "text": "\t\t\t\t\t\tconst taskIndex = taskRunning.findIndex((task) =&gt;",
            "lineNumber": 1389
          },
          {
            "text": "\t\t\t\t\t\t\ttask.agent?.type === agentMessages.data.agent_name &amp;&amp;",
            "lineNumber": 1390
          },
          {
            "text": "\t\t\t\t\t\t\ttask.toolkits?.at(-1)?.toolkitName === toolkit_name",
            "lineNumber": 1391
          },
          {
            "text": "\t\t\t\t\t\t);",
            "lineNumber": 1392
          },
          {
            "lineNumber": 1393
          },
          {
            "text": "\t\t\t\t\t\tif (taskIndex !== -1) {",
            "lineNumber": 1394
          },
          {
            "text": "\t\t\t\t\t\t\tif (toolkit_name &amp;&amp; method_name &amp;&amp; message) {",
            "lineNumber": 1395
          },
          {
            "text": "\t\t\t\t\t\t\t\tconst targetMessage = filterMessage(agentMessages)",
            "lineNumber": 1396
          },
          {
            "lineNumber": 1397
          },
          {
            "text": "\t\t\t\t\t\t\t\tif (targetMessage) {",
            "lineNumber": 1398
          },
          {
            "text": "\t\t\t\t\t\t\t\t\ttaskRunning![taskIndex].toolkits?.unshift({",
            "lineNumber": 1399
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\ttoolkitName: toolkit_name,",
            "lineNumber": 1400
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\ttoolkitMethods: method_name,",
            "lineNumber": 1401
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\tmessage: normalizeToolkitMessage(targetMessage.data.message),",
            "lineNumber": 1402
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t\ttoolkitStatus: \"completed\",",
            "lineNumber": 1403
          },
          {
            "text": "\t\t\t\t\t\t\t\t\t});",
            "lineNumber": 1404
          },
          {
            "text": "\t\t\t\t\t\t\t\t}",
            "lineNumber": 1405
          },
          {
            "lineNumber": 1406
          },
          {
            "text": "\t\t\t\t\t\t\t}",
            "lineNumber": 1407
          },
          {
            "text": "\t\t\t\t\t\t}",
            "lineNumber": 1408
          },
          {
            "text": "\t\t\t\t\t\tsetTaskAssigning(currentTaskId, [...taskAssigning]);",
            "lineNumber": 1409
          },
          {
            "text": "\t\t\t\t\t\tsetTaskRunning(currentTaskId, taskRunning);",
            "lineNumber": 1410
          },
          {
            "text": "\t\t\t\t\t\treturn;",
            "lineNumber": 1411
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 1412
          },
          {
            "text": "\t\t\t\t\t// Terminal",
            "lineNumber": 1413
          },
          {
            "text": "\t\t\t\t\tif (agentMessages.step === \"terminal\") {",
            "lineNumber": 1414
          },
          {
            "text": "\t\t\t\t\t\taddTerminal(currentTaskId, agentMessages.data.process_task_id as string, agentMessages.data.output as string)",
            "lineNumber": 1415
          },
          {
            "text": "\t\t\t\t\t\treturn",
            "lineNumber": 1416
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 1417
          },
          {
            "text": "\t\t\t\t\t// Write File",
            "lineNumber": 1418
          },
          {
            "text": "\t\t\t\t\tif (agentMessages.step === \"write_file\") {",
            "lineNumber": 1419
          },
          {
            "text": "\t\t\t\t\t\tconsole.log('write_to_file', agentMessages.data)",
            "lineNumber": 1420
          },
          {
            "text": "\t\t\t\t\t\tsetNuwFileNum(currentTaskId, tasks[currentTaskId].nuwFileNum + 1)",
            "lineNumber": 1421
          },
          {
            "text": "\t\t\t\t\t\tconst { file_path } = agentMessages.data;",
            "lineNumber": 1422
          },
          {
            "text": "\t\t\t\t\t\tconst fileName = file_path?.replace(/\\\\/g, \"/\").split(\"/\").pop() || \"\";",
            "lineNumber": 1423
          },
          {
            "text": "\t\t\t\t\t\tconst fileType = fileName.split(\".\").pop() || \"\";",
            "lineNumber": 1424
          },
          {
            "text": "\t\t\t\t\t\tconst fileInfo: FileInfo = {",
            "lineNumber": 1425
          },
          {
            "text": "\t\t\t\t\t\t\tname: fileName,",
            "lineNumber": 1426
          },
          {
            "text": "\t\t\t\t\t\t\ttype: fileType,",
            "lineNumber": 1427
          },
          {
            "text": "\t\t\t\t\t\t\tpath: file_path || \"\",",
            "lineNumber": 1428
          },
          {
            "text": "\t\t\t\t\t\t\ticon: FileText,",
            "lineNumber": 1429
          },
          {
            "text": "\t\t\t\t\t\t};",
            "lineNumber": 1430
          },
          {
            "text": "\t\t\t\t\t\taddFileList(currentTaskId, agentMessages.data.process_task_id as string, fileInfo);",
            "lineNumber": 1431
          },
          {
            "text": "\t\t\t\t\t\treturn;",
            "lineNumber": 1432
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 1433
          },
          {
            "lineNumber": 1434
          },
          {
            "text": "\t\t\t\t\tif",
            "lineNumber": 1435
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 1836
          },
          {
            "lineNumber": 1886
          },
          {
            "text": "\t\t}",
            "lineNumber": 1888
          },
          {
            "text": ")",
            "lineNumber": 2594
          },
          {
            "text": ";",
            "lineNumber": 2595
          }
        ]
      },
      "score": 0.276589035987854
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 236
          },
          "endPosition": {
            "line": 1075
          }
        },
        "contents": "@sync_step\n@traceroot.trace()\nasync def step_solve(options: Chat, request: Request, task_lock: TaskLock):\n    # if True:\n    #     import faulthandler\n\n    #     faulthandler.enable()\n    #     for second in [5, 10, 20, 30, 60, 120, 240]:\n    #         faulthandler.dump_traceback_later(second)\n {\"sub_tasks\": [], \"summary_task\": \"\"}\n\n                    def on_stream_batch(new_tasks: list[Task], is_final: bool = False):\n                        fresh_tasks = [t for t in new_tasks if t.id not in stream_state[\"seen_ids\"]]\n                        for t in fresh_tasks:\n                            stream_state[\"seen_ids\"].add(t.id)\n                        stream_state[\"subtasks\"].extend(fresh_tasks)\n\n                    def on_stream_text(chunk):\n                        try:\n                            # With task_agent using stream_accumulate=True, chunk.msg.content is accumulated content\n                            # We need to calculate the delta to send only new content to frontend\n                            accumulated_content = chunk.msg.content if hasattr(chunk, 'msg') and chunk.msg else str(chunk)\n                            last_content = stream_state[\"last_content\"]\n\n                            # Calculate delta: new content that wasn't in the previous chunk\n                            if accumulated_content.startswith(last_content):\n                                delta_content = accumulated_content[len(last_content):]\n                            else:\n                                delta_content = accumulated_content\n\n                            stream_state[\"last_content\"] = accumulated_content\n\n                            if delta_content:\n                                asyncio.run_coroutine_threadsafe(\n                                    task_lock.put_queue(\n                                        ActionDecomposeTextData(\n                                            data={\n                                                \"project_id\": options.project_id,\n                                                \"task_id\": options.task_id,\n                                                \"content\": delta_content,\n                                            }\n                                        )\n                                    ),\n                                    event_loop,\n                                )\n                        except Exception as e:\n                            logger.warning(f\"Failed to stream decomposition text: {e}\")",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 237,
                "column": 1
              },
              "endPosition": {
                "line": 239,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 239,
                "column": 1
              },
              "endPosition": {
                "line": 247,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@sync_step",
            "lineNumber": 237
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 238
          },
          {
            "text": "async def step_solve(options: Chat, request: Request, task_lock: TaskLock):",
            "lineNumber": 239,
            "isSignature": true
          },
          {
            "text": "    # if True:",
            "lineNumber": 240,
            "isSignature": true
          },
          {
            "text": "    #     import faulthandler",
            "lineNumber": 241,
            "isSignature": true
          },
          {
            "lineNumber": 242,
            "isSignature": true
          },
          {
            "text": "    #     faulthandler.enable()",
            "lineNumber": 243,
            "isSignature": true
          },
          {
            "text": "    #     for second in [5, 10, 20, 30, 60, 120, 240]:",
            "lineNumber": 244,
            "isSignature": true
          },
          {
            "text": "    #         faulthandler.dump_traceback_later(second)",
            "lineNumber": 245,
            "isSignature": true
          },
          {
            "text": " {\"sub_tasks\": [], \"summary_task\": \"\"}",
            "lineNumber": 440
          },
          {
            "lineNumber": 441
          },
          {
            "text": "                    def on_stream_batch(new_tasks: list[Task], is_final: bool = False):",
            "lineNumber": 442
          },
          {
            "text": "                        fresh_tasks = [t for t in new_tasks if t.id not in stream_state[\"seen_ids\"]]",
            "lineNumber": 443
          },
          {
            "text": "                        for t in fresh_tasks:",
            "lineNumber": 444
          },
          {
            "text": "                            stream_state[\"seen_ids\"].add(t.id)",
            "lineNumber": 445
          },
          {
            "text": "                        stream_state[\"subtasks\"].extend(fresh_tasks)",
            "lineNumber": 446
          },
          {
            "lineNumber": 447
          },
          {
            "text": "                    def on_stream_text(chunk):",
            "lineNumber": 448
          },
          {
            "text": "                        try:",
            "lineNumber": 449
          },
          {
            "text": "                            # With task_agent using stream_accumulate=True, chunk.msg.content is accumulated content",
            "lineNumber": 450
          },
          {
            "text": "                            # We need to calculate the delta to send only new content to frontend",
            "lineNumber": 451
          },
          {
            "text": "                            accumulated_content = chunk.msg.content if hasattr(chunk, 'msg') and chunk.msg else str(chunk)",
            "lineNumber": 452
          },
          {
            "text": "                            last_content = stream_state[\"last_content\"]",
            "lineNumber": 453
          },
          {
            "lineNumber": 454
          },
          {
            "text": "                            # Calculate delta: new content that wasn't in the previous chunk",
            "lineNumber": 455
          },
          {
            "text": "                            if accumulated_content.startswith(last_content):",
            "lineNumber": 456
          },
          {
            "text": "                                delta_content = accumulated_content[len(last_content):]",
            "lineNumber": 457
          },
          {
            "text": "                            else:",
            "lineNumber": 458
          },
          {
            "text": "                                delta_content = accumulated_content",
            "lineNumber": 459
          },
          {
            "lineNumber": 460
          },
          {
            "text": "                            stream_state[\"last_content\"] = accumulated_content",
            "lineNumber": 461
          },
          {
            "lineNumber": 462
          },
          {
            "text": "                            if delta_content:",
            "lineNumber": 463
          },
          {
            "text": "                                asyncio.run_coroutine_threadsafe(",
            "lineNumber": 464
          },
          {
            "text": "                                    task_lock.put_queue(",
            "lineNumber": 465
          },
          {
            "text": "                                        ActionDecomposeTextData(",
            "lineNumber": 466
          },
          {
            "text": "                                            data={",
            "lineNumber": 467
          },
          {
            "text": "                                                \"project_id\": options.project_id,",
            "lineNumber": 468
          },
          {
            "text": "                                                \"task_id\": options.task_id,",
            "lineNumber": 469
          },
          {
            "text": "                                                \"content\": delta_content,",
            "lineNumber": 470
          },
          {
            "text": "                                            }",
            "lineNumber": 471
          },
          {
            "text": "                                        )",
            "lineNumber": 472
          },
          {
            "text": "                                    ),",
            "lineNumber": 473
          },
          {
            "text": "                                    event_loop,",
            "lineNumber": 474
          },
          {
            "text": "                                )",
            "lineNumber": 475
          },
          {
            "text": "                        except Exception as e:",
            "lineNumber": 476
          },
          {
            "text": "                            logger.warning(f\"Failed to stream decomposition text: {e}\")",
            "lineNumber": 477
          }
        ]
      },
      "score": 0.2749011516571045
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 1297,
            "column": 17
          },
          "endPosition": {
            "line": 1424
          }
        },
        "contents": "@traceroot.trace()\nasync def construct_workforce(options: Chat) -&gt; tuple[Workforce, ListenChatAgent]:\n    logger.info(\"Constructing workforce\", extra={\"project_id\": options.project_id, \"task_id\": options.task_id})\n    working_directory = get_working_directory(options)\n    logger.debug(\"Working directory set\", extra={\"working_directory\": working_directory})\n    [coordinator_agent, task_agent] = [\n        agent_model(\n            key,\n            prompt,\n            options,\n            [\n                *(\n                    ToolkitMessageIntegration(\n                        message_handler=HumanToolkit(options.project_id, key).send_message_to_user\n                    ).register_toolkits(NoteTakingToolkit(options.project_id, working_directory=working_directory))\n                ).get_tools()\n            ],\n        )\n        for key, prompt in {\n            Agents.coordinator_agent:",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1301
          },
          {
            "text": "async def construct_workforce(options: Chat) -&gt; tuple[Workforce, ListenChatAgent]:",
            "lineNumber": 1302,
            "isSignature": true
          },
          {
            "text": "    logger.info(\"Constructing workforce\", extra={\"project_id\": options.project_id, \"task_id\": options.task_id})",
            "lineNumber": 1303
          },
          {
            "text": "    working_directory = get_working_directory(options)",
            "lineNumber": 1304
          },
          {
            "text": "    logger.debug(\"Working directory set\", extra={\"working_directory\": working_directory})",
            "lineNumber": 1305
          },
          {
            "text": "    [coordinator_agent, task_agent] = [",
            "lineNumber": 1306
          },
          {
            "text": "        agent_model(",
            "lineNumber": 1307
          },
          {
            "text": "            key,",
            "lineNumber": 1308
          },
          {
            "text": "            prompt,",
            "lineNumber": 1309
          },
          {
            "text": "            options,",
            "lineNumber": 1310
          },
          {
            "text": "            [",
            "lineNumber": 1311
          },
          {
            "text": "                *(",
            "lineNumber": 1312
          },
          {
            "text": "                    ToolkitMessageIntegration(",
            "lineNumber": 1313
          },
          {
            "text": "                        message_handler=HumanToolkit(options.project_id, key).send_message_to_user",
            "lineNumber": 1314
          },
          {
            "text": "                    ).register_toolkits(NoteTakingToolkit(options.project_id, working_directory=working_directory))",
            "lineNumber": 1315
          },
          {
            "text": "                ).get_tools()",
            "lineNumber": 1316
          },
          {
            "text": "            ],",
            "lineNumber": 1317
          },
          {
            "text": "        )",
            "lineNumber": 1318
          },
          {
            "text": "        for key, prompt in {",
            "lineNumber": 1319
          },
          {
            "text": "            Agents.coordinator_agent:",
            "lineNumber": 1320
          }
        ]
      },
      "score": 0.27116790413856506
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 236
          },
          "endPosition": {
            "line": 1075
          }
        },
        "contents": "@sync_step\n@traceroot.trace()\nasync def step_solve(options: Chat, request: Request, task_lock: TaskLock):\n    # if True:\n    #     import faulthandler\n\n    #     faulthandler.enable()\n    #     for second in [5, 10, 20, 30, 60, 120, 240]:\n    #         faulthandler.dump_traceback_later(second)\n\n\n            elif item.action == Action.update_task:\n                assert camel_task is not None\n                update_tasks = {item.id: item for item in item.data.task}\n                # Use stored decomposition results if available\n                if not sub_tasks:\n                    sub_tasks = getattr(task_lock, \"decompose_sub_tasks\", [])\n                sub_tasks = update_sub_tasks(sub_tasks, update_tasks)\n                add_sub_tasks(camel_task, item.data.task)\n                summary_task_content_local = getattr(task_lock, \"summary_task_content\", summary_task_content)\n                yield to_sub_tasks(camel_task, summary_task_content_local)\n            elif item.action == Action.add_task:\n\n                # Check if this might be a misrouted second question\n                if camel_task is None and workforce is None:\n                    logger.error(f\"Cannot add task: both camel_task and workforce are None for project {options.project_id}\")\n                    yield sse_json(\"error\", {\"message\": \"Cannot add task: task not initialized. Please start a task first.\"})\n                    continue\n\n                assert camel_task is not None\n                if workforce is None:\n                    logger.error(f\"Cannot add task: workforce not initialized for project {options.project_id}\")\n                    yield sse_json(\"error\", {\"message\": \"Workforce not initialized. Please start the task first.\"})\n                    continue\n\n                # Add task to the workforce queue\n                workforce.add_task(\n                    item.content,\n                    item.task_id,\n                    item.additional_info\n                )\n\n                returnData = {\n                    \"project_id\": item.project_id,\n                    \"task_id\": item.task_id or (len(camel_task.subtasks) + 1)\n                }\n                yield sse_json(\"add_task\", returnData)\n            elif item.action == Action.remove_task:\n                if workforce is None:\n                    logger.error",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 237,
                "column": 1
              },
              "endPosition": {
                "line": 239,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 239,
                "column": 1
              },
              "endPosition": {
                "line": 247,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@sync_step",
            "lineNumber": 237
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 238
          },
          {
            "text": "async def step_solve(options: Chat, request: Request, task_lock: TaskLock):",
            "lineNumber": 239,
            "isSignature": true
          },
          {
            "text": "    # if True:",
            "lineNumber": 240,
            "isSignature": true
          },
          {
            "text": "    #     import faulthandler",
            "lineNumber": 241,
            "isSignature": true
          },
          {
            "lineNumber": 242,
            "isSignature": true
          },
          {
            "text": "    #     faulthandler.enable()",
            "lineNumber": 243,
            "isSignature": true
          },
          {
            "text": "    #     for second in [5, 10, 20, 30, 60, 120, 240]:",
            "lineNumber": 244,
            "isSignature": true
          },
          {
            "text": "    #         faulthandler.dump_traceback_later(second)",
            "lineNumber": 245,
            "isSignature": true
          },
          {
            "lineNumber": 549
          },
          {
            "lineNumber": 550
          },
          {
            "text": "            elif item.action == Action.update_task:",
            "lineNumber": 551
          },
          {
            "text": "                assert camel_task is not None",
            "lineNumber": 552
          },
          {
            "text": "                update_tasks = {item.id: item for item in item.data.task}",
            "lineNumber": 553
          },
          {
            "text": "                # Use stored decomposition results if available",
            "lineNumber": 554
          },
          {
            "text": "                if not sub_tasks:",
            "lineNumber": 555
          },
          {
            "text": "                    sub_tasks = getattr(task_lock, \"decompose_sub_tasks\", [])",
            "lineNumber": 556
          },
          {
            "text": "                sub_tasks = update_sub_tasks(sub_tasks, update_tasks)",
            "lineNumber": 557
          },
          {
            "text": "                add_sub_tasks(camel_task, item.data.task)",
            "lineNumber": 558
          },
          {
            "text": "                summary_task_content_local = getattr(task_lock, \"summary_task_content\", summary_task_content)",
            "lineNumber": 559
          },
          {
            "text": "                yield to_sub_tasks(camel_task, summary_task_content_local)",
            "lineNumber": 560
          },
          {
            "text": "            elif item.action == Action.add_task:",
            "lineNumber": 561
          },
          {
            "lineNumber": 562
          },
          {
            "text": "                # Check if this might be a misrouted second question",
            "lineNumber": 563
          },
          {
            "text": "                if camel_task is None and workforce is None:",
            "lineNumber": 564
          },
          {
            "text": "                    logger.error(f\"Cannot add task: both camel_task and workforce are None for project {options.project_id}\")",
            "lineNumber": 565
          },
          {
            "text": "                    yield sse_json(\"error\", {\"message\": \"Cannot add task: task not initialized. Please start a task first.\"})",
            "lineNumber": 566
          },
          {
            "text": "                    continue",
            "lineNumber": 567
          },
          {
            "lineNumber": 568
          },
          {
            "text": "                assert camel_task is not None",
            "lineNumber": 569
          },
          {
            "text": "                if workforce is None:",
            "lineNumber": 570
          },
          {
            "text": "                    logger.error(f\"Cannot add task: workforce not initialized for project {options.project_id}\")",
            "lineNumber": 571
          },
          {
            "text": "                    yield sse_json(\"error\", {\"message\": \"Workforce not initialized. Please start the task first.\"})",
            "lineNumber": 572
          },
          {
            "text": "                    continue",
            "lineNumber": 573
          },
          {
            "lineNumber": 574
          },
          {
            "text": "                # Add task to the workforce queue",
            "lineNumber": 575
          },
          {
            "text": "                workforce.add_task(",
            "lineNumber": 576
          },
          {
            "text": "                    item.content,",
            "lineNumber": 577
          },
          {
            "text": "                    item.task_id,",
            "lineNumber": 578
          },
          {
            "text": "                    item.additional_info",
            "lineNumber": 579
          },
          {
            "text": "                )",
            "lineNumber": 580
          },
          {
            "lineNumber": 581
          },
          {
            "text": "                returnData = {",
            "lineNumber": 582
          },
          {
            "text": "                    \"project_id\": item.project_id,",
            "lineNumber": 583
          },
          {
            "text": "                    \"task_id\": item.task_id or (len(camel_task.subtasks) + 1)",
            "lineNumber": 584
          },
          {
            "text": "                }",
            "lineNumber": 585
          },
          {
            "text": "                yield sse_json(\"add_task\", returnData)",
            "lineNumber": 586
          },
          {
            "text": "            elif item.action == Action.remove_task:",
            "lineNumber": 587
          },
          {
            "text": "                if workforce is None:",
            "lineNumber": 588
          },
          {
            "text": "                    logger.error",
            "lineNumber": 589
          }
        ]
      },
      "score": 0.2707078456878662
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 83
          },
          "endPosition": {
            "line": 654
          }
        },
        "contents": "class ListenChatAgent(ChatAgent):\n@traceroot.trace()\ndef _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:\n\n            # Prepare result message with truncation\n            if isinstance(result, str):\n                result_msg = result\n            else:\n                result_str = repr(result)\n                MAX_RESULT_LENGTH = 500\n                if len(result_str) &gt; MAX_RESULT_LENGTH:\n                    result_msg = (\n                        result_str[:MAX_RESULT_LENGTH]\n                        + f\"... (truncated, total length: {len(result_str)} chars)\"\n                    )\n                else:\n                    result_msg = result_str\n\n            # Only send deactivate event if tool is NOT wrapped by @listen_toolkit\n            if not has_listen_decorator:\n                asyncio.create_task(\n                    task_lock.put_queue(\n                        ActionDeactivateToolkitData(\n                            data={\n                                \"agent_name\": self.agent_name,\n                                \"process_task_id\": self.process_task_id,\n                                \"toolkit_name\": toolkit_name,\n                                \"method_name\": func_name,\n                                \"message\": result_msg,\n                            },\n                        )\n                    )\n                )\n        except Exception as e:\n            # Capture the error message to prevent framework crash\n            error_msg = f\"Error executing tool '{func_name}': {e!s}\"\n            result = f\"Tool execution failed: {error_msg}\"\n            mask_flag = False\n            traceroot_logger.error(\n                f\"Tool execution failed for {func_name}: {e}\", exc_info=True\n            )\n\n        return self._record_tool_calling(\n            func_name,\n            args,\n            result,\n            tool_call_id,\n            mask_output=mask_flag,\n            extra_content=tool_call_request.extra_content,\n        )\n\n    @traceroot.trace()\n    async def _aexecute_tool(\n        self, tool_call_request: ToolCallRequest\n    ) -&gt; ToolCallingRecord:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 84,
                "column": 1
              },
              "endPosition": {
                "line": 85,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 276,
                "column": 5
              },
              "endPosition": {
                "line": 277,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 277,
                "column": 5
              },
              "endPosition": {
                "line": 282,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ListenChatAgent(ChatAgent):",
            "lineNumber": 84,
            "isSignature": true
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 361
          },
          {
            "text": "def _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:",
            "lineNumber": 362
          },
          {
            "lineNumber": 418
          },
          {
            "text": "            # Prepare result message with truncation",
            "lineNumber": 419
          },
          {
            "text": "            if isinstance(result, str):",
            "lineNumber": 420
          },
          {
            "text": "                result_msg = result",
            "lineNumber": 421
          },
          {
            "text": "            else:",
            "lineNumber": 422
          },
          {
            "text": "                result_str = repr(result)",
            "lineNumber": 423
          },
          {
            "text": "                MAX_RESULT_LENGTH = 500",
            "lineNumber": 424
          },
          {
            "text": "                if len(result_str) &gt; MAX_RESULT_LENGTH:",
            "lineNumber": 425
          },
          {
            "text": "                    result_msg = (",
            "lineNumber": 426
          },
          {
            "text": "                        result_str[:MAX_RESULT_LENGTH]",
            "lineNumber": 427
          },
          {
            "text": "                        + f\"... (truncated, total length: {len(result_str)} chars)\"",
            "lineNumber": 428
          },
          {
            "text": "                    )",
            "lineNumber": 429
          },
          {
            "text": "                else:",
            "lineNumber": 430
          },
          {
            "text": "                    result_msg = result_str",
            "lineNumber": 431
          },
          {
            "lineNumber": 432
          },
          {
            "text": "            # Only send deactivate event if tool is NOT wrapped by @listen_toolkit",
            "lineNumber": 433
          },
          {
            "text": "            if not has_listen_decorator:",
            "lineNumber": 434
          },
          {
            "text": "                asyncio.create_task(",
            "lineNumber": 435
          },
          {
            "text": "                    task_lock.put_queue(",
            "lineNumber": 436
          },
          {
            "text": "                        ActionDeactivateToolkitData(",
            "lineNumber": 437
          },
          {
            "text": "                            data={",
            "lineNumber": 438
          },
          {
            "text": "                                \"agent_name\": self.agent_name,",
            "lineNumber": 439
          },
          {
            "text": "                                \"process_task_id\": self.process_task_id,",
            "lineNumber": 440
          },
          {
            "text": "                                \"toolkit_name\": toolkit_name,",
            "lineNumber": 441
          },
          {
            "text": "                                \"method_name\": func_name,",
            "lineNumber": 442
          },
          {
            "text": "                                \"message\": result_msg,",
            "lineNumber": 443
          },
          {
            "text": "                            },",
            "lineNumber": 444
          },
          {
            "text": "                        )",
            "lineNumber": 445
          },
          {
            "text": "                    )",
            "lineNumber": 446
          },
          {
            "text": "                )",
            "lineNumber": 447
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 448
          },
          {
            "text": "            # Capture the error message to prevent framework crash",
            "lineNumber": 449
          },
          {
            "text": "            error_msg = f\"Error executing tool '{func_name}': {e!s}\"",
            "lineNumber": 450
          },
          {
            "text": "            result = f\"Tool execution failed: {error_msg}\"",
            "lineNumber": 451
          },
          {
            "text": "            mask_flag = False",
            "lineNumber": 452
          },
          {
            "text": "            traceroot_logger.error(",
            "lineNumber": 453
          },
          {
            "text": "                f\"Tool execution failed for {func_name}: {e}\", exc_info=True",
            "lineNumber": 454
          },
          {
            "text": "            )",
            "lineNumber": 455
          },
          {
            "lineNumber": 456
          },
          {
            "text": "        return self._record_tool_calling(",
            "lineNumber": 457
          },
          {
            "text": "            func_name,",
            "lineNumber": 458
          },
          {
            "text": "            args,",
            "lineNumber": 459
          },
          {
            "text": "            result,",
            "lineNumber": 460
          },
          {
            "text": "            tool_call_id,",
            "lineNumber": 461
          },
          {
            "text": "            mask_output=mask_flag,",
            "lineNumber": 462
          },
          {
            "text": "            extra_content=tool_call_request.extra_content,",
            "lineNumber": 463
          },
          {
            "text": "        )",
            "lineNumber": 464
          },
          {
            "lineNumber": 465
          },
          {
            "text": "    @traceroot.trace()",
            "lineNumber": 466
          },
          {
            "text": "    async def _aexecute_tool(",
            "lineNumber": 467
          },
          {
            "text": "        self, tool_call_request: ToolCallRequest",
            "lineNumber": 468
          },
          {
            "text": "    ) -&gt; ToolCallingRecord:",
            "lineNumber": 469
          },
          {
            "text": "        ",
            "lineNumber": 470
          }
        ]
      },
      "score": 0.26786935329437256
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ChatBox\\index.tsx",
        "range": {
          "startPosition": {
            "line": 20
          },
          "endPosition": {
            "line": 1174,
            "column": 1
          }
        },
        "contents": "export default function ChatBox(): JSX.Element {\nconst handleSend = async \n else {\n          if (!privacy) {\n            const API_FIELDS = [\n              'take_screenshot',\n              'access_local_software',\n              'access_your_address',\n              'password_storage',\n            ];\n            const requestData = {\n              [API_FIELDS[0]]: true,\n              [API_FIELDS[1]]: true,\n              [API_FIELDS[2]]: true,\n              [API_FIELDS[3]]: true,\n            };\n            proxyFetchPut('/api/user/privacy', requestData);\n            setPrivacy(true);\n          }\n\n          setTimeout(() =&gt; {\n            scrollToBottom();\n          }, 200);\n\n          // For the very first message, add it to the current chatStore first, then call startTask\n          const attachesToSend =\n            JSON.parse(JSON.stringify(chatStore.tasks[_taskId]?.attaches)) ||\n            [];\n          setMessage('');\n          try {\n            await chatStore.startTask(\n              _taskId,\n              undefined,\n              undefined,\n              undefined,\n              tempMessageContent,\n              attachesToSend\n            );\n            chatStore.setHasWaitComfirm(_taskId as string, true);\n          } catch (err: any) {\n            console.error('Failed to start task:', err);\n            toast.error(\n              err?.message ||\n                'Failed to start task. Please check your model configuration.'\n            );\n            return;\n          }\n        }\n      }\n    } catch (error) {\n      console.error('error:', error);\n    }\n  };\n\n  useEffect(() =&gt; {\n    // Wait for both config and privacy to be loaded before handling share token\n    if (share_token &amp;&amp; isConfigLoaded &amp;&amp; isPrivacyLoaded) {\n      handleSendShare(share_token);\n    }\n  }, [share_token, isConfigLoaded, isPrivacyLoaded]);\n\n  useEffect(() =&gt; {\n    console.log('ChatStore Data: ', chatStore);\n  }, []);\n\n  const handleSendShare = async (token: string) =&gt;\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 21,
                "column": 1
              },
              "endPosition": {
                "line": 21,
                "column": 16
              }
            },
            {
              "startPosition": {
                "line": 21,
                "column": 16
              },
              "endPosition": {
                "line": 22,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 152,
                "column": 3
              },
              "endPosition": {
                "line": 152,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 152,
                "column": 9
              },
              "endPosition": {
                "line": 152,
                "column": 28
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export default function ChatBox(): JSX.Element {",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "const handleSend = async ",
            "lineNumber": 152
          },
          {
            "text": " else {",
            "lineNumber": 339
          },
          {
            "text": "          if (!privacy) {",
            "lineNumber": 340
          },
          {
            "text": "            const API_FIELDS = [",
            "lineNumber": 341
          },
          {
            "text": "              'take_screenshot',",
            "lineNumber": 342
          },
          {
            "text": "              'access_local_software',",
            "lineNumber": 343
          },
          {
            "text": "              'access_your_address',",
            "lineNumber": 344
          },
          {
            "text": "              'password_storage',",
            "lineNumber": 345
          },
          {
            "text": "            ];",
            "lineNumber": 346
          },
          {
            "text": "            const requestData = {",
            "lineNumber": 347
          },
          {
            "text": "              [API_FIELDS[0]]: true,",
            "lineNumber": 348
          },
          {
            "text": "              [API_FIELDS[1]]: true,",
            "lineNumber": 349
          },
          {
            "text": "              [API_FIELDS[2]]: true,",
            "lineNumber": 350
          },
          {
            "text": "              [API_FIELDS[3]]: true,",
            "lineNumber": 351
          },
          {
            "text": "            };",
            "lineNumber": 352
          },
          {
            "text": "            proxyFetchPut('/api/user/privacy', requestData);",
            "lineNumber": 353
          },
          {
            "text": "            setPrivacy(true);",
            "lineNumber": 354
          },
          {
            "text": "          }",
            "lineNumber": 355
          },
          {
            "lineNumber": 356
          },
          {
            "text": "          setTimeout(() =&gt; {",
            "lineNumber": 357
          },
          {
            "text": "            scrollToBottom();",
            "lineNumber": 358
          },
          {
            "text": "          }, 200);",
            "lineNumber": 359
          },
          {
            "lineNumber": 360
          },
          {
            "text": "          // For the very first message, add it to the current chatStore first, then call startTask",
            "lineNumber": 361
          },
          {
            "text": "          const attachesToSend =",
            "lineNumber": 362
          },
          {
            "text": "            JSON.parse(JSON.stringify(chatStore.tasks[_taskId]?.attaches)) ||",
            "lineNumber": 363
          },
          {
            "text": "            [];",
            "lineNumber": 364
          },
          {
            "text": "          setMessage('');",
            "lineNumber": 365
          },
          {
            "text": "          try {",
            "lineNumber": 366
          },
          {
            "text": "            await chatStore.startTask(",
            "lineNumber": 367
          },
          {
            "text": "              _taskId,",
            "lineNumber": 368
          },
          {
            "text": "              undefined,",
            "lineNumber": 369
          },
          {
            "text": "              undefined,",
            "lineNumber": 370
          },
          {
            "text": "              undefined,",
            "lineNumber": 371
          },
          {
            "text": "              tempMessageContent,",
            "lineNumber": 372
          },
          {
            "text": "              attachesToSend",
            "lineNumber": 373
          },
          {
            "text": "            );",
            "lineNumber": 374
          },
          {
            "text": "            chatStore.setHasWaitComfirm(_taskId as string, true);",
            "lineNumber": 375
          },
          {
            "text": "          } catch (err: any) {",
            "lineNumber": 376
          },
          {
            "text": "            console.error('Failed to start task:', err);",
            "lineNumber": 377
          },
          {
            "text": "            toast.error(",
            "lineNumber": 378
          },
          {
            "text": "              err?.message ||",
            "lineNumber": 379
          },
          {
            "text": "                'Failed to start task. Please check your model configuration.'",
            "lineNumber": 380
          },
          {
            "text": "            );",
            "lineNumber": 381
          },
          {
            "text": "            return;",
            "lineNumber": 382
          },
          {
            "text": "          }",
            "lineNumber": 383
          },
          {
            "text": "        }",
            "lineNumber": 384
          },
          {
            "text": "      }",
            "lineNumber": 385
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 386
          },
          {
            "text": "      console.error('error:', error);",
            "lineNumber": 387
          },
          {
            "text": "    }",
            "lineNumber": 388
          },
          {
            "text": "  };",
            "lineNumber": 389
          },
          {
            "lineNumber": 390
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 391
          },
          {
            "text": "    // Wait for both config and privacy to be loaded before handling share token",
            "lineNumber": 392
          },
          {
            "text": "    if (share_token &amp;&amp; isConfigLoaded &amp;&amp; isPrivacyLoaded) {",
            "lineNumber": 393
          },
          {
            "text": "      handleSendShare(share_token);",
            "lineNumber": 394
          },
          {
            "text": "    }",
            "lineNumber": 395
          },
          {
            "text": "  }, [share_token, isConfigLoaded, isPrivacyLoaded]);",
            "lineNumber": 396
          },
          {
            "lineNumber": 397
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 398
          },
          {
            "text": "    console.log('ChatStore Data: ', chatStore);",
            "lineNumber": 399
          },
          {
            "text": "  }, []);",
            "lineNumber": 400
          },
          {
            "lineNumber": 401
          },
          {
            "text": "  const handleSendShare = async (token: string) =&gt;",
            "lineNumber": 402
          },
          {
            "text": ";",
            "lineNumber": 447
          },
          {
            "text": "}",
            "lineNumber": 1175,
            "isSignature": true
          }
        ]
      },
      "score": 0.267582505941391
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\store\\chatStore.ts",
        "range": {
          "startPosition": {
            "line": 162
          },
          "endPosition": {
            "line": 2594,
            "column": 1
          }
        },
        "contents": "const chatStore = \n(set, get) =&gt; (\nasync (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {\n\nasync onmessage(event: any) {\n\n\n\t\t\t\t\t\tconst task = tasks[currentTaskId];\n\t\t\t\t\t\tlet taskTime = task.taskTime;\n\t\t\t\t\t\tlet elapsed = task.elapsed;\n\t\t\t\t\t\t// if task is running, compute current time\n\t\t\t\t\t\tif (taskTime !== 0) {\n\t\t\t\t\t\t\tconst currentTime = Date.now()\n\t\t\t\t\t\t\telapsed += currentTime - taskTime\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsetTaskTime(currentTaskId, 0);\n\t\t\t\t\t\tsetElapsed(currentTaskId, elapsed);\n\t\t\t\t\t\tconst fileList = tasks[currentTaskId].taskAssigning.map((agent) =&gt; {\n\t\t\t\t\t\t\treturn agent.tasks.map((task) =&gt; {\n\t\t\t\t\t\t\t\treturn task.fileList || []\n\t\t\t\t\t\t\t}).flat()\n\t\t\t\t\t\t}).flat()\n\t\t\t\t\t\tlet endMessage = agentMessages.data as string\n\t\t\t\t\t\tlet summary = endMessage.match(/&lt;summary&gt;(.*?)&lt;\\/summary&gt;/)?.[1]\n\t\t\t\t\t\tlet newMessage: Message | null = null\n\t\t\t\t\t\tconst agent_summary_end = tasks[currentTaskId].messages.findLast((message: Message) =&gt; message.step === 'agent_summary_end')\n\t\t\t\t\t\tconsole.log('summary', summary)\n\t\t\t\t\t\tif (summary) {\n\t\t\t\t\t\t\tendMessage = summary\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (agent_summary_end) {\n\t\t\t\t\t\t\tconsole.log('agent_summary_end', agent_summary_end)\n\t\t\t\t\t\t\tendMessage = agent_summary_end.summary || \"\"\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconsole.log('endMessage', endMessage)\n\t\t\t\t\t\tnewMessage = {\n\t\t\t\t\t\t\tid: generateUniqueId(),\n\t\t\t\t\t\t\trole: \"agent\",\n\t\t\t\t\t\t\tcontent: endMessage || \"\",\n\t\t\t\t\t\t\tstep: agentMessages.step,\n\t\t\t\t\t\t\tisConfirm: false,\n\t\t\t\t\t\t\tfileList: fileList,\n\t\t\t\t\t\t};\n\n\n\t\t\t\t\t\taddMessages(currentTaskId, newMessage);\n\n\t\t\t\t\t\tsetIsPending(currentTaskId, false);\n\t\t\t\t\t\tsetStatus(currentTaskId, 'finished');\n\t\t\t\t\t\t// completed tasks move to history\n\t\t\t\t\t\tsetUpdateCount();\n\n\t\t\t\t\t\tconsole.log(tasks[currentTaskId], 'end');\n\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (agentMessages.step === \"notice\") {\n\t\t\t\t\t\tif (agentMessages.data.process_task_id !== '')\n\t\t\t\t}\n\n\t\t}\n)\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 163,
                "column": 1
              },
              "endPosition": {
                "line": 163,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 7
              },
              "endPosition": {
                "line": 163,
                "column": 19
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 53
              },
              "endPosition": {
                "line": 163,
                "column": 53
              }
            },
            {
              "startPosition": {
                "line": 164,
                "column": 2
              },
              "endPosition": {
                "line": 164,
                "column": 17
              }
            },
            {
              "startPosition": {
                "line": 331,
                "column": 14
              },
              "endPosition": {
                "line": 332,
                "column": 4
              }
            },
            {
              "startPosition": {
                "line": 586,
                "column": 4
              },
              "endPosition": {
                "line": 586,
                "column": 4
              }
            },
            {
              "startPosition": {
                "line": 612,
                "column": 5
              },
              "endPosition": {
                "line": 613,
                "column": 6
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const chatStore = ",
            "lineNumber": 163
          },
          {
            "text": "(set, get) =&gt; (",
            "lineNumber": 164
          },
          {
            "text": "async (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {",
            "lineNumber": 331
          },
          {
            "lineNumber": 586
          },
          {
            "text": "async onmessage(event: any) {",
            "lineNumber": 612
          },
          {
            "lineNumber": 1709
          },
          {
            "lineNumber": 1710
          },
          {
            "text": "\t\t\t\t\t\tconst task = tasks[currentTaskId];",
            "lineNumber": 1711
          },
          {
            "text": "\t\t\t\t\t\tlet taskTime = task.taskTime;",
            "lineNumber": 1712
          },
          {
            "text": "\t\t\t\t\t\tlet elapsed = task.elapsed;",
            "lineNumber": 1713
          },
          {
            "text": "\t\t\t\t\t\t// if task is running, compute current time",
            "lineNumber": 1714
          },
          {
            "text": "\t\t\t\t\t\tif (taskTime !== 0) {",
            "lineNumber": 1715
          },
          {
            "text": "\t\t\t\t\t\t\tconst currentTime = Date.now()",
            "lineNumber": 1716
          },
          {
            "text": "\t\t\t\t\t\t\telapsed += currentTime - taskTime",
            "lineNumber": 1717
          },
          {
            "text": "\t\t\t\t\t\t}",
            "lineNumber": 1718
          },
          {
            "lineNumber": 1719
          },
          {
            "text": "\t\t\t\t\t\tsetTaskTime(currentTaskId, 0);",
            "lineNumber": 1720
          },
          {
            "text": "\t\t\t\t\t\tsetElapsed(currentTaskId, elapsed);",
            "lineNumber": 1721
          },
          {
            "text": "\t\t\t\t\t\tconst fileList = tasks[currentTaskId].taskAssigning.map((agent) =&gt; {",
            "lineNumber": 1722
          },
          {
            "text": "\t\t\t\t\t\t\treturn agent.tasks.map((task) =&gt; {",
            "lineNumber": 1723
          },
          {
            "text": "\t\t\t\t\t\t\t\treturn task.fileList || []",
            "lineNumber": 1724
          },
          {
            "text": "\t\t\t\t\t\t\t}).flat()",
            "lineNumber": 1725
          },
          {
            "text": "\t\t\t\t\t\t}).flat()",
            "lineNumber": 1726
          },
          {
            "text": "\t\t\t\t\t\tlet endMessage = agentMessages.data as string",
            "lineNumber": 1727
          },
          {
            "text": "\t\t\t\t\t\tlet summary = endMessage.match(/&lt;summary&gt;(.*?)&lt;\\/summary&gt;/)?.[1]",
            "lineNumber": 1728
          },
          {
            "text": "\t\t\t\t\t\tlet newMessage: Message | null = null",
            "lineNumber": 1729
          },
          {
            "text": "\t\t\t\t\t\tconst agent_summary_end = tasks[currentTaskId].messages.findLast((message: Message) =&gt; message.step === 'agent_summary_end')",
            "lineNumber": 1730
          },
          {
            "text": "\t\t\t\t\t\tconsole.log('summary', summary)",
            "lineNumber": 1731
          },
          {
            "text": "\t\t\t\t\t\tif (summary) {",
            "lineNumber": 1732
          },
          {
            "text": "\t\t\t\t\t\t\tendMessage = summary",
            "lineNumber": 1733
          },
          {
            "text": "\t\t\t\t\t\t}",
            "lineNumber": 1734
          },
          {
            "text": "\t\t\t\t\t\telse if (agent_summary_end) {",
            "lineNumber": 1735
          },
          {
            "text": "\t\t\t\t\t\t\tconsole.log('agent_summary_end', agent_summary_end)",
            "lineNumber": 1736
          },
          {
            "text": "\t\t\t\t\t\t\tendMessage = agent_summary_end.summary || \"\"",
            "lineNumber": 1737
          },
          {
            "text": "\t\t\t\t\t\t}",
            "lineNumber": 1738
          },
          {
            "lineNumber": 1739
          },
          {
            "text": "\t\t\t\t\t\tconsole.log('endMessage', endMessage)",
            "lineNumber": 1740
          },
          {
            "text": "\t\t\t\t\t\tnewMessage = {",
            "lineNumber": 1741
          },
          {
            "text": "\t\t\t\t\t\t\tid: generateUniqueId(),",
            "lineNumber": 1742
          },
          {
            "text": "\t\t\t\t\t\t\trole: \"agent\",",
            "lineNumber": 1743
          },
          {
            "text": "\t\t\t\t\t\t\tcontent: endMessage || \"\",",
            "lineNumber": 1744
          },
          {
            "text": "\t\t\t\t\t\t\tstep: agentMessages.step,",
            "lineNumber": 1745
          },
          {
            "text": "\t\t\t\t\t\t\tisConfirm: false,",
            "lineNumber": 1746
          },
          {
            "text": "\t\t\t\t\t\t\tfileList: fileList,",
            "lineNumber": 1747
          },
          {
            "text": "\t\t\t\t\t\t};",
            "lineNumber": 1748
          },
          {
            "lineNumber": 1749
          },
          {
            "lineNumber": 1750
          },
          {
            "text": "\t\t\t\t\t\taddMessages(currentTaskId, newMessage);",
            "lineNumber": 1751
          },
          {
            "lineNumber": 1752
          },
          {
            "text": "\t\t\t\t\t\tsetIsPending(currentTaskId, false);",
            "lineNumber": 1753
          },
          {
            "text": "\t\t\t\t\t\tsetStatus(currentTaskId, 'finished');",
            "lineNumber": 1754
          },
          {
            "text": "\t\t\t\t\t\t// completed tasks move to history",
            "lineNumber": 1755
          },
          {
            "text": "\t\t\t\t\t\tsetUpdateCount();",
            "lineNumber": 1756
          },
          {
            "lineNumber": 1757
          },
          {
            "text": "\t\t\t\t\t\tconsole.log(tasks[currentTaskId], 'end');",
            "lineNumber": 1758
          },
          {
            "lineNumber": 1759
          },
          {
            "lineNumber": 1760
          },
          {
            "text": "\t\t\t\t\t\treturn;",
            "lineNumber": 1761
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 1762
          },
          {
            "text": "\t\t\t\t\tif (agentMessages.step === \"notice\") {",
            "lineNumber": 1763
          },
          {
            "text": "\t\t\t\t\t\tif (agentMessages.data.process_task_id !== '')",
            "lineNumber": 1764
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 1836
          },
          {
            "lineNumber": 1886
          },
          {
            "text": "\t\t}",
            "lineNumber": 1888
          },
          {
            "text": ")",
            "lineNumber": 2594
          },
          {
            "text": ";",
            "lineNumber": 2595
          }
        ]
      },
      "score": 0.2643871307373047
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 236
          },
          "endPosition": {
            "line": 1075
          }
        },
        "contents": "@sync_step\n@traceroot.trace()\nasync def step_solve(options: Chat, request: Request, task_lock: TaskLock):\n    # if True:\n    #     import faulthandler\n\n    #     faulthandler.enable()\n    #     for second in [5, 10, 20, 30, 60, 120, 240]:\n    #         faulthandler.dump_traceback_later(second)\n\n\n                        def on_stream_text(chunk):\n                            try:\n                                # With task_agent using stream_accumulate=True, chunk.msg.content is accumulated content\n                                # We need to calculate the delta to send only new content to frontend\n                                accumulated_content = chunk.msg.content if hasattr(chunk, 'msg') and chunk.msg else str(chunk)\n                                last_content = stream_state[\"last_content\"]\n\n                                if accumulated_content.startswith(last_content):\n                                    delta_content = accumulated_content[len(last_content):]\n                                else:\n                                    delta_content = accumulated_content\n\n                                stream_state[\"last_content\"] = accumulated_content\n\n                                if delta_content:\n                                    asyncio.run_coroutine_threadsafe(\n                                        task_lock.put_queue(\n                                            ActionDecomposeTextData(\n                                                data={\n                                                    \"project_id\": options.project_id,\n                                                    \"task_id\": options.task_id,\n                                                    \"content\": delta_content,\n                                                }\n                                            )\n                                        ),\n                                        event_loop,\n                                    )\n                            except Exception as e:\n                                logger.warning(f\"Failed to stream decomposition text: {e}\")\n                        new_sub_tasks = await workforce.handle_decompose_append_task(\n                            camel_task",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 237,
                "column": 1
              },
              "endPosition": {
                "line": 239,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 239,
                "column": 1
              },
              "endPosition": {
                "line": 247,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@sync_step",
            "lineNumber": 237
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 238
          },
          {
            "text": "async def step_solve(options: Chat, request: Request, task_lock: TaskLock):",
            "lineNumber": 239,
            "isSignature": true
          },
          {
            "text": "    # if True:",
            "lineNumber": 240,
            "isSignature": true
          },
          {
            "text": "    #     import faulthandler",
            "lineNumber": 241,
            "isSignature": true
          },
          {
            "lineNumber": 242,
            "isSignature": true
          },
          {
            "text": "    #     faulthandler.enable()",
            "lineNumber": 243,
            "isSignature": true
          },
          {
            "text": "    #     for second in [5, 10, 20, 30, 60, 120, 240]:",
            "lineNumber": 244,
            "isSignature": true
          },
          {
            "text": "    #         faulthandler.dump_traceback_later(second)",
            "lineNumber": 245,
            "isSignature": true
          },
          {
            "lineNumber": 791
          },
          {
            "lineNumber": 792
          },
          {
            "text": "                        def on_stream_text(chunk):",
            "lineNumber": 793
          },
          {
            "text": "                            try:",
            "lineNumber": 794
          },
          {
            "text": "                                # With task_agent using stream_accumulate=True, chunk.msg.content is accumulated content",
            "lineNumber": 795
          },
          {
            "text": "                                # We need to calculate the delta to send only new content to frontend",
            "lineNumber": 796
          },
          {
            "text": "                                accumulated_content = chunk.msg.content if hasattr(chunk, 'msg') and chunk.msg else str(chunk)",
            "lineNumber": 797
          },
          {
            "text": "                                last_content = stream_state[\"last_content\"]",
            "lineNumber": 798
          },
          {
            "lineNumber": 799
          },
          {
            "text": "                                if accumulated_content.startswith(last_content):",
            "lineNumber": 800
          },
          {
            "text": "                                    delta_content = accumulated_content[len(last_content):]",
            "lineNumber": 801
          },
          {
            "text": "                                else:",
            "lineNumber": 802
          },
          {
            "text": "                                    delta_content = accumulated_content",
            "lineNumber": 803
          },
          {
            "lineNumber": 804
          },
          {
            "text": "                                stream_state[\"last_content\"] = accumulated_content",
            "lineNumber": 805
          },
          {
            "lineNumber": 806
          },
          {
            "text": "                                if delta_content:",
            "lineNumber": 807
          },
          {
            "text": "                                    asyncio.run_coroutine_threadsafe(",
            "lineNumber": 808
          },
          {
            "text": "                                        task_lock.put_queue(",
            "lineNumber": 809
          },
          {
            "text": "                                            ActionDecomposeTextData(",
            "lineNumber": 810
          },
          {
            "text": "                                                data={",
            "lineNumber": 811
          },
          {
            "text": "                                                    \"project_id\": options.project_id,",
            "lineNumber": 812
          },
          {
            "text": "                                                    \"task_id\": options.task_id,",
            "lineNumber": 813
          },
          {
            "text": "                                                    \"content\": delta_content,",
            "lineNumber": 814
          },
          {
            "text": "                                                }",
            "lineNumber": 815
          },
          {
            "text": "                                            )",
            "lineNumber": 816
          },
          {
            "text": "                                        ),",
            "lineNumber": 817
          },
          {
            "text": "                                        event_loop,",
            "lineNumber": 818
          },
          {
            "text": "                                    )",
            "lineNumber": 819
          },
          {
            "text": "                            except Exception as e:",
            "lineNumber": 820
          },
          {
            "text": "                                logger.warning(f\"Failed to stream decomposition text: {e}\")",
            "lineNumber": 821
          },
          {
            "text": "                        new_sub_tasks = await workforce.handle_decompose_append_task(",
            "lineNumber": 822
          },
          {
            "text": "                            camel_task",
            "lineNumber": 823
          }
        ]
      },
      "score": 0.26435768604278564
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\ref\\BACKEND_API.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 88
          }
        },
        "contents": "# 嵌入式後端 API 參考\n\n&gt; 本文件說明 Eigent 嵌入式後端（&#96;backend/&#96;）的 API 端點、請求格式與回應結構。\n\n## API 概述\n\n**嵌入式後端**（Embedded Backend）是 Eigent 的多智能體任務執行引擎，由 Electron 自動啟動。\n\n| 項目 | 說明 |\n|-----|------|\n| **位置** | &#96;backend/&#96; |\n| **啟動方式** | 由 Electron 自動啟動（動態埠，預設從 5001 起） |\n| **認證方式** | 無（本地通訊，透過 Electron IPC 取得埠號） |\n| **主要功能** | 多智能體任務執行、CAMEL Workforce 協調 |\n| **運行模式** | Cloud-Connected 和 Local Deployment 兩種模式下都會運行 |\n\n**相關文件**：\n- [Local Server 和 Cloud Service API](./SERVER_API.md) - 用戶管理、設定管理、資料持久化\n- [專案架構總覽](./ARCHITECTURE.md)\n\n---\n\n## 聊天/任務 API\n\n### POST /chat\n\n啟動新任務（SSE 串流）。\n\n**請求**：\n&#96;&#96;&#96;json\n{\n  \"project_id\": \"proj_123\",\n  \"task_id\": \"task_456\",\n  \"question\": \"幫我寫一個 Python 爬蟲\",\n  \"model_platform\": \"openai\",\n  \"model_type\": \"gpt-4.1\",\n  \"api_key\": \"sk-xxx\",\n  \"email\": \"user@example.com\",\n  \"language\": \"zh-cn\",\n  \"browser_port\": 9222\n}\n&#96;&#96;&#96;\n\n**回應 (SSE)**：\n&#96;&#96;&#96;\nevent: message\ndata: {\"step\": \"to_sub_tasks\", \"data\": {\"sub_tasks\": [...]}}\n\nevent: message\ndata: {\"step\": \"create_agent\", \"data\": {\"agent_name\": \"developer_agent\"}}\n\nevent: message\ndata: {\"step\": \"assign_task\", \"data\": {\"task_id\": \"sub_1\", \"assignee_id\": \"agent_1\"}}\n\nevent: message\ndata: {\"step\": \"activate_toolkit\", \"data\": {\"toolkit_name\": \"Terminal\", \"method_name\": \"run\"}}\n\nevent: message\ndata: {\"step\": \"task_state\", \"data\": {\"task_id\": \"sub_1\", \"state\": \"DONE\"}}\n\nevent: message\ndata: {\"step\": \"end\", \"data\": {\"summary\": \"任務完成\"}}\n&#96;&#96;&#96;\n\n---\n\n### POST /chat/{id}\n\n改進/追問任務（保留上下文）。\n\n**請求**：\n&#96;&#96;&#96;json\n{\n  \"question\": \"請修改一下輸出格式\",\n  \"project_id\": \"proj_123\"\n}\n&#96;&#96;&#96;\n\n---\n\n### DELETE /chat/{id}\n\n強制停止任務。\n\n---\n\n### POST /chat/{id}/human-reply",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# 嵌入式後端 API 參考",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "&gt; 本文件說明 Eigent 嵌入式後端（&#96;backend/&#96;）的 API 端點、請求格式與回應結構。",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## API 概述",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "**嵌入式後端**（Embedded Backend）是 Eigent 的多智能體任務執行引擎，由 Electron 自動啟動。",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "| 項目 | 說明 |",
            "lineNumber": 9
          },
          {
            "text": "|-----|------|",
            "lineNumber": 10
          },
          {
            "text": "| **位置** | &#96;backend/&#96; |",
            "lineNumber": 11
          },
          {
            "text": "| **啟動方式** | 由 Electron 自動啟動（動態埠，預設從 5001 起） |",
            "lineNumber": 12
          },
          {
            "text": "| **認證方式** | 無（本地通訊，透過 Electron IPC 取得埠號） |",
            "lineNumber": 13
          },
          {
            "text": "| **主要功能** | 多智能體任務執行、CAMEL Workforce 協調 |",
            "lineNumber": 14
          },
          {
            "text": "| **運行模式** | Cloud-Connected 和 Local Deployment 兩種模式下都會運行 |",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "**相關文件**：",
            "lineNumber": 17
          },
          {
            "text": "- [Local Server 和 Cloud Service API](./SERVER_API.md) - 用戶管理、設定管理、資料持久化",
            "lineNumber": 18
          },
          {
            "text": "- [專案架構總覽](./ARCHITECTURE.md)",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "---",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "## 聊天/任務 API",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "### POST /chat",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "啟動新任務（SSE 串流）。",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "**請求**：",
            "lineNumber": 29
          },
          {
            "text": "&#96;&#96;&#96;json",
            "lineNumber": 30
          },
          {
            "text": "{",
            "lineNumber": 31
          },
          {
            "text": "  \"project_id\": \"proj_123\",",
            "lineNumber": 32
          },
          {
            "text": "  \"task_id\": \"task_456\",",
            "lineNumber": 33
          },
          {
            "text": "  \"question\": \"幫我寫一個 Python 爬蟲\",",
            "lineNumber": 34
          },
          {
            "text": "  \"model_platform\": \"openai\",",
            "lineNumber": 35
          },
          {
            "text": "  \"model_type\": \"gpt-4.1\",",
            "lineNumber": 36
          },
          {
            "text": "  \"api_key\": \"sk-xxx\",",
            "lineNumber": 37
          },
          {
            "text": "  \"email\": \"user@example.com\",",
            "lineNumber": 38
          },
          {
            "text": "  \"language\": \"zh-cn\",",
            "lineNumber": 39
          },
          {
            "text": "  \"browser_port\": 9222",
            "lineNumber": 40
          },
          {
            "text": "}",
            "lineNumber": 41
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "**回應 (SSE)**：",
            "lineNumber": 44
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 45
          },
          {
            "text": "event: message",
            "lineNumber": 46
          },
          {
            "text": "data: {\"step\": \"to_sub_tasks\", \"data\": {\"sub_tasks\": [...]}}",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "event: message",
            "lineNumber": 49
          },
          {
            "text": "data: {\"step\": \"create_agent\", \"data\": {\"agent_name\": \"developer_agent\"}}",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "event: message",
            "lineNumber": 52
          },
          {
            "text": "data: {\"step\": \"assign_task\", \"data\": {\"task_id\": \"sub_1\", \"assignee_id\": \"agent_1\"}}",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "event: message",
            "lineNumber": 55
          },
          {
            "text": "data: {\"step\": \"activate_toolkit\", \"data\": {\"toolkit_name\": \"Terminal\", \"method_name\": \"run\"}}",
            "lineNumber": 56
          },
          {
            "lineNumber": 57
          },
          {
            "text": "event: message",
            "lineNumber": 58
          },
          {
            "text": "data: {\"step\": \"task_state\", \"data\": {\"task_id\": \"sub_1\", \"state\": \"DONE\"}}",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "event: message",
            "lineNumber": 61
          },
          {
            "text": "data: {\"step\": \"end\", \"data\": {\"summary\": \"任務完成\"}}",
            "lineNumber": 62
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "---",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "### POST /chat/{id}",
            "lineNumber": 67
          },
          {
            "lineNumber": 68
          },
          {
            "text": "改進/追問任務（保留上下文）。",
            "lineNumber": 69
          },
          {
            "lineNumber": 70
          },
          {
            "text": "**請求**：",
            "lineNumber": 71
          },
          {
            "text": "&#96;&#96;&#96;json",
            "lineNumber": 72
          },
          {
            "text": "{",
            "lineNumber": 73
          },
          {
            "text": "  \"question\": \"請修改一下輸出格式\",",
            "lineNumber": 74
          },
          {
            "text": "  \"project_id\": \"proj_123\"",
            "lineNumber": 75
          },
          {
            "text": "}",
            "lineNumber": 76
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 77
          },
          {
            "lineNumber": 78
          },
          {
            "text": "---",
            "lineNumber": 79
          },
          {
            "lineNumber": 80
          },
          {
            "text": "### DELETE /chat/{id}",
            "lineNumber": 81
          },
          {
            "lineNumber": 82
          },
          {
            "text": "強制停止任務。",
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "---",
            "lineNumber": 85
          },
          {
            "lineNumber": 86
          },
          {
            "text": "### POST /chat/{id}/human-reply",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.26100778579711914
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "slack",
  "caseInsensitive": true
}
```
Result:

```json
{
  "success": {
    "pattern": "slack",
    "outputMode": "content",
    "workspaceResults": {
      "d:\\_Code\\_GitHub\\eigent-260119": {
        "content": {
          "matches": [
            {
              "file": ".\\.specstory\\history\\2026-01-19_09-45Z-文件內容疑問.md",
              "matches": [
                {
                  "lineNumber": 10354,
                  "content": "        \"contents\": \"@traceroot.trace()\\nasync def developer_agent(options: Chat):\\n,\\n    ]\\n    system_message = f\\\"\\\"\\\"\\n&amp;lt;role&amp;gt;\\nYou are a Lead Software Engineer, a master-level coding assistant with a\\npowerful and unrestricted terminal. Your primary role is to solve any\\ntechnical task by writing and executing code, installing necessary libraries,\\ninteracting with the operating system, and deploying applications. You are the\\nteam's go-to expert for all technical implementation.\\n&amp;lt;/role&amp;gt;\\n\\n&amp;lt;team_structure&amp;gt;\\nYou collaborate with the following agents who can work in parallel:\\n- **Senior Research Analyst**: Gathers information from the web to support\\nyour development tasks.\\n- **Documentation Specialist**: Creates and manages technical and user-facing\\ndocuments.\\n- **Creative Content Specialist**: Handles image, audio, and video processing\\nand generation.\\n&amp;lt;/team_structure&amp;gt;\\n\\n&amp;lt;operating_environment&amp;gt;\\n- **System**: {platform.system()} ({platform.ma [... omitted end of long line]"
                },
                {
                  "lineNumber": 10785,
                  "content": "            \"text\": \"    - Example (open Slack):\","
                },
                {
                  "lineNumber": 10789,
                  "content": "            \"text\": \"      &amp;#96;osascript -e 'tell application \\\"Slack\\\" to activate'&amp;#96;\","
                },
                {
                  "lineNumber": 16351,
                  "content": "        \"contents\": \"@traceroot.trace()\\nasync def developer_agent(options: Chat):\\n{NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.\\n&amp;lt;/operating_environment&amp;gt;\\n\\n&amp;lt;mandatory_instructions&amp;gt;\\n- You MUST use the &amp;#96;read_note&amp;#96; tool to read the ALL notes from other agents.\\n\\nYou SHOULD keep the user informed by providing message_title and message_description\\n    parameters when calling tools. These optional parameters are available on all tools\\n    and will automatically notify the user of your progress.\\n\\n- When you complete your task, your final response must be a comprehensive\\nsummary of your work and the outcome, presented in a clear, detailed, and\\neasy-to-read format. Avoid using markdown tables for presenting data; use\\nplain text formatting instead.\\n&amp;lt;/mandatory_instructions&amp;gt;\\n\\n&amp;lt;capabilities&amp;gt;\\nYour capabilities are extensive and powerful:\\n- **Unrestricted Code Execution**: You can write and execute [... omitted end of long line]"
                },
                {
                  "lineNumber": 16684,
                  "content": "            \"text\": \"    - Example (open Slack):\","
                },
                {
                  "lineNumber": 16688,
                  "content": "            \"text\": \"      &amp;#96;osascript -e 'tell application \\\"Slack\\\" to activate'&amp;#96;\","
                },
                {
                  "lineNumber": 18372,
                  "content": "                  \"content\": \"        \\\"contents\\\": \\\"import { useNavigate } from \\\\\\\"react-router-dom\\\\\\\";\\\\nimport { hasStackKeys } from \\\\\\\"../lib\\\\\\\";\\\\n\\\\nconst hasSlackKeys = hasStackKeys();\\\\n\\\\nexport const stackClientApp = hasSlackKeys ? new StackClientApp({\\\\n\\\\tprojectId: import.meta.env.VITE_STACK_PROJECT_ID,\\\\n\\\\tpublishableClientKey: import.meta.env.VITE_STACK_PUBLISHABLE_CLIENT_KEY,\\\\n\\\\ttokenStore: \\\\\\\"cookie\\\\\\\",\\\\n\\\\tredirectMethod: {\\\\n\\\\t\\\\tuseNavigate,\\\\n\\\\t},\\\\n\\\\turls: {\\\\n\\\\t\\\\toauthCallback: (import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL) + \\\\\\\"/api/redirect/callback\\\\\\\",\\\\n\\\\t},\\\\n}) : null;\\\",\""
                },
                {
                  "lineNumber": 18852,
                  "content": "                  \"content\": \"        \\\"contents\\\": \\\"import { useNavigate } from \\\\\\\"react-router-dom\\\\\\\";\\\\nimport { hasStackKeys } from \\\\\\\"../lib\\\\\\\";\\\\n\\\\nconst hasSlackKeys = hasStackKeys();\\\\n\\\\nexport const stackClientApp = hasSlackKeys ? new StackClientApp({\\\\n\\\\tprojectId: import.meta.env.VITE_STACK_PROJECT_ID,\\\\n\\\\tpublishableClientKey: import.meta.env.VITE_STACK_PUBLISHABLE_CLIENT_KEY,\\\\n\\\\ttokenStore: \\\\\\\"cookie\\\\\\\",\\\\n\\\\tredirectMethod: {\\\\n\\\\t\\\\tuseNavigate,\\\\n\\\\t},\\\\n\\\\turls: {\\\\n\\\\t\\\\toauthCallback: (import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL) + \\\\\\\"/api/redirect/callback\\\\\\\",\\\\n\\\\t},\\\\n}) : null;\\\",\""
                },
                {
                  "lineNumber": 49967,
                  "content": "              \"file\": \"backend\\\\app\\\\utils\\\\toolkit\\\\slack_toolkit.py\","
                },
                {
                  "lineNumber": 49975,
                  "content": "                  \"content\": \"logger = traceroot.get_logger(\\\"slack_toolkit\\\")\""
                }
              ]
            },
            {
              "file": ".\\.specstory\\history\\2026-01-19_09-07Z-esbuild-45-377-reference.md",
              "matches": [
                {
                  "lineNumber": 10409,
                  "content": "        \"contents\": \"import { useNavigate } from \\\"react-router-dom\\\";\\nimport { hasStackKeys } from \\\"../lib\\\";\\n\\nconst hasSlackKeys = hasStackKeys();\\n\\nexport const stackClientApp = hasSlackKeys ? new StackClientApp({\\n\\tprojectId: import.meta.env.VITE_STACK_PROJECT_ID,\\n\\tpublishableClientKey: import.meta.env.VITE_STACK_PUBLISHABLE_CLIENT_KEY,\\n\\ttokenStore: \\\"cookie\\\",\\n\\tredirectMethod: {\\n\\t\\tuseNavigate,\\n\\t},\\n\\turls: {\\n\\t\\toauthCallback: (import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL) + \\\"/api/redirect/callback\\\",\\n\\t},\\n}) : null;\","
                },
                {
                  "lineNumber": 10424,
                  "content": "            \"text\": \"const hasSlackKeys = hasStackKeys();\","
                },
                {
                  "lineNumber": 10431,
                  "content": "            \"text\": \"export const stackClientApp = hasSlackKeys ? new StackClientApp({\","
                },
                {
                  "lineNumber": 16235,
                  "content": "        \"contents\": \"import { useNavigate } from \\\"react-router-dom\\\";\\nimport { hasStackKeys } from \\\"../lib\\\";\\n\\nconst hasSlackKeys = hasStackKeys();\\n\\nexport const stackClientApp = hasSlackKeys ? new StackClientApp({\\n\\tprojectId: import.meta.env.VITE_STACK_PROJECT_ID,\\n\\tpublishableClientKey: import.meta.env.VITE_STACK_PUBLISHABLE_CLIENT_KEY,\\n\\ttokenStore: \\\"cookie\\\",\\n\\tredirectMethod: {\\n\\t\\tuseNavigate,\\n\\t},\\n\\turls: {\\n\\t\\toauthCallback: (import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL) + \\\"/api/redirect/callback\\\",\\n\\t},\\n}) : null;\","
                },
                {
                  "lineNumber": 16250,
                  "content": "            \"text\": \"const hasSlackKeys = hasStackKeys();\","
                },
                {
                  "lineNumber": 16257,
                  "content": "            \"text\": \"export const stackClientApp = hasSlackKeys ? new StackClientApp({\","
                }
              ]
            },
            {
              "file": ".\\.specstory\\history\\2026-01-19_07-20Z-本機登入導向問題.md",
              "matches": [
                {
                  "lineNumber": 177,
                  "content": "| &#96;.\\backend\\app\\utils\\toolkit\\slack_toolkit.py&#96; |"
                }
              ]
            },
            {
              "file": ".\\src\\stack\\client.ts",
              "matches": [
                {
                  "lineNumber": 5,
                  "content": "const hasSlackKeys = hasStackKeys();"
                },
                {
                  "lineNumber": 7,
                  "content": "export const stackClientApp = hasSlackKeys ? new StackClientApp({"
                }
              ]
            },
            {
              "file": ".\\src\\hooks\\useIntegrationManagement.ts",
              "matches": [
                {
                  "lineNumber": 154,
                  "content": "\t\t\t\tif (provider === \"slack\") {"
                },
                {
                  "lineNumber": 169,
                  "content": "\t\t\t\t\t\t\t\"Slack authorization successful and configuration saved!\""
                },
                {
                  "lineNumber": 173,
                  "content": "\t\t\t\t\t\t\t\"Slack authorization successful, but access_token not found or env configuration not found\""
                }
              ]
            },
            {
              "file": ".\\src\\components\\IntegrationList\\index.tsx",
              "matches": [
                {
                  "lineNumber": 242,
                  "content": "\t\t\"Slack\","
                }
              ]
            },
            {
              "file": ".\\server\\app\\type\\config_group.py",
              "matches": [
                {
                  "lineNumber": 9,
                  "content": "    SLACK = \"Slack\""
                }
              ]
            },
            {
              "file": ".\\server\\app\\model\\config\\config.py",
              "matches": [
                {
                  "lineNumber": 42,
                  "content": "        ConfigGroup.SLACK.value: {"
                },
                {
                  "lineNumber": 43,
                  "content": "            \"env_vars\": [\"SLACK_BOT_TOKEN\"],"
                },
                {
                  "lineNumber": 44,
                  "content": "            \"toolkit\": \"slack_toolkit\","
                }
              ]
            },
            {
              "file": ".\\server\\app\\component\\oauth_adapter.py",
              "matches": [
                {
                  "lineNumber": 21,
                  "content": "class SlackOAuthAdapter(OAuthAdapter):"
                },
                {
                  "lineNumber": 23,
                  "content": "        self.client_id = env(\"SLACK_CLIENT_ID\", \"your_client_id\")"
                },
                {
                  "lineNumber": 24,
                  "content": "        self.client_secret = env(\"SLACK_CLIENT_SECRET\", \"your_client_secret\")"
                },
                {
                  "lineNumber": 25,
                  "content": "        self.redirect_uri = redirect_uri or env(\"SLACK_REDIRECT_URI\", \"https://localhost/api/oauth/slack/callback\")"
                },
                {
                  "lineNumber": 26,
                  "content": "        self.scope = env(\"SLACK_SCOPE\", \"chat:write,channels:read,channels:join,groups:read,im:write\")"
                },
                {
                  "lineNumber": 30,
                  "content": "            f\"https://slack.com/oauth/v2/authorize?client_id={self.client_id}\""
                },
                {
                  "lineNumber": 41,
                  "content": "        token_url = \"https://slack.com/api/oauth.v2.access\""
                },
                {
                  "lineNumber": 182,
                  "content": "    \"slack\": SlackOAuthAdapter,"
                },
                {
                  "lineNumber": 194,
                  "content": "    if app_name.lower() == \"slack\":"
                }
              ]
            },
            {
              "file": ".\\docs\\get_started\\quick_start.md",
              "matches": [
                {
                  "lineNumber": 188,
                  "content": "MCPs are the **tools** that give your agents their skills. We've pre-configured popular tools like Slack, Notion, Google Calendar, GitHub, and more in **MCP Market**, which you can install for your agents with a single click."
                }
              ]
            },
            {
              "file": ".\\backend\\uv.lock",
              "matches": [
                {
                  "lineNumber": 390,
                  "content": "    { name = \"slack-sdk\" },"
                },
                {
                  "lineNumber": 2428,
                  "content": "name = \"slack-sdk\""
                },
                {
                  "lineNumber": 2431,
                  "content": "sdist = { url = \"https://files.pythonhosted.org/packages/b6/dd/645f3eb93fce38eadbb649e85684730b1fc3906c2674ca59bddc2ca2bd2e/slack_sdk-3.39.0.tar.gz\", hash = \"sha256:6a56be10dc155c436ff658c6b776e1c082e29eae6a771fccf8b0a235822bbcb1\", size = 247207, upload-time = \"2025-11-20T15:27:57.556Z\" }"
                },
                {
                  "lineNumber": 2433,
                  "content": "    { url = \"https://files.pythonhosted.org/packages/ef/1f/32bcf088e535c1870b1a1f2e3b916129c66fdfe565a793316317241d41e5/slack_sdk-3.39.0-py2.py3-none-any.whl\", hash = \"sha256:b1556b2f5b8b12b94e5ea3f56c4f2c7f04462e4e1013d325c5764ff118044fa8\", size = 309850, upload-time = \"2025-11-20T15:27:55.729Z\" },"
                }
              ]
            },
            {
              "file": ".\\backend\\tests\\unit\\service\\test_chat_service.py",
              "matches": [
                {
                  "lineNumber": 517,
                  "content": "            mcp_tools={\"mcpServers\": {\"notion\": {}, \"slack\": {}}},"
                },
                {
                  "lineNumber": 526,
                  "content": "        assert \"Slack\" in result"
                }
              ]
            },
            {
              "file": ".\\backend\\app\\utils\\toolkit\\slack_toolkit.py",
              "matches": [
                {
                  "lineNumber": 1,
                  "content": "from camel.toolkits import SlackToolkit as BaseSlackToolkit"
                },
                {
                  "lineNumber": 9,
                  "content": "logger = traceroot.get_logger(\"slack_toolkit\")"
                },
                {
                  "lineNumber": 12,
                  "content": "@auto_listen_toolkit(BaseSlackToolkit)"
                },
                {
                  "lineNumber": 13,
                  "content": "class SlackToolkit(BaseSlackToolkit, AbstractToolkit):"
                },
                {
                  "lineNumber": 22,
                  "content": "        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")"
                },
                {
                  "lineNumber": 23,
                  "content": "        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):"
                },
                {
                  "lineNumber": 24,
                  "content": "            return SlackToolkit(api_task_id).get_tools()"
                }
              ]
            },
            {
              "file": ".\\backend\\app\\utils\\agent.py",
              "matches": [
                {
                  "lineNumber": 58,
                  "content": "from app.utils.toolkit.slack_toolkit import SlackToolkit"
                },
                {
                  "lineNumber": 916,
                  "content": "    - Example (open Slack):"
                },
                {
                  "lineNumber": 917,
                  "content": "      &#96;osascript -e 'tell application \"Slack\" to activate'&#96;"
                },
                {
                  "lineNumber": 1589,
                  "content": "    include toolkits: WhatsApp, Twitter, LinkedIn, Reddit, Notion, Slack, Discord and Google Suite."
                },
                {
                  "lineNumber": 1601,
                  "content": "        # *SlackToolkit.get_can_use_tools(options.project_id),"
                },
                {
                  "lineNumber": 1666,
                  "content": "6. Slack Workspace Interaction (SlackToolkit):"
                },
                {
                  "lineNumber": 1667,
                  "content": "   - Create new Slack channels (public or private)."
                },
                {
                  "lineNumber": 1811,
                  "content": "        \"slack_toolkit\": SlackToolkit,"
                }
              ]
            },
            {
              "file": ".\\backend\\app\\service\\chat_service.py",
              "matches": [
                {
                  "lineNumber": 1416,
                  "content": "    #     \"Notion, Slack, and other social platforms.\","
                }
              ]
            },
            {
              "file": ".\\README_PT-BR.md",
              "matches": [
                {
                  "lineNumber": 169,
                  "content": "O Eigent vem com ferramentas massivas integradas do **Protocolo de Contexto de Modelo (MCP)** (para navegação web, execução de código, Notion, Google suite, Slack etc.), e também permite que você **instale suas próprias ferramentas**. Equipe os agentes com exatamente as ferramentas certas para seus cenários – até mesmo integre APIs internas ou funções personalizadas – para aprimorar suas capacidades."
                },
                {
                  "lineNumber": 191,
                  "content": "### 1. Itinerário de Viagem de Tênis em Palm Springs com Resumo no Slack [Replay ▶️](https://www.eigent.ai/download?share_token=IjE3NTM0MzUxNTEzMzctNzExMyI.aIeysw.MUeG6ZcBxI1GqvPDvn4dcv-CDWw__1753435151337-7113)"
                },
                {
                  "lineNumber": 197,
                  "content": "Somos dois fãs de tênis e queremos ir ver o torneio de tênis em Palm Springs 2026. Eu moro em SF - por favor, prepare um itinerário detalhado com voos, hotéis, coisas para fazer por 3 dias - na época em que as semifinais/finais estão acontecendo. Gostamos de trilhas, comida vegana e spas. Nosso orçamento é de $5K. O itinerário deve ser uma linha do tempo detalhada de horário, atividade, custo, outros detalhes e, se aplicável, um link para comprar ingressos/fazer reservas etc. para o item. Algumas preferências. Acesso a spa seria bom, mas não necessário. Quando você terminar esta tarefa, por favor gere um relatório html sobre esta viagem; escreva um resumo deste plano e envie o resumo de texto e o link do relatório html para o canal slack #tennis-trip-sf. "
                },
                {
                  "lineNumber": 217,
                  "content": "Analise a indústria de saúde do Reino Unido para apoiar o planejamento da minha próxima empresa. Forneça uma visão geral abrangente do mercado, incluindo tendências atuais, projeções de crescimento e regulamentações relevantes. Identifique as 5–10 principais oportunidades, lacunas ou segmentos mal atendidos dentro do mercado. Apresente todas as descobertas em um relatório HTML bem estruturado e profissional. Em seguida, envie uma mensagem para o canal slack #eigentr-product-test quando esta tarefa estiver concluída para alinhar o conteúdo do relatório com meus colegas de equipe. "
                }
              ]
            },
            {
              "file": ".\\README_CN.md",
              "matches": [
                {
                  "lineNumber": 163,
                  "content": "Eigent 内置大量 **模型上下文协议（MCP）** 工具（用于网页浏览、代码执行、Notion、Google 套件、Slack 等），并允许您 **安装自己的工具**。为智能体配备适合您场景的工具——甚至集成内部 API 或自定义功能——以增强其能力。"
                },
                {
                  "lineNumber": 185,
                  "content": "### 1. 棕榈泉网球旅行行程与 Slack 摘要 [回放 ▶️](https://www.eigent.ai/download?share_token=IjE3NTM0MzUxNTEzMzctNzExMyI.aIeysw.MUeG6ZcBxI1GqvPDvn4dcv-CDWw__1753435151337-7113)"
                },
                {
                  "lineNumber": 190,
                  "content": "我们是两个网球爱好者，想去观看 2026 年棕榈泉的网球比赛。我住在旧金山——请准备一个详细的行程，包括航班、酒店、为期 3 天的活动安排——围绕半决赛/决赛的时间。我们喜欢徒步、素食和 Spa。预算为 5,000 美元。行程应是一个详细的时间表，包括时间、活动、费用、其他细节，以及购买门票/预订的链接（如适用）。完成后，请生成一份关于此次旅行的 HTML 报告；编写此计划的摘要，并将文本摘要和报告 HTML 链接发送到 Slack #tennis-trip-sf 频道。"
                },
                {
                  "lineNumber": 210,
                  "content": "分析英国医疗保健行业以支持我下一家公司的规划。提供全面的市场概览，包括当前趋势、增长预测和相关法规。识别市场中5-10个主要机会、缺口或服务不足的细分领域。将所有发现整理成结构清晰、专业的HTML报告。完成后，向Slack的#eigentr-product-test频道发送消息，以便与团队成员对齐报告内容。。"
                }
              ]
            },
            {
              "file": ".\\README.md",
              "matches": [
                {
                  "lineNumber": 170,
                  "content": "Eigent comes with massive built-in **Model Context Protocol (MCP)** tools (for web browsing, code execution, Notion, Google suite, Slack etc.), and also lets you **install your own tools**. Equip agents with exactly the right tools for your scenarios – even integrate internal APIs or custom functions – to enhance their capabilities."
                },
                {
                  "lineNumber": 192,
                  "content": "### 1. Palm Springs Tennis Trip Itinerary with Slack Summary [Replay ▶️](https://www.eigent.ai/download?share_token=IjE3NTM0MzUxNTEzMzctNzExMyI.aIeysw.MUeG6ZcBxI1GqvPDvn4dcv-CDWw__1753435151337-7113)"
                },
                {
                  "lineNumber": 197,
                  "content": "We are two tennis fans and want to go see the tennis tournament in Palm Springs 2026. I live in SF - please prepare a detailed itinerary with flights, hotels, things to do for 3 days - around the time semifinal/finals are happening. We like hiking, vegan food and spas. Our budget is $5K. The itinerary should be a detailed timeline of time, activity, cost, other details and if applicable a link to buy tickets/make reservations etc. for the item. Some preferences .Spa access would be nice but not necessary. When you finish this task, please generate a html report about this trip; write a summary of this plan and send text summary and report html link to slack #tennis-trip-sf channel."
                },
                {
                  "lineNumber": 217,
                  "content": "Analyze the UK healthcare industry to support the planning of my next company. Provide a comprehensive market overview, including current trends, growth projections, and relevant regulations. Identify the top 5–10 major opportunities, gaps, or underserved segments within the market. Present all findings in a well-structured, professional HTML report. Then send a message to slack #eigentr-product-test channel when this task is done to align the report content with my teammates."
                }
              ]
            },
            {
              "file": ".\\README_JA.md",
              "matches": [
                {
                  "lineNumber": 168,
                  "content": "Eigentには大規模な組み込み**Model Context Protocol（MCP）**ツール（ウェブブラウジング、コード実行、Notion、Google suite、Slackなど）が付属しており、**独自のツールをインストール**することもできます。エージェントにシナリオに適したツールを装備させ、内部APIやカスタム関数を統合して機能を強化できます。"
                },
                {
                  "lineNumber": 190,
                  "content": "### 1. パームスプリングステニス旅行の旅程とSlackサマリー [リプレイ ▶️](https://www.eigent.ai/download?share_token=IjE3NTM0MzUxNTEzMzctNzExMyI.aIeysw.MUeG6ZcBxI1GqvPDvn4dcv-CDWw__1753435151337-7113)"
                },
                {
                  "lineNumber": 195,
                  "content": "私たちは2人のテニスファンで、パームスプリングス2026のテニストーナメントを見に行きたいです。私はサンフランシスコに住んでいます。準決勝/決勝の時期に合わせて、3日間のフライト、ホテル、アクティビティを含む詳細な旅程を準備してください。私たちはハイキング、ヴィーガン料理、スパが好きです。予算は5,000ドルです。旅程は、時間、アクティビティ、コスト、その他の詳細、および該当する場合はチケット購入/予約リンクを含む詳細なタイムラインにしてください。スパへのアクセスはあれば嬉しいですが、必須ではありません。このタスクが完了したら、この旅行に関するHTMLレポートを生成し、計画の要約とレポートHTMLリンクをSlackの#tennis-trip-sfチャンネルに送信してください。"
                },
                {
                  "lineNumber": 215,
                  "content": "次の会社の計画をサポートするために、英国のヘルスケア業界を分析してください。現在のトレンド、成長予測、関連規制を含む包括的な市場概要を提供してください。市場内の主要な機会、ギャップ、またはサービスが行き届いていないセグメントのトップ5-10を特定してください。すべての調査結果を、よく構成されたプロフェッショナルなHTMLレポートで提示してください。その後、タスクが完了したらSlackの#eigentr-product-testチャンネルにメッセージを送信し、チームメイトとレポート内容を共有してください。"
                }
              ]
            },
            {
              "file": ".\\CONTRIBUTING.md",
              "matches": [
                {
                  "lineNumber": 25,
                  "content": "- **Slack:** [Join here](https://join.slack.com/t/camel-ai/shared_invite/zt-2g7xc41gy-_7rcrNNAArIP6sLQqldkqQ)"
                }
              ]
            }
          ],
          "totalLines": 76,
          "totalMatchedLines": 76
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---


檢視關鍵檔案以了解 Slack 訊息傳遞流程：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: backend/app/utils/toolkit/slack_toolkit.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: server/app/component/oauth_adapter.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: server/app/model/config/config.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How does SlackToolkit send messages to Slack channels using slack-sdk?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\slack_toolkit.py",
        "range": {
          "startPosition": {
            "column": 59
          },
          "endPosition": {
            "line": 25,
            "column": 21
          }
        },
        "contents": "from camel.toolkits.function_tool import FunctionTool\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\nfrom utils import traceroot_wrapper as traceroot\n\nlogger = traceroot.get_logger(\"slack_toolkit\")\n\n\n@auto_listen_toolkit(BaseSlackToolkit)\nclass SlackToolkit(BaseSlackToolkit, AbstractToolkit):\n    agent_name: str = Agents.social_medium_agent\n\n    def __init__(self, api_task_id: str, timeout: float | None = None):\n        super().__init__(timeout)\n        self.api_task_id = api_task_id\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:\n        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")\n        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):\n            return SlackToolkit(api_task_id).get_tools()\n        else:\n            return []",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from camel.toolkits.function_tool import FunctionTool",
            "lineNumber": 2
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 3
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 4
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 5
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 6
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "logger = traceroot.get_logger(\"slack_toolkit\")",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "@auto_listen_toolkit(BaseSlackToolkit)",
            "lineNumber": 12
          },
          {
            "text": "class SlackToolkit(BaseSlackToolkit, AbstractToolkit):",
            "lineNumber": 13,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.social_medium_agent",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "    def __init__(self, api_task_id: str, timeout: float | None = None):",
            "lineNumber": 16
          },
          {
            "text": "        super().__init__(timeout)",
            "lineNumber": 17
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "text": "    @classmethod",
            "lineNumber": 20
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:",
            "lineNumber": 21
          },
          {
            "text": "        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")",
            "lineNumber": 22
          },
          {
            "text": "        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):",
            "lineNumber": 23
          },
          {
            "text": "            return SlackToolkit(api_task_id).get_tools()",
            "lineNumber": 24
          },
          {
            "text": "        else:",
            "lineNumber": 25
          },
          {
            "text": "            return []",
            "lineNumber": 26,
            "isSignature": true
          }
        ]
      },
      "score": 0.45727840065956116
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1584
          },
          "endPosition": {
            "line": 1710
          }
        },
        "contents": "@traceroot.trace()\nasync def social_medium_agent(options: Chat):\n{NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.\n\nYour integrated toolkits enable you to:\n\n1. WhatsApp Business Management (WhatsAppToolkit):\n   - Send text and template messages to customers via the WhatsApp Business\n   API.\n   - Retrieve business profile information.\n\n2. Twitter Account Management (TwitterToolkit):\n   - Create tweets with text content, polls, or as quote tweets.\n   - Delete existing tweets.\n   - Retrieve user profile information.\n\n3. LinkedIn Professional Networking (LinkedInToolkit):\n   - Create posts on LinkedIn.\n   - Delete existing posts.\n   - Retrieve authenticated user's profile information.\n\n4. Reddit Content Analysis (RedditToolkit):\n   - Collect top posts and comments from specified subreddits.\n   - Perform sentiment analysis on Reddit comments.\n   - Track keyword discussions across multiple subreddits.\n\n5. Notion Workspace Management (NotionToolkit):\n   - List all pages and users in a Notion workspace.\n   - Retrieve and extract text content from Notion blocks.\n\n6. Slack Workspace Interaction (SlackToolkit):\n   - Create new Slack channels (public or private).\n   - Join or leave existing channels.\n   - Send and delete messages in channels.\n   - Retrieve channel information and message history.\n\n7. Human Interaction (HumanToolkit):\n   - Ask questions to users and send messages via console.\n\n8. Agent Communication:\n   - Communicate with other agents using messaging tools when collaboration\n   is needed. Use &#96;list_available_agents&#96; to see available team members and\n   &#96;send_message&#96; to coordinate with them, especially when you need content\n   from document agents or research from browser agents.\n\n9. File System Access:\n   - You can use terminal tools to interact with the local file system in\n   your working directory (&#96;{working_directory}&#96;), for example, to access\n   files needed for posting. You can use tools like &#96;find&#96; to locate files,\n   &#96;grep&#96; to search within them, and &#96;curl&#96; to interact with web APIs that\n   are not covered by other tools.\n\nWhen assisting users, always:\n- Identify which platform's functionality is needed for the task.\n- Check if required API credentials are available before attempting\noperations.\n- Provide clear explanations of what actions you're taking.\n- Handle rate limits and API restrictions appropriately.\n- Ask clarifying questions when user requests are ambiguous.",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1585,
                "column": 1
              },
              "endPosition": {
                "line": 1586,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 1586,
                "column": 1
              },
              "endPosition": {
                "line": 1587,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1585
          },
          {
            "text": "async def social_medium_agent(options: Chat):",
            "lineNumber": 1586,
            "isSignature": true
          },
          {
            "text": "{NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.",
            "lineNumber": 1638
          },
          {
            "lineNumber": 1639
          },
          {
            "text": "Your integrated toolkits enable you to:",
            "lineNumber": 1640
          },
          {
            "lineNumber": 1641
          },
          {
            "text": "1. WhatsApp Business Management (WhatsAppToolkit):",
            "lineNumber": 1642
          },
          {
            "text": "   - Send text and template messages to customers via the WhatsApp Business",
            "lineNumber": 1643
          },
          {
            "text": "   API.",
            "lineNumber": 1644
          },
          {
            "text": "   - Retrieve business profile information.",
            "lineNumber": 1645
          },
          {
            "lineNumber": 1646
          },
          {
            "text": "2. Twitter Account Management (TwitterToolkit):",
            "lineNumber": 1647
          },
          {
            "text": "   - Create tweets with text content, polls, or as quote tweets.",
            "lineNumber": 1648
          },
          {
            "text": "   - Delete existing tweets.",
            "lineNumber": 1649
          },
          {
            "text": "   - Retrieve user profile information.",
            "lineNumber": 1650
          },
          {
            "lineNumber": 1651
          },
          {
            "text": "3. LinkedIn Professional Networking (LinkedInToolkit):",
            "lineNumber": 1652
          },
          {
            "text": "   - Create posts on LinkedIn.",
            "lineNumber": 1653
          },
          {
            "text": "   - Delete existing posts.",
            "lineNumber": 1654
          },
          {
            "text": "   - Retrieve authenticated user's profile information.",
            "lineNumber": 1655
          },
          {
            "lineNumber": 1656
          },
          {
            "text": "4. Reddit Content Analysis (RedditToolkit):",
            "lineNumber": 1657
          },
          {
            "text": "   - Collect top posts and comments from specified subreddits.",
            "lineNumber": 1658
          },
          {
            "text": "   - Perform sentiment analysis on Reddit comments.",
            "lineNumber": 1659
          },
          {
            "text": "   - Track keyword discussions across multiple subreddits.",
            "lineNumber": 1660
          },
          {
            "lineNumber": 1661
          },
          {
            "text": "5. Notion Workspace Management (NotionToolkit):",
            "lineNumber": 1662
          },
          {
            "text": "   - List all pages and users in a Notion workspace.",
            "lineNumber": 1663
          },
          {
            "text": "   - Retrieve and extract text content from Notion blocks.",
            "lineNumber": 1664
          },
          {
            "lineNumber": 1665
          },
          {
            "text": "6. Slack Workspace Interaction (SlackToolkit):",
            "lineNumber": 1666
          },
          {
            "text": "   - Create new Slack channels (public or private).",
            "lineNumber": 1667
          },
          {
            "text": "   - Join or leave existing channels.",
            "lineNumber": 1668
          },
          {
            "text": "   - Send and delete messages in channels.",
            "lineNumber": 1669
          },
          {
            "text": "   - Retrieve channel information and message history.",
            "lineNumber": 1670
          },
          {
            "lineNumber": 1671
          },
          {
            "text": "7. Human Interaction (HumanToolkit):",
            "lineNumber": 1672
          },
          {
            "text": "   - Ask questions to users and send messages via console.",
            "lineNumber": 1673
          },
          {
            "lineNumber": 1674
          },
          {
            "text": "8. Agent Communication:",
            "lineNumber": 1675
          },
          {
            "text": "   - Communicate with other agents using messaging tools when collaboration",
            "lineNumber": 1676
          },
          {
            "text": "   is needed. Use &#96;list_available_agents&#96; to see available team members and",
            "lineNumber": 1677
          },
          {
            "text": "   &#96;send_message&#96; to coordinate with them, especially when you need content",
            "lineNumber": 1678
          },
          {
            "text": "   from document agents or research from browser agents.",
            "lineNumber": 1679
          },
          {
            "lineNumber": 1680
          },
          {
            "text": "9. File System Access:",
            "lineNumber": 1681
          },
          {
            "text": "   - You can use terminal tools to interact with the local file system in",
            "lineNumber": 1682
          },
          {
            "text": "   your working directory (&#96;{working_directory}&#96;), for example, to access",
            "lineNumber": 1683
          },
          {
            "text": "   files needed for posting. You can use tools like &#96;find&#96; to locate files,",
            "lineNumber": 1684
          },
          {
            "text": "   &#96;grep&#96; to search within them, and &#96;curl&#96; to interact with web APIs that",
            "lineNumber": 1685
          },
          {
            "text": "   are not covered by other tools.",
            "lineNumber": 1686
          },
          {
            "lineNumber": 1687
          },
          {
            "text": "When assisting users, always:",
            "lineNumber": 1688
          },
          {
            "text": "- Identify which platform's functionality is needed for the task.",
            "lineNumber": 1689
          },
          {
            "text": "- Check if required API credentials are available before attempting",
            "lineNumber": 1690
          },
          {
            "text": "operations.",
            "lineNumber": 1691
          },
          {
            "text": "- Provide clear explanations of what actions you're taking.",
            "lineNumber": 1692
          },
          {
            "text": "- Handle rate limits and API restrictions appropriately.",
            "lineNumber": 1693
          },
          {
            "text": "- Ask clarifying questions when user requests are ambiguous.",
            "lineNumber": 1694
          }
        ]
      },
      "score": 0.37982821464538574
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\human_toolkit.py",
        "range": {
          "startPosition": {
            "line": 12
          },
          "endPosition": {
            "line": 147
          }
        },
        "contents": "@auto_listen_toolkit(BaseToolkit)\nclass HumanToolkit(BaseToolkit, AbstractToolkit):\n\n\n    @listen_toolkit()\n    def send_message_to_user(\n        self,\n        message_title: str,\n        message_description: str,\n        message_attachment: str | None = None,\n    ) -&gt; str:\n        r\"\"\"Use this tool to send a tidy message to the user, including a\n        short title, a one-sentence description, and an optional attachment.\n\n        This one-way tool keeps the user informed about your progress,\n        decisions, or actions. It does not require a response.\n        You should use it to:\n        - Announce what you are about to do.\n        For example:\n        message_title=\"Starting Task\"\n        message_description=\"Searching for papers on GUI Agents.\"\n        - Report the result of an action.\n        For example:\n        message_title=\"Search Complete\"\n        message_description=\"Found 15 relevant papers.\"\n        - Report a created file.\n        For example:\n        message_title=\"File Ready\"\n        message_description=\"The report is ready for your review.\"\n        message_attachment=\"report.pdf\"\n        - State a decision.\n        For example:\n        message_title=\"Next Step\"\n        message_description=\"Analyzing the top 10 papers.\"\n        - Give a status update during a long-running task.\n\n        Args:\n            message_title (str): The title of the message.\n            message_description (str): The short description.\n            message_attachment (str): The attachment of the message,\n                which can be a file path or a URL.\n\n        Returns:\n            str: Confirmation that the message was successfully sent.\n        \"\"\"\n        print(f\"\\nAgent Message:\\n{message_title} \\n{message_description}\\n\")\n        if message_attachment:\n            print(message_attachment)\n\n        task_lock = get_task_lock(self.api_task_id)\n\n        # Get process_task_id from ContextVar with fallback\n        current_process_task_id = process_task.get(\"\")\n        if not current_process_task_id:\n            current_process_task_id =",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 13,
                "column": 1
              },
              "endPosition": {
                "line": 14,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 14,
                "column": 1
              },
              "endPosition": {
                "line": 15,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@auto_listen_toolkit(BaseToolkit)",
            "lineNumber": 13
          },
          {
            "text": "class HumanToolkit(BaseToolkit, AbstractToolkit):",
            "lineNumber": 14,
            "isSignature": true
          },
          {
            "lineNumber": 62
          },
          {
            "lineNumber": 63
          },
          {
            "text": "    @listen_toolkit()",
            "lineNumber": 64
          },
          {
            "text": "    def send_message_to_user(",
            "lineNumber": 65
          },
          {
            "text": "        self,",
            "lineNumber": 66
          },
          {
            "text": "        message_title: str,",
            "lineNumber": 67
          },
          {
            "text": "        message_description: str,",
            "lineNumber": 68
          },
          {
            "text": "        message_attachment: str | None = None,",
            "lineNumber": 69
          },
          {
            "text": "    ) -&gt; str:",
            "lineNumber": 70
          },
          {
            "text": "        r\"\"\"Use this tool to send a tidy message to the user, including a",
            "lineNumber": 71
          },
          {
            "text": "        short title, a one-sentence description, and an optional attachment.",
            "lineNumber": 72
          },
          {
            "lineNumber": 73
          },
          {
            "text": "        This one-way tool keeps the user informed about your progress,",
            "lineNumber": 74
          },
          {
            "text": "        decisions, or actions. It does not require a response.",
            "lineNumber": 75
          },
          {
            "text": "        You should use it to:",
            "lineNumber": 76
          },
          {
            "text": "        - Announce what you are about to do.",
            "lineNumber": 77
          },
          {
            "text": "        For example:",
            "lineNumber": 78
          },
          {
            "text": "        message_title=\"Starting Task\"",
            "lineNumber": 79
          },
          {
            "text": "        message_description=\"Searching for papers on GUI Agents.\"",
            "lineNumber": 80
          },
          {
            "text": "        - Report the result of an action.",
            "lineNumber": 81
          },
          {
            "text": "        For example:",
            "lineNumber": 82
          },
          {
            "text": "        message_title=\"Search Complete\"",
            "lineNumber": 83
          },
          {
            "text": "        message_description=\"Found 15 relevant papers.\"",
            "lineNumber": 84
          },
          {
            "text": "        - Report a created file.",
            "lineNumber": 85
          },
          {
            "text": "        For example:",
            "lineNumber": 86
          },
          {
            "text": "        message_title=\"File Ready\"",
            "lineNumber": 87
          },
          {
            "text": "        message_description=\"The report is ready for your review.\"",
            "lineNumber": 88
          },
          {
            "text": "        message_attachment=\"report.pdf\"",
            "lineNumber": 89
          },
          {
            "text": "        - State a decision.",
            "lineNumber": 90
          },
          {
            "text": "        For example:",
            "lineNumber": 91
          },
          {
            "text": "        message_title=\"Next Step\"",
            "lineNumber": 92
          },
          {
            "text": "        message_description=\"Analyzing the top 10 papers.\"",
            "lineNumber": 93
          },
          {
            "text": "        - Give a status update during a long-running task.",
            "lineNumber": 94
          },
          {
            "lineNumber": 95
          },
          {
            "text": "        Args:",
            "lineNumber": 96
          },
          {
            "text": "            message_title (str): The title of the message.",
            "lineNumber": 97
          },
          {
            "text": "            message_description (str): The short description.",
            "lineNumber": 98
          },
          {
            "text": "            message_attachment (str): The attachment of the message,",
            "lineNumber": 99
          },
          {
            "text": "                which can be a file path or a URL.",
            "lineNumber": 100
          },
          {
            "lineNumber": 101
          },
          {
            "text": "        Returns:",
            "lineNumber": 102
          },
          {
            "text": "            str: Confirmation that the message was successfully sent.",
            "lineNumber": 103
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 104
          },
          {
            "text": "        print(f\"\\nAgent Message:\\n{message_title} \\n{message_description}\\n\")",
            "lineNumber": 105
          },
          {
            "text": "        if message_attachment:",
            "lineNumber": 106
          },
          {
            "text": "            print(message_attachment)",
            "lineNumber": 107
          },
          {
            "lineNumber": 108
          },
          {
            "text": "        task_lock = get_task_lock(self.api_task_id)",
            "lineNumber": 109
          },
          {
            "lineNumber": 110
          },
          {
            "text": "        # Get process_task_id from ContextVar with fallback",
            "lineNumber": 111
          },
          {
            "text": "        current_process_task_id = process_task.get(\"\")",
            "lineNumber": 112
          },
          {
            "text": "        if not current_process_task_id:",
            "lineNumber": 113
          },
          {
            "text": "            current_process_task_id =",
            "lineNumber": 114
          }
        ]
      },
      "score": 0.35782280564308167
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\component\\oauth_adapter.py",
        "range": {
          "startPosition": {
            "line": 17,
            "column": 12
          },
          "endPosition": {
            "line": 84
          }
        },
        "contents": "class SlackOAuthAdapter(OAuthAdapter):\n    def __init__(self, redirect_uri: Optional[str] = None):\n        self.client_id = env(\"SLACK_CLIENT_ID\", \"your_client_id\")\n        self.client_secret = env(\"SLACK_CLIENT_SECRET\", \"your_client_secret\")\n        self.redirect_uri = redirect_uri or env(\"SLACK_REDIRECT_URI\", \"https://localhost/api/oauth/slack/callback\")\n        self.scope = env(\"SLACK_SCOPE\", \"chat:write,channels:read,channels:join,groups:read,im:write\")\n\n    def get_authorize_url(self, state: Optional[str] = None) -&gt; Optional[str]:\n        url = (\n            f\"https://slack.com/oauth/v2/authorize?client_id={self.client_id}\"\n            f\"&amp;scope={self.scope}\"\n            f\"&amp;redirect_uri={self.redirect_uri}\"\n        )\n        if state:\n            url += f\"&amp;state={state}\"\n        return url\n\n    def fetch_token(self, code: Optional[str]) -&gt; Optional[Dict[str, Any]]:\n        if not code:\n            return None\n        token_url = \"https://slack.com/api/oauth.v2.access\"\n        data = {\n            \"client_id\": self.client_id,\n            \"client_secret\": self.client_secret,\n            \"code\": code,\n            \"redirect_uri\": self.redirect_uri,\n        }\n        with httpx.Client() as client:\n            resp = client.post(token_url, data=data)\n            return resp.json()\n\n\nclass NotionOAuthAdapter(OAuthAdapter):\n    def __init__(self, redirect_uri: Optional[str] = None):\n        self.client_id = env(\"NOTION_CLIENT_ID\", \"your_notion_client_id\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class SlackOAuthAdapter(OAuthAdapter):",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "    def __init__(self, redirect_uri: Optional[str] = None):",
            "lineNumber": 22
          },
          {
            "text": "        self.client_id = env(\"SLACK_CLIENT_ID\", \"your_client_id\")",
            "lineNumber": 23
          },
          {
            "text": "        self.client_secret = env(\"SLACK_CLIENT_SECRET\", \"your_client_secret\")",
            "lineNumber": 24
          },
          {
            "text": "        self.redirect_uri = redirect_uri or env(\"SLACK_REDIRECT_URI\", \"https://localhost/api/oauth/slack/callback\")",
            "lineNumber": 25
          },
          {
            "text": "        self.scope = env(\"SLACK_SCOPE\", \"chat:write,channels:read,channels:join,groups:read,im:write\")",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "    def get_authorize_url(self, state: Optional[str] = None) -&gt; Optional[str]:",
            "lineNumber": 28
          },
          {
            "text": "        url = (",
            "lineNumber": 29
          },
          {
            "text": "            f\"https://slack.com/oauth/v2/authorize?client_id={self.client_id}\"",
            "lineNumber": 30
          },
          {
            "text": "            f\"&amp;scope={self.scope}\"",
            "lineNumber": 31
          },
          {
            "text": "            f\"&amp;redirect_uri={self.redirect_uri}\"",
            "lineNumber": 32
          },
          {
            "text": "        )",
            "lineNumber": 33
          },
          {
            "text": "        if state:",
            "lineNumber": 34
          },
          {
            "text": "            url += f\"&amp;state={state}\"",
            "lineNumber": 35
          },
          {
            "text": "        return url",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "    def fetch_token(self, code: Optional[str]) -&gt; Optional[Dict[str, Any]]:",
            "lineNumber": 38
          },
          {
            "text": "        if not code:",
            "lineNumber": 39
          },
          {
            "text": "            return None",
            "lineNumber": 40
          },
          {
            "text": "        token_url = \"https://slack.com/api/oauth.v2.access\"",
            "lineNumber": 41
          },
          {
            "text": "        data = {",
            "lineNumber": 42
          },
          {
            "text": "            \"client_id\": self.client_id,",
            "lineNumber": 43
          },
          {
            "text": "            \"client_secret\": self.client_secret,",
            "lineNumber": 44
          },
          {
            "text": "            \"code\": code,",
            "lineNumber": 45
          },
          {
            "text": "            \"redirect_uri\": self.redirect_uri,",
            "lineNumber": 46
          },
          {
            "text": "        }",
            "lineNumber": 47
          },
          {
            "text": "        with httpx.Client() as client:",
            "lineNumber": 48
          },
          {
            "text": "            resp = client.post(token_url, data=data)",
            "lineNumber": 49
          },
          {
            "text": "            return resp.json()",
            "lineNumber": 50,
            "isSignature": true
          },
          {
            "lineNumber": 51
          },
          {
            "lineNumber": 52
          },
          {
            "text": "class NotionOAuthAdapter(OAuthAdapter):",
            "lineNumber": 53,
            "isSignature": true
          },
          {
            "text": "    def __init__(self, redirect_uri: Optional[str] = None):",
            "lineNumber": 54
          },
          {
            "text": "        self.client_id = env(\"NOTION_CLIENT_ID\", \"your_notion_client_id\")",
            "lineNumber": 55
          }
        ]
      },
      "score": 0.34445780515670776
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1581,
            "column": 5
          },
          "endPosition": {
            "line": 1710
          }
        },
        "contents": "@traceroot.trace()\nasync def social_medium_agent(options: Chat):\n    \"\"\"\n    Agent to handling tasks related to social media:\n    include toolkits: WhatsApp, Twitter, LinkedIn, Reddit, Notion, Slack, Discord and Google Suite.\n    \"\"\"\n    working_directory = get_working_directory(options)\n    traceroot_logger.info(\n        f\"Creating social medium agent for project: {options.project_id} in directory: {working_directory}\"\n    )\n    tools = [\n        *WhatsAppToolkit.get_can_use_tools(options.project_id),\n        *TwitterToolkit.get_can_use_tools(options.project_id),\n        *LinkedInToolkit.get_can_use_tools(options.project_id),\n        *RedditToolkit.get_can_use_tools(options.project_id),\n        *await NotionMCPToolkit.get_can_use_tools(options.project_id),\n        # *SlackToolkit.get_can_use_tools(options.project_id),\n        *await GoogleGmailMCPToolkit.get_can_use_tools(\n            options.project_id, options.get_bun_env()\n        ),\n        *GoogleCalendarToolkit.get_can_use_tools(options.project_id),\n        *HumanToolkit.get_can_use_tools(options.project_id, Agents.social_medium_agent),\n        *TerminalToolkit(\n            options.project_id,\n            agent_name=Agents.social_medium_agent,\n            clone_current_env=False,\n        ).get_tools(),\n        *NoteTakingToolkit(\n            options.project_id,\n            Agents.social_medium_agent,\n            working_directory=working_directory,\n        ).get_tools(),\n        # *DiscordToolkit(options.project_id).get_tools(),  # Not supported temporarily\n        # *GoogleSuiteToolkit(options.project_id).get_tools(),  # Not supported temporarily\n    ]\n    # if env(\"EXA_API_KEY\") or options.is_cloud():\n    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1585
          },
          {
            "text": "async def social_medium_agent(options: Chat):",
            "lineNumber": 1586,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1587
          },
          {
            "text": "    Agent to handling tasks related to social media:",
            "lineNumber": 1588
          },
          {
            "text": "    include toolkits: WhatsApp, Twitter, LinkedIn, Reddit, Notion, Slack, Discord and Google Suite.",
            "lineNumber": 1589
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1590
          },
          {
            "text": "    working_directory = get_working_directory(options)",
            "lineNumber": 1591
          },
          {
            "text": "    traceroot_logger.info(",
            "lineNumber": 1592
          },
          {
            "text": "        f\"Creating social medium agent for project: {options.project_id} in directory: {working_directory}\"",
            "lineNumber": 1593
          },
          {
            "text": "    )",
            "lineNumber": 1594
          },
          {
            "text": "    tools = [",
            "lineNumber": 1595
          },
          {
            "text": "        *WhatsAppToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1596
          },
          {
            "text": "        *TwitterToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1597
          },
          {
            "text": "        *LinkedInToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1598
          },
          {
            "text": "        *RedditToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1599
          },
          {
            "text": "        *await NotionMCPToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1600
          },
          {
            "text": "        # *SlackToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1601
          },
          {
            "text": "        *await GoogleGmailMCPToolkit.get_can_use_tools(",
            "lineNumber": 1602
          },
          {
            "text": "            options.project_id, options.get_bun_env()",
            "lineNumber": 1603
          },
          {
            "text": "        ),",
            "lineNumber": 1604
          },
          {
            "text": "        *GoogleCalendarToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1605
          },
          {
            "text": "        *HumanToolkit.get_can_use_tools(options.project_id, Agents.social_medium_agent),",
            "lineNumber": 1606
          },
          {
            "text": "        *TerminalToolkit(",
            "lineNumber": 1607
          },
          {
            "text": "            options.project_id,",
            "lineNumber": 1608
          },
          {
            "text": "            agent_name=Agents.social_medium_agent,",
            "lineNumber": 1609
          },
          {
            "text": "            clone_current_env=False,",
            "lineNumber": 1610
          },
          {
            "text": "        ).get_tools(),",
            "lineNumber": 1611
          },
          {
            "text": "        *NoteTakingToolkit(",
            "lineNumber": 1612
          },
          {
            "text": "            options.project_id,",
            "lineNumber": 1613
          },
          {
            "text": "            Agents.social_medium_agent,",
            "lineNumber": 1614
          },
          {
            "text": "            working_directory=working_directory,",
            "lineNumber": 1615
          },
          {
            "text": "        ).get_tools(),",
            "lineNumber": 1616
          },
          {
            "text": "        # *DiscordToolkit(options.project_id).get_tools(),  # Not supported temporarily",
            "lineNumber": 1617
          },
          {
            "text": "        # *GoogleSuiteToolkit(options.project_id).get_tools(),  # Not supported temporarily",
            "lineNumber": 1618
          },
          {
            "text": "    ]",
            "lineNumber": 1619
          },
          {
            "text": "    # if env(\"EXA_API_KEY\") or options.is_cloud():",
            "lineNumber": 1620
          },
          {
            "text": "    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))",
            "lineNumber": 1621
          }
        ]
      },
      "score": 0.33744120597839355
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\model\\config\\config.py",
        "range": {
          "startPosition": {
            "line": 31,
            "column": 29
          },
          "endPosition": {
            "line": 184
          }
        },
        "contents": "class ConfigInfo:\n    configs: dict = {\n        # \"model_platform\": {\"env_vars\": [\"api_key\"]},\n        # ConfigGroup.GOOGLE_SUITE.value: {\n        #     \"env_vars\": [],\n        #     \"toolkit\": \"\",\n        # },\n        ConfigGroup.SLACK.value: {\n            \"env_vars\": [\"SLACK_BOT_TOKEN\"],\n            \"toolkit\": \"slack_toolkit\",\n        },\n        ConfigGroup.LARK.value: {\n            \"env_vars\": [\"LARK_APP_ID\", \"LARK_APP_SECRET\"],\n            \"toolkit\": \"lark_toolkit\",\n        },\n        ConfigGroup.NOTION.value: {\n            \"env_vars\": [\"MCP_REMOTE_CONFIG_DIR\"],\n            \"toolkit\": \"notion_mcp_toolkit\",\n        },\n        ConfigGroup.TWITTER.value: {\n            \"env_vars\": [\n                \"TWITTER_CONSUMER_KEY\",\n                \"TWITTER_CONSUMER_SECRET\",\n                \"TWITTER_ACCESS_TOKEN\",\n                \"TWITTER_ACCESS_TOKEN_SECRET\",\n            ],\n            \"toolkit\": \"twitter_toolkit\",\n        },\n        ConfigGroup.WHATSAPP.value: {\n            \"env_vars\": [\"WHATSAPP_ACCESS_TOKEN\", \"WHATSAPP_PHONE_NUMBER_ID\"],\n            \"toolkit\": \"whatsapp_toolkit\",\n        },\n        ConfigGroup.LINKEDIN.value: {\n            \"env_vars\": [\"LINKEDIN_ACCESS_TOKEN\"],\n            \"toolkit\": \"linkedin_toolkit\",\n        },\n        ConfigGroup.REDDIT.value: {\n            \"env_vars\": [\n                \"REDDIT_CLIENT_ID\",\n                \"REDDIT_CLIENT_SECRET\",\n                \"REDDIT_USER_AGENT\",\n            ],\n            \"toolkit\": \"reddit_toolkit\",\n        },\n        # ConfigGroup.DISCORD.value: {\n        #     \"env_vars\": [\"DISCORD_BOT_TOKEN\"],\n        #     \"toolkit\": \"discord_toolkit\",\n        # },\n        ConfigGroup.SEARCH.value: {\n            \"env_vars\": [\"GOOGLE_API_KEY\", \"SEARCH_ENGINE_ID\", \"EXA_API_KEY\"],\n            \"toolkit\": \"search_toolkit\",\n        },\n        ConfigGroup.AUDIO_ANALYSIS.value: {\n            \"env_vars\": [],\n            \"toolkit\": \"audio_analysis_toolkit\",\n        },\n        ConfigGroup.CODE_EXECUTION.value: {\n            \"env_vars\": [],\n            \"toolkit\": \"code_execution_toolkit\",",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class ConfigInfo:",
            "lineNumber": 35,
            "isSignature": true
          },
          {
            "text": "    configs: dict = {",
            "lineNumber": 36
          },
          {
            "text": "        # \"model_platform\": {\"env_vars\": [\"api_key\"]},",
            "lineNumber": 37
          },
          {
            "text": "        # ConfigGroup.GOOGLE_SUITE.value: {",
            "lineNumber": 38
          },
          {
            "text": "        #     \"env_vars\": [],",
            "lineNumber": 39
          },
          {
            "text": "        #     \"toolkit\": \"\",",
            "lineNumber": 40
          },
          {
            "text": "        # },",
            "lineNumber": 41
          },
          {
            "text": "        ConfigGroup.SLACK.value: {",
            "lineNumber": 42
          },
          {
            "text": "            \"env_vars\": [\"SLACK_BOT_TOKEN\"],",
            "lineNumber": 43
          },
          {
            "text": "            \"toolkit\": \"slack_toolkit\",",
            "lineNumber": 44
          },
          {
            "text": "        },",
            "lineNumber": 45
          },
          {
            "text": "        ConfigGroup.LARK.value: {",
            "lineNumber": 46
          },
          {
            "text": "            \"env_vars\": [\"LARK_APP_ID\", \"LARK_APP_SECRET\"],",
            "lineNumber": 47
          },
          {
            "text": "            \"toolkit\": \"lark_toolkit\",",
            "lineNumber": 48
          },
          {
            "text": "        },",
            "lineNumber": 49
          },
          {
            "text": "        ConfigGroup.NOTION.value: {",
            "lineNumber": 50
          },
          {
            "text": "            \"env_vars\": [\"MCP_REMOTE_CONFIG_DIR\"],",
            "lineNumber": 51
          },
          {
            "text": "            \"toolkit\": \"notion_mcp_toolkit\",",
            "lineNumber": 52
          },
          {
            "text": "        },",
            "lineNumber": 53
          },
          {
            "text": "        ConfigGroup.TWITTER.value: {",
            "lineNumber": 54
          },
          {
            "text": "            \"env_vars\": [",
            "lineNumber": 55
          },
          {
            "text": "                \"TWITTER_CONSUMER_KEY\",",
            "lineNumber": 56
          },
          {
            "text": "                \"TWITTER_CONSUMER_SECRET\",",
            "lineNumber": 57
          },
          {
            "text": "                \"TWITTER_ACCESS_TOKEN\",",
            "lineNumber": 58
          },
          {
            "text": "                \"TWITTER_ACCESS_TOKEN_SECRET\",",
            "lineNumber": 59
          },
          {
            "text": "            ],",
            "lineNumber": 60
          },
          {
            "text": "            \"toolkit\": \"twitter_toolkit\",",
            "lineNumber": 61
          },
          {
            "text": "        },",
            "lineNumber": 62
          },
          {
            "text": "        ConfigGroup.WHATSAPP.value: {",
            "lineNumber": 63
          },
          {
            "text": "            \"env_vars\": [\"WHATSAPP_ACCESS_TOKEN\", \"WHATSAPP_PHONE_NUMBER_ID\"],",
            "lineNumber": 64
          },
          {
            "text": "            \"toolkit\": \"whatsapp_toolkit\",",
            "lineNumber": 65
          },
          {
            "text": "        },",
            "lineNumber": 66
          },
          {
            "text": "        ConfigGroup.LINKEDIN.value: {",
            "lineNumber": 67
          },
          {
            "text": "            \"env_vars\": [\"LINKEDIN_ACCESS_TOKEN\"],",
            "lineNumber": 68
          },
          {
            "text": "            \"toolkit\": \"linkedin_toolkit\",",
            "lineNumber": 69
          },
          {
            "text": "        },",
            "lineNumber": 70
          },
          {
            "text": "        ConfigGroup.REDDIT.value: {",
            "lineNumber": 71
          },
          {
            "text": "            \"env_vars\": [",
            "lineNumber": 72
          },
          {
            "text": "                \"REDDIT_CLIENT_ID\",",
            "lineNumber": 73
          },
          {
            "text": "                \"REDDIT_CLIENT_SECRET\",",
            "lineNumber": 74
          },
          {
            "text": "                \"REDDIT_USER_AGENT\",",
            "lineNumber": 75
          },
          {
            "text": "            ],",
            "lineNumber": 76
          },
          {
            "text": "            \"toolkit\": \"reddit_toolkit\",",
            "lineNumber": 77
          },
          {
            "text": "        },",
            "lineNumber": 78
          },
          {
            "text": "        # ConfigGroup.DISCORD.value: {",
            "lineNumber": 79
          },
          {
            "text": "        #     \"env_vars\": [\"DISCORD_BOT_TOKEN\"],",
            "lineNumber": 80
          },
          {
            "text": "        #     \"toolkit\": \"discord_toolkit\",",
            "lineNumber": 81
          },
          {
            "text": "        # },",
            "lineNumber": 82
          },
          {
            "text": "        ConfigGroup.SEARCH.value: {",
            "lineNumber": 83
          },
          {
            "text": "            \"env_vars\": [\"GOOGLE_API_KEY\", \"SEARCH_ENGINE_ID\", \"EXA_API_KEY\"],",
            "lineNumber": 84
          },
          {
            "text": "            \"toolkit\": \"search_toolkit\",",
            "lineNumber": 85
          },
          {
            "text": "        },",
            "lineNumber": 86
          },
          {
            "text": "        ConfigGroup.AUDIO_ANALYSIS.value: {",
            "lineNumber": 87
          },
          {
            "text": "            \"env_vars\": [],",
            "lineNumber": 88
          },
          {
            "text": "            \"toolkit\": \"audio_analysis_toolkit\",",
            "lineNumber": 89
          },
          {
            "text": "        },",
            "lineNumber": 90
          },
          {
            "text": "        ConfigGroup.CODE_EXECUTION.value: {",
            "lineNumber": 91
          },
          {
            "text": "            \"env_vars\": [],",
            "lineNumber": 92
          },
          {
            "text": "            \"toolkit\": \"code_execution_toolkit\",",
            "lineNumber": 93
          }
        ]
      },
      "score": 0.3268868029117584
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 83
          },
          "endPosition": {
            "line": 654
          }
        },
        "contents": "class ListenChatAgent(ChatAgent):\n@traceroot.trace()\ndef _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:\n\n\n        try:\n            task_lock = get_task_lock(self.api_task_id)\n\n            toolkit_name = (\n                getattr(tool, \"_toolkit_name\")\n                if hasattr(tool, \"_toolkit_name\")\n                else \"mcp_toolkit\"\n            )\n            traceroot_logger.debug(\n                f\"Agent {self.agent_name} executing tool: {func_name} from toolkit: {toolkit_name} with args: {json.dumps(args, ensure_ascii=False)}\"\n            )\n\n            # Only send activate event if tool is NOT wrapped by @listen_toolkit\n            if not has_listen_decorator:\n                asyncio.create_task(\n                    task_lock.put_queue(\n                        ActionActivateToolkitData(\n                            data={\n                                \"agent_name\": self.agent_name,\n                                \"process_task_id\": self.process_task_id,\n                                \"toolkit_name\": toolkit_name,\n                                \"method_name\": func_name,\n                                \"message\": json.dumps(args, ensure_ascii=False),\n                            },\n                        )\n                    )\n                )\n            # Set process_task context for all tool executions\n            with set_process_task(self.process_task_id):\n                raw_result = tool(**args)\n            traceroot_logger.debug(f\"Tool {func_name} executed successfully\")\n            if self.mask_tool_output:\n                self._secure_result_store[tool_call_id] = raw_result\n                result = (\n                    \"[The tool has been executed successfully, but the output\"\n                    \" from the tool is masked. You can move forward]\"\n                )\n                mask_flag = True\n            else:\n                result = raw_result\n                mask_flag = False\n            # Prepare result message with truncation\n            if",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 84,
                "column": 1
              },
              "endPosition": {
                "line": 85,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 276,
                "column": 5
              },
              "endPosition": {
                "line": 277,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 277,
                "column": 5
              },
              "endPosition": {
                "line": 282,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ListenChatAgent(ChatAgent):",
            "lineNumber": 84,
            "isSignature": true
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 361
          },
          {
            "text": "def _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:",
            "lineNumber": 362
          },
          {
            "lineNumber": 376
          },
          {
            "lineNumber": 377
          },
          {
            "text": "        try:",
            "lineNumber": 378
          },
          {
            "text": "            task_lock = get_task_lock(self.api_task_id)",
            "lineNumber": 379
          },
          {
            "lineNumber": 380
          },
          {
            "text": "            toolkit_name = (",
            "lineNumber": 381
          },
          {
            "text": "                getattr(tool, \"_toolkit_name\")",
            "lineNumber": 382
          },
          {
            "text": "                if hasattr(tool, \"_toolkit_name\")",
            "lineNumber": 383
          },
          {
            "text": "                else \"mcp_toolkit\"",
            "lineNumber": 384
          },
          {
            "text": "            )",
            "lineNumber": 385
          },
          {
            "text": "            traceroot_logger.debug(",
            "lineNumber": 386
          },
          {
            "text": "                f\"Agent {self.agent_name} executing tool: {func_name} from toolkit: {toolkit_name} with args: {json.dumps(args, ensure_ascii=False)}\"",
            "lineNumber": 387
          },
          {
            "text": "            )",
            "lineNumber": 388
          },
          {
            "lineNumber": 389
          },
          {
            "text": "            # Only send activate event if tool is NOT wrapped by @listen_toolkit",
            "lineNumber": 390
          },
          {
            "text": "            if not has_listen_decorator:",
            "lineNumber": 391
          },
          {
            "text": "                asyncio.create_task(",
            "lineNumber": 392
          },
          {
            "text": "                    task_lock.put_queue(",
            "lineNumber": 393
          },
          {
            "text": "                        ActionActivateToolkitData(",
            "lineNumber": 394
          },
          {
            "text": "                            data={",
            "lineNumber": 395
          },
          {
            "text": "                                \"agent_name\": self.agent_name,",
            "lineNumber": 396
          },
          {
            "text": "                                \"process_task_id\": self.process_task_id,",
            "lineNumber": 397
          },
          {
            "text": "                                \"toolkit_name\": toolkit_name,",
            "lineNumber": 398
          },
          {
            "text": "                                \"method_name\": func_name,",
            "lineNumber": 399
          },
          {
            "text": "                                \"message\": json.dumps(args, ensure_ascii=False),",
            "lineNumber": 400
          },
          {
            "text": "                            },",
            "lineNumber": 401
          },
          {
            "text": "                        )",
            "lineNumber": 402
          },
          {
            "text": "                    )",
            "lineNumber": 403
          },
          {
            "text": "                )",
            "lineNumber": 404
          },
          {
            "text": "            # Set process_task context for all tool executions",
            "lineNumber": 405
          },
          {
            "text": "            with set_process_task(self.process_task_id):",
            "lineNumber": 406
          },
          {
            "text": "                raw_result = tool(**args)",
            "lineNumber": 407
          },
          {
            "text": "            traceroot_logger.debug(f\"Tool {func_name} executed successfully\")",
            "lineNumber": 408
          },
          {
            "text": "            if self.mask_tool_output:",
            "lineNumber": 409
          },
          {
            "text": "                self._secure_result_store[tool_call_id] = raw_result",
            "lineNumber": 410
          },
          {
            "text": "                result = (",
            "lineNumber": 411
          },
          {
            "text": "                    \"[The tool has been executed successfully, but the output\"",
            "lineNumber": 412
          },
          {
            "text": "                    \" from the tool is masked. You can move forward]\"",
            "lineNumber": 413
          },
          {
            "text": "                )",
            "lineNumber": 414
          },
          {
            "text": "                mask_flag = True",
            "lineNumber": 415
          },
          {
            "text": "            else:",
            "lineNumber": 416
          },
          {
            "text": "                result = raw_result",
            "lineNumber": 417
          },
          {
            "text": "                mask_flag = False",
            "lineNumber": 418
          },
          {
            "text": "            # Prepare result message with truncation",
            "lineNumber": 419
          },
          {
            "text": "            if",
            "lineNumber": 420
          }
        ]
      },
      "score": 0.31281858682632446
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1584
          },
          "endPosition": {
            "line": 1710
          }
        },
        "contents": "@traceroot.trace()\nasync def social_medium_agent(options: Chat):\n\n    ]\n    # if env(\"EXA_API_KEY\") or options.is_cloud():\n    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))\n    return agent_model(\n        Agents.social_medium_agent,\n        BaseMessage.make_assistant_message(\n            role_name=\"Social Medium Agent\",\n            content=f\"\"\"\nYou are a Social Media Management Assistant with comprehensive capabilities\nacross multiple platforms. You MUST use the &#96;send_message_to_user&#96; tool to\ninform the user of every decision and action you take. Your message must\ninclude a short title and a one-sentence description. This is a mandatory\npart of your workflow. When you complete your task, your final response must\nbe a comprehensive summary of your actions, presented in a clear, detailed,\nand easy-to-read format. Avoid using markdown tables for presenting data;\nuse plain text formatting instead.\n\n- **Working Directory**: &#96;{working_directory}&#96;. All local file operations must\noccur here, but you can access files from any place in the file system. For all file system operations, you MUST use absolute paths to ensure precision and avoid ambiguity.\nThe current date is {NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.\n\nYour integrated toolkits enable you to:\n\n1. WhatsApp Business Management (WhatsAppToolkit):\n   - Send text and template messages to customers via the WhatsApp Business\n   API.\n   - Retrieve business profile information.\n\n2. Twitter Account Management (TwitterToolkit):\n   - Create tweets with text content, polls, or as quote tweets.\n   - Delete existing tweets.\n   - Retrieve user profile information.\n\n3. LinkedIn Professional Networking (LinkedInToolkit):\n   - Create posts on LinkedIn.\n   - Delete existing posts.\n   - Retrieve authenticated user's profile information.\n\n4. Reddit Content Analysis (RedditToolkit):\n   - Collect top posts and comments from specified subreddits.\n   - Perform sentiment analysis on Reddit comments.\n   - Track keyword discussions across multiple subreddits.\n\n5. Notion Workspace Management (NotionToolkit):\n   - List all pages and users in a Notion workspace.\n   - Retrieve and extract text content from Notion blocks.\n\n6. Slack Workspace Interaction (SlackToolkit):\n   - Create new Slack channels (public or private).\n   - Join or leave existing channels.\n   - Send and delete messages in channels.\n   - Retrieve channel information and message history.\n\n7. Human Interaction (HumanToolkit):\n   - Ask questions to users and send messages via console.\n\n8. Agent Communication:\n   - Communicate with other agents using messaging tools when collaboration\n   is needed. Use &#96;list_available_agents&#96; to see available team members and\n   &#96;send_message&#96; to coordinate with them, especially when you need content\n   from document agents or research from browser agents.\n\n9. File System Access:\n   - You can use terminal tools to interact with the local file system in\n   your working directory (&#96;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1585,
                "column": 1
              },
              "endPosition": {
                "line": 1586,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 1586,
                "column": 1
              },
              "endPosition": {
                "line": 1587,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1585
          },
          {
            "text": "async def social_medium_agent(options: Chat):",
            "lineNumber": 1586,
            "isSignature": true
          },
          {
            "lineNumber": 1618
          },
          {
            "text": "    ]",
            "lineNumber": 1619
          },
          {
            "text": "    # if env(\"EXA_API_KEY\") or options.is_cloud():",
            "lineNumber": 1620
          },
          {
            "text": "    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))",
            "lineNumber": 1621
          },
          {
            "text": "    return agent_model(",
            "lineNumber": 1622
          },
          {
            "text": "        Agents.social_medium_agent,",
            "lineNumber": 1623
          },
          {
            "text": "        BaseMessage.make_assistant_message(",
            "lineNumber": 1624
          },
          {
            "text": "            role_name=\"Social Medium Agent\",",
            "lineNumber": 1625
          },
          {
            "text": "            content=f\"\"\"",
            "lineNumber": 1626
          },
          {
            "text": "You are a Social Media Management Assistant with comprehensive capabilities",
            "lineNumber": 1627
          },
          {
            "text": "across multiple platforms. You MUST use the &#96;send_message_to_user&#96; tool to",
            "lineNumber": 1628
          },
          {
            "text": "inform the user of every decision and action you take. Your message must",
            "lineNumber": 1629
          },
          {
            "text": "include a short title and a one-sentence description. This is a mandatory",
            "lineNumber": 1630
          },
          {
            "text": "part of your workflow. When you complete your task, your final response must",
            "lineNumber": 1631
          },
          {
            "text": "be a comprehensive summary of your actions, presented in a clear, detailed,",
            "lineNumber": 1632
          },
          {
            "text": "and easy-to-read format. Avoid using markdown tables for presenting data;",
            "lineNumber": 1633
          },
          {
            "text": "use plain text formatting instead.",
            "lineNumber": 1634
          },
          {
            "lineNumber": 1635
          },
          {
            "text": "- **Working Directory**: &#96;{working_directory}&#96;. All local file operations must",
            "lineNumber": 1636
          },
          {
            "text": "occur here, but you can access files from any place in the file system. For all file system operations, you MUST use absolute paths to ensure precision and avoid ambiguity.",
            "lineNumber": 1637
          },
          {
            "text": "The current date is {NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.",
            "lineNumber": 1638
          },
          {
            "lineNumber": 1639
          },
          {
            "text": "Your integrated toolkits enable you to:",
            "lineNumber": 1640
          },
          {
            "lineNumber": 1641
          },
          {
            "text": "1. WhatsApp Business Management (WhatsAppToolkit):",
            "lineNumber": 1642
          },
          {
            "text": "   - Send text and template messages to customers via the WhatsApp Business",
            "lineNumber": 1643
          },
          {
            "text": "   API.",
            "lineNumber": 1644
          },
          {
            "text": "   - Retrieve business profile information.",
            "lineNumber": 1645
          },
          {
            "lineNumber": 1646
          },
          {
            "text": "2. Twitter Account Management (TwitterToolkit):",
            "lineNumber": 1647
          },
          {
            "text": "   - Create tweets with text content, polls, or as quote tweets.",
            "lineNumber": 1648
          },
          {
            "text": "   - Delete existing tweets.",
            "lineNumber": 1649
          },
          {
            "text": "   - Retrieve user profile information.",
            "lineNumber": 1650
          },
          {
            "lineNumber": 1651
          },
          {
            "text": "3. LinkedIn Professional Networking (LinkedInToolkit):",
            "lineNumber": 1652
          },
          {
            "text": "   - Create posts on LinkedIn.",
            "lineNumber": 1653
          },
          {
            "text": "   - Delete existing posts.",
            "lineNumber": 1654
          },
          {
            "text": "   - Retrieve authenticated user's profile information.",
            "lineNumber": 1655
          },
          {
            "lineNumber": 1656
          },
          {
            "text": "4. Reddit Content Analysis (RedditToolkit):",
            "lineNumber": 1657
          },
          {
            "text": "   - Collect top posts and comments from specified subreddits.",
            "lineNumber": 1658
          },
          {
            "text": "   - Perform sentiment analysis on Reddit comments.",
            "lineNumber": 1659
          },
          {
            "text": "   - Track keyword discussions across multiple subreddits.",
            "lineNumber": 1660
          },
          {
            "lineNumber": 1661
          },
          {
            "text": "5. Notion Workspace Management (NotionToolkit):",
            "lineNumber": 1662
          },
          {
            "text": "   - List all pages and users in a Notion workspace.",
            "lineNumber": 1663
          },
          {
            "text": "   - Retrieve and extract text content from Notion blocks.",
            "lineNumber": 1664
          },
          {
            "lineNumber": 1665
          },
          {
            "text": "6. Slack Workspace Interaction (SlackToolkit):",
            "lineNumber": 1666
          },
          {
            "text": "   - Create new Slack channels (public or private).",
            "lineNumber": 1667
          },
          {
            "text": "   - Join or leave existing channels.",
            "lineNumber": 1668
          },
          {
            "text": "   - Send and delete messages in channels.",
            "lineNumber": 1669
          },
          {
            "text": "   - Retrieve channel information and message history.",
            "lineNumber": 1670
          },
          {
            "lineNumber": 1671
          },
          {
            "text": "7. Human Interaction (HumanToolkit):",
            "lineNumber": 1672
          },
          {
            "text": "   - Ask questions to users and send messages via console.",
            "lineNumber": 1673
          },
          {
            "lineNumber": 1674
          },
          {
            "text": "8. Agent Communication:",
            "lineNumber": 1675
          },
          {
            "text": "   - Communicate with other agents using messaging tools when collaboration",
            "lineNumber": 1676
          },
          {
            "text": "   is needed. Use &#96;list_available_agents&#96; to see available team members and",
            "lineNumber": 1677
          },
          {
            "text": "   &#96;send_message&#96; to coordinate with them, especially when you need content",
            "lineNumber": 1678
          },
          {
            "text": "   from document agents or research from browser agents.",
            "lineNumber": 1679
          },
          {
            "lineNumber": 1680
          },
          {
            "text": "9. File System Access:",
            "lineNumber": 1681
          },
          {
            "text": "   - You can use terminal tools to interact with the local file system in",
            "lineNumber": 1682
          },
          {
            "text": "   your working directory (&#96;",
            "lineNumber": 1683
          }
        ]
      },
      "score": 0.3070079982280731
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\human_toolkit.py",
        "range": {
          "startPosition": {
            "line": 12
          },
          "endPosition": {
            "line": 147,
            "column": 9
          }
        },
        "contents": "@auto_listen_toolkit(BaseToolkit)\nclass HumanToolkit(BaseToolkit, AbstractToolkit):\n@listen_toolkit()\ndef send_message_to_user(\n        self,\n        message_title: str,\n        message_description: str,\n        message_attachment: str | None = None,\n    ) -&gt; str:\n\n        if not current_process_task_id:\n            current_process_task_id = self.api_task_id\n            logger.warning(f\"[send_message_to_user] ContextVar process_task is empty, using api_task_id as fallback: '{current_process_task_id}'\")\n\n        from app.utils.listen.toolkit_listen import _safe_put_queue\n\n        notice_data = ActionNoticeData(\n            process_task_id=current_process_task_id,\n            data=f\"{message_description}\",\n        )\n        _safe_put_queue(task_lock, notice_data)\n\n        attachment_info = f\" {message_attachment}\" if message_attachment else \"\"\n        return f\"Message successfully sent to user: '{message_title} {message_description}{attachment_info}'\"\n\n    def get_tools(self) -&gt; list[FunctionTool]:\n        r\"\"\"Returns a list of FunctionTool objects representing the\n        functions in the toolkit.\n\n        Returns:\n            List[FunctionTool]: A list of FunctionTool objects\n                representing the functions in the toolkit.\n        \"\"\"\n        return [\n            FunctionTool(self.ask_human_via_gui),\n            FunctionTool(self.send_message_to_user),\n        ]\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str, agent_name: str) -&gt; list[FunctionTool]:\n        human = cls(api_task_id, agent_name)\n        return [\n            FunctionTool(human.ask_human_via_gui),\n            # Note: send_message_to_user is not included in get_can_use_tools\n            # It is only available via get_tools() if needed\n        ]",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 13,
                "column": 1
              },
              "endPosition": {
                "line": 14,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 14,
                "column": 1
              },
              "endPosition": {
                "line": 15,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 64,
                "column": 5
              },
              "endPosition": {
                "line": 65,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 65,
                "column": 5
              },
              "endPosition": {
                "line": 71,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@auto_listen_toolkit(BaseToolkit)",
            "lineNumber": 13
          },
          {
            "text": "class HumanToolkit(BaseToolkit, AbstractToolkit):",
            "lineNumber": 14,
            "isSignature": true
          },
          {
            "text": "@listen_toolkit()",
            "lineNumber": 64
          },
          {
            "text": "def send_message_to_user(",
            "lineNumber": 65
          },
          {
            "text": "        self,",
            "lineNumber": 66
          },
          {
            "text": "        message_title: str,",
            "lineNumber": 67
          },
          {
            "text": "        message_description: str,",
            "lineNumber": 68
          },
          {
            "text": "        message_attachment: str | None = None,",
            "lineNumber": 69
          },
          {
            "text": "    ) -&gt; str:",
            "lineNumber": 70
          },
          {
            "lineNumber": 112
          },
          {
            "text": "        if not current_process_task_id:",
            "lineNumber": 113
          },
          {
            "text": "            current_process_task_id = self.api_task_id",
            "lineNumber": 114
          },
          {
            "text": "            logger.warning(f\"[send_message_to_user] ContextVar process_task is empty, using api_task_id as fallback: '{current_process_task_id}'\")",
            "lineNumber": 115
          },
          {
            "lineNumber": 116
          },
          {
            "text": "        from app.utils.listen.toolkit_listen import _safe_put_queue",
            "lineNumber": 117
          },
          {
            "lineNumber": 118
          },
          {
            "text": "        notice_data = ActionNoticeData(",
            "lineNumber": 119
          },
          {
            "text": "            process_task_id=current_process_task_id,",
            "lineNumber": 120
          },
          {
            "text": "            data=f\"{message_description}\",",
            "lineNumber": 121
          },
          {
            "text": "        )",
            "lineNumber": 122
          },
          {
            "text": "        _safe_put_queue(task_lock, notice_data)",
            "lineNumber": 123
          },
          {
            "lineNumber": 124
          },
          {
            "text": "        attachment_info = f\" {message_attachment}\" if message_attachment else \"\"",
            "lineNumber": 125
          },
          {
            "text": "        return f\"Message successfully sent to user: '{message_title} {message_description}{attachment_info}'\"",
            "lineNumber": 126
          },
          {
            "lineNumber": 127
          },
          {
            "text": "    def get_tools(self) -&gt; list[FunctionTool]:",
            "lineNumber": 128
          },
          {
            "text": "        r\"\"\"Returns a list of FunctionTool objects representing the",
            "lineNumber": 129
          },
          {
            "text": "        functions in the toolkit.",
            "lineNumber": 130
          },
          {
            "lineNumber": 131
          },
          {
            "text": "        Returns:",
            "lineNumber": 132
          },
          {
            "text": "            List[FunctionTool]: A list of FunctionTool objects",
            "lineNumber": 133
          },
          {
            "text": "                representing the functions in the toolkit.",
            "lineNumber": 134
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 135
          },
          {
            "text": "        return [",
            "lineNumber": 136
          },
          {
            "text": "            FunctionTool(self.ask_human_via_gui),",
            "lineNumber": 137
          },
          {
            "text": "            FunctionTool(self.send_message_to_user),",
            "lineNumber": 138
          },
          {
            "text": "        ]",
            "lineNumber": 139
          },
          {
            "lineNumber": 140
          },
          {
            "text": "    @classmethod",
            "lineNumber": 141
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str, agent_name: str) -&gt; list[FunctionTool]:",
            "lineNumber": 142
          },
          {
            "text": "        human = cls(api_task_id, agent_name)",
            "lineNumber": 143
          },
          {
            "text": "        return [",
            "lineNumber": 144
          },
          {
            "text": "            FunctionTool(human.ask_human_via_gui),",
            "lineNumber": 145
          },
          {
            "text": "            # Note: send_message_to_user is not included in get_can_use_tools",
            "lineNumber": 146
          },
          {
            "text": "            # It is only available via get_tools() if needed",
            "lineNumber": 147
          },
          {
            "text": "        ]",
            "lineNumber": 148,
            "isSignature": true
          }
        ]
      },
      "score": 0.3066132962703705
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\listen\\toolkit_listen.py",
        "range": {
          "startPosition": {
            "line": 78
          },
          "endPosition": {
            "line": 295
          }
        },
        "contents": "def listen_toolkit(\n    wrap_method: Callable[..., Any] | None = None,\n    inputs: Callable[..., str] | None = None,\n    return_msg: Callable[[Any], str] | None = None,\n):\ndef decorator(func: Callable[..., Any]):\n@wraps(wrap)\nasync def async_wrapper(*args, **kwargs):\n\n\n                if return_msg and error is None:\n                    res_msg = return_msg(res)\n                elif isinstance(res, str):\n                    res_msg = res\n                else:\n                    if error is None:\n                        try:\n                            res_msg = json.dumps(res, ensure_ascii=False)\n                        except TypeError:\n                            # Handle cases where res contains non-serializable objects (like coroutines)\n                            res_str = str(res)\n                            # Truncate very long outputs to avoid flooding logs\n                            MAX_LENGTH = 500\n                            if len(res_str) &gt; MAX_LENGTH:\n                                res_msg = res_str[:MAX_LENGTH] + f\"... (truncated, total length: {len(res_str)} chars)\"\n                            else:\n                                res_msg = res_str\n                    else:\n                        res_msg = str(error)\n\n                deactivate_timestamp = datetime.now().isoformat()\n                status = \"ERROR\" if error is not None else \"SUCCESS\"\n\n                # Log toolkit deactivation (only send to WorkFlow if not skipped)\n                logger.info(f\"[TOOLKIT DEACTIVATE] Toolkit: {toolkit_name} | Method: {method_name} | Task ID: {process_task_id} | Agent: {toolkit.agent_name} | Status: {status} | Timestamp: {deactivate_timestamp}\")\n\n                if not skip_workflow_display:\n                    deactivate_data = ActionDeactivateToolkitData(\n                        data={\n                            \"agent_name\": toolkit.agent_name,\n                            \"process_task_id\": process_task_id,\n                            \"toolkit_name\": toolkit_name,\n                            \"method_name\": method_name,\n                            \"message\": res_msg,\n                        },\n                    )\n                    await task_lock.put_queue(deactivate_data)\n                if error is not None:\n                    raise error",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 79,
                "column": 1
              },
              "endPosition": {
                "line": 84,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 84,
                "column": 5
              },
              "endPosition": {
                "line": 85,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 89,
                "column": 13
              },
              "endPosition": {
                "line": 90,
                "column": 13
              }
            },
            {
              "startPosition": {
                "line": 90,
                "column": 13
              },
              "endPosition": {
                "line": 91,
                "column": 17
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def listen_toolkit(",
            "lineNumber": 79,
            "isSignature": true
          },
          {
            "text": "    wrap_method: Callable[..., Any] | None = None,",
            "lineNumber": 80,
            "isSignature": true
          },
          {
            "text": "    inputs: Callable[..., str] | None = None,",
            "lineNumber": 81,
            "isSignature": true
          },
          {
            "text": "    return_msg: Callable[[Any], str] | None = None,",
            "lineNumber": 82,
            "isSignature": true
          },
          {
            "text": "):",
            "lineNumber": 83,
            "isSignature": true
          },
          {
            "text": "def decorator(func: Callable[..., Any]):",
            "lineNumber": 84
          },
          {
            "text": "@wraps(wrap)",
            "lineNumber": 89
          },
          {
            "text": "async def async_wrapper(*args, **kwargs):",
            "lineNumber": 90
          },
          {
            "lineNumber": 145
          },
          {
            "lineNumber": 146
          },
          {
            "text": "                if return_msg and error is None:",
            "lineNumber": 147
          },
          {
            "text": "                    res_msg = return_msg(res)",
            "lineNumber": 148
          },
          {
            "text": "                elif isinstance(res, str):",
            "lineNumber": 149
          },
          {
            "text": "                    res_msg = res",
            "lineNumber": 150
          },
          {
            "text": "                else:",
            "lineNumber": 151
          },
          {
            "text": "                    if error is None:",
            "lineNumber": 152
          },
          {
            "text": "                        try:",
            "lineNumber": 153
          },
          {
            "text": "                            res_msg = json.dumps(res, ensure_ascii=False)",
            "lineNumber": 154
          },
          {
            "text": "                        except TypeError:",
            "lineNumber": 155
          },
          {
            "text": "                            # Handle cases where res contains non-serializable objects (like coroutines)",
            "lineNumber": 156
          },
          {
            "text": "                            res_str = str(res)",
            "lineNumber": 157
          },
          {
            "text": "                            # Truncate very long outputs to avoid flooding logs",
            "lineNumber": 158
          },
          {
            "text": "                            MAX_LENGTH = 500",
            "lineNumber": 159
          },
          {
            "text": "                            if len(res_str) &gt; MAX_LENGTH:",
            "lineNumber": 160
          },
          {
            "text": "                                res_msg = res_str[:MAX_LENGTH] + f\"... (truncated, total length: {len(res_str)} chars)\"",
            "lineNumber": 161
          },
          {
            "text": "                            else:",
            "lineNumber": 162
          },
          {
            "text": "                                res_msg = res_str",
            "lineNumber": 163
          },
          {
            "text": "                    else:",
            "lineNumber": 164
          },
          {
            "text": "                        res_msg = str(error)",
            "lineNumber": 165
          },
          {
            "lineNumber": 166
          },
          {
            "text": "                deactivate_timestamp = datetime.now().isoformat()",
            "lineNumber": 167
          },
          {
            "text": "                status = \"ERROR\" if error is not None else \"SUCCESS\"",
            "lineNumber": 168
          },
          {
            "lineNumber": 169
          },
          {
            "text": "                # Log toolkit deactivation (only send to WorkFlow if not skipped)",
            "lineNumber": 170
          },
          {
            "text": "                logger.info(f\"[TOOLKIT DEACTIVATE] Toolkit: {toolkit_name} | Method: {method_name} | Task ID: {process_task_id} | Agent: {toolkit.agent_name} | Status: {status} | Timestamp: {deactivate_timestamp}\")",
            "lineNumber": 171
          },
          {
            "lineNumber": 172
          },
          {
            "text": "                if not skip_workflow_display:",
            "lineNumber": 173
          },
          {
            "text": "                    deactivate_data = ActionDeactivateToolkitData(",
            "lineNumber": 174
          },
          {
            "text": "                        data={",
            "lineNumber": 175
          },
          {
            "text": "                            \"agent_name\": toolkit.agent_name,",
            "lineNumber": 176
          },
          {
            "text": "                            \"process_task_id\": process_task_id,",
            "lineNumber": 177
          },
          {
            "text": "                            \"toolkit_name\": toolkit_name,",
            "lineNumber": 178
          },
          {
            "text": "                            \"method_name\": method_name,",
            "lineNumber": 179
          },
          {
            "text": "                            \"message\": res_msg,",
            "lineNumber": 180
          },
          {
            "text": "                        },",
            "lineNumber": 181
          },
          {
            "text": "                    )",
            "lineNumber": 182
          },
          {
            "text": "                    await task_lock.put_queue(deactivate_data)",
            "lineNumber": 183
          },
          {
            "text": "                if error is not None:",
            "lineNumber": 184
          },
          {
            "text": "                    raise error",
            "lineNumber": 185
          }
        ]
      },
      "score": 0.30347734689712524
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\listen\\toolkit_listen.py",
        "range": {
          "startPosition": {
            "line": 75,
            "column": 79
          },
          "endPosition": {
            "line": 295
          }
        },
        "contents": "def listen_toolkit(\n    wrap_method: Callable[..., Any] | None = None,\n    inputs: Callable[..., str] | None = None,\n    return_msg: Callable[[Any], str] | None = None,\n):\n    def decorator(func: Callable[..., Any]):\n        wrap = func if wrap_method is None else wrap_method\n\n        if iscoroutinefunction(func):\n            # async function wrapper\n            @wraps(wrap)\n            async def async_wrapper(*args, **kwargs):\n                toolkit: AbstractToolkit = args[0]\n                # Check if api_task_id exists\n                if not hasattr(toolkit, 'api_task_id'):\n                    logger.warning(f\"[listen_toolkit] {toolkit.__class__.__name__} missing api_task_id, calling method directly\")\n                    return await func(*args, **kwargs)\n                    \n                task_lock = get_task_lock(toolkit.api_task_id)\n\n                if inputs is not None:\n                    args_str = inputs(*args, **kwargs)\n                else:\n                    # remove first param self\n                    filtered_args = args[1:] if len(args) &gt; 0 else []\n\n                    args_str = \", \".join(repr(arg) for arg in filtered_args)\n                    if kwargs:\n                        kwargs_str = \", \".join(f\"{k}={v!r}\" for k, v in kwargs.items())\n                        args_str = f\"{args_str}, {kwargs_str}\" if args_str else kwargs_str\n\n                # Truncate args_str if too long\n                MAX_ARGS_LENGTH = 500\n                if len(args_str) &gt; MAX_ARGS_LENGTH:\n                    args_str = args_str[:MAX_ARGS_LENGTH] + f\"... (truncated, total length: {len(args_str)} chars)\"\n\n                toolkit_name = toolkit.toolkit_name()\n                method_name = func.__name__.replace(\"_\", \" \")\n\n                # Skip WorkFlow display for send_message_to_user (called by message_integration)\n                # It still executes normally and sends notice, just doesn't show as a tool call\n                skip_workflow_display = func.__name__ == \"send_message_to_user\"\n\n                # Multi-layer fallback to get process_task_id\n                process_task_id = process_task.get(\"\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def listen_toolkit(",
            "lineNumber": 79,
            "isSignature": true
          },
          {
            "text": "    wrap_method: Callable[..., Any] | None = None,",
            "lineNumber": 80,
            "isSignature": true
          },
          {
            "text": "    inputs: Callable[..., str] | None = None,",
            "lineNumber": 81,
            "isSignature": true
          },
          {
            "text": "    return_msg: Callable[[Any], str] | None = None,",
            "lineNumber": 82,
            "isSignature": true
          },
          {
            "text": "):",
            "lineNumber": 83,
            "isSignature": true
          },
          {
            "text": "    def decorator(func: Callable[..., Any]):",
            "lineNumber": 84
          },
          {
            "text": "        wrap = func if wrap_method is None else wrap_method",
            "lineNumber": 85
          },
          {
            "lineNumber": 86
          },
          {
            "text": "        if iscoroutinefunction(func):",
            "lineNumber": 87
          },
          {
            "text": "            # async function wrapper",
            "lineNumber": 88
          },
          {
            "text": "            @wraps(wrap)",
            "lineNumber": 89
          },
          {
            "text": "            async def async_wrapper(*args, **kwargs):",
            "lineNumber": 90
          },
          {
            "text": "                toolkit: AbstractToolkit = args[0]",
            "lineNumber": 91
          },
          {
            "text": "                # Check if api_task_id exists",
            "lineNumber": 92
          },
          {
            "text": "                if not hasattr(toolkit, 'api_task_id'):",
            "lineNumber": 93
          },
          {
            "text": "                    logger.warning(f\"[listen_toolkit] {toolkit.__class__.__name__} missing api_task_id, calling method directly\")",
            "lineNumber": 94
          },
          {
            "text": "                    return await func(*args, **kwargs)",
            "lineNumber": 95
          },
          {
            "text": "                    ",
            "lineNumber": 96
          },
          {
            "text": "                task_lock = get_task_lock(toolkit.api_task_id)",
            "lineNumber": 97
          },
          {
            "lineNumber": 98
          },
          {
            "text": "                if inputs is not None:",
            "lineNumber": 99
          },
          {
            "text": "                    args_str = inputs(*args, **kwargs)",
            "lineNumber": 100
          },
          {
            "text": "                else:",
            "lineNumber": 101
          },
          {
            "text": "                    # remove first param self",
            "lineNumber": 102
          },
          {
            "text": "                    filtered_args = args[1:] if len(args) &gt; 0 else []",
            "lineNumber": 103
          },
          {
            "lineNumber": 104
          },
          {
            "text": "                    args_str = \", \".join(repr(arg) for arg in filtered_args)",
            "lineNumber": 105
          },
          {
            "text": "                    if kwargs:",
            "lineNumber": 106
          },
          {
            "text": "                        kwargs_str = \", \".join(f\"{k}={v!r}\" for k, v in kwargs.items())",
            "lineNumber": 107
          },
          {
            "text": "                        args_str = f\"{args_str}, {kwargs_str}\" if args_str else kwargs_str",
            "lineNumber": 108
          },
          {
            "lineNumber": 109
          },
          {
            "text": "                # Truncate args_str if too long",
            "lineNumber": 110
          },
          {
            "text": "                MAX_ARGS_LENGTH = 500",
            "lineNumber": 111
          },
          {
            "text": "                if len(args_str) &gt; MAX_ARGS_LENGTH:",
            "lineNumber": 112
          },
          {
            "text": "                    args_str = args_str[:MAX_ARGS_LENGTH] + f\"... (truncated, total length: {len(args_str)} chars)\"",
            "lineNumber": 113
          },
          {
            "lineNumber": 114
          },
          {
            "text": "                toolkit_name = toolkit.toolkit_name()",
            "lineNumber": 115
          },
          {
            "text": "                method_name = func.__name__.replace(\"_\", \" \")",
            "lineNumber": 116
          },
          {
            "lineNumber": 117
          },
          {
            "text": "                # Skip WorkFlow display for send_message_to_user (called by message_integration)",
            "lineNumber": 118
          },
          {
            "text": "                # It still executes normally and sends notice, just doesn't show as a tool call",
            "lineNumber": 119
          },
          {
            "text": "                skip_workflow_display = func.__name__ == \"send_message_to_user\"",
            "lineNumber": 120
          },
          {
            "lineNumber": 121
          },
          {
            "text": "                # Multi-layer fallback to get process_task_id",
            "lineNumber": 122
          },
          {
            "text": "                process_task_id = process_task.get(\"\")",
            "lineNumber": 123
          }
        ]
      },
      "score": 0.3018985986709595
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\listen\\toolkit_listen.py",
        "range": {
          "startPosition": {
            "line": 78
          },
          "endPosition": {
            "line": 301,
            "column": 76
          }
        },
        "contents": "def listen_toolkit(\n    wrap_method: Callable[..., Any] | None = None,\n    inputs: Callable[..., str] | None = None,\n    return_msg: Callable[[Any], str] | None = None,\n):\ndef decorator(func: Callable[..., Any]):\n@wraps(wrap)\ndef sync_wrapper(*args, **kwargs):\n\n\n                if return_msg and error is None:\n                    res_msg = return_msg(res)\n                elif isinstance(res, str):\n                    res_msg = res\n                else:\n                    if error is None:\n                        try:\n                            res_msg = json.dumps(res, ensure_ascii=False)\n                        except TypeError:\n                            # Handle cases where res contains non-serializable objects (like coroutines)\n                            res_str = str(res)\n                            # Truncate very long outputs to avoid flooding logs\n                            MAX_LENGTH = 500\n                            if len(res_str) &gt; MAX_LENGTH:\n                                res_msg = res_str[:MAX_LENGTH] + f\"... (truncated, total length: {len(res_str)} chars)\"\n                            else:\n                                res_msg = res_str\n                    else:\n                        res_msg = str(error)\n\n                if not skip_workflow_display:\n                    deactivate_data = ActionDeactivateToolkitData(\n                        data={\n                            \"agent_name\": toolkit.agent_name,\n                            \"process_task_id\": process_task_id,\n                            \"toolkit_name\": toolkit_name,\n                            \"method_name\": method_name,\n                            \"message\": res_msg,\n                        },\n                    )\n                    _safe_put_queue(task_lock, deactivate_data)\n\n                if error is not None:\n                    raise error\n                return res\n\n            return sync_wrapper\n\n    return decorator\n\n\nT = TypeVar('T')\n\n# Methods that should not be wrapped by auto_listen_toolkit\n# These are utility/helper methods that don't perform actual tool operations",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 79,
                "column": 1
              },
              "endPosition": {
                "line": 84,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 84,
                "column": 5
              },
              "endPosition": {
                "line": 85,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 89,
                "column": 13
              },
              "endPosition": {
                "line": 90,
                "column": 13
              }
            },
            {
              "startPosition": {
                "line": 90,
                "column": 13
              },
              "endPosition": {
                "line": 91,
                "column": 17
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def listen_toolkit(",
            "lineNumber": 79,
            "isSignature": true
          },
          {
            "text": "    wrap_method: Callable[..., Any] | None = None,",
            "lineNumber": 80,
            "isSignature": true
          },
          {
            "text": "    inputs: Callable[..., str] | None = None,",
            "lineNumber": 81,
            "isSignature": true
          },
          {
            "text": "    return_msg: Callable[[Any], str] | None = None,",
            "lineNumber": 82,
            "isSignature": true
          },
          {
            "text": "):",
            "lineNumber": 83,
            "isSignature": true
          },
          {
            "text": "def decorator(func: Callable[..., Any]):",
            "lineNumber": 84
          },
          {
            "text": "@wraps(wrap)",
            "lineNumber": 192
          },
          {
            "text": "def sync_wrapper(*args, **kwargs):",
            "lineNumber": 193
          },
          {
            "lineNumber": 256
          },
          {
            "lineNumber": 257
          },
          {
            "text": "                if return_msg and error is None:",
            "lineNumber": 258
          },
          {
            "text": "                    res_msg = return_msg(res)",
            "lineNumber": 259
          },
          {
            "text": "                elif isinstance(res, str):",
            "lineNumber": 260
          },
          {
            "text": "                    res_msg = res",
            "lineNumber": 261
          },
          {
            "text": "                else:",
            "lineNumber": 262
          },
          {
            "text": "                    if error is None:",
            "lineNumber": 263
          },
          {
            "text": "                        try:",
            "lineNumber": 264
          },
          {
            "text": "                            res_msg = json.dumps(res, ensure_ascii=False)",
            "lineNumber": 265
          },
          {
            "text": "                        except TypeError:",
            "lineNumber": 266
          },
          {
            "text": "                            # Handle cases where res contains non-serializable objects (like coroutines)",
            "lineNumber": 267
          },
          {
            "text": "                            res_str = str(res)",
            "lineNumber": 268
          },
          {
            "text": "                            # Truncate very long outputs to avoid flooding logs",
            "lineNumber": 269
          },
          {
            "text": "                            MAX_LENGTH = 500",
            "lineNumber": 270
          },
          {
            "text": "                            if len(res_str) &gt; MAX_LENGTH:",
            "lineNumber": 271
          },
          {
            "text": "                                res_msg = res_str[:MAX_LENGTH] + f\"... (truncated, total length: {len(res_str)} chars)\"",
            "lineNumber": 272
          },
          {
            "text": "                            else:",
            "lineNumber": 273
          },
          {
            "text": "                                res_msg = res_str",
            "lineNumber": 274
          },
          {
            "text": "                    else:",
            "lineNumber": 275
          },
          {
            "text": "                        res_msg = str(error)",
            "lineNumber": 276
          },
          {
            "lineNumber": 277
          },
          {
            "text": "                if not skip_workflow_display:",
            "lineNumber": 278
          },
          {
            "text": "                    deactivate_data = ActionDeactivateToolkitData(",
            "lineNumber": 279
          },
          {
            "text": "                        data={",
            "lineNumber": 280
          },
          {
            "text": "                            \"agent_name\": toolkit.agent_name,",
            "lineNumber": 281
          },
          {
            "text": "                            \"process_task_id\": process_task_id,",
            "lineNumber": 282
          },
          {
            "text": "                            \"toolkit_name\": toolkit_name,",
            "lineNumber": 283
          },
          {
            "text": "                            \"method_name\": method_name,",
            "lineNumber": 284
          },
          {
            "text": "                            \"message\": res_msg,",
            "lineNumber": 285
          },
          {
            "text": "                        },",
            "lineNumber": 286
          },
          {
            "text": "                    )",
            "lineNumber": 287
          },
          {
            "text": "                    _safe_put_queue(task_lock, deactivate_data)",
            "lineNumber": 288
          },
          {
            "lineNumber": 289
          },
          {
            "text": "                if error is not None:",
            "lineNumber": 290
          },
          {
            "text": "                    raise error",
            "lineNumber": 291
          },
          {
            "text": "                return res",
            "lineNumber": 292
          },
          {
            "lineNumber": 293
          },
          {
            "text": "            return sync_wrapper",
            "lineNumber": 294
          },
          {
            "lineNumber": 295
          },
          {
            "text": "    return decorator",
            "lineNumber": 296,
            "isSignature": true
          },
          {
            "lineNumber": 297
          },
          {
            "lineNumber": 298
          },
          {
            "text": "T = TypeVar('T')",
            "lineNumber": 299
          },
          {
            "lineNumber": 300
          },
          {
            "text": "# Methods that should not be wrapped by auto_listen_toolkit",
            "lineNumber": 301
          },
          {
            "text": "# These are utility/helper methods that don't perform actual tool operations",
            "lineNumber": 302
          }
        ]
      },
      "score": 0.300487756729126
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 83
          },
          "endPosition": {
            "line": 654
          }
        },
        "contents": "class ListenChatAgent(ChatAgent):\n@traceroot.trace()\ndef _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:\n\n            # Prepare result message with truncation\n            if isinstance(result, str):\n                result_msg = result\n            else:\n                result_str = repr(result)\n                MAX_RESULT_LENGTH = 500\n                if len(result_str) &gt; MAX_RESULT_LENGTH:\n                    result_msg = (\n                        result_str[:MAX_RESULT_LENGTH]\n                        + f\"... (truncated, total length: {len(result_str)} chars)\"\n                    )\n                else:\n                    result_msg = result_str\n\n            # Only send deactivate event if tool is NOT wrapped by @listen_toolkit\n            if not has_listen_decorator:\n                asyncio.create_task(\n                    task_lock.put_queue(\n                        ActionDeactivateToolkitData(\n                            data={\n                                \"agent_name\": self.agent_name,\n                                \"process_task_id\": self.process_task_id,\n                                \"toolkit_name\": toolkit_name,\n                                \"method_name\": func_name,\n                                \"message\": result_msg,\n                            },\n                        )\n                    )\n                )\n        except Exception as e:\n            # Capture the error message to prevent framework crash\n            error_msg = f\"Error executing tool '{func_name}': {e!s}\"\n            result = f\"Tool execution failed: {error_msg}\"\n            mask_flag = False\n            traceroot_logger.error(\n                f\"Tool execution failed for {func_name}: {e}\", exc_info=True\n            )\n\n        return self._record_tool_calling(\n            func_name,\n            args,\n            result,\n            tool_call_id,\n            mask_output=mask_flag,\n            extra_content=tool_call_request.extra_content,\n        )\n\n    @traceroot.trace()\n    async def _aexecute_tool(\n        self, tool_call_request: ToolCallRequest\n    ) -&gt; ToolCallingRecord:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 84,
                "column": 1
              },
              "endPosition": {
                "line": 85,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 276,
                "column": 5
              },
              "endPosition": {
                "line": 277,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 277,
                "column": 5
              },
              "endPosition": {
                "line": 282,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ListenChatAgent(ChatAgent):",
            "lineNumber": 84,
            "isSignature": true
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 361
          },
          {
            "text": "def _execute_tool(self, tool_call_request: ToolCallRequest) -&gt; ToolCallingRecord:",
            "lineNumber": 362
          },
          {
            "lineNumber": 418
          },
          {
            "text": "            # Prepare result message with truncation",
            "lineNumber": 419
          },
          {
            "text": "            if isinstance(result, str):",
            "lineNumber": 420
          },
          {
            "text": "                result_msg = result",
            "lineNumber": 421
          },
          {
            "text": "            else:",
            "lineNumber": 422
          },
          {
            "text": "                result_str = repr(result)",
            "lineNumber": 423
          },
          {
            "text": "                MAX_RESULT_LENGTH = 500",
            "lineNumber": 424
          },
          {
            "text": "                if len(result_str) &gt; MAX_RESULT_LENGTH:",
            "lineNumber": 425
          },
          {
            "text": "                    result_msg = (",
            "lineNumber": 426
          },
          {
            "text": "                        result_str[:MAX_RESULT_LENGTH]",
            "lineNumber": 427
          },
          {
            "text": "                        + f\"... (truncated, total length: {len(result_str)} chars)\"",
            "lineNumber": 428
          },
          {
            "text": "                    )",
            "lineNumber": 429
          },
          {
            "text": "                else:",
            "lineNumber": 430
          },
          {
            "text": "                    result_msg = result_str",
            "lineNumber": 431
          },
          {
            "lineNumber": 432
          },
          {
            "text": "            # Only send deactivate event if tool is NOT wrapped by @listen_toolkit",
            "lineNumber": 433
          },
          {
            "text": "            if not has_listen_decorator:",
            "lineNumber": 434
          },
          {
            "text": "                asyncio.create_task(",
            "lineNumber": 435
          },
          {
            "text": "                    task_lock.put_queue(",
            "lineNumber": 436
          },
          {
            "text": "                        ActionDeactivateToolkitData(",
            "lineNumber": 437
          },
          {
            "text": "                            data={",
            "lineNumber": 438
          },
          {
            "text": "                                \"agent_name\": self.agent_name,",
            "lineNumber": 439
          },
          {
            "text": "                                \"process_task_id\": self.process_task_id,",
            "lineNumber": 440
          },
          {
            "text": "                                \"toolkit_name\": toolkit_name,",
            "lineNumber": 441
          },
          {
            "text": "                                \"method_name\": func_name,",
            "lineNumber": 442
          },
          {
            "text": "                                \"message\": result_msg,",
            "lineNumber": 443
          },
          {
            "text": "                            },",
            "lineNumber": 444
          },
          {
            "text": "                        )",
            "lineNumber": 445
          },
          {
            "text": "                    )",
            "lineNumber": 446
          },
          {
            "text": "                )",
            "lineNumber": 447
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 448
          },
          {
            "text": "            # Capture the error message to prevent framework crash",
            "lineNumber": 449
          },
          {
            "text": "            error_msg = f\"Error executing tool '{func_name}': {e!s}\"",
            "lineNumber": 450
          },
          {
            "text": "            result = f\"Tool execution failed: {error_msg}\"",
            "lineNumber": 451
          },
          {
            "text": "            mask_flag = False",
            "lineNumber": 452
          },
          {
            "text": "            traceroot_logger.error(",
            "lineNumber": 453
          },
          {
            "text": "                f\"Tool execution failed for {func_name}: {e}\", exc_info=True",
            "lineNumber": 454
          },
          {
            "text": "            )",
            "lineNumber": 455
          },
          {
            "lineNumber": 456
          },
          {
            "text": "        return self._record_tool_calling(",
            "lineNumber": 457
          },
          {
            "text": "            func_name,",
            "lineNumber": 458
          },
          {
            "text": "            args,",
            "lineNumber": 459
          },
          {
            "text": "            result,",
            "lineNumber": 460
          },
          {
            "text": "            tool_call_id,",
            "lineNumber": 461
          },
          {
            "text": "            mask_output=mask_flag,",
            "lineNumber": 462
          },
          {
            "text": "            extra_content=tool_call_request.extra_content,",
            "lineNumber": 463
          },
          {
            "text": "        )",
            "lineNumber": 464
          },
          {
            "lineNumber": 465
          },
          {
            "text": "    @traceroot.trace()",
            "lineNumber": 466
          },
          {
            "text": "    async def _aexecute_tool(",
            "lineNumber": 467
          },
          {
            "text": "        self, tool_call_request: ToolCallRequest",
            "lineNumber": 468
          },
          {
            "text": "    ) -&gt; ToolCallingRecord:",
            "lineNumber": 469
          },
          {
            "text": "        ",
            "lineNumber": 470
          }
        ]
      },
      "score": 0.30029165744781494
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 1297,
            "column": 17
          },
          "endPosition": {
            "line": 1424
          }
        },
        "contents": "@traceroot.trace()\nasync def construct_workforce(options: Chat) -&gt; tuple[Workforce, ListenChatAgent]:\n    logger.info(\"Constructing workforce\", extra={\"project_id\": options.project_id, \"task_id\": options.task_id})\n    working_directory = get_working_directory(options)\n    logger.debug(\"Working directory set\", extra={\"working_directory\": working_directory})\n    [coordinator_agent, task_agent] = [\n        agent_model(\n            key,\n            prompt,\n            options,\n            [\n                *(\n                    ToolkitMessageIntegration(\n                        message_handler=HumanToolkit(options.project_id, key).send_message_to_user\n                    ).register_toolkits(NoteTakingToolkit(options.project_id, working_directory=working_directory))\n                ).get_tools()\n            ],\n        )\n        for key, prompt in {\n            Agents.coordinator_agent:",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1301
          },
          {
            "text": "async def construct_workforce(options: Chat) -&gt; tuple[Workforce, ListenChatAgent]:",
            "lineNumber": 1302,
            "isSignature": true
          },
          {
            "text": "    logger.info(\"Constructing workforce\", extra={\"project_id\": options.project_id, \"task_id\": options.task_id})",
            "lineNumber": 1303
          },
          {
            "text": "    working_directory = get_working_directory(options)",
            "lineNumber": 1304
          },
          {
            "text": "    logger.debug(\"Working directory set\", extra={\"working_directory\": working_directory})",
            "lineNumber": 1305
          },
          {
            "text": "    [coordinator_agent, task_agent] = [",
            "lineNumber": 1306
          },
          {
            "text": "        agent_model(",
            "lineNumber": 1307
          },
          {
            "text": "            key,",
            "lineNumber": 1308
          },
          {
            "text": "            prompt,",
            "lineNumber": 1309
          },
          {
            "text": "            options,",
            "lineNumber": 1310
          },
          {
            "text": "            [",
            "lineNumber": 1311
          },
          {
            "text": "                *(",
            "lineNumber": 1312
          },
          {
            "text": "                    ToolkitMessageIntegration(",
            "lineNumber": 1313
          },
          {
            "text": "                        message_handler=HumanToolkit(options.project_id, key).send_message_to_user",
            "lineNumber": 1314
          },
          {
            "text": "                    ).register_toolkits(NoteTakingToolkit(options.project_id, working_directory=working_directory))",
            "lineNumber": 1315
          },
          {
            "text": "                ).get_tools()",
            "lineNumber": 1316
          },
          {
            "text": "            ],",
            "lineNumber": 1317
          },
          {
            "text": "        )",
            "lineNumber": 1318
          },
          {
            "text": "        for key, prompt in {",
            "lineNumber": 1319
          },
          {
            "text": "            Agents.coordinator_agent:",
            "lineNumber": 1320
          }
        ]
      },
      "score": 0.29879310727119446
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 83
          },
          "endPosition": {
            "line": 654
          }
        },
        "contents": "class ListenChatAgent(ChatAgent):\n@traceroot.trace()\nasync def _aexecute_tool(\n        self, tool_call_request: ToolCallRequest\n    ) -&gt; ToolCallingRecord:\n\n\n        # Always send activate event from agent to ensure consistent logging\n        # This ensures all tool calls are logged, regardless of decorator detection issues\n        await task_lock.put_queue(\n            ActionActivateToolkitData(\n                data={\n                    \"agent_name\": self.agent_name,\n                    \"process_task_id\": self.process_task_id,\n                    \"toolkit_name\": toolkit_name,\n                    \"method_name\": func_name,\n                    \"message\": json.dumps(args, ensure_ascii=False),\n                },\n            )\n        )\n        try:\n            # Set process_task context for all tool executions\n            with set_process_task(self.process_task_id):\n                # Try different invocation paths in order of preference\n                if hasattr(tool, \"func\") and hasattr(tool.func, \"async_call\"):\n                    # Case: FunctionTool wrapping an MCP tool\n                    # Check if the wrapped tool is sync to avoid run_in_executor\n                    if hasattr(tool, \"is_async\") and not tool.is_async:\n                        # Sync tool: call directly to preserve ContextVar\n                        result = tool(**args)\n                        if asyncio.iscoroutine(result):\n                            result = await result\n                    else:\n                        # Async tool: use async_call\n                        result = await tool.func.async_call(**args)\n\n                elif hasattr(tool, \"async_call\") and callable(tool.async_call)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 84,
                "column": 1
              },
              "endPosition": {
                "line": 85,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 466,
                "column": 5
              },
              "endPosition": {
                "line": 467,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 467,
                "column": 5
              },
              "endPosition": {
                "line": 470,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ListenChatAgent(ChatAgent):",
            "lineNumber": 84,
            "isSignature": true
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 466
          },
          {
            "text": "async def _aexecute_tool(",
            "lineNumber": 467
          },
          {
            "text": "        self, tool_call_request: ToolCallRequest",
            "lineNumber": 468
          },
          {
            "text": "    ) -&gt; ToolCallingRecord:",
            "lineNumber": 469
          },
          {
            "lineNumber": 512
          },
          {
            "lineNumber": 513
          },
          {
            "text": "        # Always send activate event from agent to ensure consistent logging",
            "lineNumber": 514
          },
          {
            "text": "        # This ensures all tool calls are logged, regardless of decorator detection issues",
            "lineNumber": 515
          },
          {
            "text": "        await task_lock.put_queue(",
            "lineNumber": 516
          },
          {
            "text": "            ActionActivateToolkitData(",
            "lineNumber": 517
          },
          {
            "text": "                data={",
            "lineNumber": 518
          },
          {
            "text": "                    \"agent_name\": self.agent_name,",
            "lineNumber": 519
          },
          {
            "text": "                    \"process_task_id\": self.process_task_id,",
            "lineNumber": 520
          },
          {
            "text": "                    \"toolkit_name\": toolkit_name,",
            "lineNumber": 521
          },
          {
            "text": "                    \"method_name\": func_name,",
            "lineNumber": 522
          },
          {
            "text": "                    \"message\": json.dumps(args, ensure_ascii=False),",
            "lineNumber": 523
          },
          {
            "text": "                },",
            "lineNumber": 524
          },
          {
            "text": "            )",
            "lineNumber": 525
          },
          {
            "text": "        )",
            "lineNumber": 526
          },
          {
            "text": "        try:",
            "lineNumber": 527
          },
          {
            "text": "            # Set process_task context for all tool executions",
            "lineNumber": 528
          },
          {
            "text": "            with set_process_task(self.process_task_id):",
            "lineNumber": 529
          },
          {
            "text": "                # Try different invocation paths in order of preference",
            "lineNumber": 530
          },
          {
            "text": "                if hasattr(tool, \"func\") and hasattr(tool.func, \"async_call\"):",
            "lineNumber": 531
          },
          {
            "text": "                    # Case: FunctionTool wrapping an MCP tool",
            "lineNumber": 532
          },
          {
            "text": "                    # Check if the wrapped tool is sync to avoid run_in_executor",
            "lineNumber": 533
          },
          {
            "text": "                    if hasattr(tool, \"is_async\") and not tool.is_async:",
            "lineNumber": 534
          },
          {
            "text": "                        # Sync tool: call directly to preserve ContextVar",
            "lineNumber": 535
          },
          {
            "text": "                        result = tool(**args)",
            "lineNumber": 536
          },
          {
            "text": "                        if asyncio.iscoroutine(result):",
            "lineNumber": 537
          },
          {
            "text": "                            result = await result",
            "lineNumber": 538
          },
          {
            "text": "                    else:",
            "lineNumber": 539
          },
          {
            "text": "                        # Async tool: use async_call",
            "lineNumber": 540
          },
          {
            "text": "                        result = await tool.func.async_call(**args)",
            "lineNumber": 541
          },
          {
            "lineNumber": 542
          },
          {
            "text": "                elif hasattr(tool, \"async_call\") and callable(tool.async_call)",
            "lineNumber": 543
          }
        ]
      },
      "score": 0.28541600704193115
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 44,
            "column": 62
          },
          "endPosition": {
            "line": 654
          }
        },
        "contents": "from app.utils.toolkit.github_toolkit import GithubToolkit\nfrom app.utils.toolkit.search_toolkit import SearchToolkit\nfrom app.utils.toolkit.video_download_toolkit import VideoDownloaderToolkit\nfrom app.utils.toolkit.audio_analysis_toolkit import AudioAnalysisToolkit\nfrom app.utils.toolkit.video_analysis_toolkit import VideoAnalysisToolkit\nfrom app.utils.toolkit.image_analysis_toolkit import ImageAnalysisToolkit\nfrom app.utils.toolkit.openai_image_toolkit import OpenAIImageToolkit\nfrom app.utils.toolkit.web_deploy_toolkit import WebDeployToolkit\nfrom app.utils.toolkit.whatsapp_toolkit import WhatsAppToolkit\nfrom app.utils.toolkit.twitter_toolkit import TwitterToolkit\nfrom app.utils.toolkit.linkedin_toolkit import LinkedInToolkit\nfrom app.utils.toolkit.reddit_toolkit import RedditToolkit\nfrom app.utils.toolkit.slack_toolkit import SlackToolkit\nfrom app.utils.toolkit.lark_toolkit import LarkToolkit\nfrom camel.types import ModelPlatformType, ModelType\nfrom camel.toolkits import MCPToolkit, ToolkitMessageIntegration\nimport datetime\nfrom pydantic import BaseModel\nfrom app.model.chat import Chat, McpServers\n\n# Create traceroot logger for agent tracking\ntraceroot_logger = traceroot.get_logger(\"agent\")\nfrom app.service.task import (\n    Action,\n    ActionActivateAgentData,\n    ActionActivateToolkitData,\n    ActionBudgetNotEnough,\n    ActionCreateAgentData,\n    ActionDeactivateAgentData,\n    ActionDeactivateToolkitData,\n    Agents,\n    get_task_lock,\n)\nfrom app.service.task import set_process_task\n\nNOW_STR = datetime.datetime.now().strftime(\"%Y-%m-%d %H:00:00\")\n\n\nclass ListenChatAgent(ChatAgent):\n    @traceroot.trace()\n    def __init__(\n        self,\n        api_task_id: str,\n        agent_name: str,\n        system_message: BaseMessage | str | None = None,\n        model: (\n            BaseModelBackend\n            | ModelManager\n            | Tuple[str, str]\n            | str\n            | ModelType\n            | Tuple[ModelPlatformType, ModelType]\n            | List[BaseModelBackend]\n            | List[str]\n            | List[ModelType]\n            | List[Tuple[str, str]]\n            | List[Tuple[ModelPlatformType, ModelType]]\n            | None\n        ) = None,\n        memory: AgentMemory | None = None,\n        message_window_size: int | None = None,\n        token_limit: int | None = None,\n        output_language: str | None = None,\n        tools: List[FunctionTool | Callable[..., Any]] | None = None,\n        toolkits_to_register_agent: List[RegisteredAgentToolkit] | None = None,\n        external_tools: (\n            List[FunctionTool | Callable[..., Any] | Dict[str, Any]] | None\n        ) = None,\n        response_terminators: List[ResponseTerminator] | None = None,\n        scheduling_strategy: str = \"round_robin\",\n        max_iteration: int | None = None,\n        agent_id: str | None = None,\n        stop_event: Event | None = None,\n        tool_execution_timeout: float | None = None,\n        mask_tool_output: bool = False,\n        pause_event: asyncio.Event | None = None,\n        prune_tool_calls_from_memory: bool = False,\n        enable_snapshot_clean: bool = False,\n        step_timeout: float | None = 900,\n        **kwargs: Any,\n    ) -&gt; None:\n        ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from app.utils.toolkit.github_toolkit import GithubToolkit",
            "lineNumber": 46
          },
          {
            "text": "from app.utils.toolkit.search_toolkit import SearchToolkit",
            "lineNumber": 47
          },
          {
            "text": "from app.utils.toolkit.video_download_toolkit import VideoDownloaderToolkit",
            "lineNumber": 48
          },
          {
            "text": "from app.utils.toolkit.audio_analysis_toolkit import AudioAnalysisToolkit",
            "lineNumber": 49
          },
          {
            "text": "from app.utils.toolkit.video_analysis_toolkit import VideoAnalysisToolkit",
            "lineNumber": 50
          },
          {
            "text": "from app.utils.toolkit.image_analysis_toolkit import ImageAnalysisToolkit",
            "lineNumber": 51
          },
          {
            "text": "from app.utils.toolkit.openai_image_toolkit import OpenAIImageToolkit",
            "lineNumber": 52
          },
          {
            "text": "from app.utils.toolkit.web_deploy_toolkit import WebDeployToolkit",
            "lineNumber": 53
          },
          {
            "text": "from app.utils.toolkit.whatsapp_toolkit import WhatsAppToolkit",
            "lineNumber": 54
          },
          {
            "text": "from app.utils.toolkit.twitter_toolkit import TwitterToolkit",
            "lineNumber": 55
          },
          {
            "text": "from app.utils.toolkit.linkedin_toolkit import LinkedInToolkit",
            "lineNumber": 56
          },
          {
            "text": "from app.utils.toolkit.reddit_toolkit import RedditToolkit",
            "lineNumber": 57
          },
          {
            "text": "from app.utils.toolkit.slack_toolkit import SlackToolkit",
            "lineNumber": 58
          },
          {
            "text": "from app.utils.toolkit.lark_toolkit import LarkToolkit",
            "lineNumber": 59
          },
          {
            "text": "from camel.types import ModelPlatformType, ModelType",
            "lineNumber": 60
          },
          {
            "text": "from camel.toolkits import MCPToolkit, ToolkitMessageIntegration",
            "lineNumber": 61
          },
          {
            "text": "import datetime",
            "lineNumber": 62
          },
          {
            "text": "from pydantic import BaseModel",
            "lineNumber": 63
          },
          {
            "text": "from app.model.chat import Chat, McpServers",
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "# Create traceroot logger for agent tracking",
            "lineNumber": 66
          },
          {
            "text": "traceroot_logger = traceroot.get_logger(\"agent\")",
            "lineNumber": 67
          },
          {
            "text": "from app.service.task import (",
            "lineNumber": 68
          },
          {
            "text": "    Action,",
            "lineNumber": 69
          },
          {
            "text": "    ActionActivateAgentData,",
            "lineNumber": 70
          },
          {
            "text": "    ActionActivateToolkitData,",
            "lineNumber": 71
          },
          {
            "text": "    ActionBudgetNotEnough,",
            "lineNumber": 72
          },
          {
            "text": "    ActionCreateAgentData,",
            "lineNumber": 73
          },
          {
            "text": "    ActionDeactivateAgentData,",
            "lineNumber": 74
          },
          {
            "text": "    ActionDeactivateToolkitData,",
            "lineNumber": 75
          },
          {
            "text": "    Agents,",
            "lineNumber": 76
          },
          {
            "text": "    get_task_lock,",
            "lineNumber": 77
          },
          {
            "text": ")",
            "lineNumber": 78
          },
          {
            "text": "from app.service.task import set_process_task",
            "lineNumber": 79
          },
          {
            "lineNumber": 80
          },
          {
            "text": "NOW_STR = datetime.datetime.now().strftime(\"%Y-%m-%d %H:00:00\")",
            "lineNumber": 81
          },
          {
            "lineNumber": 82
          },
          {
            "lineNumber": 83
          },
          {
            "text": "class ListenChatAgent(ChatAgent):",
            "lineNumber": 84,
            "isSignature": true
          },
          {
            "text": "    @traceroot.trace()",
            "lineNumber": 85
          },
          {
            "text": "    def __init__(",
            "lineNumber": 86
          },
          {
            "text": "        self,",
            "lineNumber": 87
          },
          {
            "text": "        api_task_id: str,",
            "lineNumber": 88
          },
          {
            "text": "        agent_name: str,",
            "lineNumber": 89
          },
          {
            "text": "        system_message: BaseMessage | str | None = None,",
            "lineNumber": 90
          },
          {
            "text": "        model: (",
            "lineNumber": 91
          },
          {
            "text": "            BaseModelBackend",
            "lineNumber": 92
          },
          {
            "text": "            | ModelManager",
            "lineNumber": 93
          },
          {
            "text": "            | Tuple[str, str]",
            "lineNumber": 94
          },
          {
            "text": "            | str",
            "lineNumber": 95
          },
          {
            "text": "            | ModelType",
            "lineNumber": 96
          },
          {
            "text": "            | Tuple[ModelPlatformType, ModelType]",
            "lineNumber": 97
          },
          {
            "text": "            | List[BaseModelBackend]",
            "lineNumber": 98
          },
          {
            "text": "            | List[str]",
            "lineNumber": 99
          },
          {
            "text": "            | List[ModelType]",
            "lineNumber": 100
          },
          {
            "text": "            | List[Tuple[str, str]]",
            "lineNumber": 101
          },
          {
            "text": "            | List[Tuple[ModelPlatformType, ModelType]]",
            "lineNumber": 102
          },
          {
            "text": "            | None",
            "lineNumber": 103
          },
          {
            "text": "        ) = None,",
            "lineNumber": 104
          },
          {
            "text": "        memory: AgentMemory | None = None,",
            "lineNumber": 105
          },
          {
            "text": "        message_window_size: int | None = None,",
            "lineNumber": 106
          },
          {
            "text": "        token_limit: int | None = None,",
            "lineNumber": 107
          },
          {
            "text": "        output_language: str | None = None,",
            "lineNumber": 108
          },
          {
            "text": "        tools: List[FunctionTool | Callable[..., Any]] | None = None,",
            "lineNumber": 109
          },
          {
            "text": "        toolkits_to_register_agent: List[RegisteredAgentToolkit] | None = None,",
            "lineNumber": 110
          },
          {
            "text": "        external_tools: (",
            "lineNumber": 111
          },
          {
            "text": "            List[FunctionTool | Callable[..., Any] | Dict[str, Any]] | None",
            "lineNumber": 112
          },
          {
            "text": "        ) = None,",
            "lineNumber": 113
          },
          {
            "text": "        response_terminators: List[ResponseTerminator] | None = None,",
            "lineNumber": 114
          },
          {
            "text": "        scheduling_strategy: str = \"round_robin\",",
            "lineNumber": 115
          },
          {
            "text": "        max_iteration: int | None = None,",
            "lineNumber": 116
          },
          {
            "text": "        agent_id: str | None = None,",
            "lineNumber": 117
          },
          {
            "text": "        stop_event: Event | None = None,",
            "lineNumber": 118
          },
          {
            "text": "        tool_execution_timeout: float | None = None,",
            "lineNumber": 119
          },
          {
            "text": "        mask_tool_output: bool = False,",
            "lineNumber": 120
          },
          {
            "text": "        pause_event: asyncio.Event | None = None,",
            "lineNumber": 121
          },
          {
            "text": "        prune_tool_calls_from_memory: bool = False,",
            "lineNumber": 122
          },
          {
            "text": "        enable_snapshot_clean: bool = False,",
            "lineNumber": 123
          },
          {
            "text": "        step_timeout: float | None = 900,",
            "lineNumber": 124
          },
          {
            "text": "        **kwargs: Any,",
            "lineNumber": 125
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 126
          },
          {
            "text": "        ",
            "lineNumber": 127
          }
        ]
      },
      "score": 0.2827852964401245
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 236
          },
          "endPosition": {
            "line": 1075
          }
        },
        "contents": "@sync_step\n@traceroot.trace()\nasync def step_solve(options: Chat, request: Request, task_lock: TaskLock):\n    # if True:\n    #     import faulthandler\n\n    #     faulthandler.enable()\n    #     for second in [5, 10, 20, 30, 60, 120, 240]:\n    #         faulthandler.dump_traceback_later(second)\n\n                else:\n                    if workforce is None:\n                        logger.warning(f\"[TRACE] Workforce is None - this might be the issue\")\n                    if not new_task_content:\n                        logger.warning(f\"[TRACE] No new task content provided\")\n            elif item.action == Action.create_agent:\n                yield sse_json(\"create_agent\", item.data)\n            elif item.action == Action.activate_agent:\n                yield sse_json(\"activate_agent\", item.data)\n            elif item.action == Action.deactivate_agent:\n                yield sse_json(\"deactivate_agent\", dict(item.data))\n            elif item.action == Action.assign_task:\n                yield sse_json(\"assign_task\", item.data)\n            elif item.action == Action.activate_toolkit:\n                yield sse_json(\"activate_toolkit\", item.data)\n            elif item.action == Action.deactivate_toolkit:\n                yield sse_json(\"deactivate_toolkit\", item.data)\n            elif item.action == Action.write_file:\n                yield sse_json(\n                    \"write_file\",\n                    {\"file_path\": item.data, \"process_task_id\": item.process_task_id},\n                )\n            elif item.action == Action.ask:\n                yield sse_json(\"ask\", item.data)\n            elif item.action == Action.notice:\n                yield sse_json(\n                    \"notice\",\n                    {\"notice\": item.data, \"process_task_id\": item.process_task_id},\n                )\n            elif item.action == Action.search_mcp:\n                yield sse_json(\"search_mcp\", item.data)\n            elif item.action == Action.install_mcp:\n                task = asyncio.create_task(install_mcp(mcp, item))\n                task_lock.add_background_task(task)\n            elif item.action == Action.terminal:\n                yield sse_json(\n                    \"terminal\",",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 237,
                "column": 1
              },
              "endPosition": {
                "line": 239,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 239,
                "column": 1
              },
              "endPosition": {
                "line": 247,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@sync_step",
            "lineNumber": 237
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 238
          },
          {
            "text": "async def step_solve(options: Chat, request: Request, task_lock: TaskLock):",
            "lineNumber": 239,
            "isSignature": true
          },
          {
            "text": "    # if True:",
            "lineNumber": 240,
            "isSignature": true
          },
          {
            "text": "    #     import faulthandler",
            "lineNumber": 241,
            "isSignature": true
          },
          {
            "lineNumber": 242,
            "isSignature": true
          },
          {
            "text": "    #     faulthandler.enable()",
            "lineNumber": 243,
            "isSignature": true
          },
          {
            "text": "    #     for second in [5, 10, 20, 30, 60, 120, 240]:",
            "lineNumber": 244,
            "isSignature": true
          },
          {
            "text": "    #         faulthandler.dump_traceback_later(second)",
            "lineNumber": 245,
            "isSignature": true
          },
          {
            "lineNumber": 877
          },
          {
            "text": "                else:",
            "lineNumber": 878
          },
          {
            "text": "                    if workforce is None:",
            "lineNumber": 879
          },
          {
            "text": "                        logger.warning(f\"[TRACE] Workforce is None - this might be the issue\")",
            "lineNumber": 880
          },
          {
            "text": "                    if not new_task_content:",
            "lineNumber": 881
          },
          {
            "text": "                        logger.warning(f\"[TRACE] No new task content provided\")",
            "lineNumber": 882
          },
          {
            "text": "            elif item.action == Action.create_agent:",
            "lineNumber": 883
          },
          {
            "text": "                yield sse_json(\"create_agent\", item.data)",
            "lineNumber": 884
          },
          {
            "text": "            elif item.action == Action.activate_agent:",
            "lineNumber": 885
          },
          {
            "text": "                yield sse_json(\"activate_agent\", item.data)",
            "lineNumber": 886
          },
          {
            "text": "            elif item.action == Action.deactivate_agent:",
            "lineNumber": 887
          },
          {
            "text": "                yield sse_json(\"deactivate_agent\", dict(item.data))",
            "lineNumber": 888
          },
          {
            "text": "            elif item.action == Action.assign_task:",
            "lineNumber": 889
          },
          {
            "text": "                yield sse_json(\"assign_task\", item.data)",
            "lineNumber": 890
          },
          {
            "text": "            elif item.action == Action.activate_toolkit:",
            "lineNumber": 891
          },
          {
            "text": "                yield sse_json(\"activate_toolkit\", item.data)",
            "lineNumber": 892
          },
          {
            "text": "            elif item.action == Action.deactivate_toolkit:",
            "lineNumber": 893
          },
          {
            "text": "                yield sse_json(\"deactivate_toolkit\", item.data)",
            "lineNumber": 894
          },
          {
            "text": "            elif item.action == Action.write_file:",
            "lineNumber": 895
          },
          {
            "text": "                yield sse_json(",
            "lineNumber": 896
          },
          {
            "text": "                    \"write_file\",",
            "lineNumber": 897
          },
          {
            "text": "                    {\"file_path\": item.data, \"process_task_id\": item.process_task_id},",
            "lineNumber": 898
          },
          {
            "text": "                )",
            "lineNumber": 899
          },
          {
            "text": "            elif item.action == Action.ask:",
            "lineNumber": 900
          },
          {
            "text": "                yield sse_json(\"ask\", item.data)",
            "lineNumber": 901
          },
          {
            "text": "            elif item.action == Action.notice:",
            "lineNumber": 902
          },
          {
            "text": "                yield sse_json(",
            "lineNumber": 903
          },
          {
            "text": "                    \"notice\",",
            "lineNumber": 904
          },
          {
            "text": "                    {\"notice\": item.data, \"process_task_id\": item.process_task_id},",
            "lineNumber": 905
          },
          {
            "text": "                )",
            "lineNumber": 906
          },
          {
            "text": "            elif item.action == Action.search_mcp:",
            "lineNumber": 907
          },
          {
            "text": "                yield sse_json(\"search_mcp\", item.data)",
            "lineNumber": 908
          },
          {
            "text": "            elif item.action == Action.install_mcp:",
            "lineNumber": 909
          },
          {
            "text": "                task = asyncio.create_task(install_mcp(mcp, item))",
            "lineNumber": 910
          },
          {
            "text": "                task_lock.add_background_task(task)",
            "lineNumber": 911
          },
          {
            "text": "            elif item.action == Action.terminal:",
            "lineNumber": 912
          },
          {
            "text": "                yield sse_json(",
            "lineNumber": 913
          },
          {
            "text": "                    \"terminal\",",
            "lineNumber": 914
          }
        ]
      },
      "score": 0.27815425395965576
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1785,
            "column": 5
          },
          "endPosition": {
            "line": 1878
          }
        },
        "contents": "@traceroot.trace()\nasync def get_toolkits(tools: list[str], agent_name: str, api_task_id: str):\n    traceroot_logger.info(\n        f\"Getting toolkits for agent: {agent_name}, task: {api_task_id}, tools: {tools}\"\n    )\n    toolkits = {\n        \"audio_analysis_toolkit\": AudioAnalysisToolkit,\n        \"openai_image_toolkit\": OpenAIImageToolkit,\n        \"excel_toolkit\": ExcelToolkit,\n        \"file_write_toolkit\": FileToolkit,\n        \"github_toolkit\": GithubToolkit,\n        \"google_calendar_toolkit\": GoogleCalendarToolkit,\n        \"google_drive_mcp_toolkit\": GoogleDriveMCPToolkit,\n        \"google_gmail_mcp_toolkit\": GoogleGmailMCPToolkit,\n        \"image_analysis_toolkit\": ImageAnalysisToolkit,\n        \"linkedin_toolkit\": LinkedInToolkit,\n        \"lark_toolkit\": LarkToolkit,\n        \"mcp_search_toolkit\": McpSearchToolkit,\n        \"notion_mcp_toolkit\": NotionMCPToolkit,\n        \"pptx_toolkit\": PPTXToolkit,\n        \"reddit_toolkit\": RedditToolkit,\n        \"search_toolkit\": SearchToolkit,\n        \"slack_toolkit\": SlackToolkit,\n        \"terminal_toolkit\": TerminalToolkit,\n        \"twitter_toolkit\": TwitterToolkit,\n        \"video_analysis_toolkit\": VideoAnalysisToolkit,\n        \"video_download_toolkit\": VideoDownloaderToolkit,\n        \"whatsapp_toolkit\": WhatsAppToolkit,\n    }\n    res = []\n    for item in tools:\n        if item in toolkits:\n            toolkit: AbstractToolkit = toolkits[item]\n            toolkit.agent_name = agent_name\n            toolkit_tools = toolkit.get_can_use_tools(api_task_id)\n            toolkit_tools = (\n                await toolkit_tools\n                if asyncio.iscoroutine(toolkit_tools)\n                else toolkit_tools\n            )\n            res.extend(toolkit_tools)\n        else:\n            traceroot_logger.warning(f\"Toolkit {item} not found for agent {agent_name}\")\n    return res\n\n\n@traceroot.trace()\nasync def get_mcp_tools(mcp_server: McpServers):\n    traceroot_logger.info",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1789
          },
          {
            "text": "async def get_toolkits(tools: list[str], agent_name: str, api_task_id: str):",
            "lineNumber": 1790,
            "isSignature": true
          },
          {
            "text": "    traceroot_logger.info(",
            "lineNumber": 1791
          },
          {
            "text": "        f\"Getting toolkits for agent: {agent_name}, task: {api_task_id}, tools: {tools}\"",
            "lineNumber": 1792
          },
          {
            "text": "    )",
            "lineNumber": 1793
          },
          {
            "text": "    toolkits = {",
            "lineNumber": 1794
          },
          {
            "text": "        \"audio_analysis_toolkit\": AudioAnalysisToolkit,",
            "lineNumber": 1795
          },
          {
            "text": "        \"openai_image_toolkit\": OpenAIImageToolkit,",
            "lineNumber": 1796
          },
          {
            "text": "        \"excel_toolkit\": ExcelToolkit,",
            "lineNumber": 1797
          },
          {
            "text": "        \"file_write_toolkit\": FileToolkit,",
            "lineNumber": 1798
          },
          {
            "text": "        \"github_toolkit\": GithubToolkit,",
            "lineNumber": 1799
          },
          {
            "text": "        \"google_calendar_toolkit\": GoogleCalendarToolkit,",
            "lineNumber": 1800
          },
          {
            "text": "        \"google_drive_mcp_toolkit\": GoogleDriveMCPToolkit,",
            "lineNumber": 1801
          },
          {
            "text": "        \"google_gmail_mcp_toolkit\": GoogleGmailMCPToolkit,",
            "lineNumber": 1802
          },
          {
            "text": "        \"image_analysis_toolkit\": ImageAnalysisToolkit,",
            "lineNumber": 1803
          },
          {
            "text": "        \"linkedin_toolkit\": LinkedInToolkit,",
            "lineNumber": 1804
          },
          {
            "text": "        \"lark_toolkit\": LarkToolkit,",
            "lineNumber": 1805
          },
          {
            "text": "        \"mcp_search_toolkit\": McpSearchToolkit,",
            "lineNumber": 1806
          },
          {
            "text": "        \"notion_mcp_toolkit\": NotionMCPToolkit,",
            "lineNumber": 1807
          },
          {
            "text": "        \"pptx_toolkit\": PPTXToolkit,",
            "lineNumber": 1808
          },
          {
            "text": "        \"reddit_toolkit\": RedditToolkit,",
            "lineNumber": 1809
          },
          {
            "text": "        \"search_toolkit\": SearchToolkit,",
            "lineNumber": 1810
          },
          {
            "text": "        \"slack_toolkit\": SlackToolkit,",
            "lineNumber": 1811
          },
          {
            "text": "        \"terminal_toolkit\": TerminalToolkit,",
            "lineNumber": 1812
          },
          {
            "text": "        \"twitter_toolkit\": TwitterToolkit,",
            "lineNumber": 1813
          },
          {
            "text": "        \"video_analysis_toolkit\": VideoAnalysisToolkit,",
            "lineNumber": 1814
          },
          {
            "text": "        \"video_download_toolkit\": VideoDownloaderToolkit,",
            "lineNumber": 1815
          },
          {
            "text": "        \"whatsapp_toolkit\": WhatsAppToolkit,",
            "lineNumber": 1816
          },
          {
            "text": "    }",
            "lineNumber": 1817
          },
          {
            "text": "    res = []",
            "lineNumber": 1818
          },
          {
            "text": "    for item in tools:",
            "lineNumber": 1819
          },
          {
            "text": "        if item in toolkits:",
            "lineNumber": 1820
          },
          {
            "text": "            toolkit: AbstractToolkit = toolkits[item]",
            "lineNumber": 1821
          },
          {
            "text": "            toolkit.agent_name = agent_name",
            "lineNumber": 1822
          },
          {
            "text": "            toolkit_tools = toolkit.get_can_use_tools(api_task_id)",
            "lineNumber": 1823
          },
          {
            "text": "            toolkit_tools = (",
            "lineNumber": 1824
          },
          {
            "text": "                await toolkit_tools",
            "lineNumber": 1825
          },
          {
            "text": "                if asyncio.iscoroutine(toolkit_tools)",
            "lineNumber": 1826
          },
          {
            "text": "                else toolkit_tools",
            "lineNumber": 1827
          },
          {
            "text": "            )",
            "lineNumber": 1828
          },
          {
            "text": "            res.extend(toolkit_tools)",
            "lineNumber": 1829
          },
          {
            "text": "        else:",
            "lineNumber": 1830
          },
          {
            "text": "            traceroot_logger.warning(f\"Toolkit {item} not found for agent {agent_name}\")",
            "lineNumber": 1831
          },
          {
            "text": "    return res",
            "lineNumber": 1832,
            "isSignature": true
          },
          {
            "lineNumber": 1833
          },
          {
            "lineNumber": 1834
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1835
          },
          {
            "text": "async def get_mcp_tools(mcp_server: McpServers):",
            "lineNumber": 1836,
            "isSignature": true
          },
          {
            "text": "    traceroot_logger.info",
            "lineNumber": 1837
          }
        ]
      },
      "score": 0.27609193325042725
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1584
          },
          "endPosition": {
            "line": 1785
          }
        },
        "contents": "@traceroot.trace()\nasync def social_medium_agent(options: Chat):\n{working_directory}&#96;), for example, to access\n   files needed for posting. You can use tools like &#96;find&#96; to locate files,\n   &#96;grep&#96; to search within them, and &#96;curl&#96; to interact with web APIs that\n   are not covered by other tools.\n\nWhen assisting users, always:\n- Identify which platform's functionality is needed for the task.\n- Check if required API credentials are available before attempting\noperations.\n- Provide clear explanations of what actions you're taking.\n- Handle rate limits and API restrictions appropriately.\n- Ask clarifying questions when user requests are ambiguous.\n\"\"\",\n        ),\n        options,\n        tools,\n        tool_names=[\n            WhatsAppToolkit.toolkit_name(),\n            TwitterToolkit.toolkit_name(),\n            LinkedInToolkit.toolkit_name(),\n            RedditToolkit.toolkit_name(),\n            NotionMCPToolkit.toolkit_name(),\n            GoogleGmailMCPToolkit.toolkit_name(),\n            GoogleCalendarToolkit.toolkit_name(),\n            HumanToolkit.toolkit_name(),\n            TerminalToolkit.toolkit_name(),\n            NoteTakingToolkit.toolkit_name(),\n        ],\n    )\n\n\n@traceroot.trace()\nasync def mcp_agent(options: Chat):\n    traceroot_logger.info",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1585,
                "column": 1
              },
              "endPosition": {
                "line": 1586,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 1586,
                "column": 1
              },
              "endPosition": {
                "line": 1587,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1585
          },
          {
            "text": "async def social_medium_agent(options: Chat):",
            "lineNumber": 1586,
            "isSignature": true
          },
          {
            "text": "{working_directory}&#96;), for example, to access",
            "lineNumber": 1683
          },
          {
            "text": "   files needed for posting. You can use tools like &#96;find&#96; to locate files,",
            "lineNumber": 1684
          },
          {
            "text": "   &#96;grep&#96; to search within them, and &#96;curl&#96; to interact with web APIs that",
            "lineNumber": 1685
          },
          {
            "text": "   are not covered by other tools.",
            "lineNumber": 1686
          },
          {
            "lineNumber": 1687
          },
          {
            "text": "When assisting users, always:",
            "lineNumber": 1688
          },
          {
            "text": "- Identify which platform's functionality is needed for the task.",
            "lineNumber": 1689
          },
          {
            "text": "- Check if required API credentials are available before attempting",
            "lineNumber": 1690
          },
          {
            "text": "operations.",
            "lineNumber": 1691
          },
          {
            "text": "- Provide clear explanations of what actions you're taking.",
            "lineNumber": 1692
          },
          {
            "text": "- Handle rate limits and API restrictions appropriately.",
            "lineNumber": 1693
          },
          {
            "text": "- Ask clarifying questions when user requests are ambiguous.",
            "lineNumber": 1694
          },
          {
            "text": "\"\"\",",
            "lineNumber": 1695
          },
          {
            "text": "        ),",
            "lineNumber": 1696
          },
          {
            "text": "        options,",
            "lineNumber": 1697
          },
          {
            "text": "        tools,",
            "lineNumber": 1698
          },
          {
            "text": "        tool_names=[",
            "lineNumber": 1699
          },
          {
            "text": "            WhatsAppToolkit.toolkit_name(),",
            "lineNumber": 1700
          },
          {
            "text": "            TwitterToolkit.toolkit_name(),",
            "lineNumber": 1701
          },
          {
            "text": "            LinkedInToolkit.toolkit_name(),",
            "lineNumber": 1702
          },
          {
            "text": "            RedditToolkit.toolkit_name(),",
            "lineNumber": 1703
          },
          {
            "text": "            NotionMCPToolkit.toolkit_name(),",
            "lineNumber": 1704
          },
          {
            "text": "            GoogleGmailMCPToolkit.toolkit_name(),",
            "lineNumber": 1705
          },
          {
            "text": "            GoogleCalendarToolkit.toolkit_name(),",
            "lineNumber": 1706
          },
          {
            "text": "            HumanToolkit.toolkit_name(),",
            "lineNumber": 1707
          },
          {
            "text": "            TerminalToolkit.toolkit_name(),",
            "lineNumber": 1708
          },
          {
            "text": "            NoteTakingToolkit.toolkit_name(),",
            "lineNumber": 1709
          },
          {
            "text": "        ],",
            "lineNumber": 1710
          },
          {
            "text": "    )",
            "lineNumber": 1711,
            "isSignature": true
          },
          {
            "lineNumber": 1712
          },
          {
            "lineNumber": 1713
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1714
          },
          {
            "text": "async def mcp_agent(options: Chat):",
            "lineNumber": 1715,
            "isSignature": true
          },
          {
            "text": "    traceroot_logger.info",
            "lineNumber": 1716
          }
        ]
      },
      "score": 0.27598729729652405
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\store\\chatStore.ts",
        "range": {
          "startPosition": {
            "line": 162
          },
          "endPosition": {
            "line": 2594,
            "column": 1
          }
        },
        "contents": "const chatStore = \n(set, get) =&gt; (\nasync (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {\n // Default to current store\n\t\t\t/**\n\t\t\t * Replay creates its own chatStore for each task with replayProject\n\t\t\t */\n\t\t\tif (project_id &amp;&amp; type !== \"replay\") {\n\t\t\t\tconsole.log(\"Creating a new Chat Instance for current project on end\")\n\t\t\t\tconst newChatResult = projectStore.appendInitChatStore(project_id);\n\n\t\t\t\tif (newChatResult) {\n\t\t\t\t\tnewTaskId = newChatResult.taskId;\n\t\t\t\t\ttargetChatStore = newChatResult.chatStore;\n\t\t\t\t\ttargetChatStore.getState().setIsPending(newTaskId, true);\n\n\t\t\t\t\t//From handleSend if message is given\n\t\t\t\t\t// Add the message to the new chatStore if provided\n\t\t\t\t\tif (messageContent) {\n\t\t\t\t\t\ttargetChatStore.getState().addMessages(newTaskId, {\n\t\t\t\t\t\t\tid: generateUniqueId(),\n\t\t\t\t\t\t\trole: \"user\",\n\t\t\t\t\t\t\tcontent: messageContent,\n\t\t\t\t\t\t\tattaches: messageAttaches || [],\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttargetChatStore.getState().setHasMessages(newTaskId, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst base_Url = import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL\n\t\t\tconst api = type == 'share' ?\n\t\t\t\t&#96;${base_Url}/api/chat/share/playback/${shareToken}?delay_time=${delayTime}&#96;\n\t\t\t\t: type == 'replay' ?\n\t\t\t\t\t&#96;${base_Url}/api/chat/steps/playback/${newTaskId}?delay_time=${delayTime}&#96;\n\t\t\t\t\t: &#96;${baseURL}/chat&#96;\n\n\t\t\tconst { tasks } = get()\n\t\t\tlet historyId: string | null = projectStore.getHistoryId(project_id);\n\t\t\tlet snapshots: any = [];\n\t\t\tlet skipFirstConfirm = true;\n\n\t\t\t// replay or share request\n\t\t\tif (type) {\n\t\t\t\tconst res = await proxyFetchGet(&#96;/api/chat/snapshots&#96;, {\n\t\t\t\t\tapi_task_id: taskId\n\t\t\t\t});\n\t\t\t\tif (res) {\n\t\t\t\t\tsnapshots = [...new Map(res.map((item: any) =&gt; [item.camel_task_id, item])).values()];\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\t// get current model\n\t\t\tlet apiModel = {\n\t\t\t\tapi_key: '',\n\t\t\t\tmodel_type: '',\n\t\t\t\tmodel_platform: '',\n\t\t\t\tapi_url: '',\n\t\t\t\textra_params: {}\n\t\t\t}\n\t\t\tif (modelType === 'custom' || modelType === 'local') {\n\t\t\t\tconst res = await proxyFetchGet('/api/providers', {\n\t\t\t\t\tprefer: true\n\t\t\t\t});\n\t\t}\n)\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 163,
                "column": 1
              },
              "endPosition": {
                "line": 163,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 7
              },
              "endPosition": {
                "line": 163,
                "column": 19
              }
            },
            {
              "startPosition": {
                "line": 163,
                "column": 53
              },
              "endPosition": {
                "line": 163,
                "column": 53
              }
            },
            {
              "startPosition": {
                "line": 164,
                "column": 2
              },
              "endPosition": {
                "line": 164,
                "column": 17
              }
            },
            {
              "startPosition": {
                "line": 331,
                "column": 14
              },
              "endPosition": {
                "line": 332,
                "column": 4
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const chatStore = ",
            "lineNumber": 163
          },
          {
            "text": "(set, get) =&gt; (",
            "lineNumber": 164
          },
          {
            "text": "async (taskId: string, type?: string, shareToken?: string, delayTime?: number, messageContent?: string, messageAttaches?: File[]) =&gt; {",
            "lineNumber": 331
          },
          {
            "text": " // Default to current store",
            "lineNumber": 368
          },
          {
            "text": "\t\t\t/**",
            "lineNumber": 369
          },
          {
            "text": "\t\t\t * Replay creates its own chatStore for each task with replayProject",
            "lineNumber": 370
          },
          {
            "text": "\t\t\t */",
            "lineNumber": 371
          },
          {
            "text": "\t\t\tif (project_id &amp;&amp; type !== \"replay\") {",
            "lineNumber": 372
          },
          {
            "text": "\t\t\t\tconsole.log(\"Creating a new Chat Instance for current project on end\")",
            "lineNumber": 373
          },
          {
            "text": "\t\t\t\tconst newChatResult = projectStore.appendInitChatStore(project_id);",
            "lineNumber": 374
          },
          {
            "lineNumber": 375
          },
          {
            "text": "\t\t\t\tif (newChatResult) {",
            "lineNumber": 376
          },
          {
            "text": "\t\t\t\t\tnewTaskId = newChatResult.taskId;",
            "lineNumber": 377
          },
          {
            "text": "\t\t\t\t\ttargetChatStore = newChatResult.chatStore;",
            "lineNumber": 378
          },
          {
            "text": "\t\t\t\t\ttargetChatStore.getState().setIsPending(newTaskId, true);",
            "lineNumber": 379
          },
          {
            "lineNumber": 380
          },
          {
            "text": "\t\t\t\t\t//From handleSend if message is given",
            "lineNumber": 381
          },
          {
            "text": "\t\t\t\t\t// Add the message to the new chatStore if provided",
            "lineNumber": 382
          },
          {
            "text": "\t\t\t\t\tif (messageContent) {",
            "lineNumber": 383
          },
          {
            "text": "\t\t\t\t\t\ttargetChatStore.getState().addMessages(newTaskId, {",
            "lineNumber": 384
          },
          {
            "text": "\t\t\t\t\t\t\tid: generateUniqueId(),",
            "lineNumber": 385
          },
          {
            "text": "\t\t\t\t\t\t\trole: \"user\",",
            "lineNumber": 386
          },
          {
            "text": "\t\t\t\t\t\t\tcontent: messageContent,",
            "lineNumber": 387
          },
          {
            "text": "\t\t\t\t\t\t\tattaches: messageAttaches || [],",
            "lineNumber": 388
          },
          {
            "text": "\t\t\t\t\t\t});",
            "lineNumber": 389
          },
          {
            "text": "\t\t\t\t\t\ttargetChatStore.getState().setHasMessages(newTaskId, true);",
            "lineNumber": 390
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 391
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 392
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 393
          },
          {
            "lineNumber": 394
          },
          {
            "text": "\t\t\tconst base_Url = import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL",
            "lineNumber": 395
          },
          {
            "text": "\t\t\tconst api = type == 'share' ?",
            "lineNumber": 396
          },
          {
            "text": "\t\t\t\t&#96;${base_Url}/api/chat/share/playback/${shareToken}?delay_time=${delayTime}&#96;",
            "lineNumber": 397
          },
          {
            "text": "\t\t\t\t: type == 'replay' ?",
            "lineNumber": 398
          },
          {
            "text": "\t\t\t\t\t&#96;${base_Url}/api/chat/steps/playback/${newTaskId}?delay_time=${delayTime}&#96;",
            "lineNumber": 399
          },
          {
            "text": "\t\t\t\t\t: &#96;${baseURL}/chat&#96;",
            "lineNumber": 400
          },
          {
            "lineNumber": 401
          },
          {
            "text": "\t\t\tconst { tasks } = get()",
            "lineNumber": 402
          },
          {
            "text": "\t\t\tlet historyId: string | null = projectStore.getHistoryId(project_id);",
            "lineNumber": 403
          },
          {
            "text": "\t\t\tlet snapshots: any = [];",
            "lineNumber": 404
          },
          {
            "text": "\t\t\tlet skipFirstConfirm = true;",
            "lineNumber": 405
          },
          {
            "lineNumber": 406
          },
          {
            "text": "\t\t\t// replay or share request",
            "lineNumber": 407
          },
          {
            "text": "\t\t\tif (type) {",
            "lineNumber": 408
          },
          {
            "text": "\t\t\t\tconst res = await proxyFetchGet(&#96;/api/chat/snapshots&#96;, {",
            "lineNumber": 409
          },
          {
            "text": "\t\t\t\t\tapi_task_id: taskId",
            "lineNumber": 410
          },
          {
            "text": "\t\t\t\t});",
            "lineNumber": 411
          },
          {
            "text": "\t\t\t\tif (res) {",
            "lineNumber": 412
          },
          {
            "text": "\t\t\t\t\tsnapshots = [...new Map(res.map((item: any) =&gt; [item.camel_task_id, item])).values()];",
            "lineNumber": 413
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 414
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 415
          },
          {
            "lineNumber": 416
          },
          {
            "lineNumber": 417
          },
          {
            "text": "\t\t\t// get current model",
            "lineNumber": 418
          },
          {
            "text": "\t\t\tlet apiModel = {",
            "lineNumber": 419
          },
          {
            "text": "\t\t\t\tapi_key: '',",
            "lineNumber": 420
          },
          {
            "text": "\t\t\t\tmodel_type: '',",
            "lineNumber": 421
          },
          {
            "text": "\t\t\t\tmodel_platform: '',",
            "lineNumber": 422
          },
          {
            "text": "\t\t\t\tapi_url: '',",
            "lineNumber": 423
          },
          {
            "text": "\t\t\t\textra_params: {}",
            "lineNumber": 424
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 425
          },
          {
            "text": "\t\t\tif (modelType === 'custom' || modelType === 'local') {",
            "lineNumber": 426
          },
          {
            "text": "\t\t\t\tconst res = await proxyFetchGet('/api/providers', {",
            "lineNumber": 427
          },
          {
            "text": "\t\t\t\t\tprefer: true",
            "lineNumber": 428
          },
          {
            "text": "\t\t\t\t});",
            "lineNumber": 429
          },
          {
            "text": "\t\t}",
            "lineNumber": 1888
          },
          {
            "text": ")",
            "lineNumber": 2594
          },
          {
            "text": ";",
            "lineNumber": 2595
          }
        ]
      },
      "score": 0.27594995498657227
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\chat_service.py",
        "range": {
          "startPosition": {
            "line": 1300
          },
          "endPosition": {
            "line": 1424
          }
        },
        "contents": "@traceroot.trace()\nasync def construct_workforce(options: Chat) -&gt; tuple[Workforce, ListenChatAgent]:\n\"\"\",\n        }.items()\n    ]\n    new_worker_agent = agent_model(\n        Agents.new_worker_agent,\n        f\"\"\"\n        You are a helpful assistant.\n- You are now working in system {platform.system()} with architecture\n{platform.machine()} at working directory &#96;{working_directory}&#96;. All local file operations must occur here, but you can access files from any place in the file system. For all file system operations, you MUST use absolute paths to ensure precision and avoid ambiguity.\nThe current date is {datetime.date.today()}. For any date-related tasks, you MUST use this as the current date.\n        \"\"\",\n        options,\n        [\n            *HumanToolkit.get_can_use_tools(options.project_id, Agents.new_worker_agent),\n            *(\n                ToolkitMessageIntegration(\n                    message_handler=HumanToolkit(options.project_id, Agents.new_worker_agent).send_message_to_user\n                ).register_toolkits(NoteTakingToolkit(options.project_id, working_directory=working_directory))\n            ).get_tools(),\n        ],\n    )\n    # msg_toolkit = AgentCommunicationToolkit(max_message_history=100)\n\n    searcher = browser_agent(options)\n    developer = await developer_agent(options)\n    documenter = await document_agent(options)\n    multi_modaler = multi_modal_agent(options)\n\n    # msg_toolkit.register_agent(\"Worker\", new_worker_agent)\n    # msg_toolkit.register_agent(\"Browser_Agent\", searcher)\n    # msg_toolkit.register_agent(\"Developer_Agent\", developer)\n    # msg_toolkit.register_agent(\"Document_Agent\", documenter)\n    # msg_toolkit.register_agent(\"Multi_Modal_Agent\", multi_modaler)\n\n    # Convert string model_platform to enum for comparison\n    try:\n        model_platform_enum = ModelPlatformType(options.model_platform.lower())\n    except (ValueError, AttributeError):\n        # If conversion fails, default to non-OpenAI behavior\n        model_platform_enum = None\n\n    workforce =",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1301,
                "column": 1
              },
              "endPosition": {
                "line": 1302,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 1302,
                "column": 1
              },
              "endPosition": {
                "line": 1303,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1301
          },
          {
            "text": "async def construct_workforce(options: Chat) -&gt; tuple[Workforce, ListenChatAgent]:",
            "lineNumber": 1302,
            "isSignature": true
          },
          {
            "text": "\"\"\",",
            "lineNumber": 1335
          },
          {
            "text": "        }.items()",
            "lineNumber": 1336
          },
          {
            "text": "    ]",
            "lineNumber": 1337
          },
          {
            "text": "    new_worker_agent = agent_model(",
            "lineNumber": 1338
          },
          {
            "text": "        Agents.new_worker_agent,",
            "lineNumber": 1339
          },
          {
            "text": "        f\"\"\"",
            "lineNumber": 1340
          },
          {
            "text": "        You are a helpful assistant.",
            "lineNumber": 1341
          },
          {
            "text": "- You are now working in system {platform.system()} with architecture",
            "lineNumber": 1342
          },
          {
            "text": "{platform.machine()} at working directory &#96;{working_directory}&#96;. All local file operations must occur here, but you can access files from any place in the file system. For all file system operations, you MUST use absolute paths to ensure precision and avoid ambiguity.",
            "lineNumber": 1343
          },
          {
            "text": "The current date is {datetime.date.today()}. For any date-related tasks, you MUST use this as the current date.",
            "lineNumber": 1344
          },
          {
            "text": "        \"\"\",",
            "lineNumber": 1345
          },
          {
            "text": "        options,",
            "lineNumber": 1346
          },
          {
            "text": "        [",
            "lineNumber": 1347
          },
          {
            "text": "            *HumanToolkit.get_can_use_tools(options.project_id, Agents.new_worker_agent),",
            "lineNumber": 1348
          },
          {
            "text": "            *(",
            "lineNumber": 1349
          },
          {
            "text": "                ToolkitMessageIntegration(",
            "lineNumber": 1350
          },
          {
            "text": "                    message_handler=HumanToolkit(options.project_id, Agents.new_worker_agent).send_message_to_user",
            "lineNumber": 1351
          },
          {
            "text": "                ).register_toolkits(NoteTakingToolkit(options.project_id, working_directory=working_directory))",
            "lineNumber": 1352
          },
          {
            "text": "            ).get_tools(),",
            "lineNumber": 1353
          },
          {
            "text": "        ],",
            "lineNumber": 1354
          },
          {
            "text": "    )",
            "lineNumber": 1355
          },
          {
            "text": "    # msg_toolkit = AgentCommunicationToolkit(max_message_history=100)",
            "lineNumber": 1356
          },
          {
            "lineNumber": 1357
          },
          {
            "text": "    searcher = browser_agent(options)",
            "lineNumber": 1358
          },
          {
            "text": "    developer = await developer_agent(options)",
            "lineNumber": 1359
          },
          {
            "text": "    documenter = await document_agent(options)",
            "lineNumber": 1360
          },
          {
            "text": "    multi_modaler = multi_modal_agent(options)",
            "lineNumber": 1361
          },
          {
            "lineNumber": 1362
          },
          {
            "text": "    # msg_toolkit.register_agent(\"Worker\", new_worker_agent)",
            "lineNumber": 1363
          },
          {
            "text": "    # msg_toolkit.register_agent(\"Browser_Agent\", searcher)",
            "lineNumber": 1364
          },
          {
            "text": "    # msg_toolkit.register_agent(\"Developer_Agent\", developer)",
            "lineNumber": 1365
          },
          {
            "text": "    # msg_toolkit.register_agent(\"Document_Agent\", documenter)",
            "lineNumber": 1366
          },
          {
            "text": "    # msg_toolkit.register_agent(\"Multi_Modal_Agent\", multi_modaler)",
            "lineNumber": 1367
          },
          {
            "lineNumber": 1368
          },
          {
            "text": "    # Convert string model_platform to enum for comparison",
            "lineNumber": 1369
          },
          {
            "text": "    try:",
            "lineNumber": 1370
          },
          {
            "text": "        model_platform_enum = ModelPlatformType(options.model_platform.lower())",
            "lineNumber": 1371
          },
          {
            "text": "    except (ValueError, AttributeError):",
            "lineNumber": 1372
          },
          {
            "text": "        # If conversion fails, default to non-OpenAI behavior",
            "lineNumber": 1373
          },
          {
            "text": "        model_platform_enum = None",
            "lineNumber": 1374
          },
          {
            "lineNumber": 1375
          },
          {
            "text": "    workforce =",
            "lineNumber": 1376
          }
        ]
      },
      "score": 0.27402010560035706
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1165,
            "column": 5
          },
          "endPosition": {
            "line": 1388
          }
        },
        "contents": "@traceroot.trace()\nasync def document_agent(options: Chat):\n    working_directory = get_working_directory(options)\n    traceroot_logger.info(\n        f\"Creating document agent for project: {options.project_id} in directory: {working_directory}\"\n    )\n    message_integration = ToolkitMessageIntegration(\n        message_handler=HumanToolkit(\n            options.project_id, Agents.task_agent\n        ).send_message_to_user\n    )\n    file_write_toolkit = FileToolkit(\n        options.project_id, working_directory=working_directory\n    )\n    pptx_toolkit = PPTXToolkit(options.project_id, working_directory=working_directory)\n    pptx_toolkit = message_integration.register_toolkits(pptx_toolkit)\n    mark_it_down_toolkit = MarkItDownToolkit(options.project_id)\n    mark_it_down_toolkit = message_integration.register_toolkits(mark_it_down_toolkit)\n    excel_toolkit = ExcelToolkit(\n        options.project_id, working_directory=working_directory\n    )\n    excel_toolkit = message_integration.register_toolkits(excel_toolkit)\n    note_toolkit = NoteTakingToolkit(\n        options.project_id, Agents.document_agent, working_directory=working_directory\n    )\n    note_toolkit = message_integration.register_toolkits(note_toolkit)\n    terminal_toolkit = TerminalToolkit(\n        options.project_id,\n        Agents.document_agent,\n        safe_mode=True,\n        clone_current_env=False,\n    )\n    terminal_toolkit = message_integration.register_toolkits(terminal_toolkit)\n    tools = [\n        *file_write_toolkit.get_tools(),\n        *pptx_toolkit.get_tools(),\n        *HumanToolkit.get_can_use_tools(options.project_id, Agents.document_agent),\n        *mark_it_down_toolkit.get_tools(),\n        *excel_toolkit.get_tools(),\n        *note_toolkit.get_tools(),\n        *terminal_toolkit.get_tools(),\n        *await GoogleDriveMCPToolkit.get_can_use_tools(\n            options.project_id, options.get_bun_env()\n        ),\n    ]\n    # if env(\"EXA_API_KEY\") or options.is_cloud():\n    #     search_toolkit = SearchToolkit(options.project_id, Agents.document_agent).search_exa",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1169
          },
          {
            "text": "async def document_agent(options: Chat):",
            "lineNumber": 1170,
            "isSignature": true
          },
          {
            "text": "    working_directory = get_working_directory(options)",
            "lineNumber": 1171
          },
          {
            "text": "    traceroot_logger.info(",
            "lineNumber": 1172
          },
          {
            "text": "        f\"Creating document agent for project: {options.project_id} in directory: {working_directory}\"",
            "lineNumber": 1173
          },
          {
            "text": "    )",
            "lineNumber": 1174
          },
          {
            "text": "    message_integration = ToolkitMessageIntegration(",
            "lineNumber": 1175
          },
          {
            "text": "        message_handler=HumanToolkit(",
            "lineNumber": 1176
          },
          {
            "text": "            options.project_id, Agents.task_agent",
            "lineNumber": 1177
          },
          {
            "text": "        ).send_message_to_user",
            "lineNumber": 1178
          },
          {
            "text": "    )",
            "lineNumber": 1179
          },
          {
            "text": "    file_write_toolkit = FileToolkit(",
            "lineNumber": 1180
          },
          {
            "text": "        options.project_id, working_directory=working_directory",
            "lineNumber": 1181
          },
          {
            "text": "    )",
            "lineNumber": 1182
          },
          {
            "text": "    pptx_toolkit = PPTXToolkit(options.project_id, working_directory=working_directory)",
            "lineNumber": 1183
          },
          {
            "text": "    pptx_toolkit = message_integration.register_toolkits(pptx_toolkit)",
            "lineNumber": 1184
          },
          {
            "text": "    mark_it_down_toolkit = MarkItDownToolkit(options.project_id)",
            "lineNumber": 1185
          },
          {
            "text": "    mark_it_down_toolkit = message_integration.register_toolkits(mark_it_down_toolkit)",
            "lineNumber": 1186
          },
          {
            "text": "    excel_toolkit = ExcelToolkit(",
            "lineNumber": 1187
          },
          {
            "text": "        options.project_id, working_directory=working_directory",
            "lineNumber": 1188
          },
          {
            "text": "    )",
            "lineNumber": 1189
          },
          {
            "text": "    excel_toolkit = message_integration.register_toolkits(excel_toolkit)",
            "lineNumber": 1190
          },
          {
            "text": "    note_toolkit = NoteTakingToolkit(",
            "lineNumber": 1191
          },
          {
            "text": "        options.project_id, Agents.document_agent, working_directory=working_directory",
            "lineNumber": 1192
          },
          {
            "text": "    )",
            "lineNumber": 1193
          },
          {
            "text": "    note_toolkit = message_integration.register_toolkits(note_toolkit)",
            "lineNumber": 1194
          },
          {
            "text": "    terminal_toolkit = TerminalToolkit(",
            "lineNumber": 1195
          },
          {
            "text": "        options.project_id,",
            "lineNumber": 1196
          },
          {
            "text": "        Agents.document_agent,",
            "lineNumber": 1197
          },
          {
            "text": "        safe_mode=True,",
            "lineNumber": 1198
          },
          {
            "text": "        clone_current_env=False,",
            "lineNumber": 1199
          },
          {
            "text": "    )",
            "lineNumber": 1200
          },
          {
            "text": "    terminal_toolkit = message_integration.register_toolkits(terminal_toolkit)",
            "lineNumber": 1201
          },
          {
            "text": "    tools = [",
            "lineNumber": 1202
          },
          {
            "text": "        *file_write_toolkit.get_tools(),",
            "lineNumber": 1203
          },
          {
            "text": "        *pptx_toolkit.get_tools(),",
            "lineNumber": 1204
          },
          {
            "text": "        *HumanToolkit.get_can_use_tools(options.project_id, Agents.document_agent),",
            "lineNumber": 1205
          },
          {
            "text": "        *mark_it_down_toolkit.get_tools(),",
            "lineNumber": 1206
          },
          {
            "text": "        *excel_toolkit.get_tools(),",
            "lineNumber": 1207
          },
          {
            "text": "        *note_toolkit.get_tools(),",
            "lineNumber": 1208
          },
          {
            "text": "        *terminal_toolkit.get_tools(),",
            "lineNumber": 1209
          },
          {
            "text": "        *await GoogleDriveMCPToolkit.get_can_use_tools(",
            "lineNumber": 1210
          },
          {
            "text": "            options.project_id, options.get_bun_env()",
            "lineNumber": 1211
          },
          {
            "text": "        ),",
            "lineNumber": 1212
          },
          {
            "text": "    ]",
            "lineNumber": 1213
          },
          {
            "text": "    # if env(\"EXA_API_KEY\") or options.is_cloud():",
            "lineNumber": 1214
          },
          {
            "text": "    #     search_toolkit = SearchToolkit(options.project_id, Agents.document_agent).search_exa",
            "lineNumber": 1215
          }
        ]
      },
      "score": 0.2729288935661316
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\listen\\toolkit_listen.py",
        "range": {
          "startPosition": {
            "line": 78
          },
          "endPosition": {
            "line": 295
          }
        },
        "contents": "def listen_toolkit(\n    wrap_method: Callable[..., Any] | None = None,\n    inputs: Callable[..., str] | None = None,\n    return_msg: Callable[[Any], str] | None = None,\n):\ndef decorator(func: Callable[..., Any]):\n@wraps(wrap)\nasync def async_wrapper(*args, **kwargs):\n\n                if error is not None:\n                    raise error\n                return res\n\n            return async_wrapper\n\n        else:\n            # sync function wrapper\n            @wraps(wrap)\n            def sync_wrapper(*args, **kwargs):\n                toolkit: AbstractToolkit = args[0]\n\n                # Check if api_task_id exists\n                if not hasattr(toolkit, 'api_task_id'):\n                    logger.warning(f\"[listen_toolkit] {toolkit.__class__.__name__} missing api_task_id, calling method directly\")\n                    return func(*args, **kwargs)\n\n                task_lock = get_task_lock(toolkit.api_task_id)\n\n                if inputs is not None:\n                    args_str = inputs(*args, **kwargs)\n                else:\n                    # remove first param self\n                    filtered_args = args[1:] if len(args) &gt; 0 else []\n\n                    args_str = \", \".join(repr(arg) for arg in filtered_args)\n                    if kwargs:\n                        kwargs_str = \", \".join(f\"{k}={v!r}\" for k, v in kwargs.items())\n                        args_str = f\"{args_str}, {kwargs_str}\" if args_str else kwargs_str\n\n                # Truncate args_str if too long\n                MAX_ARGS_LENGTH = 500\n                if len(args_str) &gt; MAX_ARGS_LENGTH:\n                    args_str = args_str[:MAX_ARGS_LENGTH] + f\"... (truncated, total length: {len(args_str)} chars)\"\n\n                toolkit_name = toolkit.toolkit_name()\n                method_name = func.__name__.replace(\"_\", \" \")\n\n                # Skip WorkFlow display for send_message_to_user (called by message_integration)\n                skip_workflow_display = func.__name__ == \"send_message_to_user\"\n\n                # Multi-layer fallback to get process_task_id\n                process_task_id = process_task.get(\"\")\n                if not process_task_id:\n                    process_task_id =",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 79,
                "column": 1
              },
              "endPosition": {
                "line": 84,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 84,
                "column": 5
              },
              "endPosition": {
                "line": 85,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 89,
                "column": 13
              },
              "endPosition": {
                "line": 90,
                "column": 13
              }
            },
            {
              "startPosition": {
                "line": 90,
                "column": 13
              },
              "endPosition": {
                "line": 91,
                "column": 17
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def listen_toolkit(",
            "lineNumber": 79,
            "isSignature": true
          },
          {
            "text": "    wrap_method: Callable[..., Any] | None = None,",
            "lineNumber": 80,
            "isSignature": true
          },
          {
            "text": "    inputs: Callable[..., str] | None = None,",
            "lineNumber": 81,
            "isSignature": true
          },
          {
            "text": "    return_msg: Callable[[Any], str] | None = None,",
            "lineNumber": 82,
            "isSignature": true
          },
          {
            "text": "):",
            "lineNumber": 83,
            "isSignature": true
          },
          {
            "text": "def decorator(func: Callable[..., Any]):",
            "lineNumber": 84
          },
          {
            "text": "@wraps(wrap)",
            "lineNumber": 89
          },
          {
            "text": "async def async_wrapper(*args, **kwargs):",
            "lineNumber": 90
          },
          {
            "lineNumber": 183
          },
          {
            "text": "                if error is not None:",
            "lineNumber": 184
          },
          {
            "text": "                    raise error",
            "lineNumber": 185
          },
          {
            "text": "                return res",
            "lineNumber": 186
          },
          {
            "lineNumber": 187
          },
          {
            "text": "            return async_wrapper",
            "lineNumber": 188
          },
          {
            "lineNumber": 189
          },
          {
            "text": "        else:",
            "lineNumber": 190
          },
          {
            "text": "            # sync function wrapper",
            "lineNumber": 191
          },
          {
            "text": "            @wraps(wrap)",
            "lineNumber": 192
          },
          {
            "text": "            def sync_wrapper(*args, **kwargs):",
            "lineNumber": 193
          },
          {
            "text": "                toolkit: AbstractToolkit = args[0]",
            "lineNumber": 194
          },
          {
            "lineNumber": 195
          },
          {
            "text": "                # Check if api_task_id exists",
            "lineNumber": 196
          },
          {
            "text": "                if not hasattr(toolkit, 'api_task_id'):",
            "lineNumber": 197
          },
          {
            "text": "                    logger.warning(f\"[listen_toolkit] {toolkit.__class__.__name__} missing api_task_id, calling method directly\")",
            "lineNumber": 198
          },
          {
            "text": "                    return func(*args, **kwargs)",
            "lineNumber": 199
          },
          {
            "lineNumber": 200
          },
          {
            "text": "                task_lock = get_task_lock(toolkit.api_task_id)",
            "lineNumber": 201
          },
          {
            "lineNumber": 202
          },
          {
            "text": "                if inputs is not None:",
            "lineNumber": 203
          },
          {
            "text": "                    args_str = inputs(*args, **kwargs)",
            "lineNumber": 204
          },
          {
            "text": "                else:",
            "lineNumber": 205
          },
          {
            "text": "                    # remove first param self",
            "lineNumber": 206
          },
          {
            "text": "                    filtered_args = args[1:] if len(args) &gt; 0 else []",
            "lineNumber": 207
          },
          {
            "lineNumber": 208
          },
          {
            "text": "                    args_str = \", \".join(repr(arg) for arg in filtered_args)",
            "lineNumber": 209
          },
          {
            "text": "                    if kwargs:",
            "lineNumber": 210
          },
          {
            "text": "                        kwargs_str = \", \".join(f\"{k}={v!r}\" for k, v in kwargs.items())",
            "lineNumber": 211
          },
          {
            "text": "                        args_str = f\"{args_str}, {kwargs_str}\" if args_str else kwargs_str",
            "lineNumber": 212
          },
          {
            "lineNumber": 213
          },
          {
            "text": "                # Truncate args_str if too long",
            "lineNumber": 214
          },
          {
            "text": "                MAX_ARGS_LENGTH = 500",
            "lineNumber": 215
          },
          {
            "text": "                if len(args_str) &gt; MAX_ARGS_LENGTH:",
            "lineNumber": 216
          },
          {
            "text": "                    args_str = args_str[:MAX_ARGS_LENGTH] + f\"... (truncated, total length: {len(args_str)} chars)\"",
            "lineNumber": 217
          },
          {
            "lineNumber": 218
          },
          {
            "text": "                toolkit_name = toolkit.toolkit_name()",
            "lineNumber": 219
          },
          {
            "text": "                method_name = func.__name__.replace(\"_\", \" \")",
            "lineNumber": 220
          },
          {
            "lineNumber": 221
          },
          {
            "text": "                # Skip WorkFlow display for send_message_to_user (called by message_integration)",
            "lineNumber": 222
          },
          {
            "text": "                skip_workflow_display = func.__name__ == \"send_message_to_user\"",
            "lineNumber": 223
          },
          {
            "lineNumber": 224
          },
          {
            "text": "                # Multi-layer fallback to get process_task_id",
            "lineNumber": 225
          },
          {
            "text": "                process_task_id = process_task.get(\"\")",
            "lineNumber": 226
          },
          {
            "text": "                if not process_task_id:",
            "lineNumber": 227
          },
          {
            "text": "                    process_task_id =",
            "lineNumber": 228
          }
        ]
      },
      "score": 0.27230334281921387
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\service\\task.py",
        "range": {
          "startPosition": {
            "column": 53
          },
          "endPosition": {
            "line": 47,
            "column": 23
          }
        },
        "contents": "from typing import List, Dict, Optional\nfrom pydantic import BaseModel\nfrom app.exception.exception import ProgramException\nfrom app.model.chat import McpServers, Status, SupplementChat, Chat, UpdateData\nimport asyncio\nfrom enum import Enum\nfrom camel.tasks import Task\nfrom contextlib import contextmanager\nfrom contextvars import ContextVar\nfrom datetime import datetime, timedelta\nimport weakref\nfrom utils import traceroot_wrapper as traceroot\n\nlogger = traceroot.get_logger(\"task_service\")\n\n\nclass Action(str, Enum):\n    improve = \"improve\"  # user -&gt; backend\n    update_task = \"update_task\"  # user -&gt; backend\n    task_state = \"task_state\"  # backend -&gt; user\n    new_task_state = \"new_task_state\"  # backend -&gt; user\n    decompose_progress = \"decompose_progress\"  # backend -&gt; user (streaming decomposition)\n    decompose_text = \"decompose_text\"  # backend -&gt; user (raw streaming text)\n    start = \"start\"  # user -&gt; backend\n    create_agent = \"create_agent\"  # backend -&gt; user\n    activate_agent = \"activate_agent\"  # backend -&gt; user\n    deactivate_agent = \"deactivate_agent\"  # backend -&gt; user\n    assign_task = \"assign_task\"  # backend -&gt; user\n    activate_toolkit = \"activate_toolkit\"  # backend -&gt; user\n    deactivate_toolkit = \"deactivate_toolkit\"  # backend -&gt; user\n    write_file = \"write_file\"  # backend -&gt; user\n    ask = \"ask\"  # backend -&gt; user\n    notice = \"notice\"  # backend -&gt; user\n    search_mcp = \"search_mcp\"  # backend -&gt; user\n    install_mcp = \"install_mcp\"  # backend -&gt; user\n    terminal = \"terminal\"  # backend -&gt; user\n    end = \"end\"  # backend -&gt; user\n    stop = \"stop\"  # user -&gt; backend\n    supplement = \"supplement\"  # user -&gt; backend\n    pause = \"pause\"  # user -&gt; backend  user take control\n    resume = \"resume\"  # user -&gt; backend  user take control\n    new_agent = \"new_agent\"  # user -&gt; backend\n    budget_not_enough = \"budget_not_enough\"  # backend -&gt; user\n    add_task = \"add_task\"  # user -&gt; backend\n    remove_task = \"remove_task\"  # user -&gt; backend\n    skip_task = \"skip_task\"  # user -&gt; backend\n    timeout = \"timeout\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from typing import List, Dict, Optional",
            "lineNumber": 2
          },
          {
            "text": "from pydantic import BaseModel",
            "lineNumber": 3
          },
          {
            "text": "from app.exception.exception import ProgramException",
            "lineNumber": 4
          },
          {
            "text": "from app.model.chat import McpServers, Status, SupplementChat, Chat, UpdateData",
            "lineNumber": 5
          },
          {
            "text": "import asyncio",
            "lineNumber": 6
          },
          {
            "text": "from enum import Enum",
            "lineNumber": 7
          },
          {
            "text": "from camel.tasks import Task",
            "lineNumber": 8
          },
          {
            "text": "from contextlib import contextmanager",
            "lineNumber": 9
          },
          {
            "text": "from contextvars import ContextVar",
            "lineNumber": 10
          },
          {
            "text": "from datetime import datetime, timedelta",
            "lineNumber": 11
          },
          {
            "text": "import weakref",
            "lineNumber": 12
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "logger = traceroot.get_logger(\"task_service\")",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "lineNumber": 17
          },
          {
            "text": "class Action(str, Enum):",
            "lineNumber": 18,
            "isSignature": true
          },
          {
            "text": "    improve = \"improve\"  # user -&gt; backend",
            "lineNumber": 19
          },
          {
            "text": "    update_task = \"update_task\"  # user -&gt; backend",
            "lineNumber": 20
          },
          {
            "text": "    task_state = \"task_state\"  # backend -&gt; user",
            "lineNumber": 21
          },
          {
            "text": "    new_task_state = \"new_task_state\"  # backend -&gt; user",
            "lineNumber": 22
          },
          {
            "text": "    decompose_progress = \"decompose_progress\"  # backend -&gt; user (streaming decomposition)",
            "lineNumber": 23
          },
          {
            "text": "    decompose_text = \"decompose_text\"  # backend -&gt; user (raw streaming text)",
            "lineNumber": 24
          },
          {
            "text": "    start = \"start\"  # user -&gt; backend",
            "lineNumber": 25
          },
          {
            "text": "    create_agent = \"create_agent\"  # backend -&gt; user",
            "lineNumber": 26
          },
          {
            "text": "    activate_agent = \"activate_agent\"  # backend -&gt; user",
            "lineNumber": 27
          },
          {
            "text": "    deactivate_agent = \"deactivate_agent\"  # backend -&gt; user",
            "lineNumber": 28
          },
          {
            "text": "    assign_task = \"assign_task\"  # backend -&gt; user",
            "lineNumber": 29
          },
          {
            "text": "    activate_toolkit = \"activate_toolkit\"  # backend -&gt; user",
            "lineNumber": 30
          },
          {
            "text": "    deactivate_toolkit = \"deactivate_toolkit\"  # backend -&gt; user",
            "lineNumber": 31
          },
          {
            "text": "    write_file = \"write_file\"  # backend -&gt; user",
            "lineNumber": 32
          },
          {
            "text": "    ask = \"ask\"  # backend -&gt; user",
            "lineNumber": 33
          },
          {
            "text": "    notice = \"notice\"  # backend -&gt; user",
            "lineNumber": 34
          },
          {
            "text": "    search_mcp = \"search_mcp\"  # backend -&gt; user",
            "lineNumber": 35
          },
          {
            "text": "    install_mcp = \"install_mcp\"  # backend -&gt; user",
            "lineNumber": 36
          },
          {
            "text": "    terminal = \"terminal\"  # backend -&gt; user",
            "lineNumber": 37
          },
          {
            "text": "    end = \"end\"  # backend -&gt; user",
            "lineNumber": 38
          },
          {
            "text": "    stop = \"stop\"  # user -&gt; backend",
            "lineNumber": 39
          },
          {
            "text": "    supplement = \"supplement\"  # user -&gt; backend",
            "lineNumber": 40
          },
          {
            "text": "    pause = \"pause\"  # user -&gt; backend  user take control",
            "lineNumber": 41
          },
          {
            "text": "    resume = \"resume\"  # user -&gt; backend  user take control",
            "lineNumber": 42
          },
          {
            "text": "    new_agent = \"new_agent\"  # user -&gt; backend",
            "lineNumber": 43
          },
          {
            "text": "    budget_not_enough = \"budget_not_enough\"  # backend -&gt; user",
            "lineNumber": 44
          },
          {
            "text": "    add_task = \"add_task\"  # user -&gt; backend",
            "lineNumber": 45
          },
          {
            "text": "    remove_task = \"remove_task\"  # user -&gt; backend",
            "lineNumber": 46
          },
          {
            "text": "    skip_task = \"skip_task\"  # user -&gt; backend",
            "lineNumber": 47
          },
          {
            "text": "    timeout = \"timeout\"",
            "lineNumber": 48,
            "isSignature": true
          }
        ]
      },
      "score": 0.27156591415405273
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\whatsapp_toolkit.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 22,
            "column": 21
          }
        },
        "contents": "from typing import Any, Dict, List\nfrom camel.toolkits import WhatsAppToolkit as BaseWhatsAppToolkit\nfrom camel.toolkits.function_tool import FunctionTool\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\n\n\n@auto_listen_toolkit(BaseWhatsAppToolkit)\nclass WhatsAppToolkit(BaseWhatsAppToolkit, AbstractToolkit):\n    agent_name: str = Agents.social_medium_agent\n\n    def __init__(self, api_task_id: str, timeout: float | None = None):\n        super().__init__(timeout)\n        self.api_task_id = api_task_id\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:\n        if env(\"WHATSAPP_ACCESS_TOKEN\") and env(\"WHATSAPP_PHONE_NUMBER_ID\"):\n            return WhatsAppToolkit(api_task_id).get_tools()\n        else:\n            return []",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from typing import Any, Dict, List",
            "lineNumber": 1
          },
          {
            "text": "from camel.toolkits import WhatsAppToolkit as BaseWhatsAppToolkit",
            "lineNumber": 2
          },
          {
            "text": "from camel.toolkits.function_tool import FunctionTool",
            "lineNumber": 3
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 4
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 5
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 6
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "@auto_listen_toolkit(BaseWhatsAppToolkit)",
            "lineNumber": 10
          },
          {
            "text": "class WhatsAppToolkit(BaseWhatsAppToolkit, AbstractToolkit):",
            "lineNumber": 11,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.social_medium_agent",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "    def __init__(self, api_task_id: str, timeout: float | None = None):",
            "lineNumber": 14
          },
          {
            "text": "        super().__init__(timeout)",
            "lineNumber": 15
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 16
          },
          {
            "lineNumber": 17
          },
          {
            "text": "    @classmethod",
            "lineNumber": 18
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:",
            "lineNumber": 19
          },
          {
            "text": "        if env(\"WHATSAPP_ACCESS_TOKEN\") and env(\"WHATSAPP_PHONE_NUMBER_ID\"):",
            "lineNumber": 20
          },
          {
            "text": "            return WhatsAppToolkit(api_task_id).get_tools()",
            "lineNumber": 21
          },
          {
            "text": "        else:",
            "lineNumber": 22
          },
          {
            "text": "            return []",
            "lineNumber": 23,
            "isSignature": true
          }
        ]
      },
      "score": 0.2697904109954834
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


檢查基礎類別與環境變數設定方式：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "BaseSlackToolkit|camel\\.toolkits.*Slack",
  "caseInsensitive": true
}
```
Result:

```json
{
  "success": {
    "pattern": "BaseSlackToolkit|camel\\.toolkits.*Slack",
    "outputMode": "content",
    "workspaceResults": {
      "d:\\_Code\\_GitHub\\eigent-260119": {
        "content": {
          "matches": [
            {
              "file": ".\\backend\\app\\utils\\toolkit\\slack_toolkit.py",
              "matches": [
                {
                  "lineNumber": 1,
                  "content": "from camel.toolkits import SlackToolkit as BaseSlackToolkit"
                },
                {
                  "lineNumber": 12,
                  "content": "@auto_listen_toolkit(BaseSlackToolkit)"
                },
                {
                  "lineNumber": 13,
                  "content": "class SlackToolkit(BaseSlackToolkit, AbstractToolkit):"
                }
              ]
            }
          ],
          "totalLines": 3,
          "totalMatchedLines": 3
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How are SLACK_BOT_TOKEN and SLACK_USER_TOKEN environment variables set and used?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\slack_toolkit.py",
        "range": {
          "startPosition": {
            "column": 59
          },
          "endPosition": {
            "line": 25,
            "column": 21
          }
        },
        "contents": "from camel.toolkits.function_tool import FunctionTool\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\nfrom utils import traceroot_wrapper as traceroot\n\nlogger = traceroot.get_logger(\"slack_toolkit\")\n\n\n@auto_listen_toolkit(BaseSlackToolkit)\nclass SlackToolkit(BaseSlackToolkit, AbstractToolkit):\n    agent_name: str = Agents.social_medium_agent\n\n    def __init__(self, api_task_id: str, timeout: float | None = None):\n        super().__init__(timeout)\n        self.api_task_id = api_task_id\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:\n        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")\n        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):\n            return SlackToolkit(api_task_id).get_tools()\n        else:\n            return []",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from camel.toolkits.function_tool import FunctionTool",
            "lineNumber": 2
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 3
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 4
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 5
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 6
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "logger = traceroot.get_logger(\"slack_toolkit\")",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "@auto_listen_toolkit(BaseSlackToolkit)",
            "lineNumber": 12
          },
          {
            "text": "class SlackToolkit(BaseSlackToolkit, AbstractToolkit):",
            "lineNumber": 13,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.social_medium_agent",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "    def __init__(self, api_task_id: str, timeout: float | None = None):",
            "lineNumber": 16
          },
          {
            "text": "        super().__init__(timeout)",
            "lineNumber": 17
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "text": "    @classmethod",
            "lineNumber": 20
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:",
            "lineNumber": 21
          },
          {
            "text": "        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")",
            "lineNumber": 22
          },
          {
            "text": "        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):",
            "lineNumber": 23
          },
          {
            "text": "            return SlackToolkit(api_task_id).get_tools()",
            "lineNumber": 24
          },
          {
            "text": "        else:",
            "lineNumber": 25
          },
          {
            "text": "            return []",
            "lineNumber": 26,
            "isSignature": true
          }
        ]
      },
      "score": 0.5042514801025391
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\model\\config\\config.py",
        "range": {
          "startPosition": {
            "line": 31,
            "column": 29
          },
          "endPosition": {
            "line": 184
          }
        },
        "contents": "class ConfigInfo:\n    configs: dict = {\n        # \"model_platform\": {\"env_vars\": [\"api_key\"]},\n        # ConfigGroup.GOOGLE_SUITE.value: {\n        #     \"env_vars\": [],\n        #     \"toolkit\": \"\",\n        # },\n        ConfigGroup.SLACK.value: {\n            \"env_vars\": [\"SLACK_BOT_TOKEN\"],\n            \"toolkit\": \"slack_toolkit\",\n        },\n        ConfigGroup.LARK.value: {\n            \"env_vars\": [\"LARK_APP_ID\", \"LARK_APP_SECRET\"],\n            \"toolkit\": \"lark_toolkit\",\n        },\n        ConfigGroup.NOTION.value: {\n            \"env_vars\": [\"MCP_REMOTE_CONFIG_DIR\"],\n            \"toolkit\": \"notion_mcp_toolkit\",\n        },\n        ConfigGroup.TWITTER.value: {\n            \"env_vars\": [\n                \"TWITTER_CONSUMER_KEY\",\n                \"TWITTER_CONSUMER_SECRET\",\n                \"TWITTER_ACCESS_TOKEN\",\n                \"TWITTER_ACCESS_TOKEN_SECRET\",\n            ],\n            \"toolkit\": \"twitter_toolkit\",\n        },\n        ConfigGroup.WHATSAPP.value: {\n            \"env_vars\": [\"WHATSAPP_ACCESS_TOKEN\", \"WHATSAPP_PHONE_NUMBER_ID\"],\n            \"toolkit\": \"whatsapp_toolkit\",\n        },\n        ConfigGroup.LINKEDIN.value: {\n            \"env_vars\": [\"LINKEDIN_ACCESS_TOKEN\"],\n            \"toolkit\": \"linkedin_toolkit\",\n        },\n        ConfigGroup.REDDIT.value: {\n            \"env_vars\": [\n                \"REDDIT_CLIENT_ID\",\n                \"REDDIT_CLIENT_SECRET\",\n                \"REDDIT_USER_AGENT\",\n            ],\n            \"toolkit\": \"reddit_toolkit\",\n        },\n        # ConfigGroup.DISCORD.value: {\n        #     \"env_vars\": [\"DISCORD_BOT_TOKEN\"],\n        #     \"toolkit\": \"discord_toolkit\",\n        # },\n        ConfigGroup.SEARCH.value: {\n            \"env_vars\": [\"GOOGLE_API_KEY\", \"SEARCH_ENGINE_ID\", \"EXA_API_KEY\"],\n            \"toolkit\": \"search_toolkit\",\n        },\n        ConfigGroup.AUDIO_ANALYSIS.value: {\n            \"env_vars\": [],\n            \"toolkit\": \"audio_analysis_toolkit\",\n        },\n        ConfigGroup.CODE_EXECUTION.value: {\n            \"env_vars\": [],\n            \"toolkit\": \"code_execution_toolkit\",",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class ConfigInfo:",
            "lineNumber": 35,
            "isSignature": true
          },
          {
            "text": "    configs: dict = {",
            "lineNumber": 36
          },
          {
            "text": "        # \"model_platform\": {\"env_vars\": [\"api_key\"]},",
            "lineNumber": 37
          },
          {
            "text": "        # ConfigGroup.GOOGLE_SUITE.value: {",
            "lineNumber": 38
          },
          {
            "text": "        #     \"env_vars\": [],",
            "lineNumber": 39
          },
          {
            "text": "        #     \"toolkit\": \"\",",
            "lineNumber": 40
          },
          {
            "text": "        # },",
            "lineNumber": 41
          },
          {
            "text": "        ConfigGroup.SLACK.value: {",
            "lineNumber": 42
          },
          {
            "text": "            \"env_vars\": [\"SLACK_BOT_TOKEN\"],",
            "lineNumber": 43
          },
          {
            "text": "            \"toolkit\": \"slack_toolkit\",",
            "lineNumber": 44
          },
          {
            "text": "        },",
            "lineNumber": 45
          },
          {
            "text": "        ConfigGroup.LARK.value: {",
            "lineNumber": 46
          },
          {
            "text": "            \"env_vars\": [\"LARK_APP_ID\", \"LARK_APP_SECRET\"],",
            "lineNumber": 47
          },
          {
            "text": "            \"toolkit\": \"lark_toolkit\",",
            "lineNumber": 48
          },
          {
            "text": "        },",
            "lineNumber": 49
          },
          {
            "text": "        ConfigGroup.NOTION.value: {",
            "lineNumber": 50
          },
          {
            "text": "            \"env_vars\": [\"MCP_REMOTE_CONFIG_DIR\"],",
            "lineNumber": 51
          },
          {
            "text": "            \"toolkit\": \"notion_mcp_toolkit\",",
            "lineNumber": 52
          },
          {
            "text": "        },",
            "lineNumber": 53
          },
          {
            "text": "        ConfigGroup.TWITTER.value: {",
            "lineNumber": 54
          },
          {
            "text": "            \"env_vars\": [",
            "lineNumber": 55
          },
          {
            "text": "                \"TWITTER_CONSUMER_KEY\",",
            "lineNumber": 56
          },
          {
            "text": "                \"TWITTER_CONSUMER_SECRET\",",
            "lineNumber": 57
          },
          {
            "text": "                \"TWITTER_ACCESS_TOKEN\",",
            "lineNumber": 58
          },
          {
            "text": "                \"TWITTER_ACCESS_TOKEN_SECRET\",",
            "lineNumber": 59
          },
          {
            "text": "            ],",
            "lineNumber": 60
          },
          {
            "text": "            \"toolkit\": \"twitter_toolkit\",",
            "lineNumber": 61
          },
          {
            "text": "        },",
            "lineNumber": 62
          },
          {
            "text": "        ConfigGroup.WHATSAPP.value: {",
            "lineNumber": 63
          },
          {
            "text": "            \"env_vars\": [\"WHATSAPP_ACCESS_TOKEN\", \"WHATSAPP_PHONE_NUMBER_ID\"],",
            "lineNumber": 64
          },
          {
            "text": "            \"toolkit\": \"whatsapp_toolkit\",",
            "lineNumber": 65
          },
          {
            "text": "        },",
            "lineNumber": 66
          },
          {
            "text": "        ConfigGroup.LINKEDIN.value: {",
            "lineNumber": 67
          },
          {
            "text": "            \"env_vars\": [\"LINKEDIN_ACCESS_TOKEN\"],",
            "lineNumber": 68
          },
          {
            "text": "            \"toolkit\": \"linkedin_toolkit\",",
            "lineNumber": 69
          },
          {
            "text": "        },",
            "lineNumber": 70
          },
          {
            "text": "        ConfigGroup.REDDIT.value: {",
            "lineNumber": 71
          },
          {
            "text": "            \"env_vars\": [",
            "lineNumber": 72
          },
          {
            "text": "                \"REDDIT_CLIENT_ID\",",
            "lineNumber": 73
          },
          {
            "text": "                \"REDDIT_CLIENT_SECRET\",",
            "lineNumber": 74
          },
          {
            "text": "                \"REDDIT_USER_AGENT\",",
            "lineNumber": 75
          },
          {
            "text": "            ],",
            "lineNumber": 76
          },
          {
            "text": "            \"toolkit\": \"reddit_toolkit\",",
            "lineNumber": 77
          },
          {
            "text": "        },",
            "lineNumber": 78
          },
          {
            "text": "        # ConfigGroup.DISCORD.value: {",
            "lineNumber": 79
          },
          {
            "text": "        #     \"env_vars\": [\"DISCORD_BOT_TOKEN\"],",
            "lineNumber": 80
          },
          {
            "text": "        #     \"toolkit\": \"discord_toolkit\",",
            "lineNumber": 81
          },
          {
            "text": "        # },",
            "lineNumber": 82
          },
          {
            "text": "        ConfigGroup.SEARCH.value: {",
            "lineNumber": 83
          },
          {
            "text": "            \"env_vars\": [\"GOOGLE_API_KEY\", \"SEARCH_ENGINE_ID\", \"EXA_API_KEY\"],",
            "lineNumber": 84
          },
          {
            "text": "            \"toolkit\": \"search_toolkit\",",
            "lineNumber": 85
          },
          {
            "text": "        },",
            "lineNumber": 86
          },
          {
            "text": "        ConfigGroup.AUDIO_ANALYSIS.value: {",
            "lineNumber": 87
          },
          {
            "text": "            \"env_vars\": [],",
            "lineNumber": 88
          },
          {
            "text": "            \"toolkit\": \"audio_analysis_toolkit\",",
            "lineNumber": 89
          },
          {
            "text": "        },",
            "lineNumber": 90
          },
          {
            "text": "        ConfigGroup.CODE_EXECUTION.value: {",
            "lineNumber": 91
          },
          {
            "text": "            \"env_vars\": [],",
            "lineNumber": 92
          },
          {
            "text": "            \"toolkit\": \"code_execution_toolkit\",",
            "lineNumber": 93
          }
        ]
      },
      "score": 0.4325377941131592
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\component\\oauth_adapter.py",
        "range": {
          "startPosition": {
            "line": 17,
            "column": 12
          },
          "endPosition": {
            "line": 84
          }
        },
        "contents": "class SlackOAuthAdapter(OAuthAdapter):\n    def __init__(self, redirect_uri: Optional[str] = None):\n        self.client_id = env(\"SLACK_CLIENT_ID\", \"your_client_id\")\n        self.client_secret = env(\"SLACK_CLIENT_SECRET\", \"your_client_secret\")\n        self.redirect_uri = redirect_uri or env(\"SLACK_REDIRECT_URI\", \"https://localhost/api/oauth/slack/callback\")\n        self.scope = env(\"SLACK_SCOPE\", \"chat:write,channels:read,channels:join,groups:read,im:write\")\n\n    def get_authorize_url(self, state: Optional[str] = None) -&gt; Optional[str]:\n        url = (\n            f\"https://slack.com/oauth/v2/authorize?client_id={self.client_id}\"\n            f\"&amp;scope={self.scope}\"\n            f\"&amp;redirect_uri={self.redirect_uri}\"\n        )\n        if state:\n            url += f\"&amp;state={state}\"\n        return url\n\n    def fetch_token(self, code: Optional[str]) -&gt; Optional[Dict[str, Any]]:\n        if not code:\n            return None\n        token_url = \"https://slack.com/api/oauth.v2.access\"\n        data = {\n            \"client_id\": self.client_id,\n            \"client_secret\": self.client_secret,\n            \"code\": code,\n            \"redirect_uri\": self.redirect_uri,\n        }\n        with httpx.Client() as client:\n            resp = client.post(token_url, data=data)\n            return resp.json()\n\n\nclass NotionOAuthAdapter(OAuthAdapter):\n    def __init__(self, redirect_uri: Optional[str] = None):\n        self.client_id = env(\"NOTION_CLIENT_ID\", \"your_notion_client_id\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class SlackOAuthAdapter(OAuthAdapter):",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "    def __init__(self, redirect_uri: Optional[str] = None):",
            "lineNumber": 22
          },
          {
            "text": "        self.client_id = env(\"SLACK_CLIENT_ID\", \"your_client_id\")",
            "lineNumber": 23
          },
          {
            "text": "        self.client_secret = env(\"SLACK_CLIENT_SECRET\", \"your_client_secret\")",
            "lineNumber": 24
          },
          {
            "text": "        self.redirect_uri = redirect_uri or env(\"SLACK_REDIRECT_URI\", \"https://localhost/api/oauth/slack/callback\")",
            "lineNumber": 25
          },
          {
            "text": "        self.scope = env(\"SLACK_SCOPE\", \"chat:write,channels:read,channels:join,groups:read,im:write\")",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "    def get_authorize_url(self, state: Optional[str] = None) -&gt; Optional[str]:",
            "lineNumber": 28
          },
          {
            "text": "        url = (",
            "lineNumber": 29
          },
          {
            "text": "            f\"https://slack.com/oauth/v2/authorize?client_id={self.client_id}\"",
            "lineNumber": 30
          },
          {
            "text": "            f\"&amp;scope={self.scope}\"",
            "lineNumber": 31
          },
          {
            "text": "            f\"&amp;redirect_uri={self.redirect_uri}\"",
            "lineNumber": 32
          },
          {
            "text": "        )",
            "lineNumber": 33
          },
          {
            "text": "        if state:",
            "lineNumber": 34
          },
          {
            "text": "            url += f\"&amp;state={state}\"",
            "lineNumber": 35
          },
          {
            "text": "        return url",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "    def fetch_token(self, code: Optional[str]) -&gt; Optional[Dict[str, Any]]:",
            "lineNumber": 38
          },
          {
            "text": "        if not code:",
            "lineNumber": 39
          },
          {
            "text": "            return None",
            "lineNumber": 40
          },
          {
            "text": "        token_url = \"https://slack.com/api/oauth.v2.access\"",
            "lineNumber": 41
          },
          {
            "text": "        data = {",
            "lineNumber": 42
          },
          {
            "text": "            \"client_id\": self.client_id,",
            "lineNumber": 43
          },
          {
            "text": "            \"client_secret\": self.client_secret,",
            "lineNumber": 44
          },
          {
            "text": "            \"code\": code,",
            "lineNumber": 45
          },
          {
            "text": "            \"redirect_uri\": self.redirect_uri,",
            "lineNumber": 46
          },
          {
            "text": "        }",
            "lineNumber": 47
          },
          {
            "text": "        with httpx.Client() as client:",
            "lineNumber": 48
          },
          {
            "text": "            resp = client.post(token_url, data=data)",
            "lineNumber": 49
          },
          {
            "text": "            return resp.json()",
            "lineNumber": 50,
            "isSignature": true
          },
          {
            "lineNumber": 51
          },
          {
            "lineNumber": 52
          },
          {
            "text": "class NotionOAuthAdapter(OAuthAdapter):",
            "lineNumber": 53,
            "isSignature": true
          },
          {
            "text": "    def __init__(self, redirect_uri: Optional[str] = None):",
            "lineNumber": 54
          },
          {
            "text": "        self.client_id = env(\"NOTION_CLIENT_ID\", \"your_notion_client_id\")",
            "lineNumber": 55
          }
        ]
      },
      "score": 0.4007059335708618
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\hooks\\useIntegrationManagement.ts",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 292,
            "column": 1
          }
        },
        "contents": "export function useIntegrationManagement(items: IntegrationItem[]) {\nconst saveEnvAndConfig = \n [configs, email]);\n\n\t// Process OAuth callback\n\tconst processOauth = useCallback(\n\t\tasync (data: { provider: string; code: string }) =&gt; {\n\t\t\tif (isLockedRef.current) return;\n\t\t\tif (!items || items.length === 0) {\n\t\t\t\t// Items not ready, cache event, wait for items to have value\n\t\t\t\tpendingOauthEventRef.current = data;\n\t\t\t\tconsole.warn(\"items is empty, cache oauth event\", data);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst provider = data.provider.toLowerCase();\n\t\t\tisLockedRef.current = true;\n\t\t\ttry {\n\t\t\t\tconst tokenResult = await proxyFetchPost(\n\t\t\t\t\t&#96;/api/oauth/${provider}/token&#96;,\n\t\t\t\t\t{ code: data.code }\n\t\t\t\t);\n\t\t\t\tsetInstalled((prev) =&gt; ({\n\t\t\t\t\t...prev,\n\t\t\t\t\t[capitalizeFirstLetter(provider)]: true,\n\t\t\t\t}));\n\t\t\t\tconst currentItem = items.find(\n\t\t\t\t\t(item) =&gt; item.key.toLowerCase() === provider\n\t\t\t\t);\n\t\t\t\tif (provider === \"slack\") {\n\t\t\t\t\tif (\n\t\t\t\t\t\ttokenResult.access_token &amp;&amp;\n\t\t\t\t\t\tcurrentItem &amp;&amp;\n\t\t\t\t\t\tcurrentItem.env_vars &amp;&amp;\n\t\t\t\t\t\tcurrentItem.env_vars.length &gt; 0\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst envVarKey = currentItem.env_vars[0];\n\t\t\t\t\t\tawait saveEnvAndConfig(\n\t\t\t\t\t\t\tprovider,\n\t\t\t\t\t\t\tenvVarKey,\n\t\t\t\t\t\t\ttokenResult.access_token\n\t\t\t\t\t\t);\n\t\t\t\t\t\tawait fetchInstalled();\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\"Slack authorization successful and configuration saved!\"\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\"Slack authorization successful, but access_token not found or env configuration not found\"\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e: any) {\n\t\t\t\tconsole.log(&#96;${data.provider} authorization failed: ${e.message || e}&#96;);\n\t\t\t} finally {\n\t\t\t\tisLockedRef.current = false;\n\t\t\t}\n\t\t},\n\t\t[items, saveEnvAndConfig, fetchInstalled]\n\t);\n\n\t// Listen to main process OAuth authorization callback\n\tuseEffect(() =&gt; {\n\t\tconst handler = (_event: any, data: { provider: string; code: string }) =&gt; {\n\t\t\tif (!data.provider || !data.code) return;\n\t\t\tprocessOauth(data);\n\t\t};\n\t\twindow.ipcRenderer?.on(\"oauth-authorized\", handler);\n\t\treturn () =&gt; {\n\t\t\twindow.ipcRenderer?.off(\"oauth-authorized\", handler);\n\t\t};\n\t}, [processOauth]);\n\n\t// Listen to OAuth callback URL notification\n\tuseEffect\n\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 24,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 24,
                "column": 8
              },
              "endPosition": {
                "line": 25,
                "column": 2
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export function useIntegrationManagement(items: IntegrationItem[]) {",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "const saveEnvAndConfig = ",
            "lineNumber": 88
          },
          {
            "text": " [configs, email]);",
            "lineNumber": 128
          },
          {
            "lineNumber": 129
          },
          {
            "text": "\t// Process OAuth callback",
            "lineNumber": 130
          },
          {
            "text": "\tconst processOauth = useCallback(",
            "lineNumber": 131
          },
          {
            "text": "\t\tasync (data: { provider: string; code: string }) =&gt; {",
            "lineNumber": 132
          },
          {
            "text": "\t\t\tif (isLockedRef.current) return;",
            "lineNumber": 133
          },
          {
            "text": "\t\t\tif (!items || items.length === 0) {",
            "lineNumber": 134
          },
          {
            "text": "\t\t\t\t// Items not ready, cache event, wait for items to have value",
            "lineNumber": 135
          },
          {
            "text": "\t\t\t\tpendingOauthEventRef.current = data;",
            "lineNumber": 136
          },
          {
            "text": "\t\t\t\tconsole.warn(\"items is empty, cache oauth event\", data);",
            "lineNumber": 137
          },
          {
            "text": "\t\t\t\treturn;",
            "lineNumber": 138
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 139
          },
          {
            "text": "\t\t\tconst provider = data.provider.toLowerCase();",
            "lineNumber": 140
          },
          {
            "text": "\t\t\tisLockedRef.current = true;",
            "lineNumber": 141
          },
          {
            "text": "\t\t\ttry {",
            "lineNumber": 142
          },
          {
            "text": "\t\t\t\tconst tokenResult = await proxyFetchPost(",
            "lineNumber": 143
          },
          {
            "text": "\t\t\t\t\t&#96;/api/oauth/${provider}/token&#96;,",
            "lineNumber": 144
          },
          {
            "text": "\t\t\t\t\t{ code: data.code }",
            "lineNumber": 145
          },
          {
            "text": "\t\t\t\t);",
            "lineNumber": 146
          },
          {
            "text": "\t\t\t\tsetInstalled((prev) =&gt; ({",
            "lineNumber": 147
          },
          {
            "text": "\t\t\t\t\t...prev,",
            "lineNumber": 148
          },
          {
            "text": "\t\t\t\t\t[capitalizeFirstLetter(provider)]: true,",
            "lineNumber": 149
          },
          {
            "text": "\t\t\t\t}));",
            "lineNumber": 150
          },
          {
            "text": "\t\t\t\tconst currentItem = items.find(",
            "lineNumber": 151
          },
          {
            "text": "\t\t\t\t\t(item) =&gt; item.key.toLowerCase() === provider",
            "lineNumber": 152
          },
          {
            "text": "\t\t\t\t);",
            "lineNumber": 153
          },
          {
            "text": "\t\t\t\tif (provider === \"slack\") {",
            "lineNumber": 154
          },
          {
            "text": "\t\t\t\t\tif (",
            "lineNumber": 155
          },
          {
            "text": "\t\t\t\t\t\ttokenResult.access_token &amp;&amp;",
            "lineNumber": 156
          },
          {
            "text": "\t\t\t\t\t\tcurrentItem &amp;&amp;",
            "lineNumber": 157
          },
          {
            "text": "\t\t\t\t\t\tcurrentItem.env_vars &amp;&amp;",
            "lineNumber": 158
          },
          {
            "text": "\t\t\t\t\t\tcurrentItem.env_vars.length &gt; 0",
            "lineNumber": 159
          },
          {
            "text": "\t\t\t\t\t) {",
            "lineNumber": 160
          },
          {
            "text": "\t\t\t\t\t\tconst envVarKey = currentItem.env_vars[0];",
            "lineNumber": 161
          },
          {
            "text": "\t\t\t\t\t\tawait saveEnvAndConfig(",
            "lineNumber": 162
          },
          {
            "text": "\t\t\t\t\t\t\tprovider,",
            "lineNumber": 163
          },
          {
            "text": "\t\t\t\t\t\t\tenvVarKey,",
            "lineNumber": 164
          },
          {
            "text": "\t\t\t\t\t\t\ttokenResult.access_token",
            "lineNumber": 165
          },
          {
            "text": "\t\t\t\t\t\t);",
            "lineNumber": 166
          },
          {
            "text": "\t\t\t\t\t\tawait fetchInstalled();",
            "lineNumber": 167
          },
          {
            "text": "\t\t\t\t\t\tconsole.log(",
            "lineNumber": 168
          },
          {
            "text": "\t\t\t\t\t\t\t\"Slack authorization successful and configuration saved!\"",
            "lineNumber": 169
          },
          {
            "text": "\t\t\t\t\t\t);",
            "lineNumber": 170
          },
          {
            "text": "\t\t\t\t\t} else {",
            "lineNumber": 171
          },
          {
            "text": "\t\t\t\t\t\tconsole.log(",
            "lineNumber": 172
          },
          {
            "text": "\t\t\t\t\t\t\t\"Slack authorization successful, but access_token not found or env configuration not found\"",
            "lineNumber": 173
          },
          {
            "text": "\t\t\t\t\t\t);",
            "lineNumber": 174
          },
          {
            "text": "\t\t\t\t\t}",
            "lineNumber": 175
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 176
          },
          {
            "text": "\t\t\t} catch (e: any) {",
            "lineNumber": 177
          },
          {
            "text": "\t\t\t\tconsole.log(&#96;${data.provider} authorization failed: ${e.message || e}&#96;);",
            "lineNumber": 178
          },
          {
            "text": "\t\t\t} finally {",
            "lineNumber": 179
          },
          {
            "text": "\t\t\t\tisLockedRef.current = false;",
            "lineNumber": 180
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 181
          },
          {
            "text": "\t\t},",
            "lineNumber": 182
          },
          {
            "text": "\t\t[items, saveEnvAndConfig, fetchInstalled]",
            "lineNumber": 183
          },
          {
            "text": "\t);",
            "lineNumber": 184
          },
          {
            "lineNumber": 185
          },
          {
            "text": "\t// Listen to main process OAuth authorization callback",
            "lineNumber": 186
          },
          {
            "text": "\tuseEffect(() =&gt; {",
            "lineNumber": 187
          },
          {
            "text": "\t\tconst handler = (_event: any, data: { provider: string; code: string }) =&gt; {",
            "lineNumber": 188
          },
          {
            "text": "\t\t\tif (!data.provider || !data.code) return;",
            "lineNumber": 189
          },
          {
            "text": "\t\t\tprocessOauth(data);",
            "lineNumber": 190
          },
          {
            "text": "\t\t};",
            "lineNumber": 191
          },
          {
            "text": "\t\twindow.ipcRenderer?.on(\"oauth-authorized\", handler);",
            "lineNumber": 192
          },
          {
            "text": "\t\treturn () =&gt; {",
            "lineNumber": 193
          },
          {
            "text": "\t\t\twindow.ipcRenderer?.off(\"oauth-authorized\", handler);",
            "lineNumber": 194
          },
          {
            "text": "\t\t};",
            "lineNumber": 195
          },
          {
            "text": "\t}, [processOauth]);",
            "lineNumber": 196
          },
          {
            "lineNumber": 197
          },
          {
            "text": "\t// Listen to OAuth callback URL notification",
            "lineNumber": 198
          },
          {
            "text": "\tuseEffect",
            "lineNumber": 199
          },
          {
            "lineNumber": 209
          },
          {
            "text": "}",
            "lineNumber": 293,
            "isSignature": true
          }
        ]
      },
      "score": 0.38781818747520447
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\component\\environment.py",
        "range": {
          "startPosition": {
            "line": 58,
            "column": 43
          },
          "endPosition": {
            "line": 88
          }
        },
        "contents": "def env(key: str, default=None):\n    \"\"\"\n    Get environment variable.\n    First checks thread-local user-specific environment,\n    then falls back to global environment.\n    \"\"\"\n    # If we have a user-specific environment path, try to reload it to get latest values\n    if hasattr(_thread_local, 'env_path') and os.path.exists(_thread_local.env_path):\n        # Temporarily load user-specific env to get the latest value\n        from dotenv import dotenv_values\n        user_env_values = dotenv_values(_thread_local.env_path)\n        if key in user_env_values:\n            value = user_env_values[key] or default\n            traceroot_logger.debug(\"Environment variable retrieved from user-specific config\", extra={\"key\": key, \"env_path\": _thread_local.env_path, \"has_value\": value is not None})\n            return value\n\n    # Fall back to global environment\n    value = os.getenv(key, default)\n    traceroot_logger.debug(\"Environment variable retrieved from global config\", extra={\"key\": key, \"has_value\": value is not None, \"using_default\": value == default})\n    return value\n\n\ndef env_or_fail(key: str):\n    value = env(key)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def env(key: str, default=None):",
            "lineNumber": 62,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 63
          },
          {
            "text": "    Get environment variable.",
            "lineNumber": 64
          },
          {
            "text": "    First checks thread-local user-specific environment,",
            "lineNumber": 65
          },
          {
            "text": "    then falls back to global environment.",
            "lineNumber": 66
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 67
          },
          {
            "text": "    # If we have a user-specific environment path, try to reload it to get latest values",
            "lineNumber": 68
          },
          {
            "text": "    if hasattr(_thread_local, 'env_path') and os.path.exists(_thread_local.env_path):",
            "lineNumber": 69
          },
          {
            "text": "        # Temporarily load user-specific env to get the latest value",
            "lineNumber": 70
          },
          {
            "text": "        from dotenv import dotenv_values",
            "lineNumber": 71
          },
          {
            "text": "        user_env_values = dotenv_values(_thread_local.env_path)",
            "lineNumber": 72
          },
          {
            "text": "        if key in user_env_values:",
            "lineNumber": 73
          },
          {
            "text": "            value = user_env_values[key] or default",
            "lineNumber": 74
          },
          {
            "text": "            traceroot_logger.debug(\"Environment variable retrieved from user-specific config\", extra={\"key\": key, \"env_path\": _thread_local.env_path, \"has_value\": value is not None})",
            "lineNumber": 75
          },
          {
            "text": "            return value",
            "lineNumber": 76
          },
          {
            "lineNumber": 77
          },
          {
            "text": "    # Fall back to global environment",
            "lineNumber": 78
          },
          {
            "text": "    value = os.getenv(key, default)",
            "lineNumber": 79
          },
          {
            "text": "    traceroot_logger.debug(\"Environment variable retrieved from global config\", extra={\"key\": key, \"has_value\": value is not None, \"using_default\": value == default})",
            "lineNumber": 80
          },
          {
            "text": "    return value",
            "lineNumber": 81,
            "isSignature": true
          },
          {
            "lineNumber": 82
          },
          {
            "lineNumber": 83
          },
          {
            "text": "def env_or_fail(key: str):",
            "lineNumber": 84,
            "isSignature": true
          },
          {
            "text": "    value = env(key)",
            "lineNumber": 85
          }
        ]
      },
      "score": 0.36856740713119507
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\component\\environment.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 46
          }
        },
        "contents": "from utils import traceroot_wrapper as traceroot\nimport importlib.util\nimport os\nfrom pathlib import Path\nfrom fastapi import APIRouter, FastAPI\nfrom dotenv import load_dotenv\nimport importlib\nfrom typing import Any, overload\nimport threading\n\ntraceroot_logger = traceroot.get_logger(\"env\")\n\n# Thread-local storage for user-specific environment\n_thread_local = threading.local()\n\n# Default global environment path\ndefault_env_path = os.path.join(os.path.expanduser(\"~\"), \".eigent\", \".env\")\nload_dotenv(dotenv_path=default_env_path)\n\n\ndef set_user_env_path(env_path: str | None = None):\n    \"\"\"\n    Set user-specific environment path for current thread.\n    If env_path is None, uses default global environment.\n    \"\"\"\n    traceroot_logger.info(\"Setting user environment path\", extra={\"env_path\": env_path, \"exists\": env_path and os.path.exists(env_path) if env_path else None})\n\n    if env_path and os.path.exists(env_path):\n        _thread_local.env_path = env_path\n        # Load user-specific environment variables\n        load_dotenv(dotenv_path=env_path, override=True)\n        traceroot_logger.info(\"User-specific environment loaded\", extra={\"env_path\": env_path})\n    else:\n        # Clear thread-local env_path to fall back to global\n        if hasattr(_thread_local, 'env_path'):\n            delattr(_thread_local, 'env_path')\n        traceroot_logger.info(\"Reset to default global environment\")\n\n        if env_path and not os.path.exists(env_path):\n            traceroot_logger.warning(\"User environment path does not exist, falling back to global\", extra={\"env_path\": env_path})\n\n\ndef get_current_env_path() -&gt; str:\n    \"\"\"\n    Get current environment path (either user-specific or default).\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 1
          },
          {
            "text": "import importlib.util",
            "lineNumber": 2
          },
          {
            "text": "import os",
            "lineNumber": 3
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 4
          },
          {
            "text": "from fastapi import APIRouter, FastAPI",
            "lineNumber": 5
          },
          {
            "text": "from dotenv import load_dotenv",
            "lineNumber": 6
          },
          {
            "text": "import importlib",
            "lineNumber": 7
          },
          {
            "text": "from typing import Any, overload",
            "lineNumber": 8
          },
          {
            "text": "import threading",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "traceroot_logger = traceroot.get_logger(\"env\")",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "# Thread-local storage for user-specific environment",
            "lineNumber": 13
          },
          {
            "text": "_thread_local = threading.local()",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "# Default global environment path",
            "lineNumber": 16
          },
          {
            "text": "default_env_path = os.path.join(os.path.expanduser(\"~\"), \".eigent\", \".env\")",
            "lineNumber": 17
          },
          {
            "text": "load_dotenv(dotenv_path=default_env_path)",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "def set_user_env_path(env_path: str | None = None):",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 22
          },
          {
            "text": "    Set user-specific environment path for current thread.",
            "lineNumber": 23
          },
          {
            "text": "    If env_path is None, uses default global environment.",
            "lineNumber": 24
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 25
          },
          {
            "text": "    traceroot_logger.info(\"Setting user environment path\", extra={\"env_path\": env_path, \"exists\": env_path and os.path.exists(env_path) if env_path else None})",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "    if env_path and os.path.exists(env_path):",
            "lineNumber": 28
          },
          {
            "text": "        _thread_local.env_path = env_path",
            "lineNumber": 29
          },
          {
            "text": "        # Load user-specific environment variables",
            "lineNumber": 30
          },
          {
            "text": "        load_dotenv(dotenv_path=env_path, override=True)",
            "lineNumber": 31
          },
          {
            "text": "        traceroot_logger.info(\"User-specific environment loaded\", extra={\"env_path\": env_path})",
            "lineNumber": 32
          },
          {
            "text": "    else:",
            "lineNumber": 33
          },
          {
            "text": "        # Clear thread-local env_path to fall back to global",
            "lineNumber": 34
          },
          {
            "text": "        if hasattr(_thread_local, 'env_path'):",
            "lineNumber": 35
          },
          {
            "text": "            delattr(_thread_local, 'env_path')",
            "lineNumber": 36
          },
          {
            "text": "        traceroot_logger.info(\"Reset to default global environment\")",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "        if env_path and not os.path.exists(env_path):",
            "lineNumber": 39
          },
          {
            "text": "            traceroot_logger.warning(\"User environment path does not exist, falling back to global\", extra={\"env_path\": env_path})",
            "lineNumber": 40,
            "isSignature": true
          },
          {
            "lineNumber": 41
          },
          {
            "lineNumber": 42
          },
          {
            "text": "def get_current_env_path() -&gt; str:",
            "lineNumber": 43,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 44
          },
          {
            "text": "    Get current environment path (either user-specific or default).",
            "lineNumber": 45
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 46
          }
        ]
      },
      "score": 0.36234956979751587
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\controller\\chat_controller.py",
        "range": {
          "startPosition": {
            "line": 70,
            "column": 13
          },
          "endPosition": {
            "line": 126
          }
        },
        "contents": "@router.post(\"/chat\", name=\"start chat\")\n@traceroot.trace()\nasync def post(data: Chat, request: Request):\n    chat_logger.info(\n        \"Starting new chat session\", extra={\"project_id\": data.project_id, \"task_id\": data.task_id, \"user\": data.email}\n    )\n    task_lock = get_or_create_task_lock(data.project_id)\n\n    # Set user-specific environment path for this thread\n    set_user_env_path(data.env_path)\n    load_dotenv(dotenv_path=data.env_path)\n\n    os.environ[\"file_save_path\"] = data.file_save_path()\n    os.environ[\"browser_port\"] = str(data.browser_port)\n    os.environ[\"OPENAI_API_KEY\"] = data.api_key\n    os.environ[\"OPENAI_API_BASE_URL\"] = data.api_url or \"https://api.openai.com/v1\"\n    os.environ[\"CAMEL_MODEL_LOG_ENABLED\"] = \"true\"\n\n    # Set user-specific search engine configuration if provided\n    if data.search_config:\n        for key, value in data.search_config.items():\n            if value:  # Only set non-empty values\n                os.environ[key] = value\n                chat_logger.info(f\"Set search config: {key}\", extra={\"project_id\": data.project_id})\n\n    email_sanitized = re.sub(r'[\\\\/*?:\"&lt;&gt;|\\s]', \"_\", data.email.split(\"@\")[0]).strip(\".\")\n    camel_log = (\n        Path.home()\n        / \".eigent\"\n        / email_sanitized\n        / (\"project_\" + data.project_id)\n        / (\"task_\" + data.task_id)\n        / \"camel_logs\"\n    )\n    camel_log.mkdir(parents=True, exist_ok=True)\n\n    os.environ[\"CAMEL_LOG_DIR\"] = str(camel_log)\n\n    if data.is_cloud():\n        os.environ[\"cloud_api_key\"] = data.api_key\n\n    # Set the initial current_task_id in task_lock\n    set_current_task_id(data.project_id, data.task_id)\n\n    # Put initial action in queue to start processing\n    await task_lock.put_queue(ActionImproveData(data=data.question, new_task_id=data.task_id))\n\n    chat_logger.info",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@router.post(\"/chat\", name=\"start chat\")",
            "lineNumber": 74
          },
          {
            "text": "@traceroot.trace()",
            "lineNumber": 75
          },
          {
            "text": "async def post(data: Chat, request: Request):",
            "lineNumber": 76,
            "isSignature": true
          },
          {
            "text": "    chat_logger.info(",
            "lineNumber": 77
          },
          {
            "text": "        \"Starting new chat session\", extra={\"project_id\": data.project_id, \"task_id\": data.task_id, \"user\": data.email}",
            "lineNumber": 78
          },
          {
            "text": "    )",
            "lineNumber": 79
          },
          {
            "text": "    task_lock = get_or_create_task_lock(data.project_id)",
            "lineNumber": 80
          },
          {
            "lineNumber": 81
          },
          {
            "text": "    # Set user-specific environment path for this thread",
            "lineNumber": 82
          },
          {
            "text": "    set_user_env_path(data.env_path)",
            "lineNumber": 83
          },
          {
            "text": "    load_dotenv(dotenv_path=data.env_path)",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "    os.environ[\"file_save_path\"] = data.file_save_path()",
            "lineNumber": 86
          },
          {
            "text": "    os.environ[\"browser_port\"] = str(data.browser_port)",
            "lineNumber": 87
          },
          {
            "text": "    os.environ[\"OPENAI_API_KEY\"] = data.api_key",
            "lineNumber": 88
          },
          {
            "text": "    os.environ[\"OPENAI_API_BASE_URL\"] = data.api_url or \"https://api.openai.com/v1\"",
            "lineNumber": 89
          },
          {
            "text": "    os.environ[\"CAMEL_MODEL_LOG_ENABLED\"] = \"true\"",
            "lineNumber": 90
          },
          {
            "lineNumber": 91
          },
          {
            "text": "    # Set user-specific search engine configuration if provided",
            "lineNumber": 92
          },
          {
            "text": "    if data.search_config:",
            "lineNumber": 93
          },
          {
            "text": "        for key, value in data.search_config.items():",
            "lineNumber": 94
          },
          {
            "text": "            if value:  # Only set non-empty values",
            "lineNumber": 95
          },
          {
            "text": "                os.environ[key] = value",
            "lineNumber": 96
          },
          {
            "text": "                chat_logger.info(f\"Set search config: {key}\", extra={\"project_id\": data.project_id})",
            "lineNumber": 97
          },
          {
            "lineNumber": 98
          },
          {
            "text": "    email_sanitized = re.sub(r'[\\\\/*?:\"&lt;&gt;|\\s]', \"_\", data.email.split(\"@\")[0]).strip(\".\")",
            "lineNumber": 99
          },
          {
            "text": "    camel_log = (",
            "lineNumber": 100
          },
          {
            "text": "        Path.home()",
            "lineNumber": 101
          },
          {
            "text": "        / \".eigent\"",
            "lineNumber": 102
          },
          {
            "text": "        / email_sanitized",
            "lineNumber": 103
          },
          {
            "text": "        / (\"project_\" + data.project_id)",
            "lineNumber": 104
          },
          {
            "text": "        / (\"task_\" + data.task_id)",
            "lineNumber": 105
          },
          {
            "text": "        / \"camel_logs\"",
            "lineNumber": 106
          },
          {
            "text": "    )",
            "lineNumber": 107
          },
          {
            "text": "    camel_log.mkdir(parents=True, exist_ok=True)",
            "lineNumber": 108
          },
          {
            "lineNumber": 109
          },
          {
            "text": "    os.environ[\"CAMEL_LOG_DIR\"] = str(camel_log)",
            "lineNumber": 110
          },
          {
            "lineNumber": 111
          },
          {
            "text": "    if data.is_cloud():",
            "lineNumber": 112
          },
          {
            "text": "        os.environ[\"cloud_api_key\"] = data.api_key",
            "lineNumber": 113
          },
          {
            "lineNumber": 114
          },
          {
            "text": "    # Set the initial current_task_id in task_lock",
            "lineNumber": 115
          },
          {
            "text": "    set_current_task_id(data.project_id, data.task_id)",
            "lineNumber": 116
          },
          {
            "lineNumber": 117
          },
          {
            "text": "    # Put initial action in queue to start processing",
            "lineNumber": 118
          },
          {
            "text": "    await task_lock.put_queue(ActionImproveData(data=data.question, new_task_id=data.task_id))",
            "lineNumber": 119
          },
          {
            "lineNumber": 120
          },
          {
            "text": "    chat_logger.info",
            "lineNumber": 121
          }
        ]
      },
      "score": 0.3391192555427551
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\stack\\client.ts",
        "range": {
          "startPosition": {
            "column": 51
          },
          "endPosition": {
            "line": 16,
            "column": 10
          }
        },
        "contents": "import { useNavigate } from \"react-router-dom\";\nimport { hasStackKeys } from \"../lib\";\n\nconst hasSlackKeys = hasStackKeys();\n\nexport const stackClientApp = hasSlackKeys ? new StackClientApp({\n\tprojectId: import.meta.env.VITE_STACK_PROJECT_ID,\n\tpublishableClientKey: import.meta.env.VITE_STACK_PUBLISHABLE_CLIENT_KEY,\n\ttokenStore: \"cookie\",\n\tredirectMethod: {\n\t\tuseNavigate,\n\t},\n\turls: {\n\t\toauthCallback: (import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL) + \"/api/redirect/callback\",\n\t},\n}) : null;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import { useNavigate } from \"react-router-dom\";",
            "lineNumber": 2
          },
          {
            "text": "import { hasStackKeys } from \"../lib\";",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "const hasSlackKeys = hasStackKeys();",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "export const stackClientApp = hasSlackKeys ? new StackClientApp({",
            "lineNumber": 7
          },
          {
            "text": "\tprojectId: import.meta.env.VITE_STACK_PROJECT_ID,",
            "lineNumber": 8
          },
          {
            "text": "\tpublishableClientKey: import.meta.env.VITE_STACK_PUBLISHABLE_CLIENT_KEY,",
            "lineNumber": 9
          },
          {
            "text": "\ttokenStore: \"cookie\",",
            "lineNumber": 10
          },
          {
            "text": "\tredirectMethod: {",
            "lineNumber": 11
          },
          {
            "text": "\t\tuseNavigate,",
            "lineNumber": 12
          },
          {
            "text": "\t},",
            "lineNumber": 13
          },
          {
            "text": "\turls: {",
            "lineNumber": 14
          },
          {
            "text": "\t\toauthCallback: (import.meta.env.DEV ? import.meta.env.VITE_PROXY_URL : import.meta.env.VITE_BASE_URL) + \"/api/redirect/callback\",",
            "lineNumber": 15
          },
          {
            "text": "\t},",
            "lineNumber": 16
          },
          {
            "text": "}) : null;",
            "lineNumber": 17
          }
        ]
      },
      "score": 0.32581794261932373
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\component\\auth.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 57,
            "column": 46
          }
        },
        "contents": "from fastapi import Depends, Header\nfrom fastapi_babel import _\nfrom sqlmodel import Session, select\nfrom app.component import code\nfrom fastapi.security import OAuth2PasswordBearer\nfrom app.component.database import session\nfrom app.component.environment import env, env_not_empty\nfrom datetime import timedelta, datetime\nimport jwt\nfrom jwt.exceptions import InvalidTokenError\nfrom app.model.mcp.proxy import ApiKey\nfrom app.model.user.key import Key\nfrom app.model.user.user import User\n\nfrom app.exception.exception import (\n    NoPermissionException,\n    TokenException,\n)\n\n\nclass Auth:\n    SECRET_KEY = env_not_empty(\"secret_key\")\n\n    def __init__(self, id: int, expired_at: datetime):\n        self.id = id\n        self.expired_at = expired_at\n        self._user: User | None = None\n\n    @property\n    def user(self):\n        if self._user is None:\n            raise NoPermissionException(\"未查询到登录用户\")\n        return self._user\n\n    @classmethod\n    def decode_token(cls, token: str):\n        try:\n            payload = jwt.decode(token, Auth.SECRET_KEY, algorithms=[\"HS256\"])\n            id = payload[\"id\"]\n            if payload[\"exp\"] &lt; int(datetime.now().timestamp()):\n                raise TokenException(code.token_expired, _(\"Validate credentials expired\"))\n        except InvalidTokenError:\n            raise TokenException(code.token_invalid, _(\"Could not validate credentials\"))\n        return Auth(id, payload[\"exp\"])\n\n    @classmethod\n    def create_access_token(cls, user_id: int, expires_delta: timedelta | None = None):\n        to_encode: dict = {\"id\": user_id}\n        if expires_delta:\n            expire = datetime.now() + expires_delta\n        else:\n            expire = datetime.now() + timedelta(days=30)\n        to_encode.update({\"exp\": expire})\n        encoded_jwt = jwt.encode(to_encode, Auth.SECRET_KEY, algorithm=\"HS256\")\n        return encoded_jwt\n\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from fastapi import Depends, Header",
            "lineNumber": 1
          },
          {
            "text": "from fastapi_babel import _",
            "lineNumber": 2
          },
          {
            "text": "from sqlmodel import Session, select",
            "lineNumber": 3
          },
          {
            "text": "from app.component import code",
            "lineNumber": 4
          },
          {
            "text": "from fastapi.security import OAuth2PasswordBearer",
            "lineNumber": 5
          },
          {
            "text": "from app.component.database import session",
            "lineNumber": 6
          },
          {
            "text": "from app.component.environment import env, env_not_empty",
            "lineNumber": 7
          },
          {
            "text": "from datetime import timedelta, datetime",
            "lineNumber": 8
          },
          {
            "text": "import jwt",
            "lineNumber": 9
          },
          {
            "text": "from jwt.exceptions import InvalidTokenError",
            "lineNumber": 10
          },
          {
            "text": "from app.model.mcp.proxy import ApiKey",
            "lineNumber": 11
          },
          {
            "text": "from app.model.user.key import Key",
            "lineNumber": 12
          },
          {
            "text": "from app.model.user.user import User",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "from app.exception.exception import (",
            "lineNumber": 15
          },
          {
            "text": "    NoPermissionException,",
            "lineNumber": 16
          },
          {
            "text": "    TokenException,",
            "lineNumber": 17
          },
          {
            "text": ")",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "class Auth:",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "text": "    SECRET_KEY = env_not_empty(\"secret_key\")",
            "lineNumber": 22
          },
          {
            "lineNumber": 23
          },
          {
            "text": "    def __init__(self, id: int, expired_at: datetime):",
            "lineNumber": 24
          },
          {
            "text": "        self.id = id",
            "lineNumber": 25
          },
          {
            "text": "        self.expired_at = expired_at",
            "lineNumber": 26
          },
          {
            "text": "        self._user: User | None = None",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "    @property",
            "lineNumber": 29
          },
          {
            "text": "    def user(self):",
            "lineNumber": 30
          },
          {
            "text": "        if self._user is None:",
            "lineNumber": 31
          },
          {
            "text": "            raise NoPermissionException(\"未查询到登录用户\")",
            "lineNumber": 32
          },
          {
            "text": "        return self._user",
            "lineNumber": 33
          },
          {
            "lineNumber": 34
          },
          {
            "text": "    @classmethod",
            "lineNumber": 35
          },
          {
            "text": "    def decode_token(cls, token: str):",
            "lineNumber": 36
          },
          {
            "text": "        try:",
            "lineNumber": 37
          },
          {
            "text": "            payload = jwt.decode(token, Auth.SECRET_KEY, algorithms=[\"HS256\"])",
            "lineNumber": 38
          },
          {
            "text": "            id = payload[\"id\"]",
            "lineNumber": 39
          },
          {
            "text": "            if payload[\"exp\"] &lt; int(datetime.now().timestamp()):",
            "lineNumber": 40
          },
          {
            "text": "                raise TokenException(code.token_expired, _(\"Validate credentials expired\"))",
            "lineNumber": 41
          },
          {
            "text": "        except InvalidTokenError:",
            "lineNumber": 42
          },
          {
            "text": "            raise TokenException(code.token_invalid, _(\"Could not validate credentials\"))",
            "lineNumber": 43
          },
          {
            "text": "        return Auth(id, payload[\"exp\"])",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "    @classmethod",
            "lineNumber": 46
          },
          {
            "text": "    def create_access_token(cls, user_id: int, expires_delta: timedelta | None = None):",
            "lineNumber": 47
          },
          {
            "text": "        to_encode: dict = {\"id\": user_id}",
            "lineNumber": 48
          },
          {
            "text": "        if expires_delta:",
            "lineNumber": 49
          },
          {
            "text": "            expire = datetime.now() + expires_delta",
            "lineNumber": 50
          },
          {
            "text": "        else:",
            "lineNumber": 51
          },
          {
            "text": "            expire = datetime.now() + timedelta(days=30)",
            "lineNumber": 52
          },
          {
            "text": "        to_encode.update({\"exp\": expire})",
            "lineNumber": 53
          },
          {
            "text": "        encoded_jwt = jwt.encode(to_encode, Auth.SECRET_KEY, algorithm=\"HS256\")",
            "lineNumber": 54
          },
          {
            "text": "        return encoded_jwt",
            "lineNumber": 55,
            "isSignature": true
          },
          {
            "lineNumber": 56
          },
          {
            "lineNumber": 57
          },
          {
            "text": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=",
            "lineNumber": 58
          }
        ]
      },
      "score": 0.3060934543609619
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\google_calendar_toolkit.py",
        "range": {
          "startPosition": {
            "line": 17
          },
          "endPosition": {
            "line": 286
          }
        },
        "contents": "@auto_listen_toolkit(BaseGoogleCalendarToolkit)\nclass GoogleCalendarToolkit(BaseGoogleCalendarToolkit, AbstractToolkit):\n\n\n    def _authenticate(self):\n        from google.oauth2.credentials import Credentials\n        from google_auth_oauthlib.flow import InstalledAppFlow\n        from google.auth.transport.requests import Request\n        from dotenv import load_dotenv\n\n        # Force reload environment variables from default .env file\n        default_env_path = os.path.join(os.path.expanduser(\"~\"), \".eigent\", \".env\")\n        if os.path.exists(default_env_path):\n            load_dotenv(dotenv_path=default_env_path, override=True)\n\n        creds = None\n\n        # First, try to load from token file (canonical then legacy install_auth)\n        try:\n            if os.path.exists(self._token_path):\n                logger.info(f\"Loading credentials from token file: {self._token_path}\")\n                creds = Credentials.from_authorized_user_file(self._token_path, SCOPES)\n                logger.info(\"Successfully loaded credentials from token file\")\n            elif os.path.exists(self._token_path.replace(\"google_calendar_token.json\", \"google_calendar_token_install_auth.json\")):\n                legacy_path = self._token_path.replace(\n                    \"google_calendar_token.json\", \"google_calendar_token_install_auth.json\"\n                )\n                logger.info(f\"Loading credentials from legacy token file: {legacy_path}\")\n                creds = Credentials.from_authorized_user_file(legacy_path, SCOPES)\n                logger.info(\"Successfully loaded credentials from legacy token file\")\n        except Exception as e:\n            logger.warning(f\"Could not load from token file: {e}\")\n            creds = None\n\n        # If no token file, try environment variables",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 18,
                "column": 1
              },
              "endPosition": {
                "line": 19,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 19,
                "column": 1
              },
              "endPosition": {
                "line": 20,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@auto_listen_toolkit(BaseGoogleCalendarToolkit)",
            "lineNumber": 18
          },
          {
            "text": "class GoogleCalendarToolkit(BaseGoogleCalendarToolkit, AbstractToolkit):",
            "lineNumber": 19,
            "isSignature": true
          },
          {
            "lineNumber": 73
          },
          {
            "lineNumber": 74
          },
          {
            "text": "    def _authenticate(self):",
            "lineNumber": 75
          },
          {
            "text": "        from google.oauth2.credentials import Credentials",
            "lineNumber": 76
          },
          {
            "text": "        from google_auth_oauthlib.flow import InstalledAppFlow",
            "lineNumber": 77
          },
          {
            "text": "        from google.auth.transport.requests import Request",
            "lineNumber": 78
          },
          {
            "text": "        from dotenv import load_dotenv",
            "lineNumber": 79
          },
          {
            "lineNumber": 80
          },
          {
            "text": "        # Force reload environment variables from default .env file",
            "lineNumber": 81
          },
          {
            "text": "        default_env_path = os.path.join(os.path.expanduser(\"~\"), \".eigent\", \".env\")",
            "lineNumber": 82
          },
          {
            "text": "        if os.path.exists(default_env_path):",
            "lineNumber": 83
          },
          {
            "text": "            load_dotenv(dotenv_path=default_env_path, override=True)",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "        creds = None",
            "lineNumber": 86
          },
          {
            "lineNumber": 87
          },
          {
            "text": "        # First, try to load from token file (canonical then legacy install_auth)",
            "lineNumber": 88
          },
          {
            "text": "        try:",
            "lineNumber": 89
          },
          {
            "text": "            if os.path.exists(self._token_path):",
            "lineNumber": 90
          },
          {
            "text": "                logger.info(f\"Loading credentials from token file: {self._token_path}\")",
            "lineNumber": 91
          },
          {
            "text": "                creds = Credentials.from_authorized_user_file(self._token_path, SCOPES)",
            "lineNumber": 92
          },
          {
            "text": "                logger.info(\"Successfully loaded credentials from token file\")",
            "lineNumber": 93
          },
          {
            "text": "            elif os.path.exists(self._token_path.replace(\"google_calendar_token.json\", \"google_calendar_token_install_auth.json\")):",
            "lineNumber": 94
          },
          {
            "text": "                legacy_path = self._token_path.replace(",
            "lineNumber": 95
          },
          {
            "text": "                    \"google_calendar_token.json\", \"google_calendar_token_install_auth.json\"",
            "lineNumber": 96
          },
          {
            "text": "                )",
            "lineNumber": 97
          },
          {
            "text": "                logger.info(f\"Loading credentials from legacy token file: {legacy_path}\")",
            "lineNumber": 98
          },
          {
            "text": "                creds = Credentials.from_authorized_user_file(legacy_path, SCOPES)",
            "lineNumber": 99
          },
          {
            "text": "                logger.info(\"Successfully loaded credentials from legacy token file\")",
            "lineNumber": 100
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 101
          },
          {
            "text": "            logger.warning(f\"Could not load from token file: {e}\")",
            "lineNumber": 102
          },
          {
            "text": "            creds = None",
            "lineNumber": 103
          },
          {
            "lineNumber": 104
          },
          {
            "text": "        # If no token file, try environment variables",
            "lineNumber": 105
          }
        ]
      },
      "score": 0.3048403859138489
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\google_calendar_toolkit.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 286
          }
        },
        "contents": "from typing import Any, Dict, List\nimport os\nimport threading\n\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\nfrom app.utils.oauth_state_manager import oauth_state_manager\nfrom utils import traceroot_wrapper as traceroot\n\nfrom camel.toolkits import GoogleCalendarToolkit as BaseGoogleCalendarToolkit\n\nlogger = traceroot.get_logger(\"main\")\n\nSCOPES = ['https://www.googleapis.com/auth/calendar']\n\n@auto_listen_toolkit(BaseGoogleCalendarToolkit)\nclass GoogleCalendarToolkit(BaseGoogleCalendarToolkit, AbstractToolkit):\n    agent_name: str = Agents.social_medium_agent\n\n    def __init__(self, api_task_id: str, timeout: float | None = None):\n        self.api_task_id = api_task_id\n        # Use a stable token file (no per-task suffix). Can be overridden by env.\n        self._token_path = env(\"GOOGLE_CALENDAR_TOKEN_PATH\") or os.path.join(\n            os.path.expanduser(\"~\"),\n            \".eigent\",\n            \"tokens\",\n            \"google_calendar\",\n            \"google_calendar_token.json\",\n        )\n        super().__init__(timeout)\n\n    @classmethod\n    def _build_canonical_token_path(cls) -&gt; str:\n        return env(\"GOOGLE_CALENDAR_TOKEN_PATH\") or os.path.join(\n            os.path.expanduser(\"~\"),\n            \".eigent\",\n            \"tokens\",\n            \"google_calendar\",\n            \"google_calendar_token.json\",\n        )\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str):\n        from dotenv import load_dotenv",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from typing import Any, Dict, List",
            "lineNumber": 1
          },
          {
            "text": "import os",
            "lineNumber": 2
          },
          {
            "text": "import threading",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 5
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 6
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 7
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 8
          },
          {
            "text": "from app.utils.oauth_state_manager import oauth_state_manager",
            "lineNumber": 9
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "from camel.toolkits import GoogleCalendarToolkit as BaseGoogleCalendarToolkit",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "logger = traceroot.get_logger(\"main\")",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "SCOPES = ['https://www.googleapis.com/auth/calendar']",
            "lineNumber": 16
          },
          {
            "lineNumber": 17
          },
          {
            "text": "@auto_listen_toolkit(BaseGoogleCalendarToolkit)",
            "lineNumber": 18
          },
          {
            "text": "class GoogleCalendarToolkit(BaseGoogleCalendarToolkit, AbstractToolkit):",
            "lineNumber": 19,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.social_medium_agent",
            "lineNumber": 20
          },
          {
            "lineNumber": 21
          },
          {
            "text": "    def __init__(self, api_task_id: str, timeout: float | None = None):",
            "lineNumber": 22
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 23
          },
          {
            "text": "        # Use a stable token file (no per-task suffix). Can be overridden by env.",
            "lineNumber": 24
          },
          {
            "text": "        self._token_path = env(\"GOOGLE_CALENDAR_TOKEN_PATH\") or os.path.join(",
            "lineNumber": 25
          },
          {
            "text": "            os.path.expanduser(\"~\"),",
            "lineNumber": 26
          },
          {
            "text": "            \".eigent\",",
            "lineNumber": 27
          },
          {
            "text": "            \"tokens\",",
            "lineNumber": 28
          },
          {
            "text": "            \"google_calendar\",",
            "lineNumber": 29
          },
          {
            "text": "            \"google_calendar_token.json\",",
            "lineNumber": 30
          },
          {
            "text": "        )",
            "lineNumber": 31
          },
          {
            "text": "        super().__init__(timeout)",
            "lineNumber": 32
          },
          {
            "lineNumber": 33
          },
          {
            "text": "    @classmethod",
            "lineNumber": 34
          },
          {
            "text": "    def _build_canonical_token_path(cls) -&gt; str:",
            "lineNumber": 35
          },
          {
            "text": "        return env(\"GOOGLE_CALENDAR_TOKEN_PATH\") or os.path.join(",
            "lineNumber": 36
          },
          {
            "text": "            os.path.expanduser(\"~\"),",
            "lineNumber": 37
          },
          {
            "text": "            \".eigent\",",
            "lineNumber": 38
          },
          {
            "text": "            \"tokens\",",
            "lineNumber": 39
          },
          {
            "text": "            \"google_calendar\",",
            "lineNumber": 40
          },
          {
            "text": "            \"google_calendar_token.json\",",
            "lineNumber": 41
          },
          {
            "text": "        )",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "    @classmethod",
            "lineNumber": 44
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str):",
            "lineNumber": 45
          },
          {
            "text": "        from dotenv import load_dotenv",
            "lineNumber": 46
          }
        ]
      },
      "score": 0.30418074131011963
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\electron\\main\\init.ts",
        "range": {
          "startPosition": {
            "line": 119
          },
          "endPosition": {
            "line": 474,
            "column": 1
          }
        },
        "contents": "export async function startBackend(setPort?: (port: number) =&gt; void): Promise&lt;any&gt; {\nconsole.log('start fastapi')\n    const uv_path = await getBinaryPath('uv')\n    const backendPath = getBackendPath()\n    const userData = app.getPath('userData');\n    const currentVersion = app.getVersion();\n    const venvPath = getVenvPath(currentVersion);\n    console.log('userData', userData)\n    console.log('Using venv path:', venvPath)\n    // Try to find an available port, with aggressive cleanup if needed\n    let port: number;\n    const portFile = path.join(userData, 'port.txt');\n    if (fs.existsSync(portFile)) {\n        port = parseInt(fs.readFileSync(portFile, 'utf-8'));\n        log.info(&#96;Found port from file: ${port}&#96;);\n        await killProcessOnPort(port);\n    }\n    try {\n        port = await findAvailablePort(5001);\n        fs.writeFileSync(portFile, port.toString());\n        log.info(&#96;Found available port: ${port}&#96;);\n    } catch (error) {\n        log.error('Failed to find available port, attempting cleanup...');\n\n        // Last resort: try to kill all processes in the range\n        for (let p = 5001; p &lt;= 5050; p++) {\n            await killProcessOnPort(p);\n        }\n\n        // Try once more\n        port = await findAvailablePort(5001);\n    }\n\n    if (setPort) {\n        setPort(port);\n    }\n\n    const npmCacheDir = path.join(venvPath, '.npm-cache');\n    if (!fs.existsSync(npmCacheDir)) {\n        fs.mkdirSync(npmCacheDir, { recursive: true });\n    }\n\n    const uvEnv = getUvEnv(currentVersion);\n    const env = {\n        ...process.env,\n        ...uvEnv,\n        SERVER_URL: \"https://dev.eigent.ai/api\",\n        PYTHONIOENCODING: 'utf-8',\n        PYTHONUNBUFFERED: '1',\n        npm_config_cache: npmCacheDir,\n    }\n\n    const displayFilteredLogs = (data: String) =&gt;\n\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 120,
                "column": 1
              },
              "endPosition": {
                "line": 120,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 120,
                "column": 8
              },
              "endPosition": {
                "line": 121,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export async function startBackend(setPort?: (port: number) =&gt; void): Promise&lt;any&gt; {",
            "lineNumber": 120,
            "isSignature": true
          },
          {
            "text": "console.log('start fastapi')",
            "lineNumber": 121
          },
          {
            "text": "    const uv_path = await getBinaryPath('uv')",
            "lineNumber": 122
          },
          {
            "text": "    const backendPath = getBackendPath()",
            "lineNumber": 123
          },
          {
            "text": "    const userData = app.getPath('userData');",
            "lineNumber": 124
          },
          {
            "text": "    const currentVersion = app.getVersion();",
            "lineNumber": 125
          },
          {
            "text": "    const venvPath = getVenvPath(currentVersion);",
            "lineNumber": 126
          },
          {
            "text": "    console.log('userData', userData)",
            "lineNumber": 127
          },
          {
            "text": "    console.log('Using venv path:', venvPath)",
            "lineNumber": 128
          },
          {
            "text": "    // Try to find an available port, with aggressive cleanup if needed",
            "lineNumber": 129
          },
          {
            "text": "    let port: number;",
            "lineNumber": 130
          },
          {
            "text": "    const portFile = path.join(userData, 'port.txt');",
            "lineNumber": 131
          },
          {
            "text": "    if (fs.existsSync(portFile)) {",
            "lineNumber": 132
          },
          {
            "text": "        port = parseInt(fs.readFileSync(portFile, 'utf-8'));",
            "lineNumber": 133
          },
          {
            "text": "        log.info(&#96;Found port from file: ${port}&#96;);",
            "lineNumber": 134
          },
          {
            "text": "        await killProcessOnPort(port);",
            "lineNumber": 135
          },
          {
            "text": "    }",
            "lineNumber": 136
          },
          {
            "text": "    try {",
            "lineNumber": 137
          },
          {
            "text": "        port = await findAvailablePort(5001);",
            "lineNumber": 138
          },
          {
            "text": "        fs.writeFileSync(portFile, port.toString());",
            "lineNumber": 139
          },
          {
            "text": "        log.info(&#96;Found available port: ${port}&#96;);",
            "lineNumber": 140
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 141
          },
          {
            "text": "        log.error('Failed to find available port, attempting cleanup...');",
            "lineNumber": 142
          },
          {
            "lineNumber": 143
          },
          {
            "text": "        // Last resort: try to kill all processes in the range",
            "lineNumber": 144
          },
          {
            "text": "        for (let p = 5001; p &lt;= 5050; p++) {",
            "lineNumber": 145
          },
          {
            "text": "            await killProcessOnPort(p);",
            "lineNumber": 146
          },
          {
            "text": "        }",
            "lineNumber": 147
          },
          {
            "lineNumber": 148
          },
          {
            "text": "        // Try once more",
            "lineNumber": 149
          },
          {
            "text": "        port = await findAvailablePort(5001);",
            "lineNumber": 150
          },
          {
            "text": "    }",
            "lineNumber": 151
          },
          {
            "lineNumber": 152
          },
          {
            "text": "    if (setPort) {",
            "lineNumber": 153
          },
          {
            "text": "        setPort(port);",
            "lineNumber": 154
          },
          {
            "text": "    }",
            "lineNumber": 155
          },
          {
            "lineNumber": 156
          },
          {
            "text": "    const npmCacheDir = path.join(venvPath, '.npm-cache');",
            "lineNumber": 157
          },
          {
            "text": "    if (!fs.existsSync(npmCacheDir)) {",
            "lineNumber": 158
          },
          {
            "text": "        fs.mkdirSync(npmCacheDir, { recursive: true });",
            "lineNumber": 159
          },
          {
            "text": "    }",
            "lineNumber": 160
          },
          {
            "lineNumber": 161
          },
          {
            "text": "    const uvEnv = getUvEnv(currentVersion);",
            "lineNumber": 162
          },
          {
            "text": "    const env = {",
            "lineNumber": 163
          },
          {
            "text": "        ...process.env,",
            "lineNumber": 164
          },
          {
            "text": "        ...uvEnv,",
            "lineNumber": 165
          },
          {
            "text": "        SERVER_URL: \"https://dev.eigent.ai/api\",",
            "lineNumber": 166
          },
          {
            "text": "        PYTHONIOENCODING: 'utf-8',",
            "lineNumber": 167
          },
          {
            "text": "        PYTHONUNBUFFERED: '1',",
            "lineNumber": 168
          },
          {
            "text": "        npm_config_cache: npmCacheDir,",
            "lineNumber": 169
          },
          {
            "text": "    }",
            "lineNumber": 170
          },
          {
            "lineNumber": 171
          },
          {
            "text": "    const displayFilteredLogs = (data: String) =&gt;",
            "lineNumber": 172
          },
          {
            "lineNumber": 190
          },
          {
            "text": "}",
            "lineNumber": 475,
            "isSignature": true
          }
        ]
      },
      "score": 0.29587143659591675
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1581,
            "column": 5
          },
          "endPosition": {
            "line": 1710
          }
        },
        "contents": "@traceroot.trace()\nasync def social_medium_agent(options: Chat):\n    \"\"\"\n    Agent to handling tasks related to social media:\n    include toolkits: WhatsApp, Twitter, LinkedIn, Reddit, Notion, Slack, Discord and Google Suite.\n    \"\"\"\n    working_directory = get_working_directory(options)\n    traceroot_logger.info(\n        f\"Creating social medium agent for project: {options.project_id} in directory: {working_directory}\"\n    )\n    tools = [\n        *WhatsAppToolkit.get_can_use_tools(options.project_id),\n        *TwitterToolkit.get_can_use_tools(options.project_id),\n        *LinkedInToolkit.get_can_use_tools(options.project_id),\n        *RedditToolkit.get_can_use_tools(options.project_id),\n        *await NotionMCPToolkit.get_can_use_tools(options.project_id),\n        # *SlackToolkit.get_can_use_tools(options.project_id),\n        *await GoogleGmailMCPToolkit.get_can_use_tools(\n            options.project_id, options.get_bun_env()\n        ),\n        *GoogleCalendarToolkit.get_can_use_tools(options.project_id),\n        *HumanToolkit.get_can_use_tools(options.project_id, Agents.social_medium_agent),\n        *TerminalToolkit(\n            options.project_id,\n            agent_name=Agents.social_medium_agent,\n            clone_current_env=False,\n        ).get_tools(),\n        *NoteTakingToolkit(\n            options.project_id,\n            Agents.social_medium_agent,\n            working_directory=working_directory,\n        ).get_tools(),\n        # *DiscordToolkit(options.project_id).get_tools(),  # Not supported temporarily\n        # *GoogleSuiteToolkit(options.project_id).get_tools(),  # Not supported temporarily\n    ]\n    # if env(\"EXA_API_KEY\") or options.is_cloud():\n    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1585
          },
          {
            "text": "async def social_medium_agent(options: Chat):",
            "lineNumber": 1586,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1587
          },
          {
            "text": "    Agent to handling tasks related to social media:",
            "lineNumber": 1588
          },
          {
            "text": "    include toolkits: WhatsApp, Twitter, LinkedIn, Reddit, Notion, Slack, Discord and Google Suite.",
            "lineNumber": 1589
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1590
          },
          {
            "text": "    working_directory = get_working_directory(options)",
            "lineNumber": 1591
          },
          {
            "text": "    traceroot_logger.info(",
            "lineNumber": 1592
          },
          {
            "text": "        f\"Creating social medium agent for project: {options.project_id} in directory: {working_directory}\"",
            "lineNumber": 1593
          },
          {
            "text": "    )",
            "lineNumber": 1594
          },
          {
            "text": "    tools = [",
            "lineNumber": 1595
          },
          {
            "text": "        *WhatsAppToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1596
          },
          {
            "text": "        *TwitterToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1597
          },
          {
            "text": "        *LinkedInToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1598
          },
          {
            "text": "        *RedditToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1599
          },
          {
            "text": "        *await NotionMCPToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1600
          },
          {
            "text": "        # *SlackToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1601
          },
          {
            "text": "        *await GoogleGmailMCPToolkit.get_can_use_tools(",
            "lineNumber": 1602
          },
          {
            "text": "            options.project_id, options.get_bun_env()",
            "lineNumber": 1603
          },
          {
            "text": "        ),",
            "lineNumber": 1604
          },
          {
            "text": "        *GoogleCalendarToolkit.get_can_use_tools(options.project_id),",
            "lineNumber": 1605
          },
          {
            "text": "        *HumanToolkit.get_can_use_tools(options.project_id, Agents.social_medium_agent),",
            "lineNumber": 1606
          },
          {
            "text": "        *TerminalToolkit(",
            "lineNumber": 1607
          },
          {
            "text": "            options.project_id,",
            "lineNumber": 1608
          },
          {
            "text": "            agent_name=Agents.social_medium_agent,",
            "lineNumber": 1609
          },
          {
            "text": "            clone_current_env=False,",
            "lineNumber": 1610
          },
          {
            "text": "        ).get_tools(),",
            "lineNumber": 1611
          },
          {
            "text": "        *NoteTakingToolkit(",
            "lineNumber": 1612
          },
          {
            "text": "            options.project_id,",
            "lineNumber": 1613
          },
          {
            "text": "            Agents.social_medium_agent,",
            "lineNumber": 1614
          },
          {
            "text": "            working_directory=working_directory,",
            "lineNumber": 1615
          },
          {
            "text": "        ).get_tools(),",
            "lineNumber": 1616
          },
          {
            "text": "        # *DiscordToolkit(options.project_id).get_tools(),  # Not supported temporarily",
            "lineNumber": 1617
          },
          {
            "text": "        # *GoogleSuiteToolkit(options.project_id).get_tools(),  # Not supported temporarily",
            "lineNumber": 1618
          },
          {
            "text": "    ]",
            "lineNumber": 1619
          },
          {
            "text": "    # if env(\"EXA_API_KEY\") or options.is_cloud():",
            "lineNumber": 1620
          },
          {
            "text": "    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))",
            "lineNumber": 1621
          }
        ]
      },
      "score": 0.2949010133743286
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\component\\environment.py",
        "range": {
          "startPosition": {
            "line": 25,
            "column": 43
          },
          "endPosition": {
            "line": 40
          }
        },
        "contents": "def env(key: str, default=None):\n    value = os.getenv(key, default)\n    logger.debug(\"Environment variable accessed\", extra={\"key\": key, \"has_value\": value is not None, \"using_default\": value == default})\n    return value\n\n\ndef env_or_fail(key: str):\n    value = env(key)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def env(key: str, default=None):",
            "lineNumber": 29,
            "isSignature": true
          },
          {
            "text": "    value = os.getenv(key, default)",
            "lineNumber": 30
          },
          {
            "text": "    logger.debug(\"Environment variable accessed\", extra={\"key\": key, \"has_value\": value is not None, \"using_default\": value == default})",
            "lineNumber": 31
          },
          {
            "text": "    return value",
            "lineNumber": 32,
            "isSignature": true
          },
          {
            "lineNumber": 33
          },
          {
            "lineNumber": 34
          },
          {
            "text": "def env_or_fail(key: str):",
            "lineNumber": 35,
            "isSignature": true
          },
          {
            "text": "    value = env(key)",
            "lineNumber": 36
          }
        ]
      },
      "score": 0.287029504776001
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\AddWorker\\index.tsx",
        "range": {
          "startPosition": {
            "line": 48
          },
          "endPosition": {
            "line": 546,
            "column": 1
          }
        },
        "contents": "export function AddWorker({\n\tedit = false,\n\tworkerInfo = null,\n}: {\n\tedit?: boolean;\n\tworkerInfo?: Agent | null;\n}) {\nconst ;\n\n\t// environment variable management\n\tconst initializeEnvValues = (mcp: McpItem) =&gt; {\n\t\tconsole.log(mcp);\n\t\tif (mcp?.install_command?.env) {\n\t\t\tconst initialValues: { [key: string]: EnvValue } = {};\n\t\t\tconst initialVisibility: { [key: string]: boolean } = {};\n\t\t\tfor (const key of Object.keys(mcp.install_command.env)) {\n\t\t\t\tinitialValues[key] = {\n\t\t\t\t\tvalue: \"\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\ttip:\n\t\t\t\t\t\tmcp.install_command?.env?.[key]\n\t\t\t\t\t\t\t?.replace(/{{/g, \"\")\n\t\t\t\t\t\t\t?.replace(/}}/g, \"\") || \"\",\n\t\t\t\t};\n\t\t\t\t// GOOGLE_REFRESH_TOKEN is obtained via OAuth and does not require manual input\n\t\t\t\tif (key === \"GOOGLE_REFRESH_TOKEN\") {\n\t\t\t\t\tinitialValues[key].required = false;\n\t\t\t\t}\n\t\t\t\tinitialVisibility[key] = false;\n\t\t\t}\n\t\t\tsetEnvValues(initialValues);\n\t\t\tsetSecretVisible(initialVisibility);\n\t\t}\n\t};\n\n\tconst updateEnvValue = (key: string, value: string) =&gt; {\n\t\tsetEnvValues((prev) =&gt; ({\n\t\t\t...prev,\n\t\t\t[key]: {\n\t\t\t\tvalue,\n\t\t\t\trequired: prev[key]?.required || true,\n\t\t\t\ttip: prev[key]?.tip || \"\",\n\t\t\t\terror: \"\", // Clear error when user types\n\t\t\t},\n\t\t}));\n\t};\n\n\tconst validateRequiredFields = () =&gt; {\n\t\tlet hasErrors = false;\n\t\tconst updatedEnvValues = { ...envValues };\n\n\t\tObject.keys(envValues).forEach((key) =&gt; {\n\t\t\tconst field = envValues[key];\n\t\t\tif (field?.required &amp;&amp; (!field.value || field.value.trim() === \"\")) {\n\t\t\t\tupdatedEnvValues[key] = {\n\t\t\t\t\t...field,\n\t\t\t\t\terror: &#96;${key} is required&#96;,\n\t\t\t\t};\n\t\t\t\thasErrors = true;\n\t\t\t}\n\t\t});\n\n\t\tif (hasErrors) {\n\t\t\tsetEnvValues(updatedEnvValues);\n\t\t}\n\n\t\treturn !hasErrors;\n\t};\n\n\tconst handleConfigureMcpEnvSetting = async () =&gt;\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 49,
                "column": 1
              },
              "endPosition": {
                "line": 49,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 49,
                "column": 8
              },
              "endPosition": {
                "line": 56,
                "column": 2
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export function AddWorker({",
            "lineNumber": 49,
            "isSignature": true
          },
          {
            "text": "\tedit = false,",
            "lineNumber": 50,
            "isSignature": true
          },
          {
            "text": "\tworkerInfo = null,",
            "lineNumber": 51,
            "isSignature": true
          },
          {
            "text": "}: {",
            "lineNumber": 52,
            "isSignature": true
          },
          {
            "text": "\tedit?: boolean;",
            "lineNumber": 53,
            "isSignature": true
          },
          {
            "text": "\tworkerInfo?: Agent | null;",
            "lineNumber": 54,
            "isSignature": true
          },
          {
            "text": "}) {",
            "lineNumber": 55,
            "isSignature": true
          },
          {
            "text": "const ;",
            "lineNumber": 81
          },
          {
            "lineNumber": 82
          },
          {
            "text": "\t// environment variable management",
            "lineNumber": 83
          },
          {
            "text": "\tconst initializeEnvValues = (mcp: McpItem) =&gt; {",
            "lineNumber": 84
          },
          {
            "text": "\t\tconsole.log(mcp);",
            "lineNumber": 85
          },
          {
            "text": "\t\tif (mcp?.install_command?.env) {",
            "lineNumber": 86
          },
          {
            "text": "\t\t\tconst initialValues: { [key: string]: EnvValue } = {};",
            "lineNumber": 87
          },
          {
            "text": "\t\t\tconst initialVisibility: { [key: string]: boolean } = {};",
            "lineNumber": 88
          },
          {
            "text": "\t\t\tfor (const key of Object.keys(mcp.install_command.env)) {",
            "lineNumber": 89
          },
          {
            "text": "\t\t\t\tinitialValues[key] = {",
            "lineNumber": 90
          },
          {
            "text": "\t\t\t\t\tvalue: \"\",",
            "lineNumber": 91
          },
          {
            "text": "\t\t\t\t\trequired: true,",
            "lineNumber": 92
          },
          {
            "text": "\t\t\t\t\ttip:",
            "lineNumber": 93
          },
          {
            "text": "\t\t\t\t\t\tmcp.install_command?.env?.[key]",
            "lineNumber": 94
          },
          {
            "text": "\t\t\t\t\t\t\t?.replace(/{{/g, \"\")",
            "lineNumber": 95
          },
          {
            "text": "\t\t\t\t\t\t\t?.replace(/}}/g, \"\") || \"\",",
            "lineNumber": 96
          },
          {
            "text": "\t\t\t\t};",
            "lineNumber": 97
          },
          {
            "text": "\t\t\t\t// GOOGLE_REFRESH_TOKEN is obtained via OAuth and does not require manual input",
            "lineNumber": 98
          },
          {
            "text": "\t\t\t\tif (key === \"GOOGLE_REFRESH_TOKEN\") {",
            "lineNumber": 99
          },
          {
            "text": "\t\t\t\t\tinitialValues[key].required = false;",
            "lineNumber": 100
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 101
          },
          {
            "text": "\t\t\t\tinitialVisibility[key] = false;",
            "lineNumber": 102
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 103
          },
          {
            "text": "\t\t\tsetEnvValues(initialValues);",
            "lineNumber": 104
          },
          {
            "text": "\t\t\tsetSecretVisible(initialVisibility);",
            "lineNumber": 105
          },
          {
            "text": "\t\t}",
            "lineNumber": 106
          },
          {
            "text": "\t};",
            "lineNumber": 107
          },
          {
            "lineNumber": 108
          },
          {
            "text": "\tconst updateEnvValue = (key: string, value: string) =&gt; {",
            "lineNumber": 109
          },
          {
            "text": "\t\tsetEnvValues((prev) =&gt; ({",
            "lineNumber": 110
          },
          {
            "text": "\t\t\t...prev,",
            "lineNumber": 111
          },
          {
            "text": "\t\t\t[key]: {",
            "lineNumber": 112
          },
          {
            "text": "\t\t\t\tvalue,",
            "lineNumber": 113
          },
          {
            "text": "\t\t\t\trequired: prev[key]?.required || true,",
            "lineNumber": 114
          },
          {
            "text": "\t\t\t\ttip: prev[key]?.tip || \"\",",
            "lineNumber": 115
          },
          {
            "text": "\t\t\t\terror: \"\", // Clear error when user types",
            "lineNumber": 116
          },
          {
            "text": "\t\t\t},",
            "lineNumber": 117
          },
          {
            "text": "\t\t}));",
            "lineNumber": 118
          },
          {
            "text": "\t};",
            "lineNumber": 119
          },
          {
            "lineNumber": 120
          },
          {
            "text": "\tconst validateRequiredFields = () =&gt; {",
            "lineNumber": 121
          },
          {
            "text": "\t\tlet hasErrors = false;",
            "lineNumber": 122
          },
          {
            "text": "\t\tconst updatedEnvValues = { ...envValues };",
            "lineNumber": 123
          },
          {
            "lineNumber": 124
          },
          {
            "text": "\t\tObject.keys(envValues).forEach((key) =&gt; {",
            "lineNumber": 125
          },
          {
            "text": "\t\t\tconst field = envValues[key];",
            "lineNumber": 126
          },
          {
            "text": "\t\t\tif (field?.required &amp;&amp; (!field.value || field.value.trim() === \"\")) {",
            "lineNumber": 127
          },
          {
            "text": "\t\t\t\tupdatedEnvValues[key] = {",
            "lineNumber": 128
          },
          {
            "text": "\t\t\t\t\t...field,",
            "lineNumber": 129
          },
          {
            "text": "\t\t\t\t\terror: &#96;${key} is required&#96;,",
            "lineNumber": 130
          },
          {
            "text": "\t\t\t\t};",
            "lineNumber": 131
          },
          {
            "text": "\t\t\t\thasErrors = true;",
            "lineNumber": 132
          },
          {
            "text": "\t\t\t}",
            "lineNumber": 133
          },
          {
            "text": "\t\t});",
            "lineNumber": 134
          },
          {
            "lineNumber": 135
          },
          {
            "text": "\t\tif (hasErrors) {",
            "lineNumber": 136
          },
          {
            "text": "\t\t\tsetEnvValues(updatedEnvValues);",
            "lineNumber": 137
          },
          {
            "text": "\t\t}",
            "lineNumber": 138
          },
          {
            "lineNumber": 139
          },
          {
            "text": "\t\treturn !hasErrors;",
            "lineNumber": 140
          },
          {
            "text": "\t};",
            "lineNumber": 141
          },
          {
            "lineNumber": 142
          },
          {
            "text": "\tconst handleConfigureMcpEnvSetting = async () =&gt;",
            "lineNumber": 143
          },
          {
            "text": ";",
            "lineNumber": 194
          },
          {
            "text": "}",
            "lineNumber": 547,
            "isSignature": true
          }
        ]
      },
      "score": 0.28653600811958313
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\reddit_toolkit.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 28,
            "column": 21
          }
        },
        "contents": "from typing import Any, Dict, List\nfrom camel.toolkits import RedditToolkit as BaseRedditToolkit\nfrom camel.toolkits.function_tool import FunctionTool\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\n\n\n@auto_listen_toolkit(BaseRedditToolkit)\nclass RedditToolkit(BaseRedditToolkit, AbstractToolkit):\n    agent_name: str = Agents.social_medium_agent\n\n    def __init__(\n        self,\n        api_task_id: str,\n        retries: int = 3,\n        delay: float = 0,\n        timeout: float | None = None,\n    ):\n        super().__init__(retries, delay, timeout)\n        self.api_task_id = api_task_id\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:\n        if env(\"REDDIT_CLIENT_ID\") and env(\"REDDIT_CLIENT_SECRET\") and env(\"REDDIT_USER_AGENT\"):\n            return RedditToolkit(api_task_id).get_tools()\n        else:\n            return []",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from typing import Any, Dict, List",
            "lineNumber": 1
          },
          {
            "text": "from camel.toolkits import RedditToolkit as BaseRedditToolkit",
            "lineNumber": 2
          },
          {
            "text": "from camel.toolkits.function_tool import FunctionTool",
            "lineNumber": 3
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 4
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 5
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 6
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "@auto_listen_toolkit(BaseRedditToolkit)",
            "lineNumber": 10
          },
          {
            "text": "class RedditToolkit(BaseRedditToolkit, AbstractToolkit):",
            "lineNumber": 11,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.social_medium_agent",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "    def __init__(",
            "lineNumber": 14
          },
          {
            "text": "        self,",
            "lineNumber": 15
          },
          {
            "text": "        api_task_id: str,",
            "lineNumber": 16
          },
          {
            "text": "        retries: int = 3,",
            "lineNumber": 17
          },
          {
            "text": "        delay: float = 0,",
            "lineNumber": 18
          },
          {
            "text": "        timeout: float | None = None,",
            "lineNumber": 19
          },
          {
            "text": "    ):",
            "lineNumber": 20
          },
          {
            "text": "        super().__init__(retries, delay, timeout)",
            "lineNumber": 21
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 22
          },
          {
            "lineNumber": 23
          },
          {
            "text": "    @classmethod",
            "lineNumber": 24
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:",
            "lineNumber": 25
          },
          {
            "text": "        if env(\"REDDIT_CLIENT_ID\") and env(\"REDDIT_CLIENT_SECRET\") and env(\"REDDIT_USER_AGENT\"):",
            "lineNumber": 26
          },
          {
            "text": "            return RedditToolkit(api_task_id).get_tools()",
            "lineNumber": 27
          },
          {
            "text": "        else:",
            "lineNumber": 28
          },
          {
            "text": "            return []",
            "lineNumber": 29,
            "isSignature": true
          }
        ]
      },
      "score": 0.2821219861507416
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\ref\\COMMANDS.md",
        "range": {
          "startPosition": {
            "line": 191
          },
          "endPosition": {
            "line": 261
          }
        },
        "contents": "| &#96;test:&#96; | 測試相關 |\n| &#96;chore:&#96; | 建置/工具相關 |\n\n---\n\n## 環境變數\n\n### 前端 (.env.development)\n\n| 變數名稱 | 說明 | 範例值 |\n|---------|------|--------|\n| &#96;VITE_BASE_URL&#96; | API 基礎路徑 | &#96;/api&#96; |\n| &#96;VITE_PROXY_URL&#96; | 代理目標 URL | &#96;https://dev.eigent.ai&#96; |\n| &#96;VITE_USE_LOCAL_PROXY&#96; | 是否使用本地代理 | &#96;true&#96; / &#96;false&#96; |\n\n### 後端環境變數\n\n#### 嵌入式後端（backend/）\n\n**注意**：嵌入式後端的環境變數由 Electron 自動注入，通常不需要手動設定。\n\n| 變數名稱 | 說明 | 預設值 | 可選覆寫位置 |\n|---------|------|--------|------------|\n| &#96;SERVER_URL&#96; | 雲端服務 URL（用於同步任務步驟） | &#96;https://dev.eigent.ai/api&#96; | &#96;~/.eigent/.env&#96; |\n| &#96;PYTHONIOENCODING&#96; | Python I/O 編碼 | &#96;utf-8&#96; | - |\n| &#96;PYTHONUNBUFFERED&#96; | Python 輸出緩衝 | &#96;1&#96; | - |\n\n#### Local Server（server/.env）\n\n| 變數名稱 | 說明 | 範例值 |\n|---------|------|--------|\n| &#96;database_url&#96; | PostgreSQL 連線字串 | &#96;postgresql://user:pass@host:5432/db&#96; |\n| &#96;url_prefix&#96; | API 路由前綴 | &#96;/api&#96; |\n\n**設定方式**：\n1. **.env 文件**（推薦）：在 &#96;server/&#96; 目錄下建立 &#96;.env&#96; 文件\n2. **環境變數**：在啟動前設定環境變數（見上方「方式 B」）\n\n---\n\n## 除錯技巧\n\n### 開啟 Electron DevTools\n\n開發模式下自動開啟，或使用快捷鍵：\n- Windows/Linux: &#96;Ctrl + Shift + I&#96;\n- macOS: &#96;Cmd + Option + I&#96;\n\n### 檢查後端健康狀態\n\n&#96;&#96;&#96;bash\n# 檢查嵌入式後端（backend/）\n# 注意：埠號可能動態分配，可透過 Electron IPC 取得\ncurl http://localhost:5001/health\n\n# 檢查 Local Server（server/）\ncurl http://localhost:3001/health\n&#96;&#96;&#96;\n\n### 查看 Swagger API 文件\n\n開啟瀏覽器訪問：\n\n- **嵌入式後端**（&#96;backend/&#96;）：\n  - URL：&#96;http://localhost:&lt;port&gt;/docs&#96;\n  - 注意：埠號由 Electron 動態分配（預設從 5001 起），可透過 Electron IPC 取得實際埠號\n  - 主要端點：&#96;/chat&#96;（SSE 任務執行）、&#96;/health&#96;\n\n- **Local Server**（&#96;server/&#96;）：\n  - URL：&#96;http://localhost:3001/docs&#96;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "| &#96;test:&#96; | 測試相關 |",
            "lineNumber": 192
          },
          {
            "text": "| &#96;chore:&#96; | 建置/工具相關 |",
            "lineNumber": 193
          },
          {
            "lineNumber": 194
          },
          {
            "text": "---",
            "lineNumber": 195
          },
          {
            "lineNumber": 196
          },
          {
            "text": "## 環境變數",
            "lineNumber": 197
          },
          {
            "lineNumber": 198
          },
          {
            "text": "### 前端 (.env.development)",
            "lineNumber": 199
          },
          {
            "lineNumber": 200
          },
          {
            "text": "| 變數名稱 | 說明 | 範例值 |",
            "lineNumber": 201
          },
          {
            "text": "|---------|------|--------|",
            "lineNumber": 202
          },
          {
            "text": "| &#96;VITE_BASE_URL&#96; | API 基礎路徑 | &#96;/api&#96; |",
            "lineNumber": 203
          },
          {
            "text": "| &#96;VITE_PROXY_URL&#96; | 代理目標 URL | &#96;https://dev.eigent.ai&#96; |",
            "lineNumber": 204
          },
          {
            "text": "| &#96;VITE_USE_LOCAL_PROXY&#96; | 是否使用本地代理 | &#96;true&#96; / &#96;false&#96; |",
            "lineNumber": 205
          },
          {
            "lineNumber": 206
          },
          {
            "text": "### 後端環境變數",
            "lineNumber": 207
          },
          {
            "lineNumber": 208
          },
          {
            "text": "#### 嵌入式後端（backend/）",
            "lineNumber": 209
          },
          {
            "lineNumber": 210
          },
          {
            "text": "**注意**：嵌入式後端的環境變數由 Electron 自動注入，通常不需要手動設定。",
            "lineNumber": 211
          },
          {
            "lineNumber": 212
          },
          {
            "text": "| 變數名稱 | 說明 | 預設值 | 可選覆寫位置 |",
            "lineNumber": 213
          },
          {
            "text": "|---------|------|--------|------------|",
            "lineNumber": 214
          },
          {
            "text": "| &#96;SERVER_URL&#96; | 雲端服務 URL（用於同步任務步驟） | &#96;https://dev.eigent.ai/api&#96; | &#96;~/.eigent/.env&#96; |",
            "lineNumber": 215
          },
          {
            "text": "| &#96;PYTHONIOENCODING&#96; | Python I/O 編碼 | &#96;utf-8&#96; | - |",
            "lineNumber": 216
          },
          {
            "text": "| &#96;PYTHONUNBUFFERED&#96; | Python 輸出緩衝 | &#96;1&#96; | - |",
            "lineNumber": 217
          },
          {
            "lineNumber": 218
          },
          {
            "text": "#### Local Server（server/.env）",
            "lineNumber": 219
          },
          {
            "lineNumber": 220
          },
          {
            "text": "| 變數名稱 | 說明 | 範例值 |",
            "lineNumber": 221
          },
          {
            "text": "|---------|------|--------|",
            "lineNumber": 222
          },
          {
            "text": "| &#96;database_url&#96; | PostgreSQL 連線字串 | &#96;postgresql://user:pass@host:5432/db&#96; |",
            "lineNumber": 223
          },
          {
            "text": "| &#96;url_prefix&#96; | API 路由前綴 | &#96;/api&#96; |",
            "lineNumber": 224
          },
          {
            "lineNumber": 225
          },
          {
            "text": "**設定方式**：",
            "lineNumber": 226
          },
          {
            "text": "1. **.env 文件**（推薦）：在 &#96;server/&#96; 目錄下建立 &#96;.env&#96; 文件",
            "lineNumber": 227
          },
          {
            "text": "2. **環境變數**：在啟動前設定環境變數（見上方「方式 B」）",
            "lineNumber": 228
          },
          {
            "lineNumber": 229
          },
          {
            "text": "---",
            "lineNumber": 230
          },
          {
            "lineNumber": 231
          },
          {
            "text": "## 除錯技巧",
            "lineNumber": 232
          },
          {
            "lineNumber": 233
          },
          {
            "text": "### 開啟 Electron DevTools",
            "lineNumber": 234
          },
          {
            "lineNumber": 235
          },
          {
            "text": "開發模式下自動開啟，或使用快捷鍵：",
            "lineNumber": 236
          },
          {
            "text": "- Windows/Linux: &#96;Ctrl + Shift + I&#96;",
            "lineNumber": 237
          },
          {
            "text": "- macOS: &#96;Cmd + Option + I&#96;",
            "lineNumber": 238
          },
          {
            "lineNumber": 239
          },
          {
            "text": "### 檢查後端健康狀態",
            "lineNumber": 240
          },
          {
            "lineNumber": 241
          },
          {
            "text": "&#96;&#96;&#96;bash",
            "lineNumber": 242
          },
          {
            "text": "# 檢查嵌入式後端（backend/）",
            "lineNumber": 243
          },
          {
            "text": "# 注意：埠號可能動態分配，可透過 Electron IPC 取得",
            "lineNumber": 244
          },
          {
            "text": "curl http://localhost:5001/health",
            "lineNumber": 245
          },
          {
            "lineNumber": 246
          },
          {
            "text": "# 檢查 Local Server（server/）",
            "lineNumber": 247
          },
          {
            "text": "curl http://localhost:3001/health",
            "lineNumber": 248
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 249
          },
          {
            "lineNumber": 250
          },
          {
            "text": "### 查看 Swagger API 文件",
            "lineNumber": 251
          },
          {
            "lineNumber": 252
          },
          {
            "text": "開啟瀏覽器訪問：",
            "lineNumber": 253
          },
          {
            "lineNumber": 254
          },
          {
            "text": "- **嵌入式後端**（&#96;backend/&#96;）：",
            "lineNumber": 255
          },
          {
            "text": "  - URL：&#96;http://localhost:&lt;port&gt;/docs&#96;",
            "lineNumber": 256
          },
          {
            "text": "  - 注意：埠號由 Electron 動態分配（預設從 5001 起），可透過 Electron IPC 取得實際埠號",
            "lineNumber": 257
          },
          {
            "text": "  - 主要端點：&#96;/chat&#96;（SSE 任務執行）、&#96;/health&#96;",
            "lineNumber": 258
          },
          {
            "lineNumber": 259
          },
          {
            "text": "- **Local Server**（&#96;server/&#96;）：",
            "lineNumber": 260
          },
          {
            "text": "  - URL：&#96;http://localhost:3001/docs&#96;",
            "lineNumber": 261
          }
        ]
      },
      "score": 0.27970433235168457
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\component\\environment.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 21,
            "column": 43
          }
        },
        "contents": "import importlib.util\nimport os\nfrom pathlib import Path\nfrom fastapi import APIRouter, FastAPI\nfrom dotenv import load_dotenv\nimport importlib\nfrom typing import Any, overload\nfrom utils import traceroot_wrapper as traceroot\n\nlogger = traceroot.get_logger(\"environment\")\n\nlogger.info(\"Loading environment variables from .env file\")\nload_dotenv()\nlogger.info(\"Environment variables loaded successfully\")\n\n\n@overload\ndef env(key: str) -&gt; str | None: ...\n\n\n@overload\ndef env(key: str, default: str) -&gt; str: ...",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import importlib.util",
            "lineNumber": 1
          },
          {
            "text": "import os",
            "lineNumber": 2
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 3
          },
          {
            "text": "from fastapi import APIRouter, FastAPI",
            "lineNumber": 4
          },
          {
            "text": "from dotenv import load_dotenv",
            "lineNumber": 5
          },
          {
            "text": "import importlib",
            "lineNumber": 6
          },
          {
            "text": "from typing import Any, overload",
            "lineNumber": 7
          },
          {
            "text": "from utils import traceroot_wrapper as traceroot",
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "logger = traceroot.get_logger(\"environment\")",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "logger.info(\"Loading environment variables from .env file\")",
            "lineNumber": 12
          },
          {
            "text": "load_dotenv()",
            "lineNumber": 13
          },
          {
            "text": "logger.info(\"Environment variables loaded successfully\")",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "@overload",
            "lineNumber": 17
          },
          {
            "text": "def env(key: str) -&gt; str | None: ...",
            "lineNumber": 18,
            "isSignature": true
          },
          {
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "@overload",
            "lineNumber": 21
          },
          {
            "text": "def env(key: str, default: str) -&gt; str: ...",
            "lineNumber": 22,
            "isSignature": true
          }
        ]
      },
      "score": 0.27898216247558594
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\search_toolkit.py",
        "range": {
          "startPosition": {
            "line": 14
          },
          "endPosition": {
            "line": 371
          }
        },
        "contents": "@auto_listen_toolkit(BaseSearchToolkit)\nclass SearchToolkit(BaseSearchToolkit, AbstractToolkit):\ndef __init__(\n        self,\n        api_task_id: str,\n        agent_name: str | None = None,\n        timeout: float | None = None,\n        exclude_domains: List[str] | None = None,\n    ):\n\n        self._config_loaded = False\n\n    def _load_user_search_config(self):\n        \"\"\"\n        Load user-specific Google Search configuration from user's .env file.\n        This is called lazily when search_google is invoked.\n        \"\"\"\n        if self._config_loaded:\n            return\n\n        self._config_loaded = True\n\n        # Try to get user-specific configuration from thread-local environment\n        # which is set by the middleware based on the user's project settings\n        google_api_key = env(\"GOOGLE_API_KEY\")\n        search_engine_id = env(\"SEARCH_ENGINE_ID\")\n\n        if google_api_key and search_engine_id:\n            self._user_google_api_key = google_api_key\n            self._user_search_engine_id = search_engine_id\n            logger.info(\"Loaded user-specific Google Search configuration\")\n        else:\n            logger.debug(\"No user-specific Google Search configuration found, will use cloud search\")\n\n    # @listen_toolkit(BaseSearchToolkit.search_wiki)\n    # def search_wiki(self, entity: str) -&gt; str:\n    #     return super().search_wiki(entity)\n\n    # @listen_toolkit(\n    #     BaseSearchToolkit.search_linkup,\n    #     lambda _,\n    #     query,\n    #     depth=\"standard\",\n    #     output_type=\"searchResults\",\n    #     structured_output_schema=None: f\"Search linkup with query '{query}', depth '{depth}', output type '{output_type}', structured output schema '{structured_output_schema}'\",",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 15,
                "column": 1
              },
              "endPosition": {
                "line": 16,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 16,
                "column": 1
              },
              "endPosition": {
                "line": 17,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@auto_listen_toolkit(BaseSearchToolkit)",
            "lineNumber": 15
          },
          {
            "text": "class SearchToolkit(BaseSearchToolkit, AbstractToolkit):",
            "lineNumber": 16,
            "isSignature": true
          },
          {
            "text": "def __init__(",
            "lineNumber": 19
          },
          {
            "text": "        self,",
            "lineNumber": 20
          },
          {
            "text": "        api_task_id: str,",
            "lineNumber": 21
          },
          {
            "text": "        agent_name: str | None = None,",
            "lineNumber": 22
          },
          {
            "text": "        timeout: float | None = None,",
            "lineNumber": 23
          },
          {
            "text": "        exclude_domains: List[str] | None = None,",
            "lineNumber": 24
          },
          {
            "text": "    ):",
            "lineNumber": 25
          },
          {
            "lineNumber": 34
          },
          {
            "text": "        self._config_loaded = False",
            "lineNumber": 35
          },
          {
            "lineNumber": 36
          },
          {
            "text": "    def _load_user_search_config(self):",
            "lineNumber": 37
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 38
          },
          {
            "text": "        Load user-specific Google Search configuration from user's .env file.",
            "lineNumber": 39
          },
          {
            "text": "        This is called lazily when search_google is invoked.",
            "lineNumber": 40
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 41
          },
          {
            "text": "        if self._config_loaded:",
            "lineNumber": 42
          },
          {
            "text": "            return",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "        self._config_loaded = True",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "        # Try to get user-specific configuration from thread-local environment",
            "lineNumber": 47
          },
          {
            "text": "        # which is set by the middleware based on the user's project settings",
            "lineNumber": 48
          },
          {
            "text": "        google_api_key = env(\"GOOGLE_API_KEY\")",
            "lineNumber": 49
          },
          {
            "text": "        search_engine_id = env(\"SEARCH_ENGINE_ID\")",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "        if google_api_key and search_engine_id:",
            "lineNumber": 52
          },
          {
            "text": "            self._user_google_api_key = google_api_key",
            "lineNumber": 53
          },
          {
            "text": "            self._user_search_engine_id = search_engine_id",
            "lineNumber": 54
          },
          {
            "text": "            logger.info(\"Loaded user-specific Google Search configuration\")",
            "lineNumber": 55
          },
          {
            "text": "        else:",
            "lineNumber": 56
          },
          {
            "text": "            logger.debug(\"No user-specific Google Search configuration found, will use cloud search\")",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "    # @listen_toolkit(BaseSearchToolkit.search_wiki)",
            "lineNumber": 59
          },
          {
            "text": "    # def search_wiki(self, entity: str) -&gt; str:",
            "lineNumber": 60
          },
          {
            "text": "    #     return super().search_wiki(entity)",
            "lineNumber": 61
          },
          {
            "lineNumber": 62
          },
          {
            "text": "    # @listen_toolkit(",
            "lineNumber": 63
          },
          {
            "text": "    #     BaseSearchToolkit.search_linkup,",
            "lineNumber": 64
          },
          {
            "text": "    #     lambda _,",
            "lineNumber": 65
          },
          {
            "text": "    #     query,",
            "lineNumber": 66
          },
          {
            "text": "    #     depth=\"standard\",",
            "lineNumber": 67
          },
          {
            "text": "    #     output_type=\"searchResults\",",
            "lineNumber": 68
          },
          {
            "text": "    #     structured_output_schema=None: f\"Search linkup with query '{query}', depth '{depth}', output type '{output_type}', structured output schema '{structured_output_schema}'\",",
            "lineNumber": 69
          }
        ]
      },
      "score": 0.27661216259002686
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\pages\\Setting\\components\\MCPEnvDialog.tsx",
        "range": {
          "startPosition": {
            "line": 75,
            "column": 1
          },
          "endPosition": {
            "line": 356,
            "column": 1
          }
        },
        "contents": "export const MCPEnvDialog: FC&lt;MCPEnvDialogProps&gt; = ({\n\tshowEnvConfig,\n\tonClose,\n\tonConnect,\n\tactiveMcp,\n}) =&gt; {\n\tconst [envValues, setEnvValues] = useState&lt;{ [key: string]: EnvValue }&gt;({});\n\tconst [showKeys, setShowKeys] = useState&lt;{ [key: string]: boolean }&gt;({});\n\tconst [isValidating, setIsValidating] = useState&lt;boolean&gt;(false);\n\tconst { t } = useTranslation();\n\tuseEffect(() =&gt; {\n\t\tinitializeEnvValues(activeMcp);\n\t}, [activeMcp]);\n\n\tconst initializeEnvValues = (mcp: any) =&gt; {\n\t\tif (mcp?.install_command?.env) {\n\t\t\tconst initialValues: { [key: string]: EnvValue } = {};\n\t\t\tObject.keys(mcp.install_command.env).forEach((key) =&gt; {\n\n\t\t\t\tinitialValues[key] = {\n\t\t\t\t\tvalue: \"\",\n\t\t\t\t\trequired: true,\n\t\t\t\t\ttip:\n\t\t\t\t\t\tmcp.install_command?.env?.[key]\n\t\t\t\t\t\t\t?.replace(/{{/g, \"\")\n\t\t\t\t\t\t\t?.replace(/}}/g, \"\") || \"\",\n\t\t\t\t};\n\t\t\t\tif (key === 'EXA_API_KEY') {\n\t\t\t\t\tinitialValues[key].required = false;\n\t\t\t\t}\n\t\t\t\tif (key === 'GOOGLE_REFRESH_TOKEN') {\n\t\t\t\t\tinitialValues[key].required = false;\n\t\t\t\t}\n\t\t\t});\n\t\t\tsetEnvValues(initialValues);\n\t\t}\n\t};\n\n\tconst getCategoryIcon = (categoryName?: string) =&gt; {\n\t\tif (!categoryName) return &lt;Bot className=\"w-10 h-10 text-icon-primary\" /&gt;;\n\t\treturn &lt;Bot className=\"w-10 h-10 text-icon-primary\" /&gt;;\n\t};\n\n\tconst getGithubRepoName = (homePage?: string) =&gt; {\n\t\tif (!homePage || !homePage.startsWith(\"https://github.com/\")) return null;\n\t\tconst parts = homePage.split(\"/\");\n\t\treturn parts.length &gt; 4 ? parts[4] : homePage;\n\t};\n\tconst updateEnvValue = (key: string, value: string) =&gt; {\n\t\tsetEnvValues((prev) =&gt; ({\n\t\t\t...prev,\n\t\t\t[key]: {\n\t\t\t\tvalue,\n\t\t\t\trequired: prev[key]?.required || true,\n\t\t\t\ttip: prev[key]?.tip || \"\",\n\t\t\t},\n\t\t}));\n\t};\n\tconst handleCloseMcpEnvSetting = () =&gt; {\n\t\tsetEnvValues({});\n\t\tsetShowKeys({});\n\t\tonClose();\n\t};\n\n\tconst setFieldError = (key: string, error: string) =&gt; {\n\t\tsetEnvValues((prev) =&gt; ({\n\t\t\t...prev,\n\t\t\t[key]: {\n\t\t\t\t...prev[key],\n\t\t\t\terror,\n\t\t\t},\n\t\t}));\n\t};\n\n\tconst clearFieldErrors = () =&gt; {\n\t\tsetEnvValues\n\n;\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const MCPEnvDialog: FC&lt;MCPEnvDialogProps&gt; = ({",
            "lineNumber": 79
          },
          {
            "text": "\tshowEnvConfig,",
            "lineNumber": 80
          },
          {
            "text": "\tonClose,",
            "lineNumber": 81
          },
          {
            "text": "\tonConnect,",
            "lineNumber": 82
          },
          {
            "text": "\tactiveMcp,",
            "lineNumber": 83
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 84
          },
          {
            "text": "\tconst [envValues, setEnvValues] = useState&lt;{ [key: string]: EnvValue }&gt;({});",
            "lineNumber": 85
          },
          {
            "text": "\tconst [showKeys, setShowKeys] = useState&lt;{ [key: string]: boolean }&gt;({});",
            "lineNumber": 86
          },
          {
            "text": "\tconst [isValidating, setIsValidating] = useState&lt;boolean&gt;(false);",
            "lineNumber": 87
          },
          {
            "text": "\tconst { t } = useTranslation();",
            "lineNumber": 88
          },
          {
            "text": "\tuseEffect(() =&gt; {",
            "lineNumber": 89
          },
          {
            "text": "\t\tinitializeEnvValues(activeMcp);",
            "lineNumber": 90
          },
          {
            "text": "\t}, [activeMcp]);",
            "lineNumber": 91
          },
          {
            "lineNumber": 92
          },
          {
            "text": "\tconst initializeEnvValues = (mcp: any) =&gt; {",
            "lineNumber": 93
          },
          {
            "text": "\t\tif (mcp?.install_command?.env) {",
            "lineNumber": 94
          },
          {
            "text": "\t\t\tconst initialValues: { [key: string]: EnvValue } = {};",
            "lineNumber": 95
          },
          {
            "text": "\t\t\tObject.keys(mcp.install_command.env).forEach((key) =&gt; {",
            "lineNumber": 96
          },
          {
            "lineNumber": 97
          },
          {
            "text": "\t\t\t\tinitialValues[key] = {",
            "lineNumber": 98
          },
          {
            "text": "\t\t\t\t\tvalue: \"\",",
            "lineNumber": 99
          },
          {
            "text": "\t\t\t\t\trequired: true,",
            "lineNumber": 100
          },
          {
            "text": "\t\t\t\t\ttip:",
            "lineNumber": 101
          },
          {
            "text": "\t\t\t\t\t\tmcp.install_command?.env?.[key]",
            "lineNumber": 102
          },
          {
            "text": "\t\t\t\t\t\t\t?.replace(/{{/g, \"\")",
            "lineNumber": 103
          },
          {
            "text": "\t\t\t\t\t\t\t?.replace(/}}/g, \"\") || \"\",",
            "lineNumber": 104
          },
          {
            "text": "\t\t\t\t};",
            "lineNumber": 105
          },
          {
            "text": "\t\t\t\tif (key === 'EXA_API_KEY') {",
            "lineNumber": 106
          },
          {
            "text": "\t\t\t\t\tinitialValues[key].required = false;",
            "lineNumber": 107
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 108
          },
          {
            "text": "\t\t\t\tif (key === 'GOOGLE_REFRESH_TOKEN') {",
            "lineNumber": 109
          },
          {
            "text": "\t\t\t\t\tinitialValues[key].required = false;",
            "lineNumber": 110
          },
          {
            "text": "\t\t\t\t}",
            "lineNumber": 111
          },
          {
            "text": "\t\t\t});",
            "lineNumber": 112
          },
          {
            "text": "\t\t\tsetEnvValues(initialValues);",
            "lineNumber": 113
          },
          {
            "text": "\t\t}",
            "lineNumber": 114
          },
          {
            "text": "\t};",
            "lineNumber": 115
          },
          {
            "lineNumber": 116
          },
          {
            "text": "\tconst getCategoryIcon = (categoryName?: string) =&gt; {",
            "lineNumber": 117
          },
          {
            "text": "\t\tif (!categoryName) return &lt;Bot className=\"w-10 h-10 text-icon-primary\" /&gt;;",
            "lineNumber": 118
          },
          {
            "text": "\t\treturn &lt;Bot className=\"w-10 h-10 text-icon-primary\" /&gt;;",
            "lineNumber": 119
          },
          {
            "text": "\t};",
            "lineNumber": 120
          },
          {
            "lineNumber": 121
          },
          {
            "text": "\tconst getGithubRepoName = (homePage?: string) =&gt; {",
            "lineNumber": 122
          },
          {
            "text": "\t\tif (!homePage || !homePage.startsWith(\"https://github.com/\")) return null;",
            "lineNumber": 123
          },
          {
            "text": "\t\tconst parts = homePage.split(\"/\");",
            "lineNumber": 124
          },
          {
            "text": "\t\treturn parts.length &gt; 4 ? parts[4] : homePage;",
            "lineNumber": 125
          },
          {
            "text": "\t};",
            "lineNumber": 126
          },
          {
            "text": "\tconst updateEnvValue = (key: string, value: string) =&gt; {",
            "lineNumber": 127
          },
          {
            "text": "\t\tsetEnvValues((prev) =&gt; ({",
            "lineNumber": 128
          },
          {
            "text": "\t\t\t...prev,",
            "lineNumber": 129
          },
          {
            "text": "\t\t\t[key]: {",
            "lineNumber": 130
          },
          {
            "text": "\t\t\t\tvalue,",
            "lineNumber": 131
          },
          {
            "text": "\t\t\t\trequired: prev[key]?.required || true,",
            "lineNumber": 132
          },
          {
            "text": "\t\t\t\ttip: prev[key]?.tip || \"\",",
            "lineNumber": 133
          },
          {
            "text": "\t\t\t},",
            "lineNumber": 134
          },
          {
            "text": "\t\t}));",
            "lineNumber": 135
          },
          {
            "text": "\t};",
            "lineNumber": 136
          },
          {
            "text": "\tconst handleCloseMcpEnvSetting = () =&gt; {",
            "lineNumber": 137
          },
          {
            "text": "\t\tsetEnvValues({});",
            "lineNumber": 138
          },
          {
            "text": "\t\tsetShowKeys({});",
            "lineNumber": 139
          },
          {
            "text": "\t\tonClose();",
            "lineNumber": 140
          },
          {
            "text": "\t};",
            "lineNumber": 141
          },
          {
            "lineNumber": 142
          },
          {
            "text": "\tconst setFieldError = (key: string, error: string) =&gt; {",
            "lineNumber": 143
          },
          {
            "text": "\t\tsetEnvValues((prev) =&gt; ({",
            "lineNumber": 144
          },
          {
            "text": "\t\t\t...prev,",
            "lineNumber": 145
          },
          {
            "text": "\t\t\t[key]: {",
            "lineNumber": 146
          },
          {
            "text": "\t\t\t\t...prev[key],",
            "lineNumber": 147
          },
          {
            "text": "\t\t\t\terror,",
            "lineNumber": 148
          },
          {
            "text": "\t\t\t},",
            "lineNumber": 149
          },
          {
            "text": "\t\t}));",
            "lineNumber": 150
          },
          {
            "text": "\t};",
            "lineNumber": 151
          },
          {
            "lineNumber": 152
          },
          {
            "text": "\tconst clearFieldErrors = () =&gt; {",
            "lineNumber": 153
          },
          {
            "text": "\t\tsetEnvValues",
            "lineNumber": 154
          },
          {
            "lineNumber": 160
          },
          {
            "text": ";",
            "lineNumber": 161
          },
          {
            "text": ";",
            "lineNumber": 357
          }
        ]
      },
      "score": 0.27448388934135437
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\whatsapp_toolkit.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 22,
            "column": 21
          }
        },
        "contents": "from typing import Any, Dict, List\nfrom camel.toolkits import WhatsAppToolkit as BaseWhatsAppToolkit\nfrom camel.toolkits.function_tool import FunctionTool\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\n\n\n@auto_listen_toolkit(BaseWhatsAppToolkit)\nclass WhatsAppToolkit(BaseWhatsAppToolkit, AbstractToolkit):\n    agent_name: str = Agents.social_medium_agent\n\n    def __init__(self, api_task_id: str, timeout: float | None = None):\n        super().__init__(timeout)\n        self.api_task_id = api_task_id\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:\n        if env(\"WHATSAPP_ACCESS_TOKEN\") and env(\"WHATSAPP_PHONE_NUMBER_ID\"):\n            return WhatsAppToolkit(api_task_id).get_tools()\n        else:\n            return []",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from typing import Any, Dict, List",
            "lineNumber": 1
          },
          {
            "text": "from camel.toolkits import WhatsAppToolkit as BaseWhatsAppToolkit",
            "lineNumber": 2
          },
          {
            "text": "from camel.toolkits.function_tool import FunctionTool",
            "lineNumber": 3
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 4
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 5
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 6
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "@auto_listen_toolkit(BaseWhatsAppToolkit)",
            "lineNumber": 10
          },
          {
            "text": "class WhatsAppToolkit(BaseWhatsAppToolkit, AbstractToolkit):",
            "lineNumber": 11,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.social_medium_agent",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "    def __init__(self, api_task_id: str, timeout: float | None = None):",
            "lineNumber": 14
          },
          {
            "text": "        super().__init__(timeout)",
            "lineNumber": 15
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 16
          },
          {
            "lineNumber": 17
          },
          {
            "text": "    @classmethod",
            "lineNumber": 18
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str) -&gt; list[FunctionTool]:",
            "lineNumber": 19
          },
          {
            "text": "        if env(\"WHATSAPP_ACCESS_TOKEN\") and env(\"WHATSAPP_PHONE_NUMBER_ID\"):",
            "lineNumber": 20
          },
          {
            "text": "            return WhatsAppToolkit(api_task_id).get_tools()",
            "lineNumber": 21
          },
          {
            "text": "        else:",
            "lineNumber": 22
          },
          {
            "text": "            return []",
            "lineNumber": 23,
            "isSignature": true
          }
        ]
      },
      "score": 0.27272385358810425
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\google_calendar_toolkit.py",
        "range": {
          "startPosition": {
            "line": 17
          },
          "endPosition": {
            "line": 286
          }
        },
        "contents": "@auto_listen_toolkit(BaseGoogleCalendarToolkit)\nclass GoogleCalendarToolkit(BaseGoogleCalendarToolkit, AbstractToolkit):\n@classmethod\ndef _build_canonical_token_path(cls) -&gt; str:\n\n        )\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str):\n        from dotenv import load_dotenv\n        \n        # Force reload environment variables\n        default_env_path = os.path.join(os.path.expanduser(\"~\"), \".eigent\", \".env\")\n        if os.path.exists(default_env_path):\n            load_dotenv(dotenv_path=default_env_path, override=True)\n        \n        if os.environ.get(\"GOOGLE_CLIENT_ID\") and os.environ.get(\"GOOGLE_CLIENT_SECRET\"):\n            return cls(api_task_id).get_tools()\n        else:\n            return []\n\n    def _get_calendar_service(self):\n        from googleapiclient.discovery import build\n        from google.auth.transport.requests import Request\n\n        creds = self._authenticate()\n\n        if creds and creds.expired and creds.refresh_token:\n            creds.refresh(Request())\n            try:\n                os.makedirs(os.path.dirname(self._token_path), exist_ok=True)\n                with open(self._token_path, \"w\") as f:\n                    f.write(creds.to_json())\n            except Exception:\n                pass\n\n        return build(\"calendar\", \"v3\", credentials=creds)\n\n    def _authenticate(self):\n        from google.oauth2.credentials import Credentials",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 18,
                "column": 1
              },
              "endPosition": {
                "line": 19,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 19,
                "column": 1
              },
              "endPosition": {
                "line": 20,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@auto_listen_toolkit(BaseGoogleCalendarToolkit)",
            "lineNumber": 18
          },
          {
            "text": "class GoogleCalendarToolkit(BaseGoogleCalendarToolkit, AbstractToolkit):",
            "lineNumber": 19,
            "isSignature": true
          },
          {
            "text": "@classmethod",
            "lineNumber": 34
          },
          {
            "text": "def _build_canonical_token_path(cls) -&gt; str:",
            "lineNumber": 35
          },
          {
            "lineNumber": 41
          },
          {
            "text": "        )",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "    @classmethod",
            "lineNumber": 44
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str):",
            "lineNumber": 45
          },
          {
            "text": "        from dotenv import load_dotenv",
            "lineNumber": 46
          },
          {
            "text": "        ",
            "lineNumber": 47
          },
          {
            "text": "        # Force reload environment variables",
            "lineNumber": 48
          },
          {
            "text": "        default_env_path = os.path.join(os.path.expanduser(\"~\"), \".eigent\", \".env\")",
            "lineNumber": 49
          },
          {
            "text": "        if os.path.exists(default_env_path):",
            "lineNumber": 50
          },
          {
            "text": "            load_dotenv(dotenv_path=default_env_path, override=True)",
            "lineNumber": 51
          },
          {
            "text": "        ",
            "lineNumber": 52
          },
          {
            "text": "        if os.environ.get(\"GOOGLE_CLIENT_ID\") and os.environ.get(\"GOOGLE_CLIENT_SECRET\"):",
            "lineNumber": 53
          },
          {
            "text": "            return cls(api_task_id).get_tools()",
            "lineNumber": 54
          },
          {
            "text": "        else:",
            "lineNumber": 55
          },
          {
            "text": "            return []",
            "lineNumber": 56
          },
          {
            "lineNumber": 57
          },
          {
            "text": "    def _get_calendar_service(self):",
            "lineNumber": 58
          },
          {
            "text": "        from googleapiclient.discovery import build",
            "lineNumber": 59
          },
          {
            "text": "        from google.auth.transport.requests import Request",
            "lineNumber": 60
          },
          {
            "lineNumber": 61
          },
          {
            "text": "        creds = self._authenticate()",
            "lineNumber": 62
          },
          {
            "lineNumber": 63
          },
          {
            "text": "        if creds and creds.expired and creds.refresh_token:",
            "lineNumber": 64
          },
          {
            "text": "            creds.refresh(Request())",
            "lineNumber": 65
          },
          {
            "text": "            try:",
            "lineNumber": 66
          },
          {
            "text": "                os.makedirs(os.path.dirname(self._token_path), exist_ok=True)",
            "lineNumber": 67
          },
          {
            "text": "                with open(self._token_path, \"w\") as f:",
            "lineNumber": 68
          },
          {
            "text": "                    f.write(creds.to_json())",
            "lineNumber": 69
          },
          {
            "text": "            except Exception:",
            "lineNumber": 70
          },
          {
            "text": "                pass",
            "lineNumber": 71
          },
          {
            "lineNumber": 72
          },
          {
            "text": "        return build(\"calendar\", \"v3\", credentials=creds)",
            "lineNumber": 73
          },
          {
            "lineNumber": 74
          },
          {
            "text": "    def _authenticate(self):",
            "lineNumber": 75
          },
          {
            "text": "        from google.oauth2.credentials import Credentials",
            "lineNumber": 76
          }
        ]
      },
      "score": 0.2719878554344177
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\agent.py",
        "range": {
          "startPosition": {
            "line": 1584
          },
          "endPosition": {
            "line": 1710
          }
        },
        "contents": "@traceroot.trace()\nasync def social_medium_agent(options: Chat):\n\n    ]\n    # if env(\"EXA_API_KEY\") or options.is_cloud():\n    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))\n    return agent_model(\n        Agents.social_medium_agent,\n        BaseMessage.make_assistant_message(\n            role_name=\"Social Medium Agent\",\n            content=f\"\"\"\nYou are a Social Media Management Assistant with comprehensive capabilities\nacross multiple platforms. You MUST use the &#96;send_message_to_user&#96; tool to\ninform the user of every decision and action you take. Your message must\ninclude a short title and a one-sentence description. This is a mandatory\npart of your workflow. When you complete your task, your final response must\nbe a comprehensive summary of your actions, presented in a clear, detailed,\nand easy-to-read format. Avoid using markdown tables for presenting data;\nuse plain text formatting instead.\n\n- **Working Directory**: &#96;{working_directory}&#96;. All local file operations must\noccur here, but you can access files from any place in the file system. For all file system operations, you MUST use absolute paths to ensure precision and avoid ambiguity.\nThe current date is {NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.\n\nYour integrated toolkits enable you to:\n\n1. WhatsApp Business Management (WhatsAppToolkit):\n   - Send text and template messages to customers via the WhatsApp Business\n   API.\n   - Retrieve business profile information.\n\n2. Twitter Account Management (TwitterToolkit):\n   - Create tweets with text content, polls, or as quote tweets.\n   - Delete existing tweets.\n   - Retrieve user profile information.\n\n3. LinkedIn Professional Networking (LinkedInToolkit):\n   - Create posts on LinkedIn.\n   - Delete existing posts.\n   - Retrieve authenticated user's profile information.\n\n4. Reddit Content Analysis (RedditToolkit):\n   - Collect top posts and comments from specified subreddits.\n   - Perform sentiment analysis on Reddit comments.\n   - Track keyword discussions across multiple subreddits.\n\n5. Notion Workspace Management (NotionToolkit):\n   - List all pages and users in a Notion workspace.\n   - Retrieve and extract text content from Notion blocks.\n\n6. Slack Workspace Interaction (SlackToolkit):\n   - Create new Slack channels (public or private).\n   - Join or leave existing channels.\n   - Send and delete messages in channels.\n   - Retrieve channel information and message history.\n\n7. Human Interaction (HumanToolkit):\n   - Ask questions to users and send messages via console.\n\n8. Agent Communication:\n   - Communicate with other agents using messaging tools when collaboration\n   is needed. Use &#96;list_available_agents&#96; to see available team members and\n   &#96;send_message&#96; to coordinate with them, especially when you need content\n   from document agents or research from browser agents.\n\n9. File System Access:\n   - You can use terminal tools to interact with the local file system in\n   your working directory (&#96;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1585,
                "column": 1
              },
              "endPosition": {
                "line": 1586,
                "column": 1
              }
            },
            {
              "startPosition": {
                "line": 1586,
                "column": 1
              },
              "endPosition": {
                "line": 1587,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "@traceroot.trace()",
            "lineNumber": 1585
          },
          {
            "text": "async def social_medium_agent(options: Chat):",
            "lineNumber": 1586,
            "isSignature": true
          },
          {
            "lineNumber": 1618
          },
          {
            "text": "    ]",
            "lineNumber": 1619
          },
          {
            "text": "    # if env(\"EXA_API_KEY\") or options.is_cloud():",
            "lineNumber": 1620
          },
          {
            "text": "    #     tools.append(FunctionTool(SearchToolkit(options.project_id, Agents.social_medium_agent).search_exa))",
            "lineNumber": 1621
          },
          {
            "text": "    return agent_model(",
            "lineNumber": 1622
          },
          {
            "text": "        Agents.social_medium_agent,",
            "lineNumber": 1623
          },
          {
            "text": "        BaseMessage.make_assistant_message(",
            "lineNumber": 1624
          },
          {
            "text": "            role_name=\"Social Medium Agent\",",
            "lineNumber": 1625
          },
          {
            "text": "            content=f\"\"\"",
            "lineNumber": 1626
          },
          {
            "text": "You are a Social Media Management Assistant with comprehensive capabilities",
            "lineNumber": 1627
          },
          {
            "text": "across multiple platforms. You MUST use the &#96;send_message_to_user&#96; tool to",
            "lineNumber": 1628
          },
          {
            "text": "inform the user of every decision and action you take. Your message must",
            "lineNumber": 1629
          },
          {
            "text": "include a short title and a one-sentence description. This is a mandatory",
            "lineNumber": 1630
          },
          {
            "text": "part of your workflow. When you complete your task, your final response must",
            "lineNumber": 1631
          },
          {
            "text": "be a comprehensive summary of your actions, presented in a clear, detailed,",
            "lineNumber": 1632
          },
          {
            "text": "and easy-to-read format. Avoid using markdown tables for presenting data;",
            "lineNumber": 1633
          },
          {
            "text": "use plain text formatting instead.",
            "lineNumber": 1634
          },
          {
            "lineNumber": 1635
          },
          {
            "text": "- **Working Directory**: &#96;{working_directory}&#96;. All local file operations must",
            "lineNumber": 1636
          },
          {
            "text": "occur here, but you can access files from any place in the file system. For all file system operations, you MUST use absolute paths to ensure precision and avoid ambiguity.",
            "lineNumber": 1637
          },
          {
            "text": "The current date is {NOW_STR}(Accurate to the hour). For any date-related tasks, you MUST use this as the current date.",
            "lineNumber": 1638
          },
          {
            "lineNumber": 1639
          },
          {
            "text": "Your integrated toolkits enable you to:",
            "lineNumber": 1640
          },
          {
            "lineNumber": 1641
          },
          {
            "text": "1. WhatsApp Business Management (WhatsAppToolkit):",
            "lineNumber": 1642
          },
          {
            "text": "   - Send text and template messages to customers via the WhatsApp Business",
            "lineNumber": 1643
          },
          {
            "text": "   API.",
            "lineNumber": 1644
          },
          {
            "text": "   - Retrieve business profile information.",
            "lineNumber": 1645
          },
          {
            "lineNumber": 1646
          },
          {
            "text": "2. Twitter Account Management (TwitterToolkit):",
            "lineNumber": 1647
          },
          {
            "text": "   - Create tweets with text content, polls, or as quote tweets.",
            "lineNumber": 1648
          },
          {
            "text": "   - Delete existing tweets.",
            "lineNumber": 1649
          },
          {
            "text": "   - Retrieve user profile information.",
            "lineNumber": 1650
          },
          {
            "lineNumber": 1651
          },
          {
            "text": "3. LinkedIn Professional Networking (LinkedInToolkit):",
            "lineNumber": 1652
          },
          {
            "text": "   - Create posts on LinkedIn.",
            "lineNumber": 1653
          },
          {
            "text": "   - Delete existing posts.",
            "lineNumber": 1654
          },
          {
            "text": "   - Retrieve authenticated user's profile information.",
            "lineNumber": 1655
          },
          {
            "lineNumber": 1656
          },
          {
            "text": "4. Reddit Content Analysis (RedditToolkit):",
            "lineNumber": 1657
          },
          {
            "text": "   - Collect top posts and comments from specified subreddits.",
            "lineNumber": 1658
          },
          {
            "text": "   - Perform sentiment analysis on Reddit comments.",
            "lineNumber": 1659
          },
          {
            "text": "   - Track keyword discussions across multiple subreddits.",
            "lineNumber": 1660
          },
          {
            "lineNumber": 1661
          },
          {
            "text": "5. Notion Workspace Management (NotionToolkit):",
            "lineNumber": 1662
          },
          {
            "text": "   - List all pages and users in a Notion workspace.",
            "lineNumber": 1663
          },
          {
            "text": "   - Retrieve and extract text content from Notion blocks.",
            "lineNumber": 1664
          },
          {
            "lineNumber": 1665
          },
          {
            "text": "6. Slack Workspace Interaction (SlackToolkit):",
            "lineNumber": 1666
          },
          {
            "text": "   - Create new Slack channels (public or private).",
            "lineNumber": 1667
          },
          {
            "text": "   - Join or leave existing channels.",
            "lineNumber": 1668
          },
          {
            "text": "   - Send and delete messages in channels.",
            "lineNumber": 1669
          },
          {
            "text": "   - Retrieve channel information and message history.",
            "lineNumber": 1670
          },
          {
            "lineNumber": 1671
          },
          {
            "text": "7. Human Interaction (HumanToolkit):",
            "lineNumber": 1672
          },
          {
            "text": "   - Ask questions to users and send messages via console.",
            "lineNumber": 1673
          },
          {
            "lineNumber": 1674
          },
          {
            "text": "8. Agent Communication:",
            "lineNumber": 1675
          },
          {
            "text": "   - Communicate with other agents using messaging tools when collaboration",
            "lineNumber": 1676
          },
          {
            "text": "   is needed. Use &#96;list_available_agents&#96; to see available team members and",
            "lineNumber": 1677
          },
          {
            "text": "   &#96;send_message&#96; to coordinate with them, especially when you need content",
            "lineNumber": 1678
          },
          {
            "text": "   from document agents or research from browser agents.",
            "lineNumber": 1679
          },
          {
            "lineNumber": 1680
          },
          {
            "text": "9. File System Access:",
            "lineNumber": 1681
          },
          {
            "text": "   - You can use terminal tools to interact with the local file system in",
            "lineNumber": 1682
          },
          {
            "text": "   your working directory (&#96;",
            "lineNumber": 1683
          }
        ]
      },
      "score": 0.2719484567642212
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\server\\app\\component\\stack_auth.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 57
          }
        },
        "contents": "import asyncio\nimport httpx\nfrom app.component.environment import env_not_empty\nimport jwt\nfrom app.exception.exception import UserException\nfrom app.component import code\n\n\nclass StackAuth:\n    _signing_key_cache = {}\n\n    @staticmethod\n    async def user_id(token: str):\n        header = jwt.get_unverified_header(token)\n        kid = header.get(\"kid\")\n        if not kid:\n            raise jwt.InvalidTokenError(\"Token is missing 'kid' in header\")\n\n        signed = await StackAuth.stack_signing_key(kid)\n        payload = jwt.decode(\n            token,\n            signed.key,\n            algorithms=[\"ES256\"],\n            audience=env_not_empty(\"stack_project_id\"),\n            # issuer=\"https://access-token.jwt-signature.stack-auth.com\",\n        )\n        return payload[\"sub\"]\n\n    @staticmethod\n    async def user_info(token: str):\n        headers = {\n            \"X-Stack-Access-Type\": \"server\",\n            \"X-Stack-Project-Id\": env_not_empty(\"stack_project_id\"),\n            \"X-Stack-Secret-Server-Key\": env_not_empty(\"stack_secret_server_key\"),\n            \"X-Stack-Access-Token\": token,\n        }\n        url = \"https://api.stack-auth.com/api/v1/users/me\"\n        async with httpx.AsyncClient() as client:\n            response = await client.get(url, headers=headers)\n        return response.json()\n\n    @staticmethod\n    async def stack_signing_key(kid: str):\n        if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import asyncio",
            "lineNumber": 1
          },
          {
            "text": "import httpx",
            "lineNumber": 2
          },
          {
            "text": "from app.component.environment import env_not_empty",
            "lineNumber": 3
          },
          {
            "text": "import jwt",
            "lineNumber": 4
          },
          {
            "text": "from app.exception.exception import UserException",
            "lineNumber": 5
          },
          {
            "text": "from app.component import code",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class StackAuth:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "    _signing_key_cache = {}",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 12
          },
          {
            "text": "    async def user_id(token: str):",
            "lineNumber": 13
          },
          {
            "text": "        header = jwt.get_unverified_header(token)",
            "lineNumber": 14
          },
          {
            "text": "        kid = header.get(\"kid\")",
            "lineNumber": 15
          },
          {
            "text": "        if not kid:",
            "lineNumber": 16
          },
          {
            "text": "            raise jwt.InvalidTokenError(\"Token is missing 'kid' in header\")",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "        signed = await StackAuth.stack_signing_key(kid)",
            "lineNumber": 19
          },
          {
            "text": "        payload = jwt.decode(",
            "lineNumber": 20
          },
          {
            "text": "            token,",
            "lineNumber": 21
          },
          {
            "text": "            signed.key,",
            "lineNumber": 22
          },
          {
            "text": "            algorithms=[\"ES256\"],",
            "lineNumber": 23
          },
          {
            "text": "            audience=env_not_empty(\"stack_project_id\"),",
            "lineNumber": 24
          },
          {
            "text": "            # issuer=\"https://access-token.jwt-signature.stack-auth.com\",",
            "lineNumber": 25
          },
          {
            "text": "        )",
            "lineNumber": 26
          },
          {
            "text": "        return payload[\"sub\"]",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 29
          },
          {
            "text": "    async def user_info(token: str):",
            "lineNumber": 30
          },
          {
            "text": "        headers = {",
            "lineNumber": 31
          },
          {
            "text": "            \"X-Stack-Access-Type\": \"server\",",
            "lineNumber": 32
          },
          {
            "text": "            \"X-Stack-Project-Id\": env_not_empty(\"stack_project_id\"),",
            "lineNumber": 33
          },
          {
            "text": "            \"X-Stack-Secret-Server-Key\": env_not_empty(\"stack_secret_server_key\"),",
            "lineNumber": 34
          },
          {
            "text": "            \"X-Stack-Access-Token\": token,",
            "lineNumber": 35
          },
          {
            "text": "        }",
            "lineNumber": 36
          },
          {
            "text": "        url = \"https://api.stack-auth.com/api/v1/users/me\"",
            "lineNumber": 37
          },
          {
            "text": "        async with httpx.AsyncClient() as client:",
            "lineNumber": 38
          },
          {
            "text": "            response = await client.get(url, headers=headers)",
            "lineNumber": 39
          },
          {
            "text": "        return response.json()",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 42
          },
          {
            "text": "    async def stack_signing_key(kid: str):",
            "lineNumber": 43
          },
          {
            "text": "        if",
            "lineNumber": 44
          }
        ]
      },
      "score": 0.27122366428375244
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\backend\\app\\utils\\toolkit\\notion_toolkit.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 27,
            "column": 21
          }
        },
        "contents": "from typing import List\nfrom camel.toolkits import NotionToolkit as BaseNotionToolkit\nfrom camel.toolkits.function_tool import FunctionTool\nfrom app.component.environment import env\nfrom app.service.task import Agents\nfrom app.utils.listen.toolkit_listen import auto_listen_toolkit\nfrom app.utils.toolkit.abstract_toolkit import AbstractToolkit\n\n\n@auto_listen_toolkit(BaseNotionToolkit)\nclass NotionToolkit(BaseNotionToolkit, AbstractToolkit):\n    agent_name: str = Agents.document_agent\n\n    def __init__(\n        self,\n        api_task_id: str,\n        notion_token: str | None = None,\n        timeout: float | None = None,\n    ) -&gt; None:\n        super().__init__(notion_token, timeout)\n        self.api_task_id = api_task_id\n\n    @classmethod\n    def get_can_use_tools(cls, api_task_id: str) -&gt; List[FunctionTool]:\n        if env(\"NOTION_TOKEN\"):\n            return NotionToolkit(api_task_id).get_tools()\n        else:\n            return []",
        "signatures": {},
        "detailedLines": [
          {
            "text": "from typing import List",
            "lineNumber": 1
          },
          {
            "text": "from camel.toolkits import NotionToolkit as BaseNotionToolkit",
            "lineNumber": 2
          },
          {
            "text": "from camel.toolkits.function_tool import FunctionTool",
            "lineNumber": 3
          },
          {
            "text": "from app.component.environment import env",
            "lineNumber": 4
          },
          {
            "text": "from app.service.task import Agents",
            "lineNumber": 5
          },
          {
            "text": "from app.utils.listen.toolkit_listen import auto_listen_toolkit",
            "lineNumber": 6
          },
          {
            "text": "from app.utils.toolkit.abstract_toolkit import AbstractToolkit",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "@auto_listen_toolkit(BaseNotionToolkit)",
            "lineNumber": 10
          },
          {
            "text": "class NotionToolkit(BaseNotionToolkit, AbstractToolkit):",
            "lineNumber": 11,
            "isSignature": true
          },
          {
            "text": "    agent_name: str = Agents.document_agent",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "    def __init__(",
            "lineNumber": 14
          },
          {
            "text": "        self,",
            "lineNumber": 15
          },
          {
            "text": "        api_task_id: str,",
            "lineNumber": 16
          },
          {
            "text": "        notion_token: str | None = None,",
            "lineNumber": 17
          },
          {
            "text": "        timeout: float | None = None,",
            "lineNumber": 18
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 19
          },
          {
            "text": "        super().__init__(notion_token, timeout)",
            "lineNumber": 20
          },
          {
            "text": "        self.api_task_id = api_task_id",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "    @classmethod",
            "lineNumber": 23
          },
          {
            "text": "    def get_can_use_tools(cls, api_task_id: str) -&gt; List[FunctionTool]:",
            "lineNumber": 24
          },
          {
            "text": "        if env(\"NOTION_TOKEN\"):",
            "lineNumber": 25
          },
          {
            "text": "            return NotionToolkit(api_task_id).get_tools()",
            "lineNumber": 26
          },
          {
            "text": "        else:",
            "lineNumber": 27
          },
          {
            "text": "            return []",
            "lineNumber": 28,
            "isSignature": true
          }
        ]
      },
      "score": 0.2681451439857483
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: backend/app/component/environment.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "SLACK_BOT_TOKEN|SLACK_USER_TOKEN",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "SLACK_BOT_TOKEN|SLACK_USER_TOKEN",
    "outputMode": "content",
    "workspaceResults": {
      "d:\\_Code\\_GitHub\\eigent-260119": {
        "content": {
          "matches": [
            {
              "file": ".\\server\\app\\model\\config\\config.py",
              "matches": [
                {
                  "lineNumber": 43,
                  "content": "            \"env_vars\": [\"SLACK_BOT_TOKEN\"],"
                }
              ]
            },
            {
              "file": ".\\backend\\app\\utils\\toolkit\\slack_toolkit.py",
              "matches": [
                {
                  "lineNumber": 22,
                  "content": "        logger.debug(f\"slack===={env('SLACK_BOT_TOKEN')}\")"
                },
                {
                  "lineNumber": 23,
                  "content": "        if env(\"SLACK_BOT_TOKEN\") or env(\"SLACK_USER_TOKEN\"):"
                }
              ]
            }
          ],
          "totalLines": 3,
          "totalMatchedLines": 3
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

